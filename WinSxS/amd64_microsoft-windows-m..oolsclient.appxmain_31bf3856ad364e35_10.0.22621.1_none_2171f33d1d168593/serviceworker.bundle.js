!function(e){function t(t){for(var i,n,a=t[0],c=t[1],l=t[2],h=0,p=[];h<a.length;h++){n=a[h];s[n]&&p.push(s[n][0]);s[n]=0}for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);d&&d(t);for(;p.length;)p.shift()();o.push.apply(o,l||[]);return r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],i=!0,n=1;n<r.length;n++){var c=r[n];0!==s[c]&&(i=!1)}if(i){o.splice(t--,1);e=a(a.s=r[0])}}return e}var i={},s={7:0},o=[];function n(e){return a.p+""+({2:"serviceWorkerSelfTest"}[e]||e)+".bundle.js"}function a(t){if(i[t])return i[t].exports;var r=i[t]={i:t,l:!1,exports:{}};e[t].call(r.exports,r,r.exports,a);r.l=!0;return r.exports}a.e=function(e){var t=[],r=s[e];if(0!==r)if(r)t.push(r[2]);else{var i=new Promise(function(t,i){r=s[e]=[t,i]});t.push(r[2]=i);var o=document.getElementsByTagName("head")[0],c=document.createElement("script");c.charset="utf-8";c.timeout=120;a.nc&&c.setAttribute("nonce",a.nc);c.src=n(e);var l=setTimeout(function(){h({type:"timeout",target:c})},12e4);c.onerror=c.onload=h;function h(t){c.onerror=c.onload=null;clearTimeout(l);var r=s[e];if(0!==r){if(r){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,n=new Error("Loading chunk "+e+" failed.\n("+i+": "+o+")");n.type=i;n.request=o;r[1](n)}s[e]=void 0}}o.appendChild(c)}return Promise.all(t)};a.m=e;a.c=i;a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})};a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})};a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};a.d(t,"a",t);return t};a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};a.p="";a.oe=function(e){console.error(e);throw e};var c=window.webpackJsonp=window.webpackJsonp||[],l=c.push.bind(c);c.push=t;c=c.slice();for(var h=0;h<c.length;h++)t(c[h]);var d=l;o.push([200,4]);r()}({117:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i;!function(e){e[e.starting=0]="starting";e[e.running=1]="running";e[e.stopping=2]="stopping";e[e.stopped=3]="stopped"}(i||(i={}))},127:function(e,t,r){"use strict";r.d(t,"a",function(){return o});var i=r(38),s=r(12);class o{constructor(e,t){this._serviceWorkerManager=e;this._origin=t;this._id=i.a.NextModelId++;this.registerServiceWorkerEvents()}get id(){return this._id}get modelName(){return o.ModelName}get displayName(){return s.a.createShortenedUrlText(this._origin)}get origin(){return this._origin}getAttachParams(e,t){return this._serviceWorkerManager.getServiceWorkerAttachParams(this._origin,e,t)}notifySelftestExecutionStateChanged(){this._serviceWorkerManager.testEventObject.fireEvent("serviceWorkerExecutionStateChanged")}unregister(e){return this._serviceWorkerManager.unregisterServiceWorker(e,this._origin)}update(e){return this._serviceWorkerManager.updateServiceWorker(e,this._origin)}simulatePushNotification(e,t){return this._serviceWorkerManager.serviceWorkerSimulatePushNotification(e,t,this._origin)}start(e,t){return this._serviceWorkerManager.startServiceWorker(this.origin,e,t)}stop(e,t){return this._serviceWorkerManager.stopServiceWorker(this.origin,e,t)}refresh(){return this._serviceWorkerManager.retrieveServiceWorkerRegistrations(this._origin)}registerServiceWorkerEvents(){return this._serviceWorkerManager.registerServiceWorkerEvents(this._origin)}}o.ModelName="serviceWorker"},200:function(e,t,r){"use strict";r.r(t);var i=r(70),s=r(84),o=r(5),n=r(15),a=r(61),c=r(45),l=r(76),h=r(13),d=r(51),p=r(0),u=r(10),v=r(42),g=r(6),m=r(27),_=r(59),k=r(114);class S{static setAlertMessage(e){if(!S.announcer){const e=document.getElementById(S.ARIA_ALERT_ZONE_ID);e&&(S.announcer=new k.a(e))}S.announcer&&S.announcer.setAlertMessage(e)}}S.ARIA_ALERT_ZONE_ID="serviceWorkerAriaAlertZone";var W=r(4),E=r(108),C=r(69),w=r(35),f=r(64),R=r(162),I=r(38),y=r(12);class b extends R.a{static createWithoutModel(e,t="filesNode"){const r=new b(null);r._modelId=I.a.NextModelId++;r._staticDisplayName=e;r._previousDisplayName=e;r.iconCssClass=t;r.toolTip=e;return r}static tooltipForModel(e){return void 0===e.tooltip?e.displayName:e.tooltip}constructor(e){super(null,!1,!1,!1,null,"listview-grid-cell-clicksection");if(e){this._model=e;this._modelId=e.id;this._previousDisplayName=this._model.displayName;this.toolTip=b.tooltipForModel(e);this.iconCssClass=e.modelName}this._sortedChildren=[]}get model(){return this._model}get searchName(){return this.displayName}get displayName(){return this.model?this._previousDisplayName:this._staticDisplayName}get modelId(){return this._modelId}get hasChildren(){return this.childCount>0}get isRootItem(){return!0}get parent(){return this._parent}get level(){if(void 0===this._level){this._level=1;let e=this.parent;for(;e;){this._level++;e=e.parent}}return this._level}get htmlLines(){this._htmlLines||(this._htmlLines=this.generateHtmlLines());return this._htmlLines}get children(){return this.dynamicDocumentsNode&&this.dynamicDocumentsNode.hasChildren?this._sortedChildren.concat([this.dynamicDocumentsNode]):this._sortedChildren}get childCount(){return this.dynamicDocumentsNode&&this.dynamicDocumentsNode.hasChildren?this._sortedChildren.length+1:this._sortedChildren.length}overrideIconCssClass(e){this.iconCssClass=e}addChild(e){if(y.a.isNumber(e.modelId)){const t=this.getIndexOfChild(e);if(t<this._sortedChildren.length&&e===this._sortedChildren[t])W.a.fail("Adding a child ResourcePickerItem that is already in the parent");else{this._sortedChildren.splice(t,0,e);e._parent=this}}}removeChild(e){if(y.a.isNumber(e.modelId)){const t=this.getIndexOfChild(e);t<this._sortedChildren.length&&e===this._sortedChildren[t]&&this._sortedChildren.splice(t,1)}}refresh(){this._htmlLines=null}generateHtmlLines(){const e=f.a.escapeHtml(f.a.replaceSpacesWithNonBreakingSpaceEntities(this.toolTip));return[`<div role='menuitem'>\n                <div class='listview-grid-cell-clicksection resourcePickerItem ${this.iconCssClass}'></div>\n                <span\n                    class='listview-grid-cell-clicksection\n                    fileItem' data-frontendId='${this.modelId}'\n                    data-plugin-vs-tooltip='${e}'\n                >${this.getEditPendingIndicator()+f.a.replaceLineBreaksWithNonBreakingSpaceEntities(f.a.escapeHtml(this.displayName))}</span>\n            </div>\n            <span style='display: none'>${this.getAdditionalAriaText()}</span>`]}getIndexOfChild(e){if(0===this._sortedChildren.length)return 0;let t,r,i=0,s=this._sortedChildren.length-1;for(;i<=s;){t=Math.floor((i+s)/2);const o=this._sortedChildren[t];0===(r=y.a.naturalSort(e.displayName,o.displayName))&&(r=e.modelId-o.modelId);if(0===r)return t;r>0?i=t+1:s=t-1}return r>0?t+1:t}updateChildDisplayName(e){this.removeChild(e);e.toolTip=b.tooltipForModel(e.model);e._previousDisplayName=e.model.displayName;this.addChild(e)}getAdditionalAriaText(){return""}getEditPendingIndicator(){return""}}class M{constructor(e,t){this._container=e;this._container.setAttribute("disabled","true");this._testEventObject=new C.a;this._serviceWorkerShell=t;const r=this._serviceWorkerShell.serviceWorkerManager&&this._serviceWorkerShell.serviceWorkerManager.resourceViewController;r&&(this._onSelectCallback=((e,t)=>{r.open(e,{activation:t})}));this._resourceItemsMap=new Map;this._rootNodesMap=new Map;this._resourceRootNodes=new Map;this._expandedItemMap=new Map;this._scalingFactor=screen.deviceXDPI/screen.logicalXDPI;this._splitter=document.createElement("div");this._splitter.classList.add("splitter");this._splitter.style.display="none";this._fileListContainer=document.createElement("div");this._fileListContainer.classList.add("fileListContainer");this._fileListContainer.id="fileListContainer";e.appendChild(this._fileListContainer);e.appendChild(this._splitter);this._treeView=new E.a(this._fileListContainer,e=>this.onListViewToggle(e),void 0,void 0,(e,t,r,i)=>{if(0===i){if(!e.model||e.model.preventOpen)return;this._onSelectCallback(e.model,1)}});this._treeView.scrollPadding=100;this._treeView.notifyToggleCallback=(()=>{this._finalWidth=0});this._treeView.postRenderCallback=(()=>{this._fileListContainer.classList.remove("refresh")});document.addEventListener("keydown",e=>this.onKeyDown(e));window.addEventListener("resize",e=>{this.isOpen&&this.calcFilePickerSize(e)});this.setupSplitter()}get testEventObject(){return this._testEventObject}get isOpen(){return this._isOpen}get rootNodes(){return this._rootNodesMap}get resourceNodes(){return this._resourceRootNodes}get scaledInnerPadding(){return this._scalingFactor*M.INNER_PADDING}resourceAdded(e,t){const r=this._resourceRootNodes.get(e.modelName);if(r){const t=new b(e);r.addChild(t);this.insertAtSortedPosition(t,r)}this._testEventObject.fireEvent("resourcePickerResourceAdded",{model:e,couldHaveExistingChildren:t})}resourceRemoved(e){if(this._resourceItemsMap.has(e.id)){const t=this._resourceItemsMap.get(e.id);this._resourceItemsMap.delete(e.id);this._rootNodesMap.delete(e.id);const r=this._resourceRootNodes.get(e.modelName);r&&r.removeChild(t);this._treeView.removeItem(t,!1,!1)}this._testEventObject.fireEvent("filePickerResourceRemoved",{model:e})}resourceOpened(e,t){const r=this._resourceItemsMap.get(e.id);r&&this._treeView.selectItem(r);this._treeView.refresh()}resourceClosed(e){}showPicker(){if(this._isOpen)return;this.drawResourcePicker();this._container.removeAttribute("disabled");this._container.style.display="block";this._container.style.zIndex="1000";this._isOpen=!0;this.repopulateTree();this.refreshViewWithCallback();const e=this._treeView.getItemAt(0);this._lastSelectedItem?this._treeView.selectItem(this._lastSelectedItem,!1):e&&this._treeView.selectItem(e,!1);document.addEventListener("focusout",this._focusOutListener,!0);document.addEventListener("click",this._documentClickListener,!0);document.addEventListener("keydown",this._documentKeydownListener,!0)}drawResourcePicker(){""!==this._container.style.width&&""!==this._fileListContainer.style.width||this.calcFilePickerSize(null);this._serviceWorkerShell.serviceworkerContentContainer.style.paddingLeft="calc("+this._container.style.width+" + 3px)";this._container.classList.add("pinnedResourcePicker");this._splitter.style.display="block";this._splitter.classList.add("splitter");this._splitter.style.marginLeft="calc("+this._fileListContainer.style.width+" + 1px)";this.invokeShellLayouts()}getAllItems(){const e=[];for(const t of this._resourceItemsMap.values())e.push(t);return e}remeasureTreeView(){this._treeView.remeasure()}refreshTreeView(){this._treeView.refresh()}getSelectedItem(){return this._treeView.getSelectedItem()}setSelectedItem(e){const t=this._resourceItemsMap.get(e.id);if(t){this._treeView.selectItem(t,!0);return!0}return!1}addResourceRoot(e,t,r){const i=b.createWithoutModel(t,r);this._rootNodesMap.set(i.modelId,i);this.insertAtSortedPosition(i);this._resourceRootNodes.set(e,i);return i}addRootResourceNode(e){const t=new b(e);this._rootNodesMap.set(t.modelId,t);this.insertAtSortedPosition(t)}getResourceItemCount(){return this._resourceItemsMap.size}onKeyDown(e){const t=e.target;let r=!1,i=0;const s=!e.shiftKey&&!e.ctrlKey&&!e.altKey;let o=!0,n=!0;if(t&&t.classList.contains("listview-grid-row-selected"))if(13!==e.keyCode&&32!==e.keyCode||!s)38===e.keyCode&&s&&(r=!0);else{const e=this._treeView.getSelectedItem()||this._treeView.getItemAt(0);o=!1;n=!1;e&&(i=e.modelId);r=!0}if(r){if(i){const e=this._resourceItemsMap.get(i);if(e&&e.model&&!e.model.preventOpen){n&&this._treeView.selectItem(e,o);const t=o?1:2;this._onSelectCallback(e.model,t)}}e.stopImmediatePropagation();e.preventDefault();return!1}return!0}onListViewToggle(e){e.hasChildren&&this._treeView.addItems(e.children,e,!1,!1)}refreshViewWithCallback(){this._fileListContainer.classList.add("refresh");this._treeView.refresh()}insertAtSortedPosition(e,t){let r=!1;const i=e.modelId;this._resourceItemsMap.get(i)&&this._treeView.removeItem(this._resourceItemsMap.get(i),!1,!1);this._resourceItemsMap.set(i,e);if(this.isOpen)if(t){if(this._treeView.getIndex(t)>=0)if(this._treeView.isItemExpanded(t)){const i=t.children,s=i.length;let o=t.getIndexOfChild(e);if(o<s&&e===i[o]){o++;for(;o<s&&!(this._treeView.getIndex(i[o])>=0);)o++;if(o<s){this._treeView.addItems([e],i[o],!0,!0,!0);r=!0}}else W.a.fail("Expected to find the given fileItem in it's parent");r||this._treeView.addItems([e],t,!1,!0)}else if(1===t.childCount){this._treeView.addItems([e],t,!1,!0);t.model||this._treeView.setRowState(this._treeView.getIndex(t),E.a.EXPAND_ROW)}}else this._treeView.addItems([e],null,!1,!0)}repopulateTree(){const e=[];for(const t of this._rootNodesMap.values())e.push(t);this._treeView.addItems(e,null,!1,!0);for(const t of e)this.repopulateChildren(t)}repopulateChildren(e){if(e.hasChildren){this._treeView.addItems(e.children,e,!1,!0);if(this._expandedItemMap.get(e.modelId))for(const t of e.children)this.repopulateChildren(t)}}calcFilePickerSize(e){const t=document.getElementById("leftBlock").getBoundingClientRect(),r=this._fileListContainer.getBoundingClientRect(),i=t.right-M.MIN_WIDTH;let s=e&&e.clientX?e.clientX:M.MIN_WIDTH;0===s?M.MIN_WIDTH>=i?s=M.MIN_WIDTH:M.MIN_WIDTH<i&&(s=Math.max(M.MIN_WIDTH,Math.min(r.right,i))):s<M.MIN_WIDTH?s=M.MIN_WIDTH:s>i&&(s=Math.max(i,M.MIN_WIDTH));this._serviceWorkerShell.serviceworkerContentContainer.style.paddingLeft=`calc(${s}px + 3px)`;this._fileListContainer.style.width=`${s-this.scaledInnerPadding}px`;this._container.style.width=`${s}px`;this._finalWidth=s;this._splitter.style.marginLeft=`calc(${this._fileListContainer.style.width} + 1px)`;this.invokeShellLayouts()}setupSplitter(){let e=!1;const t=document.getElementById("resizePane");this._splitter.addEventListener("mousedown",()=>{if(!e){document.body.classList.add("splitterEW");const r=()=>{Object(h.E)(M.SERVICEWORKER_RESOURCEPICKER_WIDTH_REG_KEY,this._fileListContainer.style.width);document.removeEventListener("mousemove",i,!0);document.removeEventListener("mouseup",r,!0);t.classList.remove("showResizePane");document.body.classList.remove("splitterEW");e=!1},i=Object(w.b)(e=>{e.buttons?this.calcFilePickerSize(e):r()});this._splitter.focus();document.addEventListener("mousemove",i,!0);document.addEventListener("mouseup",r,!0);t.classList.add("showResizePane");e=!0}});const r=Object(h.r)(M.SERVICEWORKER_RESOURCEPICKER_WIDTH_REG_KEY);if(r){this._finalWidth=parseFloat(r);!isNaN(this._finalWidth)&&this._finalWidth>=M.MIN_WIDTH?this._fileListContainer.style.width=r:this._fileListContainer.style.width=M.MIN_WIDTH+"px"}}invokeShellLayouts(){this._serviceWorkerShell.layoutDocumentWindows()}}M.MIN_WIDTH=250;M.INNER_PADDING=2;M.SERVICEWORKER_RESOURCEPICKER_WIDTH_REG_KEY="ServiceWorkerFilePickerWidth";class O{constructor(){this._rpcMapPorts=new Map;this._eventQueue=[];this._serviceWorkerManagerReady=new Promise(e=>{this._setserviceWorkerManagerReady=e});this.jsonDiagOMRpcMethodCall=this.jsonDiagOMRpcMethodCallImpl;o.b.addEventListener("attach",this.onAttach.bind(this));o.b.addEventListener("detach",this.onDetach.bind(this))}get isConnected(){return!!this._rpc}onServiceWorkerLoadComplete(e){this._setserviceWorkerManagerReady&&this._setserviceWorkerManagerReady(e);o.b.isAttached&&this.onAttach()}jsonDiagOMRpcMethodCallImpl(e,t){return m.callRemote(O.PORT_NAME,e,t)}getServiceWorkerAttachParams(e,t,r){return this.jsonDiagOMRpcMethodCall("getServiceWorkerAttachParams",[e,t,r])}async retrieveServiceWorkerRegistrations(e){const t=await this.jsonDiagOMRpcMethodCall("retrieveServiceWorkerRegistrations",[e]);t.map(e=>{e.installTime=new Date(e.installTime);e.registrationTime=new Date(e.registrationTime)});return t}retrieveServiceWorkerRegistration(e,t){return this.jsonDiagOMRpcMethodCall("retrieveServiceWorkerRegistration",[e,t])}unregisterServiceWorker(e,t){return this.jsonDiagOMRpcMethodCall("unregisterServiceWorker",[e,t])}updateServiceWorker(e,t){return this.jsonDiagOMRpcMethodCall("updateServiceWorker",[e,t])}registerServiceWorkerEvents(e){return this.jsonDiagOMRpcMethodCall("registerServiceWorkerEvents",[e])}serviceWorkerSimulatePushNotification(e,t,r){return this.jsonDiagOMRpcMethodCall("serviceWorkerSimulatePushNotification",[e,t,r])}startServiceWorker(e,t,r){return this.jsonDiagOMRpcMethodCall("startServiceWorker",[e,t,r])}stopServiceWorker(e,t,r){return this.jsonDiagOMRpcMethodCall("stopServiceWorker",[e,t,r])}jsonDiagOMRpcNotificationReceive(e,t){this.queueEvent(e,t)}queueEvent(e,t){this._eventQueue.push({event:e,params:t});this.processQueue()}processQueue(){if(!this._eventQueueCurrentItem&&this._eventQueue.length){this._eventQueueCurrentItem=this._eventQueue.shift();if(this._eventQueueCurrentItem){let e;const t=()=>{this._eventQueueCurrentItem=void 0;this.processQueue()};(e=this.jsonDiagOMRpcNotificationReceiveImpl(this._eventQueueCurrentItem.event,this._eventQueueCurrentItem.params)).then(t,t)}}}jsonDiagOMRpcNotificationReceiveImpl(e,t){switch(e){case"serviceWorkerUpdate":W.a.areEqual(0,t.length);return this._serviceWorkerManagerReady.then(e=>e.onServiceWorkerUpdate());case"serviceWorkerExecutionStateChanged":W.a.areEqual(0,t.length);return this._serviceWorkerManagerReady.then(e=>e.onServiceWorkerExecutionStateChanged());default:W.a.failDebugOnly(`Unknown serviceworker message ${e}`);return Promise.resolve()}}onAttach(){this._serviceWorkerManagerReady.then(e=>e.onConnect());m.loadScripts(O.SCRIPTS,O.PORT_NAME)}onDetach(){this._rpc=void 0;this._rpcMapPorts.clear();this._serviceWorkerManagerReady.then(e=>e.onDetached())}}O.SCRIPTS=["../serviceworker/remote/serviceWorkerRemote.bundle.js"];O.PORT_NAME="serviceWorkerDiagPort";var N=r(17),P=r(66),T=r(2),L=r(60);class D{}D.SERVICE_WORKERS_OPENED="ServiceWorkersOpened";D.SERVICE_WORKER_SIMULATE_PUSH="ServiceWorkerSimulatePush";D.SERVICE_WORKER_UNREGISTERED="ServiceWorkerUnregistered";D.SERVICE_WORKER_CHECK_FOR_UPDATE="ServiceWorkerCheckForUpdate";D.SERVICE_WORKER_INSPECT_WITH_INBOX="ServiceWorkerInspectWithInbox";D.SERVICE_WORKER_INSPECT_WITH_STORE="ServiceWorkerInspectWithStore";D.SERVICE_WORKER_STARTED="ServiceWorkerStarted";D.SERVICE_WORKER_STOPPED="ServiceWorkerStopped";const j=new L.a("ServiceWorker");var x=r(1),A=r(7),V=r(117);const U=Object(A.css)({display:"inline-flex",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"}),K=Object(A.css)({cursor:"default",display:"inline-block",flex:1,float:"right",fontWeight:"bold",lineHeight:"2em",msUserSelect:"none",textAlign:"right"}),H=Object(A.css)({marginLeft:"10px"});class F extends x.PureComponent{constructor(){super(...arguments);this.handleKeypressInspect=(e=>{13!==e.keyCode&&32!==e.keyCode||this.props.viewModel.attachToServiceWorker(this.props.scope,this.props.version,this.props.debugId,this.props.scriptUrl)});this.handleClickInspect=(()=>{this.props.viewModel.attachToServiceWorker(this.props.scope,this.props.version,this.props.debugId,this.props.scriptUrl)});this.handleKeypressStartStop=(e=>{13!==e.keyCode&&32!==e.keyCode||("Start"===this.props.startStop?this.props.viewModel.start(this.props.scope,this.props.version):this.props.viewModel.stop(this.props.scope,this.props.version))});this.handleClickStartStop=(()=>{"Start"===this.props.startStop?this.props.viewModel.start(this.props.scope,this.props.version):this.props.viewModel.stop(this.props.scope,this.props.version)})}render(){return x.createElement("div",{className:"serviceWorkerRow serviceWorker"},x.createElement("div",Object.assign({},U),x.createElement("div",{className:"serviceworkerLabel"}),x.createElement("span",Object.assign({className:"serviceWorkerScriptName"},U),this.props.scriptName),x.createElement("div",Object.assign({},K),x.createElement("a",Object.assign({className:"inspectServiceWorker",onClick:this.handleClickInspect,onKeyPress:this.handleKeypressInspect,tabIndex:1},H),Object(p.b)("InspectServiceWorker")))),x.createElement("div",Object.assign({},U),x.createElement("label",null,Object(p.b)("ServiceWorkerStatusLabel")),this.props.status,x.createElement("div",Object.assign({},K),x.createElement("a",Object.assign({className:"startStopServiceWorker",onClick:this.handleClickStartStop,onKeyPress:this.handleKeypressStartStop,tabIndex:1},H),this.props.startStop))),x.createElement("div",Object.assign({},U),x.createElement("label",null,Object(p.b)("ServiceWorkerVersionLabel")),x.createElement("span",{className:"serviceWorkerVersionValue"},this.props.version)))}}const z=Object(A.css)({display:"inline-block",lineHeight:"2em",verticalAlign:"top"}),$=Object(A.css)({color:"#ABABAC",display:"inline-block",fontStyle:"italic",lineHeight:"2em",verticalAlign:"top"});class B extends x.Component{constructor(e){super(e);this.handlePush=(()=>{this.props.viewModel.simulatePushNotification(this.props.scope)});this.handleKeyPressPush=(e=>{13!==e.keyCode&&32!==e.keyCode||this.handlePush()});this.handleUnregister=(()=>{this.props.viewModel.unregister(this.props.scope)});this.handleKeyPressUnregister=(e=>{13!==e.keyCode&&32!==e.keyCode||this.handleUnregister()});this.handleUpdate=(()=>{this.setState(()=>({waitingForUpdate:!0}));this.props.viewModel.update(this.props.scope).then(()=>{this.setState(()=>({waitingForUpdate:!1}))})});this.handleKeyPressUpdate=(e=>{13!==e.keyCode&&32!==e.keyCode||this.handleUpdate()});this.renderClients=(()=>{const e=this.props.clients.map((e,t)=>x.createElement("div",{className:"serviceWorkerClientRow",key:t},e));return x.createElement("div",{className:"serviceWorkerClients"},e)});this.renderServiceWorker=(e=>x.createElement(F,{debugId:e.debugId,scope:this.props.scope,scriptName:this.getScriptNameFromURL(e.scriptURL),scriptUrl:e.scriptURL,startStop:this.getStartStop(V.a[e.status]),status:this.getStatusMessageElement(e.state,V.a[e.status]),version:e.version,viewModel:this.props.viewModel}));this.renderServiceWorkers=(()=>{const e=[];this.props.active&&e.push(this.renderServiceWorker(this.props.active));this.props.installing&&e.push(this.renderServiceWorker(this.props.installing));this.props.waiting&&e.push(this.renderServiceWorker(this.props.waiting));return x.createElement("div",{className:"serviceWorkerRow serviceWorkers"},e)});this.state={waitingForUpdate:!1}}render(){const e=`serviceWorkerRegistration${this.props.index}`;return x.createElement("div",{className:"serviceWorkerRegistration",id:e},x.createElement("div",{className:"serviceWorkerFirstRow"},x.createElement("span",{className:"serviceWorkerScope"},x.createElement("span",null,Object(p.b)("ServiceWorkerScopeLabel"),": "),x.createElement("span",{className:"serviceWorkerScopeValue"},this.props.scope),x.createElement("div",Object.assign({},K),x.createElement("a",Object.assign({className:"pushServiceWorker",onClick:this.handlePush,onKeyPress:this.handleKeyPressPush,tabIndex:1},H),Object(p.b)("PushServiceWorker")),x.createElement("a",Object.assign({className:"unregisterServiceWorker",onClick:this.handleUnregister,onKeyPress:this.handleKeyPressUnregister,tabIndex:1},H),Object(p.b)("UnregisterServiceWorker"))))),x.createElement("div",{className:"serviceWorkerRegistrationBody"},x.createElement("div",{className:"serviceWorkerDataRow"},x.createElement("label",null,Object(p.b)("RegisteredOn")),x.createElement("span",{className:"serviceWorkerRegistrationDateValue flex"},this.props.registeredOn)),x.createElement("div",{className:"serviceWorkerDataRow"},x.createElement("label",Object.assign({},this.state.waitingForUpdate?$:z),Object(p.b)("InstalledOn")),x.createElement("span",Object.assign({className:"serviceWorkerLastUpdateDateValue flex"},this.state.waitingForUpdate?$:z),this.props.installedOn),x.createElement("div",Object.assign({},K),x.createElement("a",Object.assign({className:"updateServiceWorker",onClick:this.handleUpdate,onKeyPress:this.handleKeyPressUpdate,tabIndex:1},H),Object(p.b)("UpdateServiceWorker")))),x.createElement("div",{className:"serviceWorkerDataRow"},x.createElement("label",null,Object(p.b)("ServiceWorkerClientsLabel")),this.renderClients()),this.renderServiceWorkers()))}getLocalizationNameForStatus(e){return`${e.charAt(0).toUpperCase()}${e.substring(1)}`}getScriptNameFromURL(e){let t=e.split("/");return(t=t[t.length-1].split("\\"))[t.length-1]}getStartStop(e){return"stopped"===e||"stopping"===e?Object(p.b)("StartServiceWorker"):Object(p.b)("StopServiceWorker")}getStatusMessageElement(e,t){const r=Object(p.b)(`ServiceWorker${this.getLocalizationNameForStatus(e)}`),i=Object(p.b)(`ServiceWorker${this.getLocalizationNameForStatus(t)}`),s=Object(p.b)("ServiceWorkerStatusText",`<b>${r}</b>`,`<b>${i}</b>`);return x.createElement("span",Object.assign({className:"flex"},U,{dangerouslySetInnerHTML:{__html:`<span>${s}</span>`}}))}}const Q=Object(A.css)({fontSize:"14px",fontWeight:"bold"}),G=Object(A.css)({minWidth:600,msUserSelect:"text",paddingRight:"22px"}),q=Object(A.css)({marginLeft:"42px",marginTop:"14px"});class X extends x.PureComponent{render(){return x.createElement("div",Object.assign({className:"serviceWorkerContainer"},G),x.createElement("div",{className:"serviceWorkerSection"},x.createElement("h1",Object.assign({className:"serviceWorkerHeader"},Q),Object(p.b)("ServiceWorkerOverview"))),x.createElement("div",{className:"serviceWorkerDivider"}),this.renderRegistrations())}renderRegistrations(){if(this.props.registrations.length>0){const e=this.props.registrations.map((e,t)=>x.createElement(B,{clients:e.clientUrls,index:t,installedOn:e.installTime.toLocaleString(),key:e.scope,registeredOn:e.registrationTime.toLocaleString(),scope:e.scope,viewModel:this.props.viewModel,active:e.active,installing:e.installing,waiting:e.waiting}));return x.createElement("div",{className:"serviceWorkerSection serviceWorkerRegistrations"},e)}return x.createElement("div",Object.assign({},q),Object(p.b)("NoServiceWorkersFound"))}}class Y{constructor(e){this._titleProperty=new n.a;this._view=e;this._serviceWorkerRegistrations=[]}get title(){return this._titleProperty}get view(){return this._view}async loadModel(e){if(e!==this._model){this._model=e;this._titleProperty.invoke(this._model.displayName);this.registerServiceWorkerEvents()}return this.refresh()}async refresh(){j.logPerformance({id:"ServiceWorker_LoadServiceWorkers_Start"});if(this._model){try{this._serviceWorkerRegistrations=await this._model.refresh()}catch(e){this._serviceWorkerRegistrations=[]}this.doLayout();j.logPerformance({id:"ServiceWorker_LoadServiceWorkers_Stop"})}}registerServiceWorkerEvents(){this._model.registerServiceWorkerEvents()}render(){P.render(x.createElement(X,{registrations:this._serviceWorkerRegistrations,viewModel:this}),this._view.rootElement)}doLayout(){this.render();return this._view}async onServiceWorkerExecutionStateChanged(){await this.refresh();this._model.notifySelftestExecutionStateChanged();const e=this._waitingForSWRunning.scope,t=this._waitingForSWRunning.version,r=this._waitingForSWRunning.debugId,i=this._waitingForSWRunning.script;this._waitingForSWRunning=void 0;this.attachToServiceWorkerEdge(e,t,r,i)}async onServiceWorkerUpdate(){this.render()}async update(e){j.logExecuteCommand(D.SERVICE_WORKER_CHECK_FOR_UPDATE,T.c.Ui);j.logPerformance({id:"ServiceWorker_CheckForUpdate_Start"});const t=await this._model.update(e);j.logPerformance({id:"ServiceWorker_CheckForUpdate_Stop"});return t}async unregister(e){j.logExecuteCommand(D.SERVICE_WORKER_UNREGISTERED,T.c.Ui);j.logPerformance({id:"ServiceWorker_Unregister_Start"});const t=await this._model.unregister(e);await this.refresh();j.logPerformance({id:"ServiceWorker_Unregister_Stop"});return t}async simulatePushNotification(e){j.logExecuteCommand(D.SERVICE_WORKER_SIMULATE_PUSH,T.c.Ui);j.logPerformance({id:"ServiceWorker_SimulatePush_Start"});const t=await this._model.simulatePushNotification(Object(p.b)("TestPushMessage"),e);j.logPerformance({id:"ServiceWorker_SimulatePush_Stop"});return t}async start(e,t){j.logExecuteCommand(D.SERVICE_WORKER_STARTED,T.c.Ui);j.logPerformance({id:"ServiceWorker_WorkerStart_Start"});await this._model.start(e,t);j.logPerformance({id:"ServiceWorker_WorkerStart_Stop"})}async stop(e,t){j.logExecuteCommand(D.SERVICE_WORKER_STOPPED,T.c.Ui);j.logPerformance({id:"ServiceWorker_WorkerStop_Start"});await this._model.stop(e,t);j.logPerformance({id:"ServiceWorker_WorkerStop_Stop"})}async attachToServiceWorker(e,t,r,i){if(o.b.isWinRTHost){j.logExecuteCommand(D.SERVICE_WORKER_INSPECT_WITH_STORE,T.c.Ui);const r=await this._model.getAttachParams(e,t);o.b.attachWithPidAndHwnd(r.pid,r.hwnd)}else{j.logExecuteCommand(D.SERVICE_WORKER_INSPECT_WITH_INBOX,T.c.Ui);await this.attachToServiceWorkerEdge(e,t,r,i)}}async attachToServiceWorkerEdge(e,t,r,i){const s=this.getRunningStatus(e,t);if(s===V.a.starting)this._waitingForSWRunning={scope:e,version:t,debugId:r,script:i};else if(s===V.a.stopping||s===V.a.stopped){this.start(e,t);this._waitingForSWRunning={scope:e,version:t,debugId:r,script:i}}else s===V.a.running&&Object(h.d)(e,`{${t}}`,`{${r}}`,i)}getRunningStatus(e,t){const r=this._serviceWorkerRegistrations.find(t=>t.scope===e);return r.active.version===t?r.active.status:r.installing.version===t?r.installing.status:r.waiting.version===t?r.waiting.status:void 0}}class Z{async open(e,t,r){this.init();e.viewModel=this._viewModel;j.logExecuteCommand(D.SERVICE_WORKERS_OPENED,T.c.NotSpecified);await this._viewModel.loadModel(e);await this.doLayout();return this._view}close(e,t){P.unmountComponentAtNode(this._view.rootElement)}doLayout(){this._view=this._viewModel.doLayout()}onServiceWorkerUpdate(){this._viewModel.onServiceWorkerUpdate()}onServiceWorkerExecutionStateChanged(){this._viewModel.onServiceWorkerExecutionStateChanged()}get wasRecentlyEditing(){return!1}clearRecentlyEditingState(){}init(){if(!this._initialized){this._view=new I.a(document.createElement("div"));this._view.rootElement.setAttribute("class","serviceWorkerShell");this._viewModel=new Y(this._view);this._initialized=!0}}}var J=r(127),ee=r(148);class te{constructor(e){this._targets=new Map;this._resourceViewController=e.resourceViewController;this._serviceWorkerManager=e;this._originCount=new ee.a(e=>{const t=new J.a(this._serviceWorkerManager,e);this._resourceViewController.resourceAdded(t);e===this._topFrameOrigin&&this._resourceViewController.open(t);return t},e=>{this._resourceViewController.resourceRemoved(e)})}onMessage(e,t){const r=t[0];switch(e){case"Handshake":const t={href:r.contextInfo,origin:r.origin,targetId:"0",targetType:"_top"};this.onClearTargets();this.onTargetCreated(t);break;case"ClearTargets":this.onClearTargets();break;case"TargetCreated":this.onTargetCreated(r);break;case"TargetClosed":this.onTargetClosed(r);break;case"TargetUpdated":this.onTargetUpdated(r)}}onTargetCreated(e){this._targets.set(e.targetId,e);this.targetAdded(e)}onTargetClosed(e){this._targets.delete(e.targetId);this.targetRemoved(e)}onTargetUpdated(e){const t=this._targets.get(e.targetId);this._targets.set(e.targetId,e);t&&this.targetRemoved(t);this.targetAdded(e)}onClearTargets(){this._targets.forEach(e=>{this.targetRemoved(e)});this._targets.clear()}targetAdded(e){if(!e||!e.origin)return;"_top"===e.targetType&&(this._topFrameOrigin=e.origin);const t=e.origin;this._originCount.increment(t)}targetRemoved(e){if(!e||!e.origin)return;const t=e.origin;this._originCount.decrement(t)}}class re{constructor(e){this._resources=new Set;this._resourceVC=e}removeAll(){this._removingAll=!0;this._resources.forEach(e=>{this._resourceVC.resourceRemoved(e)});this._resources=new Set;this._removingAll=!1}resourceAdded(e){this._removingAll||this._resources.add(e)}resourceRemoved(e){this._removingAll||this._resources.delete(e)}}class ie{constructor(e,t){this.initializedSelfTest=!1;this.rpcClient=Object(u.g)();this.serviceWorkerShell=t;this._rpcWrapper=e;this._testEventObject=new C.a;this.resourceViewController=new I.a(document.getElementById("resourcesView"),null,!0,!1);this.targetManager=new te(this);this._resourceTable=new re(this.resourceViewController);this.rpcClient.listen("notificationFromRemote|ms:serviceworker",e=>{const{event:t,params:r}=e;this._rpcWrapper.jsonDiagOMRpcNotificationReceive(t,r)});this.rpcClient.listen("targetsUpdatedNotification",e=>{const{event:t,params:r}=e;this.targetManager.onMessage(t,r)});this._serviceWorkerHandler=new Z;this.resourceViewController.registerHandler(J.a.ModelName,this._serviceWorkerHandler);this.resourceViewController.registerListener(this._resourceTable);this.registerPluginMethodHandlers()}get isAttached(){return this._rpcWrapper.isConnected}get testEventObject(){return this._testEventObject}get isServiceWorkerToolReady(){return this._serviceWorkerToolLaunched}onDetached(){this._serviceWorkerToolLaunched=!1;this._resourceTable.removeAll()}registerPluginMethodHandlers(){window.setImmediate(()=>{Object(h.A)(g.c.serviceworker)})}onConnect(){this.initializeOnConnectionSuccess()}getServiceWorkerAttachParams(e,t,r){return this._rpcWrapper.getServiceWorkerAttachParams(e,t,r)}unregisterServiceWorker(e,t){return this._rpcWrapper.unregisterServiceWorker(e,t)}updateServiceWorker(e,t){return this._rpcWrapper.updateServiceWorker(e,t)}serviceWorkerSimulatePushNotification(e,t,r){return this._rpcWrapper.serviceWorkerSimulatePushNotification(e,t,r)}startServiceWorker(e,t,r){return this._rpcWrapper.startServiceWorker(e,t,r)}stopServiceWorker(e,t,r){return this._rpcWrapper.stopServiceWorker(e,t,r)}retrieveServiceWorkerRegistrations(e){return this._rpcWrapper.retrieveServiceWorkerRegistrations(e)}retrieveServiceWorkerRegistration(e,t){return this._rpcWrapper.retrieveServiceWorkerRegistration(e,t)}onServiceWorkerUpdate(){this._serviceWorkerHandler.onServiceWorkerUpdate()}onServiceWorkerExecutionStateChanged(){this._serviceWorkerHandler.onServiceWorkerExecutionStateChanged()}registerServiceWorkerEvents(e){return this._rpcWrapper.registerServiceWorkerEvents(e)}async initializeSelfTest(){if(v.b()&&!this.initializedSelfTest){this.initializedSelfTest=!0;(await r.e(2).then(r.bind(null,241))).init(this.serviceWorkerShell)}}onAttachFailed(){return N.a}initializeOnConnectionSuccess(){this._serviceWorkerToolLaunched=!0;this.testEventObject.fireEvent("serviceWorkerTabLaunched")}}const se=Object(d.a)(),oe=matchMedia("(max-width: 680px) and (min-width: 1px)");class ne{constructor(){this.propertyChanged=new n.a;this._traceWriter=new l.a;window.addEventListener("load",()=>{Object(u.g)().call("ms:host","postPendingMessageToPlugin",[g.c.serviceworker]);this._traceWriter=new l.b});this._serviceWorkerContent=document.getElementById("serviceWorkerContent");this._serviceWorkerContentContainer=document.getElementById("serviceworkerContentContainer");o.b.addEventListener("activated",()=>{this.layoutErrorDisplay(!0)});document.querySelector("#root").setAttribute("aria-label",Object(p.b)("ServiceWorkerLabel"));c.a.registerFocusHandlers(g.c.serviceworker)}static showErrorDisplay(e,t=[],r=0,i=""){ne.LastErrorDisplayId=e;const s=Object(p.b)(e,t);se.show(s,r,i)}static closeErrorDisplay(e){e===ne.LastErrorDisplayId&&se.close()}get resourcePicker(){return this._resourcePicker}get serviceWorkerManager(){return this._serviceWorkerManager}get traceWriter(){return this._traceWriter}get serviceworkerContentContainer(){return this._serviceWorkerContentContainer}set serviceworkerContentContainer(e){this._serviceWorkerContentContainer=e}initializeUI(){const e=new O;this._serviceWorkerManager=new ie(e,this);this._resourcePicker=new M(document.getElementById("resourcePickerMenu"),this);this._serviceWorkerManager.resourceViewController.registerListener(this._resourcePicker);setTimeout(()=>{e.onServiceWorkerLoadComplete(this._serviceWorkerManager)},0);document.addEventListener("keydown",this.onKeyDown.bind(this));oe.addListener(()=>{this._serviceWorkerContent.style.msGridRows="";this._serviceWorkerContent.style.msGridColumns="";this.layoutDocumentWindows()});h.w&&this._resourcePicker.addResourceRoot(J.a.ModelName,Object(p.b)("ServiceWorkerLabel"),"serviceWorker");this.resourcePicker.showPicker();Object(a.a)();window.requestAnimationFrame(()=>{_.markToolReady(g.c.serviceworker);m.startPreload(g.c.serviceworker);v.b()&&this._serviceWorkerManager.initializeSelfTest()})}layoutDocumentWindows(){this._serviceWorkerManager.resourceViewController.doLayout();this.layoutErrorDisplay(!1)}tryNarratorAnnounce(e){S.setAlertMessage(e)}layoutErrorDisplay(e){se.isShown&&se.resize(e)}onKeyDown(e){let t=!1;if(e.ctrlKey&&!e.altKey&&!e.shiftKey&&115===e.keyCode){this._serviceWorkerManager.resourceViewController.closeCurrent(!1);t=!0}if(t){e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();return!1}return!0}}Object(s.a)();document.addEventListener("DOMContentLoaded",async()=>{await Object(i.a)();const e=new ne;window.serviceWorkerShellForTestContractsOnly=e;e.initializeUI()})}});
