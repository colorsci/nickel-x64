var Common;!function(e){!function(e){!function(t){"use strict";class r extends e.StateMachine{parse(e){this._raw=e;this._nodeStack=[];this._skipTrivia=!0;this._tokenizer=new t.HtmlTokenizer(this._raw);this.read();var r=this.createNode(0);r.nodeName="#document";this._currentDocument=r;this._currentNode=r;this.refreshCurrentNode();this.pushState(this.stateParseDocument);this.run();return this._currentDocument}pushNode(e){this._nodeStack.push(this._currentNode);this._currentNode=e;this.refreshCurrentNode()}popNode(e){var t=this._currentNode;this._currentNode=this._nodeStack.pop();e||this.refreshCurrentNode();return t}refreshCurrentNode(){var e,t;if(this._currentNode)if(0===this._currentNode.kind)e=this._currentNode;else if(4===this._currentNode.kind){t=this._currentNode;e=this._currentNode}this._currentElement=t;this._currentContainer=e}skipUntil(e){for(;18!==this._currentToken.kind&&this._currentToken.kind!==e;)this.read()}createNode(e){var t=Object.create?Object.create(null):{};t.kind=e;0!==e&&4!==e||(t.childNodes=[]);4===e&&(t.attributes=[]);return t}read(){for(;;){if(this._eofToken)return this._eofToken;var e,t=this._tokenizer.next();e=t.done?{kind:18,pos:this._raw.length,end:this._raw.length}:t.value;if(!this._skipTrivia||17!==e.kind){18===e.kind&&(this._eofToken=e);this._currentToken=e;return e}}}stateParseDocument(){this.pushState(this.stateParseDocument);switch(this._currentToken.kind){case 18:this.stop();break;case 6:this.pushState(this.stateParseDocumentType);break;case 4:this.pushState(this.stateParseProcessingInstruction);break;case 0:this.pushState(this.stateParseComment);break;case 2:this.pushState(this.stateParseCharacterData);break;case 8:this.pushState(this.stateBeginParseStartElement);break;case 9:this.pushState(this.stateParseEndElement);break;case 16:this.pushState(this.stateParseText);break;case 17:default:this.read()}}stateParseDocumentType(){var e=this.createNode(1);e.nodeName="doctype";e.parentNode=this._currentNode;if(6===this._currentToken.kind){e.openToken=this._currentToken;this.read()}if(16===this._currentToken.kind){e.content=this._currentToken;this.read()}if(7===this._currentToken.kind){e.closeToken=this._currentToken;this.read()}this.appendChild(e)}stateParseProcessingInstruction(){var e=this.createNode(2);if(4===this._currentToken.kind){e.openToken=this._currentToken;this.read()}if(10===this._currentToken.kind){e.name=this._currentToken;e.nodeName=this.getNodeName(this._currentToken);this.read()}if(16===this._currentToken.kind){e.content=this._currentToken;this.read()}if(5===this._currentToken.kind){e.closeToken=this._currentToken;this.read()}this.appendChild(e)}stateParseComment(){var e=this.createNode(3);e.nodeName="#comment";if(0===this._currentToken.kind){e.openToken=this._currentToken;this.read()}if(16===this._currentToken.kind){e.content=this._currentToken;this.read()}if(1===this._currentToken.kind){e.closeToken=this._currentToken;this.read()}this.appendChild(e)}stateParseCharacterData(){var e=this.createNode(7);e.nodeName="#text";if(2===this._currentToken.kind){e.openToken=this._currentToken;this.read()}if(16===this._currentToken.kind){e.text=this._currentToken;this.read()}if(3===this._currentToken.kind){e.closeToken=this._currentToken;this.read()}this.appendChild(e)}stateParseText(){var e=this.createNode(6);e.nodeName="#text";if(16===this._currentToken.kind){e.text=this._currentToken;this.read()}this.appendChild(e)}stateBeginParseStartElement(){var e=this.createNode(4);if(8===this._currentToken.kind){e.startTagOpenToken=this._currentToken;this.read()}if(10===this._currentToken.kind){e.startTagName=this._currentToken;e.nodeName=this.getNodeName(this._currentToken);"script"===e.nodeName&&(this._inScriptElement=!0);this.read()}this._currentElement&&("body"===e.nodeName&&this.isDescendantOf("head")?this.popMatchingElement("head"):"li"===this._currentElement.nodeName&&"li"===e.nodeName?this.popNode():"rtc"===this._currentElement.nodeName&&/^(r(b|tc|p))$/i.test(e.nodeName)?this.popNode():"optgroup"===this._currentElement.nodeName&&"optgroup"===e.nodeName?this.popNode():"option"===this._currentElement.nodeName&&/^(opt(group|ion))$/i.test(e.nodeName)?this.popNode():"tr"===this._currentElement.nodeName&&"tr"===e.nodeName?this.popNode():"p"!==this._currentElement.nodeName||t.isPhrasingContent(e.nodeName)?/^(d[td])$/i.test(e.nodeName)&&/^(d[td])$/i.test(this._currentElement.nodeName)?this.popNode():/^(r(b|t|p))$/i.test(this._currentElement.nodeName)&&/^(r(b|tc?|p))$/i.test(e.nodeName)?this.popNode():/^(t(body|foot|head))$/i.test(this._currentElement.nodeName)&&/^(t(body|foot|head))$/i.test(e.nodeName)?this.popNode():/^t[hd]$/i.test(this._currentElement.nodeName)&&/^t[hd]$/i.test(e.nodeName)&&this.popNode():this.popNode());this.appendChild(e);this.pushNode(e);return this.pushStates(this.stateParseTagAttributes,this.stateEndParseStartElement)}stateEndParseStartElement(){var e=this._currentElement;if(15===this._currentToken.kind){e.startTagSlashToken=this._currentToken;this.read()}if(11===this._currentToken.kind){e.startTagCloseToken=this._currentToken;this.read()}t.isVoidTag(e.nodeName)&&this.popNode()}stateParseEndElement(){this._inScriptElement=!1;var e,t;if(9===this._currentToken.kind){e=this._currentToken;this.read()}if(10===this._currentToken.kind){var r=this.getNodeName(this._currentToken);if(!(t=this.popMatchingElement(r))){(t=this.createNode(4)).nodeName=r;this.appendChild(t)}t.endTagOpenToken=e;t.endTagName=this._currentToken;this.read()}this.skipUntil(11);if(11===this._currentToken.kind||18===this._currentToken.kind){t&&(t.endTagCloseToken=this._currentToken);this.read()}}stateParseTagAttributes(){if(18!==this._currentToken.kind&&11!==this._currentToken.kind&&12===this._currentToken.kind){var e=this.createNode(5);e.name=this._currentToken;e.nodeName=this.getNodeName(this._currentToken);this._currentToken=this.read();if(14===this._currentToken.kind){e.equalsToken=this._currentToken;this._currentToken=this.read();if(13===this._currentToken.kind){e.value=this._currentToken;this.read();if(this._inScriptElement&&e.name.end-e.name.pos==4&&e.value.end-e.value.pos>0){var r=e.name.pos,n=e.name.end-r,i=[84,89,80,69];t.lookahead(this._raw,i,{pos:r,len:n,ignoreCase:!0})&&(this._currentNode.type=this.getAttributeValue(e.value))}}}this.addAttribute(e);return this.pushStates(this.stateParseTagAttributes)}}popMatchingElement(e){var t=this._currentNode;if(this.hasTagName(t,e)){this.popNode();return t}for(var r=this._nodeStack.length-1;r>=0;r--){t=this._nodeStack[r];if(this.hasTagName(t,e)){for(var n=this._nodeStack.length-1;n>=r;n--)this.popNode(!0);this.popNode(!0);this.refreshCurrentNode();return t}}}appendChild(e){this._currentNode.firstChild||(this._currentNode.firstChild=e);if(this._currentNode.lastChild){e.previousSibling=this._currentNode.lastChild;this._currentNode.lastChild.nextSibling=e}e.parentNode=this._currentNode;this._currentNode.lastChild=e;this._currentContainer.childNodes.push(e)}addAttribute(e){var t=this._currentNode;t.firstAttribute||(t.firstAttribute=e);if(t.lastAttribute){e.previousSibling=t.lastAttribute;t.lastAttribute.nextSibling=e}e.parentNode=t;t.lastAttribute=e;t.attributes.push(e)}hasTagName(e,t){return e&&4===e.kind&&e.nodeName===t}getNodeName(e){if(10===e.kind)return this._raw.substring(e.pos,e.end).toLowerCase()}getAttributeValue(e){if(13===e.kind){var t=e.pos,r=e.end,n=this._raw.charCodeAt(t);if(34===n||39===n){t++;this._raw.charCodeAt(r-1)===n&&r--}var i=this._raw.substring(t,r);try{return decodeURIComponent(i)}catch(e){return i}}}isDescendantOf(e){if(this._currentElement.nodeName===e)return!0;for(var t=this._nodeStack.length-1;t>=0;t--){var r=this._nodeStack[t];if(4===r.kind&&r.nodeName===e)return!0}return!1}}t.HtmlParser=r}(e.Html||(e.Html={}))}(e.FormatService||(e.FormatService={}))}(Common||(Common={}));
