var htmlTreeHelpers,Common;!function(e){"use strict";let t;!function(e){e[e.Frame=0]="Frame";e[e.ExtensionContext=1]="ExtensionContext"}(t=e.ExecutionTargetType||(e.ExecutionTargetType={}));class r{constructor(e){this.pendingMessages=[];this.pendingMessagesMap={};this.pendingTimeout=!1;this.port=null;this.portId=0;this.portReady=!1;this.onDetachCallback=null;this.initializeDocumentMaxTries=15;this.initializeDocumentTries=0;this.childrenElementLimit=200;this._messageHandlers=e}static getJMCScriptUrl(e,t=!0){return(t?"\\r\\n":"\r\n")+r.JMC_SCRIPT_URL.replace("{0}",e)}static encounteredException(e){}static addListener(e,t,r,n){n?e.addEventListener(t,r,n):e.addEventListener(t,r)}static addSafeListener(t,n,s,o,i,a){var l=r.createSafeFunction(t,o,a);e.RemoteHelpers.addListener(n,s,l,i);return l}static removeListener(e,t,r,n){n?e.removeEventListener(t,r,n):e.removeEventListener(t,r)}static getDefaultView(e){return e?void 0!==e.defaultView?e.defaultView:e.parentWindow:null}static isElement(e,t){return!(!e||!t)&&("object"==typeof e.Element&&t instanceof e.Element||"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName)}static getEventTarget(e){return e.target}static getComputedStyle(e,t){for(var r,n,s=e.getComputedStyle(t),o={},i=0;i<s.length;i++){r=s[i];n=s.getPropertyValue(r);o[r]=n}o.getPropertyValue=function(e){return this[e]};return o}static getPageOffset(e){var t=r.getDefaultView(e);return{x:t.pageXOffset,y:t.pageYOffset}}static getRuleForStyleObject(e,t){return r.searchStyleSheetForStyleObject(t.ownerDocument.styleSheets,e)}static getRuleForStyleObjectByDocument(e,t){return r.searchStyleSheetForStyleObject(t.styleSheets,e)}static getIsLeftMouseButton(e){return 0===e}static eventHandled(e){e.stopPropagation();e.preventDefault();return!1}static getLeafTextContentPreview(e,t=30){var n;if(e){var s=r.getLeafTextContent(e);if(null!==s&&void 0!==s){var o=!0;if((s=s.trim()).length>t){s=s.substr(0,t)+"…";o=!1}n={isComplete:o,text:s}}}return n}static getLeafTextContentPreviewText(e,t=30){var n,s=r.getLeafTextContentPreview(e,t);s&&(n=s.text);return n}static getLeafTextContent(t){if(t.childNodes){if("IFRAME"===t.tagName)return;if(t.childNodes.length>1)return;if(1===t.childNodes.length){var r=t.childNodes[0];if("IFRAME"===r.tagName||r.childNodes&&r.childNodes.length>0)return}}return e.RemoteHelpers.getTextContent(t)}static isFrameElement(e){return!!e.tagName&&("IFRAME"===e.tagName||"FRAME"===e.tagName||"iframe"===e.localName&&"http://www.w3.org/1999/xhtml"===e.namespaceURI)}static getTextContent(e){return e.nodeType===e.COMMENT_NODE||e.nodeType===e.TEXT_NODE?e.data:e.childNodes&&1===e.childNodes.length&&e.childNodes[0].nodeType===e.TEXT_NODE?e.childNodes[0].data:e.textContent}static setTextContent(e,t){e.textContent=t}static getDocumentTypeNodeText(e){var t="";if(e.nodeType!==e.DOCUMENT_TYPE_NODE)return t;t="<!DOCTYPE "+e.nodeName;if(e.publicId){t+=' PUBLIC "'+e.publicId+'"';e.systemId&&(t+=' "'+e.systemId+'"')}else e.systemId&&(t+=' SYSTEM "'+e.systemId+'"');e.internalSubset&&(t+=" ["+e.internalSubset+"]");return t+=">"}static isCrossSiteWindow(e,t){try{e.Object.getOwnPropertyNames(t)}catch(e){return!0}return!1}static getValidWindow(e,t,n){try{if(dom.isWindow(t)){let s=t;if(r.isCrossSiteWindow(e,t)){let r=dom.getCrossSiteWindow(e,t,n);r&&(s=r.document.defaultView)}if(s.document)return{isValid:!0,window:s.document.defaultView}}}catch(e){}return{isValid:!1,window:null}}static getValidContentWindow(e,t){try{return this.getValidWindow(e,t.contentWindow)}catch(e){return{isValid:!1,window:null}}}static originForWindow(t){return t&&t.location&&t.location.protocol&&t.location.host?e.EncodingUtilities.escapeHtml(t.location.protocol+"//"+t.location.host):null}static createSafeFunction(e,t,n){return r.executeScript("(func) => { return (...args) => func(...args) }",e,!0)(browser.createSafeFunction(e,t,n))}static safeAsyncCall(e,t){let r,n;const s=new Promise((e,t)=>{r=e;n=t});let o=this.createSafeFunction(e,e=>{r(e)}),i=this.createSafeFunction(e,e=>{n(e)});t.then(o,i);return s}static executeScript(e,t,r){return diagnosticsScript.debugEval.bind(t)(e,r)}static getWindowIterator(e){return new n([e],e=>{for(var t=[],n=0;n<e.frames.length;n++){var s=r.getValidWindow(e,e.frames[n]);s.isValid&&t.push(s.window)}return t})}static getStyleSheetIterator(e,t){var r=[e];if(!t)for(var s=0;s<e.imports.length;s++)r.push(e.imports[s]);return new n(r,e=>{if(!t||!e.imports)return null;for(var r=[],n=0;n<e.imports.length;n++)r.push(e.imports[n]);return r})}static refreshBrowser(){try{browser.refresh()}catch(e){}}useTimeout(){return!1}isDiagnosticsOM(){return"undefined"!=typeof browser}isDiagnosticsOMVersionSupported(){return"undefined"!=typeof diagnostics&&"undefined"!=typeof browser&&"undefined"!=typeof emulation&&void 0!==emulation.geoLocation}initialize(t,r,n,o){htmlTreeHelpers=new s;if(browser&&browser.document){var i=e.RemoteHelpers.getDefaultView(browser.document);i&&remoteHelpers.initializeScriptEngines(i)}remoteHelpers._windowShouldHave=n;"undefined"!=typeof browser&&e.RemoteHelpers.addListener(browser,"documentComplete",remoteHelpers.onDocumentComplete);remoteHelpers.onDetachCallback=o;e.RemoteHelpers.addListener(toolUI,"detach",remoteHelpers.onDetach);e.RemoteHelpers.addListener(toolUI,"breakpointhit",remoteHelpers.onBreak);remoteHelpers.portId++;var a=new e.PortThrottler(toolUI.createPort(t+remoteHelpers.portId));a.initialize();remoteHelpers.port=a;if(remoteHelpers.port){remoteHelpers.port.addEventListener("message",remoteHelpers.processMessages);toolUI.connect(remoteHelpers.port);r()}remoteHelpers._handshakeCallback=r}initializeScriptEngines(e){if(e){if(e.document&&e.document.scripts&&0===e.document.scripts.length)try{r.executeScript("",e,!0)}catch(e){}try{if(e.frames)for(var t=0;t<e.frames.length;t++){var n=e.frames[t],s=r.getValidWindow(e,n);s.isValid&&remoteHelpers.initializeScriptEngines(s.window)}}catch(e){}}}onDocumentComplete(t){if(remoteHelpers._windowShouldHave){var n=null;if(t){t.browserOrWindow&&(t=t.browserOrWindow);try{t.document&&(n=t.document)}catch(e){}if(!n)try{t.Document&&(n=t.Document)}catch(e){}var s=e.RemoteHelpers.getDefaultView(n);if(!n||s[remoteHelpers._windowShouldHave])return;try{r.executeScript("",s,!0)}catch(e){}}}}onDetach(){r.uid=0;remoteHelpers.pendingMessages=[];remoteHelpers.pendingMessagesMap={};remoteHelpers.pendingTimeout=!1;remoteHelpers.onDetachCallback&&remoteHelpers.onDetachCallback()}onBreak(){remoteHelpers.postAllMessages()}static getUid(){return"uid"+(r.uid++).toString(36)}processMessages(e){if("InitializeDocument"!==e.data){var t,r=function(e){return function(t,r,n){var s=!n;remoteHelpers.postObject({uid:e,args:[t]},r,s)}};try{t=JSON.parse(e.data)}catch(e){return}for(var n=0;n<t.length;n++){var s=t[n];if(remoteHelpers._messageHandlers[s.command]){for(var o=s.args,i=0;i<o.length;i++)o[i]&&"callback"===o[i].type&&(o[i]=r(o[i].uid));var a=remoteHelpers._messageHandlers[s.command].apply(remoteHelpers,o);if(a&&a.suppressPostObject)continue;remoteHelpers.postObject({uid:s.uid,args:void 0!==a?[a]:a})}}}else remoteHelpers._handshakeCallback()}postObject(e,t,r){t?remoteHelpers.pendingMessagesMap[t]=e:remoteHelpers.pendingMessages.push(e);if(remoteHelpers.useTimeout()&&r){if(!remoteHelpers.pendingTimeout){diagnostics.setTimeout(remoteHelpers.postAllMessages,50);remoteHelpers.pendingTimeout=!0}}else remoteHelpers.postAllMessages()}postAllMessages(){for(var e in remoteHelpers.pendingMessagesMap)remoteHelpers.pendingMessages.push(remoteHelpers.pendingMessagesMap[e]);if(remoteHelpers.pendingMessages.length>0){let e="";try{e=JSON.stringify(remoteHelpers.pendingMessages)}finally{remoteHelpers.pendingMessages=[];remoteHelpers.pendingMessagesMap={};remoteHelpers.pendingTimeout=!1}if(e.length>0)try{remoteHelpers.port.postMessage(e)}catch(e){}}}static unwrapMirrorElement(e){try{return browser.extensionContexts.length?browser.extensionContexts[0].unwrapMirror(e):e}catch(t){return e}}static searchStyleSheetForStyleObject(t,n){for(var s=0;s<t.length;s++){var o=t[s];try{var i,a=o.cssRules?o.cssRules:o.rules;if(a&&(i=r.searchRuleListForStyleObject(a,n)))return i;if(o.imports&&o.imports.length&&(i=r.searchStyleSheetForStyleObject(o.imports,n)))return i}catch(t){e.RemoteHelpers.encounteredException(t)}}}static searchRuleListForStyleObject(e,t){for(var n,s=0;s<e.length;s++)if((n=e[s]).cssRules){if(n=r.searchRuleListForStyleObject(n.cssRules,t))return n}else if(n.style===t)return n}}r.JMC_SCRIPT_URL="//# sourceURL=browsertools://browsertools.{0}.js";r.FailedEventAddCount=0;r.FailedEvents={};r.EventsWhereWeWantToProcessOnCapture={};r.initializeHtmlTreeHelpers=(()=>{htmlTreeHelpers=new e.HtmlTreeHelpers});r.uid=0;e.RemoteHelpers=r;class n{constructor(e,t){this._q=e;this._moreItems=t}hasNext(){return this._q.length>0}next(){if(!this.hasNext())return null;var e=this._q.pop(),t=this._moreItems(e);t&&(this._q=this._q.concat(t));return e}}e.Iterator=n;class s{static isEmptyTextElement(t){if(t.tagName)return!1;var r=e.RemoteHelpers.getLeafTextContent(t);return"string"==typeof r&&!/\S/.test(r)}hasSpecialValueAttribute(e){switch(e.nodeName){case"INPUT":case"FORM":case"SELECT":case"OPTION":case"TEXTAREA":return!0}return!1}isElementAccessible(e){var t=null;try{e.nodeName;t=typeof e}catch(e){return!1}return"object"===t}}e.HtmlTreeHelpers=s;class o{static propertyEvaluationFunction(e,t){var r,n;if(e.location.protocol.indexOf("http")>=0){r=o.HttpObjectWatchList.lastIndexOf(Object.prototype.toString.call(t));n=o.HttpPropertyIgnorelist[r]}else if(e.location.protocol.indexOf("ms-appx")>=0){r=o.FileObjectWatchList.lastIndexOf(Object.prototype.toString.call(t));n=o.FilePropertyIgnorelist[r]}return n?(e,t)=>{if(!(n.lastIndexOf(t)>=0))try{return e[t]}catch(e){return e.toString()}}:(e,t)=>e[t]}}o.HttpObjectWatchList=["[object Window]"];o.HttpPropertyIgnorelist=[["indexedDB","msIndexedDB"]];o.FileObjectWatchList=["[object Window]"];o.FilePropertyIgnorelist=[["clipboardData"]];e.PropertyEvaluationIgnoreList=o;class i{constructor(e){this._global=e;this._name=e.location.hostname+e.location.pathname}get name(){return this._name}get type(){return t.Frame}get global(){return this._global}set global(e){this._global=e}executeScript(e,t){return r.executeScript(e,browser.unwrapMirror(this._global),t)}createSafeFunction(e){return r.createSafeFunction(browser.unwrapMirror(this._global),e,!0)}addSafeListener(e,t,n,s){return r.addSafeListener(browser.unwrapMirror(this._global),e,t,n,s,!0)}}e.FrameExecutionTarget=i;class a{constructor(e){this._extensionContext=e;let t=this._extensionContext.name;const r=t.lastIndexOf("_");r>=0&&(t=t.substr(0,r));this._name=t}get name(){return this._name}get type(){return t.ExtensionContext}get global(){return this._extensionContext.global}get extensionContext(){return this._extensionContext}executeScript(e,t){return r.executeScript(e,browser.unwrapMirror(this._extensionContext.global),t)}createSafeFunction(e){return this._extensionContext.createSafeFunction(browser.unwrapMirror(this.global),e)}addSafeListener(e,t,n,s){var o=this.createSafeFunction(n);r.addListener(e,t,o,s);return o}}e.ExtensionContextTarget=a}(Common||(Common={}));
