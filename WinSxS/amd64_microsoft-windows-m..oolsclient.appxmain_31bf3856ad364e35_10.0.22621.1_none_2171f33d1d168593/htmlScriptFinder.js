var Common;!function(s){!function(s){"use strict";class i{constructor(s){F12.Tools.Utility.Assert.hasValue(s,"Need to set a valid source");this._source=s;this._sourceSpans=null;this._earlyEnd=!1}get sourceSpans(){null===this._sourceSpans&&this.findScriptTags();return this._sourceSpans}static isSupportedScript(s,i){var t=s?s.toLocaleLowerCase():"",e=i?i.toLocaleLowerCase():"";return!t&&!e||"text/javascript"===t||"text/jscript"===t||"application/javascript"===t||"application/x-javascript"===t||"text/ecmascript"===t||"javascript"===e||"jscript"===e||"ecmascript"===e}findScriptTags(){this._index=0;this._sourceSpans=[];this._htmlStart=0;var i=this._source;do{if("<"===i[this._index]){if(this._index+1>=i.length)break;"!"===i[this._index+1]?this._index+3<this._source.length&&"-"===this._source[this._index+2]&&"-"===this._source[this._index+3]?this.parseComment():this.parseTag():"?"===i[this._index+1]?this.parseTag():(i[this._index+1].match(/[a-zA-Z]/)||"_"===i[this._index+1]||"/"===i[this._index+1]&&this._index+2<i.length&&(i[this._index+2].match(/a-zA-Z/)||"_"===i[this._index+2]))&&this.parseTag()}}while(++this._index<i.length);this._earlyEnd||this._sourceSpans.push(new s.SourceSpanBuilder(this._htmlStart,this._source.length-1,!1))}parseComment(){F12.Tools.Utility.Assert.areEqual(this._source[this._index],"<");F12.Tools.Utility.Assert.areEqual(this._source[this._index+1],"!");F12.Tools.Utility.Assert.areEqual(this._source[this._index+2],"-");F12.Tools.Utility.Assert.areEqual(this._source[this._index+3],"-");this._index+=3;for(;++this._index<this._source.length;)if("-"===this._source[this._index]&&this._index+2<this._source.length&&"-"===this._source[this._index+1]&&">"===this._source[this._index+2]){this._index+=2;return}}parseTag(){F12.Tools.Utility.Assert.areEqual(this._source[this._index],"<");var s=!1;this._index+1<this._source.length&&("/"===this._source[this._index+1]||"!"===this._source[this._index+1]||"?"===this._source[this._index+1])&&(s=!0);for(var i,t,e=!1,r=!1,h=!1,n=!1,o="",_="";++this._index<this._source.length;)switch(this._source[this._index]){case">":"/"!==this._source[this._index-1]&&"?"!==this._source[this._index-1]||(s=!0);if(!s&&i&&"script"===i.toLowerCase()){++this._index;this.findScriptEnd(o,_)}return;case'"':t=this.parseQuotedValue('"');e=!1;if(h){o=t;h=!1}if(n){_=t;n=!1}break;case"'":t=this.parseQuotedValue("'");e=!1;if(h){o=t;h=!1}if(n){_=t;n=!1}break;case"=":e=!0;break;default:if(e&&!this._source[this._index].match(/\s/)){t=this.parsePropertyValue();e=!1;if(h){o=t;h=!1}if(n){_=t;n=!1}}else if(this._source[this._index].match(/[a-zA-Z]/)||"_"===this._source[this._index])if(r)"type"===(t=this.parseAttribute()).toLowerCase()?h=!0:"language"!==t.toLowerCase()||h||(n=!0);else{i=this.parseElement();r=!0}}}findScriptEnd(t,e){var r=this._index,h=i.isSupportedScript(t,e),n="</script";do{if("<"===this._source[this._index]&&this._index+n.length<this._source.length&&this._source.substr(this._index,n.length).toLowerCase()===n){this._index-=1;var o=this._index;if(h&&r<o){var _=new s.SourceSpanBuilder(this._htmlStart,r-1,!1);this._sourceSpans.push(_);this._htmlStart=o+1;_=new s.SourceSpanBuilder(r,o,!0);this._sourceSpans.push(_)}break}}while(++this._index<this._source.length);if(this._index===this._source.length&&h){_=new s.SourceSpanBuilder(this._htmlStart,r-1,!1);this._sourceSpans.push(_);_=new s.SourceSpanBuilder(r,this._index-1,!0);this._sourceSpans.push(_);this._earlyEnd=!0}}parseQuotedValue(s){F12.Tools.Utility.Assert.isTrue('"'===s||"'"===s,"Invalid quote type");F12.Tools.Utility.Assert.areEqual(this._source[this._index],s);for(var i="";++this._index<this._source.length;){if(this._source[this._index]===s)return i;"\n"===this._source[this._index]||(i+=this._source[this._index])}F12.Tools.Utility.Assert.fail("Should not be here");return null}parsePropertyValue(){var s="";do{switch(this._source[this._index]){case">":this._index--;return s;default:if(this._source[this._index].match(/\s/)){this._index--;return s}s+=this._source[this._index]}}while(++this._index<this._source.length);F12.Tools.Utility.Assert.fail("Should not be here");return s}parseElement(){F12.Tools.Utility.Assert.isTrue(this._source[this._index].match(/[a-zA-Z_]/),"Non alpha or underscore character");var s="";s+=this._source[this._index];for(;++this._index<this._source.length;)switch(this._source[this._index]){case":":s+=this._source[this._index];break;default:if(!this._source[this._index].match(/[a-zA-Z0-9]/)&&"_"!==this._source[this._index]&&"."!==this._source[this._index]&&"-"!==this._source[this._index]){this._index--;return s}s+=this._source[this._index]}F12.Tools.Utility.Assert.fail("Should not be here");return s}parseAttribute(){F12.Tools.Utility.Assert.isTrue(this._source[this._index].match(/[a-zA-Z_]/),"Non alpha or underscore character");var s="";s+=this._source[this._index];for(;++this._index<this._source.length;)switch(this._source[this._index]){case".":case":":s+=this._source[this._index];break;case"-":case"_":s+=this._source[this._index];break;default:if(!this._source[this._index].match(/[a-zA-Z0-9]/)){this._index--;return s}s+=this._source[this._index]}F12.Tools.Utility.Assert.fail("Should not be here");return s}}s.HTMLScriptFinder=i}(s.FormatService||(s.FormatService={}))}(Common||(Common={}));
