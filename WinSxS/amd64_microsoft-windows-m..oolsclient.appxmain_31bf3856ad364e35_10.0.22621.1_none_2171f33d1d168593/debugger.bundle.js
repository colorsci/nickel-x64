!function(e){function t(t){for(var n,r,a=t[0],l=t[1],d=t[2],c=0,u=[];c<a.length;c++){r=a[c];s[r]&&u.push(s[r][0]);s[r]=0}for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);h&&h(t);for(;u.length;)u.shift()();o.push.apply(o,d||[]);return i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],n=!0,r=1;r<i.length;r++){var l=i[r];0!==s[l]&&(n=!1)}if(n){o.splice(t--,1);e=a(a.s=i[0])}}return e}var n={},s={16:0},o=[];function r(e){return a.p+""+({0:"debuggerSelfTest"}[e]||e)+".bundle.js"}function a(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};e[t].call(i.exports,i,i.exports,a);i.l=!0;return i.exports}a.e=function(e){var t=[],i=s[e];if(0!==i)if(i)t.push(i[2]);else{var n=new Promise(function(t,n){i=s[e]=[t,n]});t.push(i[2]=n);var o=document.getElementsByTagName("head")[0],l=document.createElement("script");l.charset="utf-8";l.timeout=120;a.nc&&l.setAttribute("nonce",a.nc);l.src=r(e);var d=setTimeout(function(){c({type:"timeout",target:l})},12e4);l.onerror=l.onload=c;function c(t){l.onerror=l.onload=null;clearTimeout(d);var i=s[e];if(0!==i){if(i){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,r=new Error("Loading chunk "+e+" failed.\n("+n+": "+o+")");r.type=n;r.request=o;i[1](r)}s[e]=void 0}}o.appendChild(l)}return Promise.all(t)};a.m=e;a.c=n;a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})};a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})};a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};a.d(t,"a",t);return t};a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};a.p="";a.oe=function(e){console.error(e);throw e};var l=window.webpackJsonp=window.webpackJsonp||[],d=l.push.bind(l);l.push=t;l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var h=d;o.push([207,4]);i()}({104:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(38),s=i(16);class o{constructor(e,t={},i,s){this.id=n.a.NextModelId++;this.doc=i;this._debuggerManager=s;this.iframeIndex=[];this._iframeIndexSet=!1;this.runtimeId=e.id;this._parentId=e.parentId;void 0!==e.longDocumentId&&(this.longDocumentId=e.longDocumentId);t.parent?this.parent=t.parent:e.parentId&&s&&s.documentController&&(this.parent=s.documentController.getDocFromRuntimeId(e.parentId));this.parent&&this.setIframeIndex()}getParent(){!this.parent&&this._parentId&&this._debuggerManager.documentController&&(this.parent=this._debuggerManager.documentController.getDocFromRuntimeId(this._parentId));this.parent&&this.parent.sourceMapState===s.a.On&&this.parent.sourceMap&&this.parent.sourceMap.sources&&this.parent.sourceMap.sources.length>0&&(this.parent=this.parent.sourceMap.sources[0]);this.parent&&!this._iframeIndexSet&&this.setIframeIndex();return this.parent}updateParent(e,t){this.parent=e;this.parent&&!this._iframeIndexSet&&this.setIframeIndex();this._parentId=t;this.doc.updateSourcemapSources(e)}makeRuntimeDoc(e,t){this.updateParent(t);this.runtimeId=e.id;void 0!==e.longDocumentId&&(this.longDocumentId=e.longDocumentId);this._debuggerManager.documentController.updateInstance(this.doc,this)}get parent(){return this._parent}set parent(e){if(this._parent!==e){this._parent&&this._parent.removeChildDocInstance(this);this._parent=e;this._parent&&this._parent.addChildDocInstance(this)}}setIframeIndex(){const e=this.doc.mimeType;if(this.isHtmlMimeType(e))if(this.parent){if(this.parent&&this.isHtmlMimeType(this.parent.mimeType)){this.parent.numOfIframesContained+=1;this.parent.rootInstance&&this.parent.rootInstance.iframeIndex.length>0&&(this.iframeIndex=this.parent.rootInstance.iframeIndex);this.iframeIndex.push(this.parent.numOfIframesContained-1)}}else this.iframeIndex=[];else"text/css"!==e&&"text/less"!==e&&"text/scss"!==e&&"text/typescript"!==e&&"text/javascript"!==e||this.parent&&("text/html"===this.parent.mimeType||"text/xml"===this.parent.mimeType)&&this.parent.rootInstance&&(this.iframeIndex=this.parent.rootInstance.iframeIndex);this._iframeIndexSet=!0}isHtmlMimeType(e){return"text/html"===e||"text/xml"===e}get modelName(){return this.doc.modelName}get displayName(){return this.doc.displayName}get toolbarPanelTemplate(){return this.doc.toolbarPanelTemplate}get tooltip(){return this.doc.tooltip}get preventOpen(){return this.doc.preventOpen}}},121:function(e,t,i){"use strict";var n=i(2),s=i(4),o=i(17),r=i(9),a=i(0),l=i(53),d=i(48),c=i(16),h=i(3),u=i(77);var p={collectionsTitle:"Typical Events",collectionsTitleLocId:"EventListTypicalEvents",collections:[{title:"Mouse Events",titleLocId:"EventListMouseEvents",tooltipLocId:"EventListMouseEvents",eventKeys:["click","dblclick","mousedown","mouseup","contextmenu"]},{title:"Keyboard Events",titleLocId:"EventListKeyboardEvents",tooltipLocId:"EventListKeyboardEvents",eventKeys:["keydown","keyup","keypress","input"]},{title:"Pointer Events",titleLocId:"EventListPointerEvents",tooltipLocId:"EventListPointerEvents",eventKeys:["pointerup","pointerdown","contextmenu","click","dblclick"]}],categories:[{title:"Timer",titleLocId:"EventListTimer",tooltipLocId:"EventListTimer",events:[{eventKey:"requestanimationframe"},{eventKey:"setimmediate"},{eventKey:"setinterval"},{eventKey:"settimeout"}]},{title:"Mouse",titleLocId:"EventListMouse",events:[{eventKey:"click"},{eventKey:"dblclick"},{eventKey:"mousedown"},{eventKey:"mouseup"},{eventKey:"mouseover"},{eventKey:"mousemove"},{eventKey:"mouseout"},{eventKey:"mousewheel"},{eventKey:"mouseenter"},{eventKey:"mouseleave"},{eventKey:"contextmenu"}]},{title:"Keyboard",titleLocId:"EventListKeyboard",events:[{eventKey:"keydown"},{eventKey:"keyup"},{eventKey:"keypress"},{eventKey:"input"}]},{title:"Pointer",titleLocId:"EventListPointer",events:[{eventKey:"click"},{eventKey:"dblclick"},{eventKey:"contextmenu"},{eventKey:"pointercancel"},{eventKey:"pointerdown"},{eventKey:"pointerenter"},{eventKey:"pointerleave"},{eventKey:"pointermove"},{eventKey:"pointerout"},{eventKey:"pointerover"},{eventKey:"pointerup"},{eventKey:"gotpointercapture"},{eventKey:"lostpointercapture"},{eventKey:"GotPointerCapture"},{eventKey:"LostPointerCapture"},{eventKey:"TouchStart"},{eventKey:"TouchEnd"},{eventKey:"TouchMove"},{eventKey:"TouchCancel"}]},{title:"Focus",titleLocId:"EventListFocus",events:[{eventKey:"focus"},{eventKey:"focusin"},{eventKey:"focusout"},{eventKey:"blur"}]},{title:"Gamepad",titleLocId:"EventListGamePad",events:[{eventKey:"gamepadconnected"},{eventKey:"gamepaddisconnected"}]},{title:"Misc",titleLocId:"EventListMisc",events:[{eventKey:"help"},{eventKey:"abort"},{eventKey:"afterprint"},{eventKey:"beforeprint"},{eventKey:"emptied"},{eventKey:"ended"},{eventKey:"canplaythrough"},{eventKey:"durationchange"},{eventKey:"loadeddata"},{eventKey:"loadedmetadata"},{eventKey:"loadstart"},{eventKey:"readystatechange"},{eventKey:"transitionstart"},{eventKey:"transitionend"},{eventKey:"animationstart"},{eventKey:"animationiteration"},{eventKey:"animationend"}]},{title:"Window",titleLocId:"EventListWindow",events:[{eventKey:"DOMContentLoaded"},{eventKey:"beforeunload"},{eventKey:"error"},{eventKey:"hashchange"},{eventKey:"load"},{eventKey:"message"},{eventKey:"pagehide"},{eventKey:"pageshow"},{eventKey:"popstate"},{eventKey:"unload"}]},{title:"Control",titleLocId:"EventListControl",events:[{eventKey:"change"},{eventKey:"contextmenu"},{eventKey:"drag"},{eventKey:"dragend"},{eventKey:"dragenter"},{eventKey:"dragleave"},{eventKey:"dragover"},{eventKey:"dragstart"},{eventKey:"drop"},{eventKey:"input"},{eventKey:"reset"},{eventKey:"resize"},{eventKey:"scroll"},{eventKey:"select"},{eventKey:"submit"}]},{title:"Device",titleLocId:"EventListDevice",events:[{eventKey:"devicelight"},{eventKey:"deviceorientation"},{eventKey:"devicemotion"},{eventKey:"OrientationChange"},{eventKey:"MSGestureChange"},{eventKey:"MSGestureTap"},{eventKey:"MSGestureEnd"},{eventKey:"MSGestureHold"},{eventKey:"MSGestureStart"},{eventKey:"MSGestureDoubleTap"},{eventKey:"MSInertiaStart"}]},{title:"Media",titleLocId:"EventListMedia",events:[{eventKey:"canplay"},{eventKey:"canplaythrough"},{eventKey:"durationchange"},{eventKey:"offline"},{eventKey:"online"},{eventKey:"pause"},{eventKey:"play"},{eventKey:"playing"},{eventKey:"progress"},{eventKey:"ratechange"},{eventKey:"seeked"},{eventKey:"seeking"},{eventKey:"stalled"},{eventKey:"storage"},{eventKey:"suspend"},{eventKey:"timeupdate"},{eventKey:"volumechange"},{eventKey:"waiting"}]}]};i.d(t,"a",function(){return g});class g{static loadEventBreakpointDescriptions(e){let t;"string"==typeof e&&(t=e);g.EventBreakpointDescriptions=t?JSON.parse(t):p;g.EventBreakpointLocMap={};for(const e of g.EventBreakpointDescriptions.categories)for(const t of e.events)t.nameLocId&&(g.EventBreakpointLocMap[t.eventKey]=t.nameLocId)}static getStringForEventBreakpointType(e){const t=g.EventBreakpointLocMap[e];return t?Object(a.b)(String(t)):e}constructor(e){this._breakpoints=[];this._listeners=[];this._debuggerManager=e;this._persistenceManager=this._debuggerManager.persistenceManager;this._multipleDocInstancesBrkpointMap=new Map;g.EventBreakpointLocMap={};g.loadEventBreakpointDescriptions()}static get eventBreakpointDescriptions(){return g.EventBreakpointDescriptions}getBreakpoint(e){if(null!==e&&e!==c.b)for(const t of this._breakpoints)if(t.breakpointId===e)return t}getBreakpointAtIndex(e){return e>=0&&e<this._breakpoints.length?this._breakpoints[e]:null}registerListener(e){-1===this._listeners.indexOf(e)&&this._listeners.push(e)}deleteAll(e,t){return Object(h.c)(h.a.DELETE_ALL_BREAKPOINTS_IN_WINDOW,e,()=>{const e=[];for(let i=this._breakpoints.length-1;i>=0;i--)e.push(this.deleteBreakpoint(this._breakpoints[i],h.a.DELETE_ALL_BREAKPOINTS_IN_WINDOW,n.c.Internal,t));return Promise.all(e)})}setEnabledState(e,t){s.a.isFalse(e.isFrozen);h.b.logPerformance({id:r.b.Debugger_BreakpointController_SetEnabledState_Start});return this.setCodeBreakpointEnabledState(e.breakpointId,t).then(i=>{if(i){e.isEnabled=t;this.breakpointChanged(e)}h.b.logPerformance({id:r.b.Debugger_BreakpointController_SetEnabledState_Stop});return i})}setAllEnabledStates(e,t,i){return Object(h.c)(t,i,()=>{h.b.logPerformance({id:r.b.Debugger_BreakpointController_SetAllEnabledStates_Start});const t=[];for(const i of this._breakpoints)i.isFrozen||t.push(this.setEnabledState(i,e));return Promise.all(t).then(()=>{h.b.logPerformance({id:r.b.Debugger_BreakpointController_SetAllEnabledStates_Stop})})})}async setBreakpointCondition(e,t,i=!1){let n,s;if(t){n=t;s=i}else{n="";s=!1}const o=await this.setCodeBreakpointCondition(e.breakpointId,n,s);if(o){e.condition=n;e.isTracepoint=s;this.breakpointChanged(e)}return o}addCodeBreakpoint(e,t,i,n=!1,s=!0){return Object(h.c)(t,i,()=>{const t=e.rawLocation.doc;if(!t)return o.a;const i=[];for(const n of t.instances)i.push(this._debuggerManager.addCodeBreakpoint(n.runtimeId,e));return Promise.all(i).then(e=>{const t=this.afterBreakpointAdded(e[0],n,s),i=[];for(let t=1;t<e.length;t++){const s=this.afterBreakpointAdded(e[t],n,!1,!0);s&&i.push(s)}t&&this._multipleDocInstancesBrkpointMap.set(t,i);return t})})}addEventBreakpoint(e,t,i,n,s){return Object(h.c)(n,s,()=>{const n=this.getExistingEventBreakpoint(e);return n?this.setBreakpointCondition(n,t,i).then(()=>this.setEnabledState(n,!0)).then(()=>this.afterBreakpointAdded(n,i,!1)):this._debuggerManager.addEventBreakpoint(e,!0,t,i,e=>{this.afterBreakpointAdded(e,i,!1)}).then(e=>e.breakpointId)})}addPendingBreakpoints(e){const t=[];for(const i of e)i.eventTypes?this.addPendingEventBreakpoint(i,t):this.addPendingCodeBreakpoint(i)}deleteBreakpoint(e,t,i,n){return Object(h.c)(t,i,()=>{if(this.getIndex(e)>=0){let t;if(n)t=o.a;else{const i=[];i.push(this._debuggerManager.removeBreakpoint(e.breakpointId));const n=this._multipleDocInstancesBrkpointMap.get(e.breakpointId);if(n)for(const e of n)i.push(this._debuggerManager.removeBreakpoint(e));t=Promise.all(i)}return t.then(()=>{if(this.getIndex(e)>=0){this._breakpoints.splice(this.getIndex(e),1);this._persistenceManager.saveDebuggerData();e.cleanUp();for(const t of this._listeners)t.breakpointRemoved(e)}})}return o.a})}resolveBreakpointById(e,t){let i=null;if(u.a.isUnresolvedId(e)&&!u.a.isUnresolvedId(t.breakpointId)&&this.hasBreakpointWithId(t.breakpointId)){const t=this.getBreakpoint(e);if(t){i=t;this.deleteBreakpoint(t,h.a.DELETE_BREAKPOINT_IN_WINDOW,n.c.Internal,!0)}}else for(const n of this._breakpoints)if((i=n).breakpointId===e){i.resolveTo(t);this.breakpointChanged(i,e);break}return i}async addExistingBreakpoints(e){const t=e.doc,i=this.getBreakpoints(t).map(async t=>{const i=this._multipleDocInstancesBrkpointMap.get(t.breakpointId),n=t.location;if(n){const s=await this._debuggerManager.addCodeBreakpoint(e.runtimeId,n,!1,t.condition,t.isTracepoint);i&&!i.includes(s.breakpointId)&&i.push(s.breakpointId);t.isEnabled||await this.setEnabledState(s,!1)}});await Promise.all(i)}async bindRemainingInstancesForBreakpoint(e,t,i){if(!i.location)return;const n=e.instances.map(e=>e.runtimeId).filter(e=>t!==e).map(async e=>{const t=await this._debuggerManager.addCodeBreakpoint(e,i.location,!1,i.condition,i.isTracepoint);i.isEnabled||await this.setEnabledState(t,!1);return t}),s=(await Promise.all(n)).map(e=>e.breakpointId);this._multipleDocInstancesBrkpointMap.set(i.breakpointId,s)}unresolveCodeBreakpoints(e){for(const t of this._breakpoints)if(t.location&&t.location.startPosition&&t.location.startPosition.doc===e){t.isBound=!1;this.breakpointChanged(t)}}unresolveAllBreakpoints(){for(const e of this._breakpoints){e.isBound=!1;this.breakpointChanged(e)}}navigateToBreakpoint(e,t,i){return Object(h.c)(t,i,()=>{if(!e.location||!e.location.startPosition)return o.a;const t={activation:2};if(!e.isFrozen){const i={location:e.location};t.params=i}return this._debuggerManager.resourceViewController.open(e.location.startPosition.doc,t)})}getBreakpointsStartingAtLine(e,t){const i=[];for(const n of this._breakpoints)n.location&&n.location.startPosition&&n.location.startPosition.doc===e&&n.location.startLineNumber===t&&i.push(n);return i}getBreakpointAtLocation(e){return this._debuggerManager.getBreakpointIdFromLocation(e).then(e=>{if(null!==e){const t=this.getBreakpoint(e);return Promise.resolve(t)}return Promise.resolve(null)})}getBreakpoints(e){if(!e)return this._breakpoints;const t=[];for(const i of this._breakpoints)i.location&&i.location.startPosition&&i.location.startPosition.doc===e&&t.push(i);return t}hasBreakpointWithId(e){for(const t of this._breakpoints)if(t.breakpointId===e)return!0;return!1}addOrRemoveBreakpointAtLocation(e){return this.getBreakpointAtLocation(e).then(t=>t?this.deleteBreakpoint(t,h.a.TOGGLE_BREAKPOINT_IN_EDITOR,n.c.Internal):this.addCodeBreakpoint(e,h.a.TOGGLE_BREAKPOINT_IN_EDITOR,n.c.Internal))}addOrRemoveAllBreakpointsAtLocation(e){const t=this.getBreakpointsStartingAtLine(e.startPosition.doc,e.lineNumber);if(t&&t.length>0){const i=[];let s=!1,o=!1;const r=e.startColumn===e.endColumn;for(const a of t){let t=!1;if(a.location){t=e.endColumn>=a.location.startColumn&&(e.startColumn<=a.location.endColumn||a.location.endLineNumber>a.location.startLineNumber);o=1===a.location.startColumn&&1===a.location.endColumn}if(r||t||o){i.push(this.deleteBreakpoint(a,h.a.DELETE_BREAKPOINT_IN_WINDOW,n.c.Internal));s=!0}}if(s)return Promise.all(i)}return this.addCodeBreakpoint(e,h.a.TOGGLE_BREAKPOINT_IN_EDITOR,n.c.Internal)}promptToModifyConditionOrTracepoint(e,t,i){Object(h.c)(t,i,()=>{for(const t of this._listeners)e.isTracepoint?t.tracepointPromptInvoked(e):t.conditionPromptInvoked(e)})}documentUrlChanged(e){const t=this.getBreakpoints(e);for(const e of t)for(const t of this._listeners)t.breakpointChanged(e)}breakpointChanged(e,t){h.b.logPerformance({id:r.b.Debugger_BreakpointController_BreakpointChanged_Start});for(const i of this._listeners)i.breakpointChanged(e,t);this._debuggerManager.testEventObject.fireEvent("breakpointChanged");h.b.logPerformance({id:r.b.Debugger_BreakpointController_BreakpointChanged_Stop})}updateBreakpointLocations(e){const t=this.getBreakpoints(e);for(const e of t){const t=new u.a(e.breakpointId,e.rawLocation,e.eventTypes,e.location,e.url,e.isBound);this.resolveBreakpointById(e.breakpointId,t)}}updateBreakpointAfterSave(e,t){return this.deleteBreakpoint(e,h.a.DELETE_BREAKPOINT_IN_WINDOW,n.c.Internal).then(()=>this.addCodeBreakpoint(t,h.a.TOGGLE_BREAKPOINT_IN_EDITOR,n.c.Internal,e.isTracepoint,!1)).then(t=>{if(t){const i=this.getBreakpoint(t);if(i){const n=[];e.isEnabled||n.push(this.setEnabledState(i,!1));e.condition&&n.push(this.setBreakpointCondition(i,e.condition,e.isTracepoint));return Promise.all(n).then(e=>t)}}return t})}toggleAll(e){return this.setAllEnabledStates(this.areAnyBreakpointsDisabled(),h.a.TOGGLE_ALL_BREAKPOINTS,e)}areAnyBreakpointsDisabled(){const e=this.getBreakpoints();for(const t of e)if(!t.isFrozen&&!t.isEnabled)return!0;return!1}setCodeBreakpointEnabledState(e,t){const i=[];i.push(this._debuggerManager.setBreakpointEnabledState(e,t));const n=this._multipleDocInstancesBrkpointMap.get(e);if(n)for(const e of n)i.push(this._debuggerManager.setBreakpointEnabledState(e,t));return Promise.all(i).then(e=>e.every(e=>e))}setCodeBreakpointCondition(e,t,i){const n=[];n.push(this._debuggerManager.setBreakpointCondition(e,t,i));const s=this._multipleDocInstancesBrkpointMap.get(e);if(s)for(const e of s)n.push(this._debuggerManager.setBreakpointCondition(e,t,i));return Promise.all(n).then(e=>e.every(e=>e))}afterBreakpointAdded(e,t,i=!0,n){if(e){if(-1===this.getIndex(e)){if(!n){this._breakpoints.push(e);if(t){e.isTracepoint=!0;if(i)for(const t of this._listeners)t.tracepointPromptInvoked(e)}for(const t of this._listeners)t.breakpointAdded(e)}this._persistenceManager.saveDebuggerData()}return e.breakpointId}return null}getIndex(e){for(let t=0;t<this._breakpoints.length;t++)if(e.equals(this._breakpoints[t]))return t;return-1}async addPendingCodeBreakpoint(e){const t=await this._debuggerManager.addPendingBreakpoint(e);if(t){const i={id:"pending",isDynamicCode:!1,length:0,mimeType:"text/javascript",url:e.url},n=new d.a(new l.b(i,void 0,this._debuggerManager),e.oneBasedStartLine,e.oneBasedStartColumn),s=new u.a(t,e.rawLocation,null,n,e.displayUrl,!1);this._multipleDocInstancesBrkpointMap.set(t,[]);s.isEnabled=e.isEnabled;s.isTracepoint=e.isTracepoint;s.condition=e.condition;this._breakpoints.push(s);for(const e of this._listeners)e.pendingBreakpointAdded(s)}}addPendingEventBreakpoint(e,t){if(!this.getExistingEventBreakpoint(e.eventTypes,t)){t.push({eventTypes:e.eventTypes});this._debuggerManager.addEventBreakpoint(e.eventTypes,e.isEnabled,e.condition,e.isTracepoint).then(e=>{this._breakpoints.push(e);for(const t of this._listeners)t.breakpointAdded(e)})}}getExistingEventBreakpoint(e,t=this._breakpoints){let i=null;for(const n of t)if(n.eventTypes&&n.eventTypes.length>0&&n.eventTypes.length===e.length){i=n;for(let t=0;t<e.length;t++)if(e[t]!==n.eventTypes[t]){i=null;break}if(i)break}return i}}},122:function(e,t,i){"use strict";var n=i(2),s=i(4),o=i(12);class r{constructor(){this._lastSelectionLength=-1;this._lastCaretPosition=-1;this._timerFunction=(()=>this.timer_elapsed())}get onTextChanged(){return this._onTextChanged}set onTextChanged(e){this._onTextChanged=e}get onCaptureKeyDown(){return this._onCaptureKeyDown}set onCaptureKeyDown(e){this._onCaptureKeyDown=e}get onBlur(){return this._onBlur}set onBlur(e){this._onBlur=e}get onCaretPositionChanged(){return this._onCaretPositionChanged}set onCaretPositionChanged(e){this._onCaretPositionChanged=e}get onSelectionLengthChanged(){return this._onSelectionLengthChanged}set onSelectionLengthChanged(e){this._onSelectionLengthChanged=e}get onMenuRequested(){return this._onMenuRequested}set onMenuRequested(e){this._onMenuRequested=e}get caretPosition(){if(this._editor)try{return this._editor.selectionEnd}catch(e){return-1}return-1}set caretPosition(e){if(this._editor&&o.a.nodeInDocument(this._editor)){var t=this.caretPosition!==e;this._editor.setSelectionRange(e,e);t&&this.fireCaretPositionChanged()}}get selectionLength(){if(this._editor)try{return this._editor.selectionEnd-this._editor.selectionStart}catch(e){return-1}return-1}set selectionLength(e){if(this._editor&&o.a.nodeInDocument(this._editor)){this._editor.setSelectionRange(this._editor.selectionStart,this._editor.selectionStart+e);var t=this._lastSelectionLength!==this.selectionLength;this._lastSelectionLength=this.selectionLength;t&&this.fireSelectionLengthChanged()}}get text(){return this._editor?this._editor.value:null}set text(e){this._editor&&(this._editor.value=e)}getPlacementTarget(e){if(this._editor){if(!this._lastPlacementTarget||this._lastPlacementTargetIndex!==e){this._lastPlacementTarget=o.a.getCharScreenPosition(this._editor,e);this._lastPlacementTargetIndex=e;var t=this._editor.getBoundingClientRect();if(this._lastPlacementTarget.right<t.left||this._lastPlacementTarget.right>t.right||this._lastPlacementTarget.top<t.top||this._lastPlacementTarget.bottom>t.bottom){var i=Math.max(this._lastPlacementTarget.top,t.top),n=Math.min(this._lastPlacementTarget.bottom,t.bottom),s=Math.max(Math.min(this._lastPlacementTarget.right,t.right),t.left);this._lastPlacementTarget={top:i,bottom:n,right:s,left:s,height:n-i,width:0}}}return this._lastPlacementTarget}return null}attach(e){this._editor=r.validateTextEditorElement(e);if(this._editor){this._isAttached=!0;this._inputHandler=(()=>{this.editor_input()});this._editor.addEventListener("input",this._inputHandler);this._blurHandler=(()=>{this.editor_blur()});this._editor.addEventListener("blur",this._blurHandler);this._focusHandler=(()=>{this.editor_focus()});this._editor.addEventListener("focus",this._focusHandler);this._captureKeyDownHandler=(e=>{this.editor_captureKeyDown(e)});this._editor.addEventListener("keydown",this._captureKeyDownHandler,!0);this._editor.setAttribute("aria-autocomplete","list");this._editor.setAttribute("aria-haspopup","true");document.activeElement===this._editor&&this.startTimer();return!0}return!1}detach(){if(this._isAttached){this._isAttached=!1;if(this._editor){this._editor.onselect=null;this._editor.removeEventListener("input",this._inputHandler);this._editor.removeEventListener("blur",this._blurHandler);this._editor.removeEventListener("focus",this._focusHandler);this._editor.removeEventListener("keydown",this._captureKeyDownHandler,!0);this._inputHandler=null;this._blurHandler=null;this._focusHandler=null;this._captureKeyDownHandler=null;this._editor.removeAttribute("aria-autocomplete");this._editor.removeAttribute("aria-haspopup");this._editor=null}this.fireOnBlur()}}insertText(e,t,i){var n=document.queryCommandSupported("ms-beginUndoUnit");n&&document.execCommand("ms-beginUndoUnit");this._editor.value=o.a.replaceTextInRange(this._editor.value,e,t,i);this.caretPosition=e+i.length;n&&document.execCommand("ms-endUndoUnit")}setActiveDescendant(e){e?this._editor.setAttribute("aria-activedescendant",e):this._editor.removeAttribute("aria-activedescendant")}setListBox(e){e?this._editor.setAttribute("aria-controls",e):this._editor.removeAttribute("aria-controls")}focusEditor(){this._editor.focus()}static validateTextEditorElement(e){var t=e,i=t;return void 0===i.selectionStart||void 0===i.selectionEnd||void 0===i.setSelectionRange||void 0===i.value?null:t}startTimer(){if(!this._timerActivated){this._timerId=window.setInterval(this._timerFunction,r.TIMER_INTERVAL);this._timerActivated=!0}}resetTimer(){if(this._timerActivated){this.stopTimer();this.startTimer()}}stopTimer(){if(this._timerActivated){this._timerActivated=!1;window.clearInterval(this._timerId)}}timer_elapsed(){if(this._lastCaretPosition!==this.caretPosition||this._lastSelectionLength!==this.selectionLength||this._lastEditorValue!==this._editor.value){this.stopTimer();if(this._isAttached){if(this._lastEditorValue!==this._editor.value){this.fireTextChanged();this._lastEditorValue=this._editor.value}if(this._lastCaretPosition!==this.caretPosition){this.fireCaretPositionChanged();this._lastCaretPosition=this.caretPosition}if(this._lastSelectionLength!==this.selectionLength){this.fireSelectionLengthChanged();this._lastSelectionLength=this.selectionLength}}this.startTimer()}}editor_input(){this.resetTimer()}editor_captureKeyDown(e){if(32===e.keyCode&&e.ctrlKey){this.fireMenuRequested();e.preventDefault()}else{13!==e.keyCode&&9!==e.keyCode&&27!==e.keyCode||this.timer_elapsed();this._onCaptureKeyDown&&this._onCaptureKeyDown(e)}}editor_blur(){this.fireOnBlur()}editor_focus(){this.startTimer()}fireOnBlur(){this.stopTimer();this._lastPlacementTarget=null;this._onBlur&&this._onBlur()}fireTextChanged(){this._lastPlacementTarget=null;this._onTextChanged&&this._onTextChanged(this._editor.value)}fireCaretPositionChanged(){this._lastPlacementTarget=null;this._onCaretPositionChanged&&this._onCaretPositionChanged(this.caretPosition)}fireSelectionLengthChanged(){this._onSelectionLengthChanged&&this._onSelectionLengthChanged(this.selectionLength)}fireMenuRequested(){this._onMenuRequested&&this._onMenuRequested()}}r.TIMER_INTERVAL=100;var a=i(5);class l{constructor(e,t,i){this._textEditorBridge=e;this._intellisenseMenu=t;this._intellisenseProvider=i;this._isInitialized=!1;this._deactivationHandler=this.uninitialize.bind(this)}get textEditorBridge(){return this._textEditorBridge}get intellisenseMenu(){return this._intellisenseMenu}get intellisenseProvider(){return this._intellisenseProvider}initialize(e){if(!this._isInitialized){this.textEditorBridge.attach(e);this.intellisenseMenu.attach(this.textEditorBridge);this.intellisenseProvider.attach(this);this._isInitialized=!0}}uninitialize(){if(this._isInitialized){this._isInitialized=!1;a.b.removeEventListener("deactivated",this._deactivationHandler);this.intellisenseProvider.detach();this.intellisenseMenu.detach();this.textEditorBridge.detach()}}}var d=i(157);class c{constructor(e,t,i,n,s,o,r,a){this._listBox=new d.b(e,t,i,r);this._listBox.rootElement.style.position="absolute";this._listBox.rootElement.style.display="none";this._isAttached=!1;this._placementTargetIndex=0;this._isDeferringLayout=!1;this._suppressMenu=!1;this._alreadyForcedOpen=!1;this._ignoreCommit=!1;this._willMenuBeOpen=!1;this._maxMenuItems=n||c.MAX_MENU_ITEMS;this._resizeListener=(()=>{this._resizeListenerHasFired=!0;this._windowInnerHeight=window.innerHeight;this._windowInnerWidth=window.innerWidth;this._toolbarOffsetHeight=0;this._listBoxOffsetWidthIsStale=!0;this._listBoxOffsetHeightIsStale=!0;var e=document.getElementById("toolbar");e&&(this._toolbarOffsetHeight=e.offsetHeight)});this._resizeListenerHasFired=!1;window.addEventListener("resize",this._resizeListener);this._autoSuppressMenuEnabled=!!s;this._showAllOptionsWhenNoMatch=a;this._traceProvider=o;this._currentEtwKey=-1}get placementTargetIndex(){return this._placementTargetIndex}set placementTargetIndex(e){this._placementTargetIndex=e;this._lastTextEditorPlacementTarget=null}get currentEtwKey(){return this._currentEtwKey}set currentEtwKey(e){this._currentEtwKey=e;this._listBox.currentEtwKey=e}get isOpen(){return this._isAttached}set isOpen(e){this._willMenuBeOpen=e;if(e!==this.isOpen)if(e&&!this.suppressMenu)this.show();else{this.hide();this._alreadyForcedOpen=!1}}get hasSelection(){return this.isOpen&&!this.isDeferringLayout&&!this._ignoreCommit&&!!this._selectedOption}get currentSelection(){return this._selectedOption}get intellisenseChoices(){return this._listBox?this._options:[]}set intellisenseChoices(e){this._options=e;this._filteredOptions=e;this._selectedOption=null;this.listBoxListItems=null}get filteredIntellisenseChoices(){return this._filteredOptions}get willIntellisenseMenuBeOpen(){return this._willMenuBeOpen}get menuListBox(){return this._listBox}get onClosing(){return this._onClosing}set onClosing(e){this._onClosing=e}get onOpened(){return this._onOpened}set onOpened(e){this._onOpened=e}get onChoiceCommitted(){return this._onChoiceCommitted}set onChoiceCommitted(e){this._onChoiceCommitted=e}get onSelectionChanged(){return this._onSelectionChanged}set onSelectionChanged(e){this._onSelectionChanged=e}get forbiddenBottomLeftRect(){return this._forbiddenBottomLeftRect}set forbiddenBottomLeftRect(e){this._forbiddenBottomLeftRect=e}get suppressMenu(){return this._suppressMenu&&this._autoSuppressMenuEnabled}set suppressMenu(e){this._suppressMenu=e}get isDeferringLayout(){return this._isDeferringLayout}set isDeferringLayout(e){if(e){this.stopDeferredRenderTimer();this.startDeferredRenderTimer()}else this.stopDeferredRenderTimer()}get listBoxListItems(){return this._listBox.listItems}set listBoxListItems(e){this._listBox.listItems=e;this._listBoxOffsetWidthIsStale=!0;this._listBoxOffsetHeightIsStale=!0}get listBoxOffsetWidth(){if(this._listBoxOffsetWidthIsStale){this._listBoxOffsetWidth=this._listBox.rootElement.offsetWidth;this._listBoxOffsetWidthIsStale=!1}return this._listBoxOffsetWidth}get listBoxOffsetHeight(){if(this._listBoxOffsetHeightIsStale){this._listBoxOffsetHeight=this._listBox.rootElement.offsetHeight;this._listBoxOffsetHeightIsStale=!1}return this._listBoxOffsetHeight}forceOpen(){if(this._filteredOptions&&this._filteredOptions.length>0){this.suppressMenu=!1;this.isOpen=!0;this.listBoxListItems=this._filteredOptions;this.isDeferringLayout=!1;this.updateLayout(!this._alreadyForcedOpen);this.updateListBoxSelection();this._alreadyForcedOpen=!0}}attach(e){if(!this._textEditorBridge){document.body.appendChild(this._listBox.rootElement);this._textEditorBridge=e;this._textEditorBridge.onBlur=(()=>this.textEditorBridge_blur())}this._textEditorBridge.setListBox(this._listBox.rootElement.id)}detach(){if(this._textEditorBridge){this.isOpen=!1;this._textEditorBridge.onBlur=null;this._textEditorBridge.setListBox(null);this._textEditorBridge=null;document.body.removeChild(this._listBox.rootElement)}}setFilter(e){this.fireSetFilterStartEvent();this.setSelectedAndFilteredOptions(e);this.fireSetFilterEndEvent();if(this._filteredOptions.length>this._maxMenuItems){this._willMenuBeOpen=!0;this.isDeferringLayout=!0;return this._filteredOptions}if(1===this._filteredOptions.length&&this._selectedOption&&this._selectedOption.text===e){this._willMenuBeOpen=!1;window.setImmediate(()=>this.isOpen=!1);return this._filteredOptions}this._willMenuBeOpen=!0;this.listBoxListItems=this._filteredOptions;this.updateLayout(this.isDeferringLayout);this.isDeferringLayout=!1;this.updateListBoxSelection();return this._filteredOptions}getTextEditorPlacementTarget(e){this._lastTextEditorPlacementTarget&&!e||(this._lastTextEditorPlacementTarget=this._textEditorBridge.getPlacementTarget(this.placementTargetIndex));return this._lastTextEditorPlacementTarget}startDeferredRenderTimer(){if(!this._isDeferringLayout){var e=this.currentEtwKey;this._deferredRenderTimerId=window.setTimeout(()=>this.deferredRenderTimer_elapsed(e),c.DEFERRED_RENDER_TIMER_INTERVAL);this._ignoreCommit=!0;this._isDeferringLayout=!0}}stopDeferredRenderTimer(){if(this._isDeferringLayout){this._ignoreCommit=!1;this._isDeferringLayout=!1;window.clearTimeout(this._deferredRenderTimerId)}}deferredRenderTimer_elapsed(e){this._isDeferringLayout=!1;this.currentEtwKey=e;if(this.isOpen){this.forceOpen();window.setTimeout(()=>this._ignoreCommit=!1,c.DEFERRED_RENDER_TIMER_INTERVAL)}}updateListBoxSelection(){if(this._selectedOption){this._listBox.selectedItem=this._selectedOption;this._listBox.scrollIntoView(this._selectedOption,!1)}else if(this.listBoxListItems.length>0){this._listBox.selectedIndex=-1;this._listBox.scrollIntoView(this.listBoxListItems[0],!1)}}setSelectedAndFilteredOptions(e){if(e&&0!==e.length&&this._options){var t=e.toUpperCase(),i=this._options.filter(e=>-1!==e.optionName.toUpperCase().indexOf(t),this);if(i.length>0){this._filteredOptions=i;var n=this.getMatchingOption(i,e,!0);if(n<0&&(n=this.getMatchingOption(i,e,!1))<0){this._selectedOption=null;return}this._selectedOption=this._filteredOptions[n]}else{this._showAllOptionsWhenNoMatch&&(this._filteredOptions=this._options);this._selectedOption=null}}}getMatchingOption(e,t,i){for(var n=i?t:t.toUpperCase(),s=0;s<e.length;++s){if(0===(i?e[s].optionName:e[s].optionName.toUpperCase()).indexOf(n))return s}return-1}textEditorBridge_blur(){document.activeElement!==this._listBox.rootElement?this.hide():document.activeElement===this._listBox.rootElement&&this._textEditorBridge.focusEditor()}updateLayout(e){if(this.isOpen&&this.listBoxListItems&&0!==this.listBoxListItems.length){this.fireUpdateLayoutStartEvent();this._resizeListenerHasFired||this._resizeListener();var t=this.getTextEditorPlacementTarget(e),i=t.right,n=t.bottom;this._listBox.rootElement.style.display="block";this._listBox.rootElement.style.top="0";this._listBox.rootElement.style.left="0";this._listBox.rootElement.style.width="";this._listBox.rootElement.style.minWidth=c.MIN_MENU_WIDTH+"px";this._listBox.rootElement.style.maxHeight=c.MAX_MENU_HEIGHT+"px";var s=this.listBoxOffsetHeight,o=this.listBoxOffsetWidth,r=0;this._forbiddenBottomLeftRect&&(r=this._forbiddenBottomLeftRect.top-n<s?this._forbiddenBottomLeftRect.width:0);var a=this._windowInnerHeight-n-2;if(t.top>a)if((n=t.top-s)<this._toolbarOffsetHeight){n=Math.max(t.top-c.MAX_MENU_HEIGHT,this._toolbarOffsetHeight);var l=t.top-n;this._listBox.rootElement.style.top=n+"px";this._listBox.rootElement.style.maxHeight=l+"px"}else this._listBox.rootElement.style.top=n+"px";else{this._listBox.rootElement.style.top=n+"px";a<c.MAX_MENU_HEIGHT&&(this._listBox.rootElement.style.maxHeight=a+"px")}if(i+o<this._windowInnerWidth)this._listBox.rootElement.style.left=i+"px";else if(i-o>r)this._listBox.rootElement.style.left=i-o+"px";else{var d=Math.max(this._windowInnerWidth-o,r),h=Math.min(d+o,this._windowInnerWidth);this._listBox.rootElement.style.left=d+"px";this._listBox.rootElement.style.width=h-d+"px";this._listBox.rootElement.style.minWidth=""}this._listBox.selectedItem&&this._listBox.scrollIntoView(this._listBox.selectedItem,!1);this.fireUpdateLayoutEndEvent()}}show(){if(!this._isAttached){this._isAttached=!0;this.suppressMenu=!1;this.updateLayout(!0);this._listBox.intellisenseChoiceSelected=((e,t)=>this.listBox_intellisenseChoiceSelected(e,t));this._listBox.selectedItemChanged=(e=>this.listBox_selectedItemChanged(e));this._textEditorBridge.onCaptureKeyDown=(e=>this.editor_captureKeyDown(e));this._listBox.rootElement.setAttribute("aria-expanded","true");this._listBox.selectedItem&&this.listBox_selectedItemChanged(this._listBox.selectedItem);this._onOpened&&this._onOpened()}}hide(){if(this._isAttached){this._isAttached=!1;this._willMenuBeOpen=!1;this._onClosing&&this._onClosing();this._textEditorBridge.setActiveDescendant(null);this._listBox.intellisenseChoiceSelected=null;this._listBox.selectedItemChanged=null;this._textEditorBridge.onCaptureKeyDown=null;this._listBox.rootElement.style.display="none";this._listBox.rootElement.removeAttribute("aria-expanded")}}listBox_intellisenseChoiceSelected(e,t){this.fireValueCommitted(e,t)}listBox_selectedItemChanged(e){if(e){this._selectedOption=e;this._textEditorBridge.setActiveDescendant(this._listBox.itemContainers[e.index].rootElement.id);this._onSelectionChanged&&this._onSelectionChanged(e)}}calculateListPageSize(){return Math.round(this.listBoxOffsetHeight/this._listBox.listItemHeight)}setListBoxSelectedIndex(e,t){e=Math.max(0,Math.min(this.listBoxListItems.length-1,e));this._listBox.selectedIndex=e;this._listBox.scrollIntoView(this._listBox.selectedItem,t)}editor_captureKeyDown(e){if(!this.isDeferringLayout)if(38!==e.keyCode)if(40!==e.keyCode)if(33!==e.keyCode)if(34!==e.keyCode){if(13!==e.keyCode){if(9!==e.keyCode)if(32!==e.keyCode)if(27!==e.keyCode);else{this.hide();e.preventDefault();e.stopImmediatePropagation();this.suppressMenu=!0}else this.hide();else if(this.fireSelectedValueCommitted(0)){e.stopImmediatePropagation();e.preventDefault()}}else if(this.fireSelectedValueCommitted(1)){e.stopImmediatePropagation();e.preventDefault()}}else{t=this.calculateListPageSize();this.setListBoxSelectedIndex(this._listBox.selectedIndex+t,!1);e.stopImmediatePropagation();e.preventDefault()}else{var t=this.calculateListPageSize();this.setListBoxSelectedIndex(this._listBox.selectedIndex-t,!0);e.stopImmediatePropagation();e.preventDefault()}else{this.setListBoxSelectedIndex(this._listBox.selectedIndex+1,!1);e.stopImmediatePropagation();e.preventDefault()}else{this.setListBoxSelectedIndex(this._listBox.selectedIndex-1,!0);e.stopImmediatePropagation();e.preventDefault()}}fireValueCommitted(e,t){if(this._onChoiceCommitted&&e){this._onChoiceCommitted(e,t);return!0}return!1}fireSelectedValueCommitted(e){return!(!this._listBox||null===this._listBox.selectedItem)&&this.fireValueCommitted(this._listBox.selectedItem,e)}fireSetFilterStartEvent(){this._traceProvider&&this._traceProvider.fireSetFilterStartEvent(this.currentEtwKey)}fireSetFilterEndEvent(){this._traceProvider&&this._traceProvider.fireSetFilterEndEvent(this.currentEtwKey)}fireUpdateLayoutStartEvent(){this._traceProvider&&this._traceProvider.fireUpdateLayoutStartEvent(this.currentEtwKey)}fireUpdateLayoutEndEvent(){this._traceProvider&&this._traceProvider.fireUpdateLayoutEndEvent(this.currentEtwKey)}}c.MAX_MENU_HEIGHT=300;c.MIN_MENU_WIDTH=200;c.MAX_MENU_ITEMS=50;c.DEFERRED_RENDER_TIMER_INTERVAL=200;var h=i(17),u=i(9);class p{constructor(e){this._intellisenseContext=e;this._htmlInputElement=document.createElement("input");this._htmlInputElement.addEventListener("focusout",e=>{this._intellisenseContext.intellisenseMenu.isOpen&&e.stopImmediatePropagation()});this._intellisenseContext.uninitialize();this._intellisenseContext.initialize(this._htmlInputElement)}get inputElement(){return this._htmlInputElement}}var g=i(16),m=i(3),_=i(73),b=i(87);i.d(t,"a",function(){return f});class f{constructor(e,t){this.waitForRefreshPromise=Promise.resolve();this._debuggerManager=e;this._persistenceManager=this._debuggerManager.persistenceManager;this.isDataTip=t;this._watchStore=new b.a(this);this.isDataTip||this.disableWatchesWindow();if(!this.isDataTip){const e=document.getElementById("intellisenseListBox")?"intellisenseListBox":void 0;this.intellisenseContext=new l(new r,new c(e,void 0,void 0,void 0,void 0,this,this),this._debuggerManager.intellisenseProvider);this.intellisenseControl=new p(this.intellisenseContext);this.intellisenseContext.intellisenseProvider.onIntellisenseResultsAvailable=(()=>this._debuggerManager.testEventObject.fireEvent("onIntellisenseResultsAvailable"))}}getWatches(){return this._watchStore?this._watchStore.getWatches():[]}getExpandStates(){return this._watchStore?this._watchStore.getExpandStates():[]}refreshView(e,t){this.view&&this.view.refreshView(e,t)}layout(){this.view&&this.view.layout()}addWatch(e,t,i){return Object(m.c)(m.a.ADD_WATCH,t,()=>{const t=this._watchStore.addWatch(e,i);if(this.isDataTip)return this.evaluateWatch(t,!0);this._persistenceManager.saveDebuggerData();this._watchStore.storeExceptionWatchState();this.refreshAllWatchItems(!1,!1,!0);return Promise.resolve(!0)})}addWatchByCurrentEditorPosition(e,t){return Object(m.c)(m.a.ADD_WATCH,e,()=>{const e=this._debuggerManager.debuggerShell.editorWindow,i=t||e.editorPosition;let s,o="";const r=e.getEditorSelection();if(r&&!r.isEmpty()&&r.containsPosition(i)){s=e.getEditorRangeContents(r).trim();this._debuggerManager.documentController.currentDoc&&(o=this._debuggerManager.documentController.currentDoc.getGeneratedIdentifierName(s))}else{const t=e.dataTips.parseExpression(i);s=(s=t.text).trim();o=t.evalText||""}if(s&&(e.rootElement.contains(document.activeElement)||t)){this._debuggerManager.executionController.debuggerManager.watchController.addWatch(o||s,n.c.Internal);return s}this._debuggerManager.watchController.promptToAddWatch(n.c.Internal);return null})}editWatch(e,t){const i=this._watchStore.editWatch(e,t);this.isDataTip||this._persistenceManager.saveDebuggerData();this._watchStore.storeExceptionWatchState();this._debuggerManager.watchController.refreshAllWatchItems(!0,!1,i)}deleteWatch(e,t){Object(m.c)(m.a.DELETE_WATCH,t,()=>{this._watchStore.deleteWatch(e);this.isDataTip||this._persistenceManager.saveDebuggerData();this._debuggerManager&&this._debuggerManager.testEventObject.fireEvent("deleteWatchCompleted")})}onValueEdit(e,t){const i=this._watchStore.findWatchWithUid(e);if(i&&this._debuggerManager.executionController.isExecutionPaused&&i.displayValue!==t){if(this._displayedFrame){let e=!0;if(0===i.fullName.indexOf(b.a.EXCEPTION_WATCHITEM_PREFIX)){this._watchStore.storeExceptionWatchState();this._watchStore.storeWatchStates();e=!1}i.reset();this._debuggerManager.setPropertyValueAsString(i.uid,t).then(()=>{this.refreshAllWatchItems(!0,e)})}}}refreshAllWatchItems(e,t=!0,i=!1){if(this._debuggerManager.executionController.isExecutionPaused){if(this._displayedFrame){this._watchStore.reset(t);this.isDataTip?this.evaluateAllUserWatches().then(()=>{this.refreshView(!0);this._debuggerManager.watchController.refreshAllWatchItems(!1)}):this.updateWatchesWindow(i,e)}}else this.refreshView(e,i)}deleteAll(e){Object(m.c)(m.a.DELETE_ALL_WATCHES,e,()=>{this.view&&this.view.isViewEnabled()&&this._watchStore.deleteAll()})}activeFrameChanged(e){if(e!==this._displayedFrame){if(this._sourceMapStateChangedRegistration){this._sourceMapStateChangedRegistration.unregister();this._sourceMapStateChangedRegistration=void 0}if(this._displayedFrame){this._watchStore.storeExceptionWatchState();this._watchStore.storeWatchStates()}this._displayedFrame=e;if(e){this._displayedFrame=e;this.isDataTip||this.updateWatchesWindow(!1,!1)}}}navigateTo(e){return h.a}getChildProperties(e,t){s.a.isTrue(e.isExpandable,"Cannot request properties for non expandable watches");let i=0,n=0;switch(t){case 0:n=f.MINIMAL_PROPERTIES_COUNT;break;case 1:i=f.MINIMAL_PROPERTIES_COUNT}let o=[];return this._debuggerManager.getChildProperties(e.uid,i,n).then(t=>{const i=t.propInfos;e.hasAdditionalChildren=t.hasAdditionalChildren;let n;for(const t of i){const i=new _.a(t.propertyId,t.name,this._watchStore);if(this._watchStore.updateWatchWithPropInfo(i,t)){i.parentWatch=e;i.rootIndex=e.rootIndex;if(e===this._watchStore.localsExpando&&this._watchStore.isExceptionWatchItem(i)){this._watchStore.insertWatchItemAtIndex(i,b.a.EXCEPTION_WATCHITEM_INDEX);n=this._watchStore.restoreWatch(i)}else o=o.concat([i])}}const s=o.map(e=>this._watchStore.restoreWatch(e));n&&s.push(n);return Promise.all(s).then(()=>{this._debuggerManager.testEventObject.fireEvent("getChildPropertiesCompleted");return Promise.resolve(o)})})}enableWatchesWindow(){this._watchStore.isWatchesEvaluationEnabled=!0}disableWatchesWindow(){this._watchStore.isWatchesEvaluationEnabled=!1;this._watchStore.reset();this.refreshView()}hasUserWatches(){return this._watchStore.hasUserWatches()}promptToAddWatch(e){this.view&&this.view.promptToAddWatch(e)}evaluateAllUserWatches(e){const t=this._displayedFrame;if(this._debuggerManager.executionController.isExecutionPaused&&t){let e=this._watchStore.getWatches();this._watchStore.thisWatch&&e.push(this._watchStore.thisWatch);if((e=e.filter(e=>!e.local&&e.containsExpression&&0===e.evalStatus)).length>0){const i=e.map(e=>{e.evalStatus=1;return this._debuggerManager.eval(t.callFrameId,e.watchName).then(t=>{return this._watchStore.updateWatchWithPropInfo(e,t)?this._watchStore.restoreWatch(e):Promise.resolve(0)})});return Promise.all(i).then(()=>h.a)}return h.a}return h.a}getLocalsForCurrentStackFrame(){return this._debuggerManager.executionController.isExecutionPaused&&this._displayedFrame?this._watchStore.localsExpando.getNonFakeChildren().then(e=>{const t=[];for(const i of e)t.push({name:i.watchName,typeName:i.watchType});return t}):Promise.resolve([])}setViewState(e){if(this.view){this.view.setViewState(e);this._debuggerManager.testEventObject.fireEventForFirstListener("watchesViewStateChanged")}}isViewEnabled(){return Boolean(this.view&&this.view.isViewEnabled())}fireBuildListBoxStartEvent(e){m.b.logPerformance({id:u.b.Debugger_Intellisense_ListBox_Build_Start,key:e})}fireBuildListBoxEndEvent(e){m.b.logPerformance({id:u.b.Debugger_Intellisense_ListBox_Build_Stop,key:e})}fireResetListBoxStartEvent(e){m.b.logPerformance({id:u.b.Debugger_Intellisense_ListBox_Reset_Start,key:e})}fireResetListBoxEndEvent(e){m.b.logPerformance({id:u.b.Debugger_Intellisense_ListBox_Reset_Stop,key:e})}fireSetFilterStartEvent(e){m.b.logPerformance({id:u.b.Debugger_Intellisense_Menu_Filter_Start,key:e})}fireSetFilterEndEvent(e){m.b.logPerformance({id:u.b.Debugger_Intellisense_Menu_Filter_Stop,key:e})}fireUpdateLayoutStartEvent(e){m.b.logPerformance({id:u.b.Debugger_Intellisense_Menu_Layout_Start,key:e})}fireUpdateLayoutEndEvent(e){m.b.logPerformance({id:u.b.Debugger_Intellisense_Menu_Layout_Stop,key:e})}getLocals(){if(this._debuggerManager&&this._debuggerManager.executionController.isExecutionPaused){const e=this._displayedFrame;if(e){this._watchStore.deleteAnyExceptionWatch();return this._debuggerManager.getLocals(e.callFrameId)}}return Promise.resolve("")}updateWatchesWindow(e,t){this._watchStore.markAllWatchesStale();this.setViewState(!1);this.waitForRefreshPromise=this.getLocals().then(i=>{if(i)return this.evaluateAllUserWatches(t).then(()=>{this._watchStore.localsExpando.uid=i;this._watchStore.localsExpando.evalStatus=2;return this._watchStore.restoreWatch(this._watchStore.localsExpando,!0)}).then(()=>this.sourceMapLocalVariables()).then(()=>{this._debuggerManager.testEventObject.fireEvent("evaluateWatchCompleted");this.refreshView(t,e);this.setViewState(!0);return h.a});this.setViewState(!0);return h.a})}sourceMapLocalVariables(){if(this._displayedFrame){const e=this._debuggerManager.getDocFromStackFrame(this._displayedFrame);if(e.sourceMapContainsLocalVariablesMapping())return this._watchStore.localsExpando.getNonFakeChildren().then(t=>{if(t&&t.length>0){const i=e.sourceMapState===g.a.On;for(let n=0,s=t.length;n<s;n++){const s=t[n];s.displayName=i?e.getAuthoredIdentifierName(s.watchName):""}}})}return Promise.resolve()}evaluateWatch(e,t){if(this._debuggerManager&&this._debuggerManager.executionController.isExecutionPaused){const i=this._displayedFrame;if(i)return this._debuggerManager.eval(i.callFrameId,e.watchName).then(i=>{return this._watchStore.updateWatchWithPropInfo(e,i)?this._watchStore.restoreWatch(e).then(()=>{this.isDataTip&&this.view&&this.view.refreshView(!0,t);this._debuggerManager.testEventObject.fireEvent("evaluateWatchCompleted");return"Error"===i.type&&-1===i.value.indexOf("is undefined")?Promise.resolve(!1):Promise.resolve(!0)}):Promise.resolve(!1)})}return Promise.resolve(!0)}}f.MINIMAL_PROPERTIES_COUNT=100},123:function(e,t,i){"use strict";i.d(t,"a",function(){return n});const n="0"},157:function(e,t,i){"use strict";var n=i(58),s=i(47),o=i(20);class r{constructor(e,t,i,n){this.index=-1;this.value=e;this.text=t;this.info=i||"";this.itemClass=n||""}}class a extends n.a{constructor(e,t,i){super(e);e||this.setTemplateFromHTML('<ul class="listBox"></ul>');this.rootElement.setAttribute("tabindex","0");this.rootElement.setAttribute("role","listbox");this.rootElement.onkeydown=(e=>this.onKeyDown(e));this._listItemElementType=t||"li";this._listItemElementClass=i||"";this._listItemContainers=[];this._selectedIndex=-1;this.rootElement.id||(this.rootElement.id=a.getUniqueID())}get selectedItemChanged(){return this._onSelectedItemChanged}set selectedItemChanged(e){this._onSelectedItemChanged=e}get selectedIndexChanged(){return this._onSelectedIndexChanged}set selectedIndexChanged(e){this._onSelectedIndexChanged=e}get itemDoubleClicked(){return this._onItemDoubleClicked}set itemDoubleClicked(e){this._onItemDoubleClicked=e}get listItems(){return this._listItems}set listItems(e){this.fireBuildListBoxStartEvent();this.selectedIndex=-1;this._listItems=[];var t=0;if(e)for(;t<e.length;++t){var i=e[t];i.index=t;this._listItems.push(i);if(t<this._listItemContainers.length){this._listItemContainers[t].item=i;this._listItemContainers[t].rootElement.style.display="list-item";this._listItemContainers[t].rootElement.removeAttribute("aria-hidden")}else{var n=this.createListItemContainer(i);this._listItemContainers.push(n);this.appendChild(n)}}this.resetUnusedItems(t);this.fireBuildListBoxEndEvent()}get listItemHeight(){if(void 0===this._listItemHeight){if(!(this.listItems.length>0))return a.DEFAULT_LIST_ITEM_HEIGHT;this._listItemHeight=this._listItemContainers[0].rootElement.offsetHeight}return this._listItemHeight}get itemContainers(){return this._listItemContainers}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){if(this._selectedIndex!==e){var t=this._selectedIndex;this._selectedIndex=e;if(t>=0){this._listItemContainers[t].selected=!1}if(e>=0&&e<this._listItemContainers.length){this._listItemContainers[e].selected=!0;if(e!==t){this._onSelectedIndexChanged&&this._onSelectedIndexChanged(e);this._onSelectedItemChanged&&this._onSelectedItemChanged(this._listItems[e])}}}}get selectedItem(){var e=this.selectedIndex;return e>=0?this._listItems[e]:null}set selectedItem(e){var t=this._listItems.indexOf(e);this.selectedIndex=t}scrollIntoView(e,t){var i=this._listItems.indexOf(e);if(i>=0){var n=this._listItemContainers[i].rootElement,s=n.getBoundingClientRect(),o=document.elementFromPoint(s.left+1,s.top+1),r=document.elementFromPoint(s.right-1,s.bottom-1);o===n&&r===n||this._listItemContainers[i].rootElement.scrollIntoView(t)}}createListItemContainer(e){return new l(this,e,this._listItemElementType,this._listItemElementClass)}fireBuildListBoxStartEvent(){}fireBuildListBoxEndEvent(){}fireResetListBoxStartEvent(){}fireResetListBoxEndEvent(){}static getUniqueID(){return"Common-Controls-Legacy-ListBox-"+a.CurrentUniqueID++}resetUnusedItems(e){this.fireResetListBoxStartEvent();for(var t=e;t<this._listItemContainers.length;++t){this._listItemContainers[t].rootElement.style.display="none";this._listItemContainers[t].rootElement.setAttribute("aria-hidden","true");this._listItemContainers[t].item=null}this.fireResetListBoxEndEvent()}onKeyDown(e){var t=!e.shiftKey&&!e.ctrlKey&&!e.altKey;if(38===e.keyCode&&t){if(this.selectedIndex>0){this.selectedIndex--;this.scrollIntoView(this.selectedItem,!0)}}else if(40===e.keyCode&&t&&this.selectedIndex<this._listItemContainers.length-1){this.selectedIndex++;this.scrollIntoView(this.selectedItem,!1)}}}a.DEFAULT_LIST_ITEM_HEIGHT=10;a.CurrentUniqueID=0;class l extends s.a{constructor(e,t,i,n){super(document.createElement(i));this._owner=e;this._item=t;this.rootElement.innerText=t.text;this.rootElement.value=t.value;t.itemClass&&t.itemClass.length>0&&this.rootElement.classList.add(t.itemClass);""!==n&&this.rootElement.classList.add(n);this.rootElement.onmouseover=(()=>{this._item&&this._item.info&&o.c({content:this._item.info});return!0});this.rootElement.setAttribute("role","option");this.rootElement.onmousedown=(()=>this.onMouseDown());this.rootElement.onclick=(()=>this.onMouseDown());this.rootElement.ondblclick=(()=>this.onDoubleClicked());this.rootElement.getAttribute("id")||this.rootElement.setAttribute("id",l.getUniqueID())}get selectedChanged(){return this._onSelectChanged}set selectedChanged(e){this._onSelectChanged=e}get selected(){return this._selected}set selected(e){var t=e!==this._selected;this._selected=e;if(t)if(e){this.rootElement.setAttribute("selected","selected");this.rootElement.setAttribute("aria-selected","true");this._owner.selectedItem=this._item}else{this.rootElement.removeAttribute("selected");this.rootElement.removeAttribute("aria-selected")}this._onSelectChanged&&t&&this._onSelectChanged(e)}get item(){return this._item}set item(e){if(e&&"string"==typeof e.text){this._item=e;this.rootElement.firstChild?this.rootElement.firstChild.nodeValue=this._item.text:this.rootElement.innerText=this._item.text;this.rootElement.setAttribute("aria-label",this._item.text)}else{this._item=null;this.rootElement.firstChild&&(this.rootElement.firstChild.nodeValue="");this.rootElement.removeAttribute("aria-label")}}static getUniqueID(){return"Common-Controls-Legacy-ListBoxItemContainer-"+l.CurrentUniqueID++}onMouseDown(){this.selected=!0;this._owner.rootElement.focus()}onDoubleClicked(){this.selected=!0;this._owner.rootElement.focus();this._owner.itemDoubleClicked&&this._owner.itemDoubleClicked(this._item)}}l.CurrentUniqueID=0;l.CONTENT_ELEMENT_ID="content";i.d(t,"a",function(){return d});i.d(t,"b",function(){return c});class d extends r{constructor(e,t){super(e,e,t)}get optionName(){return this.text}}class c extends a{constructor(e,t,i,n){super(e,t,i||"intellisenseListBoxItem");this.itemDoubleClicked=(e=>this.optionDoubleClicked(e));this._traceProvider=n;this._currentEtwKey=-1}get intellisenseChoiceSelected(){return this._intellisenseChoiceSelected}set intellisenseChoiceSelected(e){this._intellisenseChoiceSelected=e}get currentEtwKey(){return this._currentEtwKey}set currentEtwKey(e){this._currentEtwKey=e}optionDoubleClicked(e){this._intellisenseChoiceSelected&&this._intellisenseChoiceSelected(e,2)}fireBuildListBoxStartEvent(){this._traceProvider&&this._traceProvider.fireBuildListBoxStartEvent(this.currentEtwKey)}fireBuildListBoxEndEvent(){this._traceProvider&&this._traceProvider.fireBuildListBoxEndEvent(this.currentEtwKey)}fireResetListBoxStartEvent(){this._traceProvider&&this._traceProvider.fireResetListBoxStartEvent(this.currentEtwKey)}fireResetListBoxEndEvent(){this._traceProvider&&this._traceProvider.fireResetListBoxEndEvent(this.currentEtwKey)}}},167:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(4),s=i(31);class o{static positionAsRange(e){return{startLineNumber:e.line,endLineNumber:e.line,startColumn:e.column,endColumn:e.column}}get model(){return this._model}set model(e){n.a.hasValue(e,"Model should not be set without a value");this._model=e}addBreakpointDecoration(e){const t={editorState:this,decorationId:"",glyphId:""};if(this.model){if(e.isEnabled&&e.isBound&&e.location){const i={range:this.getTrimmedRange(e.location),options:{className:"breakpointDecoration",stickiness:monaco.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingAfter}};t.decorationId=this.model.deltaDecorations([],[i])[0]}if(e.location&&e.location.startPosition){const i={range:o.positionAsRange(e.location.startPosition),options:{className:"",showInOverviewRuler:Object(s.b)().getValue("plugin-editor-scrollbar-marker-breakpoint-color"),glyphMarginClassName:this.glyphMarginClassForBreakpoint(e),stickiness:monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}};t.glyphId=this.model.deltaDecorations([],[i])[0]}}return t}displayInstructionPointerDecoration(e){const t={editorState:this,decorationId:"",glyphId:""};if(this.model){t.decorationId=this.model.deltaDecorations([],[{range:this.getTrimmedRange(e),options:{className:"instructionPointerDecoration"}}])[0];e.startPosition&&(t.glyphId=this.model.deltaDecorations([],[{range:o.positionAsRange(e.startPosition),options:{overviewRuler:{color:Object(s.b)().getValue("plugin-editor-scrollbar-marker-instruction-pointer-color"),darkColor:Object(s.b)().getValue("plugin-editor-scrollbar-marker-instruction-pointer-color"),position:monaco.editor.OverviewRulerLane.Center},glyphMarginClassName:"instructionPointerGlyph "+o.GLYPH_CLASS}}])[0])}return t}displayCursorDecoration(e){const t={editorState:this,decorationId:"",glyphId:""};if(this.model){t.decorationId=this.model.deltaDecorations([],[{range:this.getTrimmedRange(e),options:{className:"cursorDecoration"}}])[0];e.startPosition&&(t.glyphId=this.model.deltaDecorations([],[{range:o.positionAsRange(e.startPosition),options:{overviewRuler:{color:Object(s.b)().getValue("plugin-color"),darkColor:Object(s.b)().getValue("plugin-color"),position:monaco.editor.OverviewRulerLane.Full},glyphMarginClassName:"cursorGlyph "+o.GLYPH_CLASS,showInOverviewRuler:Object(s.b)().getValue("plugin-color"),stickiness:monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}}])[0])}return t}addExceptionDecoration(e){const t={editorState:this,decorationId:"",glyphId:""};this.model&&(t.decorationId=this.model.deltaDecorations([],[{range:e,options:{className:"",showInOverviewRuler:Object(s.b)().getValue("plugin-font-editor-erroradornment-background-color")}}])[0]);return t}displayActiveFrameDecoration(e){const t={editorState:this,decorationId:"",glyphId:""};if(this.model){t.decorationId=this.model.deltaDecorations([],[{range:this.getTrimmedRange(e),options:{className:"activeFrameDecoration"}}])[0];e.startPosition&&(t.glyphId=this.model.deltaDecorations([],[{range:o.positionAsRange(e.startPosition),options:{showInOverviewRuler:Object(s.b)().getValue("plugin-editor-scrollbar-marker-active-frame-color"),glyphMarginClassName:"activeFrameGlyph "+o.GLYPH_CLASS}}])[0])}return t}displayTextSpotlightDecoration(e){const t={editorState:this,decorationId:"",glyphId:""};this.model&&(t.decorationId=this.model.deltaDecorations([],[{range:this.getTrimmedRange(e),options:{className:"textSpotlightDecoration"}}])[0]);return t}removeDecorationInfo(e){if(this.model&&!this.model.isDisposed()){e.decorationId&&this.model.deltaDecorations([e.decorationId],[]);e.glyphId&&this.model.deltaDecorations([e.glyphId],[])}}getTrimmedRange(e){if(!this._model)return{startLineNumber:1,startColumn:1,endLineNumber:1,endColumn:1};const t=this._model.getValueInRange(e);let i=e.endColumn,n=e.endLineNumber;if(n>this._model.getLineCount()){n=this._model.getLineCount();i=this._model.getLineContent(n).length}let s=t.length-1;for(;t.charAt(s).match(/[\s]/);){if("\n"===t.charAt(s)){n--;i=this._model.getLineContent(n).length+1;"\r"===t.charAt(s-1)&&s--}else i--;s--}return{startLineNumber:e.startLineNumber,startColumn:e.startColumn,endLineNumber:n,endColumn:i}}glyphMarginClassForBreakpoint(e){return[e.getGlyphClassName(),"breakpointGlyph",e.isBound?"":"bpUnbound",e.isEnabled?"":"bpDisabled",o.GLYPH_CLASS].join(" ")}}o.GLYPH_CLASS="f12Glyph"},207:function(e,t,i){"use strict";i.r(t);var n=i(70),s=i(5),o=i(84),r=i(34),a=i(4),l=i(0),d=i(16);class c{static initialize(){c.ToExceptionClass=c.exceptionFilterToClassNameConverter();c.ToSourceMapTooltip=c.tristateTooltip("UnloadSourceMapButtonTooltip","LoadSourceMapButtonTooltip","SourceMapButtonOffTooltip");c.ToJMCDocumentToolTip=c.tristateTooltip("FilePickerMyCodeTooltip","FilePickerLibraryCodeTooltip","JustMyCodeDisabledTooltip");c.ToFindInFilesTooltip=c.boolTooltip("FindInFilesButtonOffTooltip","FindInFilesButtonOnTooltip");c.ToDisconnectDebuggingTooltip=c.boolTooltip("DebuggerDisconnectedTooltip","DebuggerConnectedTooltip");c.ToExceptionFilterNone=c.exceptionFilterStateConverter(0);c.ToExceptionFilterUnhandled=c.exceptionFilterStateConverter(1);c.ToExceptionFilterHandled=c.exceptionFilterStateConverter(2)}static exceptionFilterToClassNameConverter(){return{convertTo:e=>{switch(e){case 2:return"breakOnExceptionsButton breakAll";case 0:return"breakOnExceptionsButton breakNone";case 1:return"breakOnExceptionsButton breakUnhandled";default:return"breakOnExceptionsButton"}},convertFrom:void 0}}static tristateTooltip(e,t,i){return{convertTo:n=>{switch(n){case d.a.On:return Object(l.b)(e);case d.a.Off:return Object(l.b)(t);case d.a.Disabled:case void 0:case null:return Object(l.b)(i);default:a.a.fail("Unexpected");return""}},convertFrom:void 0}}static boolTooltip(e,t){return{convertTo:i=>Object(l.b)(i?e:t),convertFrom:void 0}}static exceptionFilterStateConverter(e){return{convertTo:t=>t===e,convertFrom:void 0}}}c.initialize();function h(){Object(o.a)();Object(r.a)("F12.Tools.Debugger.CommonConverters",{ToExceptionClass:c.ToExceptionClass,ToJMCDocumentToolTip:c.ToJMCDocumentToolTip,ToSourceMapTooltip:c.ToSourceMapTooltip,ToFindInFilesTooltip:c.ToFindInFilesTooltip,ToDisconnectDebuggingTooltip:c.ToDisconnectDebuggingTooltip,ToExceptionFilterNone:c.ToExceptionFilterNone,ToExceptionFilterUnhandled:c.ToExceptionFilterUnhandled,ToExceptionFilterHandled:c.ToExceptionFilterHandled})}var u=i(1),p=i(66),g=i(2),m=i(85);class _{constructor(e){this.cache=[];this.listSource=e}get length(){return this.cache.length}load(e){this.listSource(t=>{this.cache=t||[];e()},this._loadArgs)}setLoadArgs(e){this._loadArgs=e}item(e){a.a.isTrue(e>=0&&e<this.cache.length);return this.cache[e]}}var b=i(12);const f=(e,t)=>b.a.loadString(e,t);class E{constructor(e,t){this.breakpointType=e;this.breakpointTypeForDisplay=t}static fromDmbpType(e){let t=E.typeMap.get(e);if(!t){switch(e){case"subtree-modified":t=new E(e,f("DomMutationBreakpointsTypeSubtreeModified"));break;case"attribute-modified":t=new E(e,f("DomMutationBreakpointsTypeAttrModified"));break;case"node-removed":t=new E(e,f("DomMutationBreakpointsTypeNodeRemoved"))}E.typeMap.set(e,t)}return t}}E.typeMap=new Map;const C=(e,t)=>b.a.loadString(e,t),y={noElementsMatchedSelector:"dmbpErrorMessageBindingFailedSelectorNotMatched",tooManyElementsMatchedSelector:"dmbpErrorMessageBindingFailedSelectorMatchedMultiple",unknown:"dmbpErrorMessageBindingFailedUnknown"};class I{constructor(e,t,i){this.selector=e;this.documentUrl=i;this.state="enabled";this.expanded=!0;this.id=I.VIEWMODEL_ID++;this._types=t}setFailed(e,t){this.bindingFailedReason=t;this.localizedTooltip=C(y[this.bindingFailedReason])||C("unknown");this.pendingId=e;this.state="unbound";this.breakpointId=void 0;this.elementUniqueId=void 0}setBound(e,t,i){this.breakpointId=e;this.elementUniqueId=t;this.localizedTooltip=this.documentUrl;this.state=i?"enabled":"disabled";this.pendingId=void 0;this.bindingFailedReason=void 0}get isPending(){return!!this.pendingId}setTypes(e){this._types=e.map(e=>E.fromDmbpType(e))}get types(){return this._types}get isChecked(){return"enabled"===this.state}}I.VIEWMODEL_ID=1;class S extends _{constructor(e,t){super();this._manager=e;this._analytics=t;this._isVisible=!1;this._manager.addEventListener("domMutationBreakpointSet",e=>{let t=this.findBPVMByBreakpointId(e.breakpointId);if(t)t.setBound(e.breakpointId,e.elementUniqueId,e.isEnabled);else if(t=this.findBreakpointWhere(t=>t.pendingId===e.pendingBreakpointId))t.setBound(e.breakpointId,e.elementUniqueId,e.isEnabled);else{(t=new I(e.selector,e.types.map(e=>E.fromDmbpType(e)),e.documentUrl)).setBound(e.breakpointId,e.elementUniqueId,e.isEnabled);this.cache.push(t)}t.setTypes(e.types);this.fireModelUpdate()});this._manager.addEventListener("domMutationBreakpointUnbound",e=>{let t=this.findIndexWhere(t=>t.breakpointId===e.breakpointId);t>-1&&this.cache.splice(t,1);this.fireModelUpdate()});this._manager.addEventListener("domMutationBreakpointEnabledChanged",e=>{var t=this.findBPVMByBreakpointId(e.breakpointId);t&&(t.state=e.isEnabled?"enabled":"disabled");this.fireModelUpdate()});this._manager.addEventListener("domMutationBreakpointPageChanged",e=>{if(e.isTopLevelDocument)this.cache.splice(0,this.cache.length);else for(let t=0;t<this.cache.length;){this.cache[t].documentUrl===e.oldDocumentUrl?this.cache.splice(t,1):t++}this.fireModelUpdate()});this._manager.addEventListener("domMutationBreakpointBindingFailed",e=>{let t=this.findBreakpointWhere(t=>t.pendingId===e.pendingBreakpointId);if(t){t.setFailed(e.pendingBreakpointId,e.reason);this.fireModelUpdate()}});this._manager.addEventListener("domMutationBreakpointPendingRegistration",e=>{e.breakpoints.forEach(e=>{let t=new I(e.selector,e.types.map(e=>E.fromDmbpType(e)),e.documentUrl);t.setFailed(e.pendingId,"unknown");this.cache.push(t)});this.fireModelUpdate()});this._manager.addEventListener("domMutationBreakpointBindingMetrics",e=>{this._analytics.log("DmbpBindingMetrics",e)});this._manager.addEventListener("domMutationPendingBreakpointRemoved",e=>{let t=this.findIndexWhere(t=>t.pendingId===e);if(t>-1){this.cache.splice(t,1);this.fireModelUpdate()}});this._modelListeners=[]}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible=e}setExpansionState(e,t){let i=this.findBPVMByViewModelId(e);if(i&&i.expanded!==t){i.expanded=t;this.fireModelUpdate()}}isExpanded(e){return this.findBPVMByViewModelId(e).expanded}findBPVMByBreakpointId(e){let t=null;this.cache.some(i=>{if(i.breakpointId===e){t=i;return!0}return!1});return t}findBPVMByViewModelId(e){let t=null;this.cache.some(i=>{if(i.id===e){t=i;return!0}return!1});return t}findBreakpointWhere(e){let t=null;this.cache.some(i=>{if(e(i)){t=i;return!0}return!1});return t}findIndexWhere(e){let t=-1;this.cache.some((i,n)=>{if(e(i)){t=n;return!0}return!1});return t}findBindFailedBreakpoints(){return this.cache.filter(e=>e.isPending)}addEventListener(e,t){this._modelListeners.push(t)}removeEventListener(e,t){const i=this._modelListeners.indexOf(t);i>-1&&this._modelListeners.splice(i,1)}fireModelUpdate(){for(const e of this._modelListeners)e()}load(e){setImmediate(e)}canRebindAll(){return this.cache.some(e=>e.isPending)}rebindAll(){this._analytics.logExecuteCommand(g.a.DMBP_MANUAL_REBIND_ALL,g.c.Ui);this.cache.filter(e=>e.isPending).forEach(e=>{this._manager.attemptRebind(e.pendingId)})}canDeleteAll(){return this.cache.length>0}deleteAll(){let e=[];this.cache.forEach(t=>{t.isPending?e.push(this._manager.deletePendingBreakpoint(t.pendingId)):e.push(this._manager.removeDomMutationBreakpoint(t.breakpointId))});return Promise.all(e).then(()=>void 0)}canToggleAll(){return this.cache.some(e=>!e.isPending)}toggleAll(){let e=this.getToggleAllType();this.cache.filter(e=>!e.isPending).forEach(t=>{this._manager.setDomMutationBreakpointEnabledState(t.breakpointId,e)})}getToggleAllType(){return!this.cache.filter(e=>!e.isPending).every(e=>!!e.isPending||"enabled"===e.state)}}var T=i(22),v=i(15),k=i(61),D=i(18),M=i(45),x=i(38),w=i(159),O=i(76),P=i(35),B=i(30),R=i(41),L=i(13),A=i(51),F=i(10),N=i(6),W=i(82),j=i(37),K=i(25),U=i(11),H=i(9),V=i(3),G=i(121);class z{constructor(e,t,i,n,s,o=!1){this.container=e;this.container.style.display="none";this.container.classList.add("lightDismissPromptContainer");this._subContainer=document.createElement("div");this._subContainer.className="popupInnerContainer";this.container.appendChild(this._subContainer);this._isTracePoint=o;this._firstElementInTabOrder=t;this._lastElementInTabOrder=i;this._cancelCallback=n||(()=>{});this._focusOutListener=(e=>{e.target===document.activeElement&&this.hideControl();return!1});this._documentClickListener=(e=>{e.target===this.container||this.container.contains(e.target)||this.hideControl();return!1});this._documentKeydownListener=(e=>{if(27===e.keyCode){this.callCancelCallback();this.hideControl();e.stopImmediatePropagation();e.preventDefault();return!1}return 112!==e.keyCode||(!s||s(this._isTracePoint))});this._popupKeydownListener=(e=>{let t=!1;if(9===e.keyCode)if(e.target===this._firstElementInTabOrder&&e.shiftKey){this._lastElementInTabOrder.focus();t=!0}else if(e.target===this._lastElementInTabOrder&&!e.shiftKey){this._firstElementInTabOrder.focus();t=!0}if(t){e.stopPropagation();e.preventDefault();return!1}return!0})}getCancelCallbackArgs(){}callCancelCallback(){this.hideControl();const e=this.getCancelCallbackArgs();this._cancelCallback(e)}get subContainer(){return this._subContainer}showControl(){if(!this._isVisible){this.container.style.display="block";this._isVisible=!0;window.setImmediate(()=>{document.addEventListener("focusout",this._focusOutListener,!0);document.addEventListener("click",this._documentClickListener,!0);document.addEventListener("keydown",this._documentKeydownListener,!0);this.container.addEventListener("keydown",this._popupKeydownListener)})}}hideControl(){this._isVisible&&window.setImmediate(()=>{this.container.style.display="none";this._isVisible=!1;document.removeEventListener("focusout",this._focusOutListener,!0);document.removeEventListener("click",this._documentClickListener,!0);document.removeEventListener("keydown",this._documentKeydownListener,!0);this.container.removeEventListener("keydown",this._popupKeydownListener)})}}class X extends z{static openLinkHelp(e){Object(L.B)(e?"https://go.microsoft.com/fwlink/?LinkID=331335":"https://go.microsoft.com/fwlink/?LinkID=331334");return!1}constructor(e,t,i,n,s=!1){const o=document.createElement("div"),r=document.createElement("select"),a=document.createElement("button");super(o,r,a,n,X.openLinkHelp);this._selectBox=r;this._cancelButton=a;this._container=o;this._debuggerShell=e;this._isTracepointPrompt=s;const d=s?"addEventTracepointContainer":"addEventBreakpointContainer";o.className=`lightDismissPromptContainer ${d}`;t.insertBefore(o,t.firstElementChild);this._dataEnteredCallback=i;this._canceledCallback=n;o.addEventListener("keypress",this.onKeyPress.bind(this));const c=document.createElement("div");c.textContent=Object(l.b)(this.titleResourceId);o.setAttribute("aria-label",Object(l.b)(this.titleResourceId));this.subContainer.appendChild(c);const h=document.createElement("div");h.textContent=Object(l.b)(this.instructionsResourceId);this.subContainer.appendChild(h);const u=document.createElement("div");u.className="popupInputContainer withHelp";u.style.msGridRows="auto 9px auto";this.subContainer.appendChild(u);const p=document.createElement("div");p.id="AddEventTracePointEventLabel";p.textContent=Object(l.b)("AddEventBreakpointDialogEventLabel");u.appendChild(p);this._selectBox.className="promptInputBox";this._selectBox.setAttribute("aria-labelledby","AddEventTracePointEventLabel");this._selectBox.style.msGridColumnSpan="3";u.appendChild(this._selectBox);const g=document.createElement("div");g.textContent=Object(l.b)(s?"TracepointLabel":"ConditionalBreakpointLabel");g.style.msGridRow="3";u.appendChild(g);this._inputBox=document.createElement("input");this._inputBox.className="promptInputBox";this._inputBox.setAttribute("aria-label",g.textContent);this._inputBox.style.msGridRow="3";u.appendChild(this._inputBox);const m=document.createElement("button");m.className="promptHelpButton";m.textContent="?";m.style.msGridRow="3";const _=s?"EventTracepointsHelpButtonTooltip":"EventBreakpointsHelpButtonTooltip",b=Object(l.b)(_);m.setAttribute("data-plugin-vs-tooltip",b);m.setAttribute("aria-label",b);m.addEventListener("click",()=>{X.openLinkHelp(this._isTracepointPrompt)});u.appendChild(m);const f=document.createElement("div");f.className="popupButtonContainer";this.container.appendChild(f);const E=document.createElement("button");E.addEventListener("click",this.submit.bind(this));E.innerText=Object(l.b)("EventBreakpointsDialogAddButton");E.className="okButton";f.appendChild(E);this._cancelButton.addEventListener("click",this.cancel.bind(this));this._cancelButton.innerText=Object(l.b)("CancelButtonLabel");this._cancelButton.className="cancelButton";this._cancelButton.type="button";f.appendChild(this._cancelButton)}get titleResourceId(){return this._isTracepointPrompt?"AddEventTracepointDialogTitle":"AddEventBreakpointDialogTitle"}get instructionsResourceId(){return this._isTracepointPrompt?"EventTracepointInstructions":"EventBreakpointInstructions"}populateEventSelections(e){if(this._eventSelectionsPopulated)return;this._eventSelectionsPopulated=!0;const t=document.createElement("optgroup");t.label=Object(l.b)(e.collectionsTitleLocId);for(const i of e.collections){const e=document.createElement("option");e.innerText=Object(l.b)(i.titleLocId);i.tooltipLocId&&e.setAttribute("data-plugin-vs-tooltip",Object(l.b)(i.tooltipLocId));e.value=JSON.stringify(i.eventKeys);t.appendChild(e)}this._selectBox.appendChild(t);for(const t of e.categories){const e=document.createElement("optgroup");e.label=Object(l.b)(t.titleLocId);for(const i of t.events){const t=document.createElement("option");t.innerText=G.a.getStringForEventBreakpointType(i.eventKey);t.value=JSON.stringify([i.eventKey]);e.appendChild(t)}this._selectBox.appendChild(e)}}activate(){this.populateEventSelections(G.a.eventBreakpointDescriptions);this._inputBox.value="";this._container.style.top="";this._selectBox.removeAttribute("size");this.showControl();this._selectBox.focus();this._selectBox.addEventListener("mousedown",()=>this.onSelectBoxMouseDownOnce());this.vCenterContainer();W.a.setAlertMessage(Object(l.b)("FullstopSeparatedStrings",Object(l.b)(this.titleResourceId),Object(l.b)(this.instructionsResourceId)))}vCenterContainer(){requestAnimationFrame(()=>{let e=this._debuggerShell.getFindResultsTop()/2-(this._container.getBoundingClientRect().height+6)/2;e=Math.max(0,e);this._container.style.top=e+"px"})}onSelectBoxMouseDownOnce(){this._selectBox.removeEventListener("mousedown",this.onSelectBoxMouseDownOnce)}submit(){this.hideControl();const e=this._selectBox.value&&JSON.parse(this._selectBox.value);e&&!this._isTracepointPrompt||this._inputBox.value?this._dataEnteredCallback(e,this._inputBox.value):this.cancel()}cancel(){this.hideControl();this._canceledCallback()}onKeyPress(e){if(13===e.keyCode){if(this._isTracepointPrompt&&document.activeElement===this._selectBox&&!this._inputBox.value){this._inputBox.focus();return!0}if(e.target!==this._cancelButton){this.submit();e.stopPropagation();e.preventDefault();return!1}}return!0}}var q=i(77);class J{constructor(e,t,i){this.breakpoint=e;this._window=t;this._controller=i;this.rootElement=document.createElement("div");this.checkbox=document.createElement("input");this.icon=document.createElement("span");this.text=document.createElement("a");this.editButton=this.createButton("bpEditButton",this.breakpoint.isTracepoint?"BreakpointsContextMenuAddTraceMessage":"EditButtonTooltip",()=>this.activateEditBox(V.a.SET_CONDITION_IN_EDITOR,g.c.Ui));this.deleteButton=this.createButton("bpDeleteButton","DeleteButtonTooltip",()=>this._window.onDeleteBreakpointRow(this,V.a.DELETE_BREAKPOINT_IN_WINDOW,g.c.Ui));const n=document.createElement("span"),s=document.createElement("span");this.rootElement.className="bpRow";this.checkbox.className="bpCheckbox";this.icon.className="bpIcon";this.text.className="bpLink";this.checkbox.type="checkbox";this.icon.textContent=" ";n.className="bpText";s.className="bpItemControls";this.rootElement.appendChild(this.checkbox);this.rootElement.appendChild(this.icon);n.appendChild(this.text);this.rootElement.appendChild(n);s.appendChild(this.editButton);s.appendChild(this.deleteButton);this.rootElement.appendChild(s);this.rootElement.tabIndex=-1;this.checkbox.tabIndex=-1;this.rootElement.addEventListener("contextmenu",this.onContextMenu.bind(this));this.checkbox.addEventListener("click",this.onCheckboxClicked.bind(this));this.text.addEventListener("click",this.navigateToBreakpointLocation.bind(this));this.rootElement.addEventListener("click",this.onClick.bind(this));this.rootElement.addEventListener("dblclick",this.navigateToBreakpointLocation.bind(this));this.rootElement.addEventListener("keydown",this.onKeyDown.bind(this));this.rootElement.addEventListener("focusin",this.onFocusin.bind(this));this.addDocListener()}get ariaLabel(){let e=[];this.breakpoint.isBound?this.breakpoint.isEnabled||e.push(Object(l.b)("Disabled")):e.push(Object(l.b)("UnboundBreakpoint"));if(this.breakpoint.eventTypes&&this.breakpoint.eventTypes.length>0){this.breakpoint.isTracepoint?e.push(Object(l.b)("EventTracepoint")):this.breakpoint.isXHR()?e.push(Object(l.b)("EventXHRBreakpointLabel")):this.breakpoint.condition?e.push(Object(l.b)("ConditionalEventBreakpoint")):e.push(Object(l.b)("EventBreakpoint"));if(!this.breakpoint.isBound&&this.breakpoint.isEnabled){const t=Object(l.b)("EventBreakpointUnboundDocMode");e=[t];this.icon.setAttribute("data-plugin-vs-tooltip",t)}else this.icon.removeAttribute("data-plugin-vs-tooltip")}else this.breakpoint.isTracepoint?e.push(Object(l.b)("Tracepoint")):this.breakpoint.condition?e.push(Object(l.b)("ConditionalBreakpointTitle")):e.push(Object(l.b)("BreakpointLabel"));e.push(this.breakpoint.toString(!0));return e.join(", ")}activateEditBox(e,t){return Object(V.c)(e,t,()=>{this._window.unselectAll();this.select();this._window.promptToSetConditionOrTracepoint(this.breakpoint);return!1})}refresh(){this.checkbox.checked=this.breakpoint.isEnabled;const e=this.breakpoint.isBound?"":"bpUnbound",t=this.breakpoint.isEnabled?"":"bpDisabled";this.icon.className=`${this.breakpoint.getGlyphClassName()} ${e} ${t} bpIcon`;this.text.textContent=this.breakpoint.toString();this.checkbox.setAttribute("aria-label",this.text.textContent);this.breakpoint.tooltipText&&this.text.setAttribute("data-plugin-vs-tooltip",this.breakpoint.tooltipText);const i=this.breakpoint.isTracepoint?"BreakpointsContextMenuAddTraceMessage":"EditButtonTooltip";this.editButton.setAttribute("data-plugin-vs-tooltip",Object(l.b)(i));this.rootElement.setAttribute("aria-label",this.ariaLabel);this.addDocListener();this===this._window.focusedBreakpointRow&&W.a.setAlertMessage(this.ariaLabel)}select(){if(!this.isSelected()){this._window.addToSelection(this);this.rootElement.classList.add("selected")}this._window.selectedBreakpointRow=this}isSelected(){return this.rootElement.classList.contains("selected")}unselect(){this.rootElement.classList.remove("selected");this._window.removeFromSelection(this)}cleanup(){this._eventRegistration&&this._eventRegistration.unregister()}addDocListener(){if(this.breakpoint.location&&this.breakpoint.location.startPosition&&this.breakpoint.location.startPosition.doc){const e=this.breakpoint.location.startPosition.doc;this.cleanup();this._eventRegistration=e.propertyChanged.addHandler(t=>{if("isEditPending"===t){this.checkbox.disabled=e.isEditPending;this.text.textContent=(e.isEditPending?"*":"")+this.breakpoint.toString();j.a.changeButtonStatus(this.editButton,!e.isEditPending)}})}}createButton(e,t,i){const n=document.createElement("div"),s=document.createElement("div");n.className=e+" iconShell_18x18";s.className="buttonIcon icon_14x14";n.appendChild(s);j.a.setupButton(n,t,i);return n}navigateToBreakpointLocation(e){if(0===e.button){this.select();this._controller.navigateToBreakpoint(this.breakpoint,V.a.GO_TO_BREAKPOINT,g.c.Ui);e.stopImmediatePropagation();return!1}return!0}onContextMenu(e){if(this.rootElement===e.target||this.rootElement===e.target.parentElement||this.rootElement===e.target.parentElement.parentElement){if(!this.isSelected()){this._window.unselectAll();this.select()}let t=0,i=0;if(e instanceof MouseEvent){t=e.pageX;i=e.pageY}if(t<=0&&i<=0){const n=e.target.getBoundingClientRect();t=n.left;i=n.top}this._window.showContextMenu(t,i,this.breakpoint,this.rootElement)}e.preventDefault();e.stopImmediatePropagation()}onClick(e){if(this.isSelected()&&(e.ctrlKey||e.shiftKey))this.unselect();else{e.ctrlKey||e.shiftKey||!this._window.isMultipleSelection()||this._window.unselectAll();this.select()}}onCheckboxClicked(e){this.isSelected()||this._window.unselectAll();this.select();this._window.setEnabledStateForSelection(!this.breakpoint.isEnabled,V.a.SET_BREAKPOINT_STATE_IN_WINDOW,g.c.Ui);e.stopPropagation()}onKeyDown(e){121!==e.keyCode||!e.shiftKey||e.ctrlKey||e.altKey||this.onContextMenu(e)}onFocusin(){this.select()}}class $ extends z{constructor(e,t,i,n,s=!1){const o=document.createElement("div"),r=document.createElement("input"),a=e=>{n(e)},d=document.createElement("button");super(o,r,d,a);this._inputBox=r;this.container=o;this._debuggerShell=e;this._isTracepointPrompt=s;o.className="lightDismissPromptContainer "+(s?"setTracepointContainer":"setConditionContainer");t.insertBefore(o,t.firstElementChild);this._dataEnteredCallback=i;this._canceledCallback=n;const c=document.createElement("button"),h=document.createElement("div");h.textContent=Object(l.b)(this.titleResourceId);const u=document.createElement("div");u.textContent=Object(l.b)(this.instructionsResourceId);const p=document.createElement("div");p.className="popupInputContainer";const g=document.createElement("div");g.className="popupButtonContainer";const m=document.createElement("label");m.textContent=Object(l.b)(s?"TracepointLabel":"ConditionalBreakpointLabel");m.id=s?"setTracepointLabel":"setConditionLabel";this._inputBox.className="promptInputBox";this._inputBox.addEventListener("keypress",this.onKeyPress.bind(this));this._inputBox.setAttribute("aria-labelledby",s?"setTracepointLabel":"setConditionLabel");c.addEventListener("click",this.submit.bind(this));c.innerText=Object(l.b)("OkButtonLabel");c.className="okButton";d.addEventListener("click",this.cancel.bind(this));d.innerText=Object(l.b)("CancelButtonLabel");d.className="cancelButton";d.type="button";this.subContainer.appendChild(h);this.subContainer.appendChild(u);p.appendChild(m);p.appendChild(this._inputBox);this.subContainer.appendChild(p);g.appendChild(c);g.appendChild(d);this.subContainer.appendChild(g)}getCancelCallbackArgs(){return this._breakpoint}get titleResourceId(){return this._isTracepointPrompt?"TracepointMessageTitle":"ConditionalBreakpointTitle"}get instructionsResourceId(){return this._isTracepointPrompt?"TracepointInstructions":"ConditionalBreakpointInstructions"}activate(e){this._breakpoint=e;if(this._breakpoint.isXHR())if(e.condition.length>q.a.XHR_BREAKPOINT_CONDITION.length+$.XHR_CONDITION_AND.length){const t=q.a.XHR_BREAKPOINT_CONDITION.length+$.XHR_CONDITION_AND.length;this._inputBox.value=e.condition.slice(t)}else{a.a.isTrue(e.condition.length===q.a.XHR_BREAKPOINT_CONDITION.length);this._inputBox.value=""}else this._inputBox.value=e.condition;this.container.style.top="";this.showControl();const t=this._debuggerShell.getFindResultsTop(),i=this.container.getBoundingClientRect(),n=i.height+6;t<i.top+n&&(this.container.style.top=t-n+"px");W.a.setAlertMessage(Object(l.b)("FullstopSeparatedStrings",Object(l.b)(this.titleResourceId),Object(l.b)(this.instructionsResourceId)));window.setImmediate(()=>{this._inputBox.focus();this._inputBox.setSelectionRange(0,this._inputBox.value.length)})}submit(){this.hideControl();this._breakpoint.isXHR()?this._inputBox.value.length>0?this._dataEnteredCallback(q.a.XHR_BREAKPOINT_CONDITION.concat($.XHR_CONDITION_AND,this._inputBox.value),this._breakpoint):this._dataEnteredCallback(q.a.XHR_BREAKPOINT_CONDITION,this._breakpoint):this._dataEnteredCallback(this._inputBox.value,this._breakpoint)}cancel(){this.hideControl();this._canceledCallback(this._breakpoint)}onKeyPress(e){if(13===e.keyCode){this.submit();e.stopPropagation();e.preventDefault();return!1}return!0}}$.XHR_CONDITION_AND=" && ";class Z{constructor(e,t,i){this._changesCompletedRegistrations={};this._deleteAllBreakpointsButton=i.querySelector("#deleteAllBreakpointsButton");this._toggleAllBreakpointsButton=i.querySelector("#toggleAllBreakpointsButton");this._addEventBreakpointButton=i.querySelector("#addEventBreakpointButton");this._addEventTracepointButton=i.querySelector("#addEventTracepointButton");this._addXHRBreakpointButton=i.querySelector("#addXHRBreakpointButton");j.a.setupButton(this._deleteAllBreakpointsButton,"BreakpointsDeleteAllButton",()=>{this._controller.deleteAll(g.c.Ui)},!1);j.a.setupButton(this._toggleAllBreakpointsButton,"BreakpointsDisableAllToggleButtonTooltip",()=>{this.toggleAll(g.c.Ui)},!1);!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("EventBreakpoint")?j.a.setupButton(this._addEventBreakpointButton,"BreakpointsAddEventBreakpointButtonTooltip",()=>{this.createEventBreakpoint()},!0):this._addEventBreakpointButton.style.display="none";!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("EventTracepoint")?j.a.setupButton(this._addEventTracepointButton,"BreakpointsAddEventTracepointButtonTooltip",()=>{this.createEventTracepoint()},!0):this._addEventTracepointButton.style.display="none";!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("BreakonXHR")?j.a.setupButton(this._addXHRBreakpointButton,"BreakpointsAddXHRButtonTooltip",()=>{this.createXHRBreakpoint(g.c.Ui)},!0):this._addXHRBreakpointButton.style.display="none";this._breakpointGrid=i.querySelector(".breakpointgrid");this._rootElement=i;this._rows=[];this._selectedRows=[];this._controller=t;document.body.addEventListener("click",()=>{if(this._menuTargetRow){this._menuTargetRow.classList.remove("contextTarget");this._menuTargetRow=null}});this._rootElement.addEventListener("keydown",e=>this.onKeyDown(e));this._setConditionPrompt=new $(e,document.getElementById("root"),(e,t)=>this._controller.setBreakpointCondition(t,e,!1),e=>{},!1);this._setTracepointPrompt=new $(e,document.getElementById("root"),(e,t)=>this._controller.setBreakpointCondition(t,e,!0),e=>{""===e.condition&&this._controller.deleteBreakpoint(e,V.a.DELETE_BREAKPOINT_IN_WINDOW,g.c.Ui)},!0);this._addEventBreakpointPrompt=new X(e,document.getElementById("root"),(e,t)=>{this._controller.addEventBreakpoint(e,t,!1,V.a.ADD_EVENT_BREAKPOINT,g.c.Ui);this.onEventBreakpointPromptClosed()},()=>{this.onEventBreakpointPromptClosed()},!1);this._addEventTracepointPrompt=new X(e,document.getElementById("root"),(e,t)=>{this._controller.addEventBreakpoint(e,t,!0,V.a.ADD_EVENT_TRACEPOINT,g.c.Ui);this.onEventTracepointPromptClosed()},()=>{this.onEventTracepointPromptClosed()},!0);document.addEventListener("keydown",this.updateSpecialKeysState.bind(this));document.addEventListener("keyup",this.updateSpecialKeysState.bind(this))}get focusedBreakpointRow(){return this._focusedBreakpointRow}set focusedBreakpointRow(e){for(const e of this._rows)e.rootElement.tabIndex=-1;e.rootElement.tabIndex=1;this._focusedBreakpointRow=e;e.rootElement.focus()}get selectedBreakpointRow(){return this._selectedBreakpointRow}set selectedBreakpointRow(e){this._selectedBreakpointRow=e;this.focusedBreakpointRow=e}showContextMenu(e,t,i,n){if(this._menuTargetRow){this._menuTargetRow.classList.remove("contextTarget");this._menuTargetRow=null}this._menuBreakpoint=i;this._menuTargetRow=n;this._menuTargetRow.classList.add("contextTarget");if(this._contextMenu){this._contextMenu.dispose();this._contextMenu=null}this._contextMenu=U.create(this.createMenuItems(i),"breakpointMenu");this._contextMenu.show(e,t)}promptToSetConditionOrTracepoint(e){window.setImmediate(()=>{e.isTracepoint?this._setTracepointPrompt.activate(e):this._setConditionPrompt.activate(e)})}breakpointAdded(e){this.addBreakpointToView(e);e.location&&(this._changesCompletedRegistrations[e.breakpointId]=e.location.changesCompleted.addHandler(()=>{const t=this.getRowFromBreakpoint(e);t&&t.refresh()}))}pendingBreakpointAdded(e){this.addBreakpointToView(e)}breakpointRemoved(e){const t=this.getRowFromBreakpoint(e);if(t){t.unselect();this._breakpointGrid.removeChild(t.rootElement);this._rows.splice(this._rows.indexOf(t),1);t.cleanup()}if(0===this._rows.length){j.a.changeButtonStatus(this._deleteAllBreakpointsButton,!1);j.a.changeButtonStatus(this._toggleAllBreakpointsButton,!1)}const i=this._changesCompletedRegistrations[e.breakpointId];if(i){i.unregister();this._changesCompletedRegistrations[e.breakpointId]=null}}breakpointChanged(e){V.b.logPerformance({id:H.b.Debugger_BreakpointWindow_BreakpointChanged_Start});const t=this.getRowFromBreakpoint(e);t&&t.refresh();if(this._controller.areAnyBreakpointsDisabled()){this._toggleAllBreakpointsButton.setAttribute("data-plugin-vs-tooltip",Object(l.b)("BreakpointsEnableAllToggleButtonTooltip"));this._toggleAllBreakpointsButton.setAttribute("aria-label",Object(l.b)("BreakpointsEnableAllToggleButtonTooltip"))}else{this._toggleAllBreakpointsButton.setAttribute("data-plugin-vs-tooltip",Object(l.b)("BreakpointsDisableAllToggleButtonTooltip"));this._toggleAllBreakpointsButton.setAttribute("aria-label",Object(l.b)("BreakpointsDisableAllToggleButtonTooltip"))}V.b.logPerformance({id:H.b.Debugger_BreakpointWindow_BreakpointChanged_Stop})}conditionPromptInvoked(e){this._setConditionPrompt.activate(e)}tracepointPromptInvoked(e){this._setTracepointPrompt.activate(e)}setEnabledStateForSelection(e,t,i){Object(V.c)(t,i,()=>{for(const t of this._selectedRows)t.breakpoint.isFrozen||this._controller.setEnabledState(t.breakpoint,e)})}selectAll(e,t){Object(V.c)(e,t,()=>{for(const e of this._rows)e.isSelected()||e.select()})}unselectAll(){for(const e of this._rows)e.unselect()}onDeleteBreakpointRow(e,t,i){if(e)if(this.isMultipleSelection()&&e.isSelected())this.deleteBreakpointsSelection(t,i);else{this.unselectAll();this.deleteBreakpoint(e,t,i)}}toggleAll(e){this._controller.toggleAll(e)}createEventBreakpoint(){Object(V.c)(V.a.ADD_EVENT_BREAKPOINT,g.c.Ui,()=>{this._addEventBreakpointPrompt.activate()})}createXHRBreakpoint(e){this._controller.addEventBreakpoint(["readystatechange",q.a.XHR_BREAKPOINT_FLAG],q.a.XHR_BREAKPOINT_CONDITION,!1,V.a.ADD_XHR_BREAKPOINT,e)}createEventTracepoint(){Object(V.c)(V.a.ADD_EVENT_TRACEPOINT,g.c.Ui,()=>{this._addEventTracepointPrompt.activate()})}addToSelection(e){if(!this._isAltKeyPressed&&-1===this._selectedRows.indexOf(e)){this._isCtrlKeyPressed||this._isShiftKeyPressed||this.unselectAll();if(this._isShiftKeyPressed&&!this._isCtrlKeyPressed){const t=this._rows.indexOf(this.selectedBreakpointRow),i=this._rows.indexOf(e);if(t>=0&&i>=0){const e=t<i?i:t;for(let n=t<i?t:i;n<=e;n++){const e=this._rows[n];if(!e.isSelected()){this._selectedRows.push(e);e.select()}}}}else this._isShiftKeyPressed||this._selectedRows.push(e)}}removeFromSelection(e){const t=this._selectedRows.indexOf(e);t>=0&&this._selectedRows.splice(t,1)}isMultipleSelection(){return this._selectedRows.length>1}onEventTracepointPromptClosed(){window.setImmediate(()=>{this._addEventTracepointButton.focus()})}onEventBreakpointPromptClosed(){window.setImmediate(()=>{this._addEventBreakpointButton.focus()})}deleteBreakpoint(e,t,i){this._rows.length>1&&(this._rows.indexOf(e)!==this._rows.length-1?this.selectNextBreakpoint(e):this.selectPreviousBreakpoint(e));this._controller.deleteBreakpoint(e.breakpoint,t,i)}deleteBreakpointsSelection(e,t){let i,n=-1;for(let e=this._rows.length-1;e>=0;e--)if(this._rows[e].isSelected()){n=e;break}n!==this._rows.length-1&&(i=this._rows[n+1]);const s=this._selectedRows;for(let i=s.length-1;i>=0;i--)this._controller.deleteBreakpoint(s[i].breakpoint,e,t);this._rows.length>0&&(i?i.select():this._rows[this._rows.length-1].select())}addBreakpointToView(e){const t=new J(e,this,this._controller);this._rows.push(t);this._breakpointGrid.appendChild(t.rootElement);this.breakpointChanged(e);if(1===this._rows.length){t.rootElement.tabIndex=1;this.selectedBreakpointRow=t}if(!j.a.isEnabled(this._deleteAllBreakpointsButton)){j.a.changeButtonStatus(this._deleteAllBreakpointsButton,!0);j.a.changeButtonStatus(this._toggleAllBreakpointsButton,!0)}}createMenuItems(e){const t=[];t.push({callback:(e,t)=>this.onGoToBreakpoint(e,t),disabled:()=>this.isMultipleSelection()||!e.isBound||!e.location,id:"menuItemGoToBreakpointWindow",label:Object(l.b)("BreakpointsContextMenuGoTo"),type:U.MenuItemType.command});t.push({id:"menuItemSep1BreakpointWindow",type:U.MenuItemType.separator});t.push({accessKey:Object(l.b)("/Common/AccessKeyAltF9"),callback:(e,t)=>this.onEditBreakpoint(e,t),disabled:()=>this.isMultipleSelection()||e.isFrozen,id:"menuItemAddTraceOrConditionBreakpointWindow",label:e.isTracepoint?Object(l.b)("BreakpointsContextMenuAddTraceMessage"):Object(l.b)("BreakpointsContextMenuAddCondition"),type:U.MenuItemType.command});t.push({callback:()=>{Object(V.c)(V.a.COPY_BREAKPOINT_IN_WINDOW,g.c.ContextMenu,()=>{this.onCopy()})},id:"menuItemCopyBreakpointWindow",label:Object(l.b)("BreakpointsContextMenuCopy"),type:U.MenuItemType.command});t.push({accessKey:Object(l.b)("/Common/AccessKeyF9"),callback:(e,t)=>this.onDeleteBreakpoint(e,t),id:"menuItemDeleteBreakpointWindow",label:Object(l.b)("BreakpointsContextMenuDelete"),type:U.MenuItemType.command});t.push({callback:(e,t)=>this.onDeleteAllBreakpoints(e,t),id:"menuItemDeleteAllBreakpointWindow",label:Object(l.b)("BreakpointsConextMenuDeleteAll"),type:U.MenuItemType.command});t.push({id:"menuItemSep2BreakpointWindow",type:U.MenuItemType.separator});t.push({accessKey:Object(l.b)("/Common/AccessKeyCtrlF9"),callback:()=>this.setEnabledStateForSelection(!0,V.a.SET_BREAKPOINT_STATE_IN_WINDOW,g.c.ContextMenu),disabled:()=>e.isEnabled||e.isFrozen,id:"menuItemEnableBreakpointWindow",label:Object(l.b)("BreakpointsContextMenuEnable"),type:U.MenuItemType.command});t.push({accessKey:Object(l.b)("/Common/AccessKeyCtrlF9"),callback:()=>this.setEnabledStateForSelection(!1,V.a.SET_BREAKPOINT_STATE_IN_WINDOW,g.c.ContextMenu),disabled:()=>!e.isEnabled||e.isFrozen,id:"menuItemDisableBreakpointWindow",label:Object(l.b)("BreakpointsContextMenuDisable"),type:U.MenuItemType.command});t.push({callback:(e,t)=>this.onEnableAllBreakpoints(e,t),id:"menuItemEnableAllBreakpointWindow",label:Object(l.b)("BreakpointsContextMenuEnableAll"),type:U.MenuItemType.command});t.push({callback:(e,t)=>this.onDisableAllBreakpoints(e,t),id:"menuItemDisableAllBreakpointWindow",label:Object(l.b)("BreakpointsContextMenuDisableAll"),type:U.MenuItemType.command});return t}onGoToBreakpoint(e,t){window.setImmediate(()=>{this._controller.navigateToBreakpoint(this._menuBreakpoint,V.a.GO_TO_BREAKPOINT,g.c.ContextMenu)})}onEditBreakpoint(e,t){const i=this.getRowFromBreakpoint(this._menuBreakpoint);i&&i.activateEditBox(V.a.SET_CONDITION_IN_EDITOR,g.c.ContextMenu)}onDeleteBreakpoint(e,t){this.onDeleteBreakpointRow(this.getRowFromBreakpoint(this._menuBreakpoint),V.a.DELETE_BREAKPOINT_IN_WINDOW,g.c.ContextMenu)}onDeleteAllBreakpoints(e,t){this._controller.deleteAll(g.c.ContextMenu)}onEnableAllBreakpoints(e,t){this._controller.setAllEnabledStates(!0,V.a.ENABLE_ALL_BREAKPOINTS,g.c.ContextMenu)}onDisableAllBreakpoints(e,t){this._controller.setAllEnabledStates(!1,V.a.DISABLE_ALL_BREAKPOINTS,g.c.ContextMenu)}onCopy(){const e=this._selectedRows.map(e=>e.breakpoint.toString()).join("\r\n");Object(K.copyPlainText)(e)}onKeyDown(e){let t=!1;switch(e.keyCode){case 65:if(e.ctrlKey&&!e.shiftKey&&!e.altKey){this.selectAll(V.a.SELECT_ALL_BREAKPOINTS_IN_WINDOW,g.c.KeyboardShortcut);t=!0}break;case 32:if(this.selectedBreakpointRow&&this.selectedBreakpointRow===this.focusedBreakpointRow){this.setEnabledStateForSelection(!this.selectedBreakpointRow.breakpoint.isEnabled,V.a.SET_BREAKPOINT_STATE_IN_WINDOW,g.c.KeyboardShortcut);t=!0}else if(this.focusedBreakpointRow){this.focusedBreakpointRow.select();t=!0}break;case 13:if(!this.isMultipleSelection()&&this.selectedBreakpointRow){this._controller.navigateToBreakpoint(this.selectedBreakpointRow.breakpoint,V.a.GO_TO_BREAKPOINT,g.c.KeyboardShortcut);t=!0}break;case 46:this.onDeleteBreakpointRow(this.selectedBreakpointRow,V.a.DELETE_BREAKPOINT_IN_WINDOW,g.c.KeyboardShortcut);t=!0;break;case 40:if(this.focusedBreakpointRow){if(!e.ctrlKey||e.altKey||e.shiftKey)if(!e.ctrlKey&&!e.altKey&&e.shiftKey&&this.focusedBreakpointRow.isSelected()&&this.isNextBreakpointSelected(this.focusedBreakpointRow)){this.focusedBreakpointRow.unselect();this.selectNextBreakpoint(this.focusedBreakpointRow)}else{e.shiftKey||e.ctrlKey||!this.isMultipleSelection()||this.unselectAll();this.selectNextBreakpoint(this.focusedBreakpointRow)}else this.focusNextBreakpoint(this.focusedBreakpointRow);t=!0}break;case 38:if(this.focusedBreakpointRow){if(!e.ctrlKey||e.altKey||e.shiftKey)if(!e.ctrlKey&&!e.altKey&&e.shiftKey&&this.focusedBreakpointRow.isSelected()&&this.isPreviousBreakpointSelected(this.focusedBreakpointRow)){this.focusedBreakpointRow.unselect();this.selectPreviousBreakpoint(this.focusedBreakpointRow)}else{e.shiftKey||e.ctrlKey||!this.isMultipleSelection()||this.unselectAll();this.selectPreviousBreakpoint(this.focusedBreakpointRow)}else this.focusPreviousBreakpoint(this.focusedBreakpointRow);t=!0}break;case 120:if(this.selectedBreakpointRow)if(!e.ctrlKey||e.altKey||e.shiftKey)if(e.ctrlKey||!e.altKey||e.shiftKey){if(!e.ctrlKey&&!e.altKey&&!e.shiftKey){this.onDeleteBreakpointRow(this.selectedBreakpointRow,V.a.DELETE_BREAKPOINT_IN_WINDOW,g.c.KeyboardShortcut);t=!0}}else{this._controller.promptToModifyConditionOrTracepoint(this.selectedBreakpointRow.breakpoint,V.a.SET_CONDITION_IN_WINDOW,g.c.KeyboardShortcut);t=!0}else{this.setEnabledStateForSelection(!this.selectedBreakpointRow.breakpoint.isEnabled,V.a.SET_BREAKPOINT_STATE_IN_WINDOW,g.c.KeyboardShortcut);t=!0}}if(t){e.preventDefault();e.stopPropagation();return!1}return!0}selectNextBreakpoint(e){const t=this._rows.indexOf(e);t<this._rows.length-1&&this._rows[t+1].select()}selectPreviousBreakpoint(e){const t=this._rows.indexOf(e);t>0&&this._rows[t-1].select()}focusNextBreakpoint(e){const t=this._rows.indexOf(e);t<this._rows.length-1&&(this.focusedBreakpointRow=this._rows[t+1])}focusPreviousBreakpoint(e){const t=this._rows.indexOf(e);t>0&&(this.focusedBreakpointRow=this._rows[t-1])}isNextBreakpointSelected(e){const t=this._rows.indexOf(e);return t<this._rows.length-1&&this._rows[t+1].isSelected()}isPreviousBreakpointSelected(e){const t=this._rows.indexOf(e);return t>0&&this._rows[t-1].isSelected()}getRowFromBreakpoint(e){for(const t of this._rows)if(t.breakpoint.equals(e))return t;return null}updateSpecialKeysState(e){this._isCtrlKeyPressed=e.ctrlKey;this._isShiftKeyPressed=e.shiftKey;this._isAltKeyPressed=e.altKey}}class Y{constructor(e,t,i,n,s,o){this.firstIndex=e;this.lastIndex=t;this.content=i;this.isFromComplexBlock=n;this.isStart=s;this.rangeType=o}}class Q{findRanges(e){var t=[];if(!e||0===e.length)return t;(t=(t=(t=(t=(t=t.concat(this.internalFindRanges("##forEach(",")##",e,"forEach",!0))).concat(this.internalFindRanges("##endForEach##",null,e,"forEach",!1))).concat(this.internalFindRanges("##if(",")##",e,"if",!0))).concat(this.internalFindRanges("##endIf##",null,e,"if",!1))).concat(this.internalFindRanges("##include(",")##",e,"include",!1))).sort(this.compareRanges);(t=t.concat(this.findRemainingRanges(e,t))).sort(this.compareRanges);return t}compareRanges(e,t){return e.firstIndex===t.firstIndex?0:e.firstIndex<t.firstIndex?-1:1}internalFindRanges(e,t,i,n,s){for(var o,r,a,l,d=0,c=[];d<i.length;){o=i.indexOf(e,d);r=null;a=null;l=null;if(-1===o)return c;if(t){if((d=o+e.length+1)>=i.length)return c;if(-1===(r=i.indexOf(t,d)))return c;a=i.substring(o+e.length,r);l=r+t.length-1}else l=o+e.length-1;c.push(new Y(o,l,a,!0,s,n));d=c[c.length-1].lastIndex+1}return c}findRemainingRanges(e,t){var i=[];if(0===t.length){i.push(new Y(0,e.length-1,e,!1,!1,"text"));return i}for(var n,s=0,o=0;o<t.length;o++){(n=t[o].firstIndex-s)>0&&i.push(new Y(s,s+n-1,e.substring(s,s+n),!1,!1,"text"));s=t[o].lastIndex+1}s<e.length-1&&i.push(new Y(s,e.length-1,e.substring(s,e.length),!1,!1,"text"));return i}}class ee{constructor(){this.blocks=[]}addBlock(e){this.blocks.push(e)}process(e,t){return""}}class te extends ee{constructor(e){super();this._text=e.content;this.containerType="text"}process(e){for(var t,i=this._text;t=this.findNextDelimitedString(i);){var n="",s=e;t.substring(te.DelimiterLength,t.length-te.DelimiterLength).split(".").forEach(e=>{s&&(s=s[e])});void 0!==s&&null!==s&&(n="string"==typeof s?s:s.toString());n=n.replace(te.GTRegex,"&gt;").replace(te.LTRegex,"&lt;").replace(te.DoubleQuoteRegex,"&quot;").replace(te.SingleQuoteRegex,"&apos;").replace(te.DollarRegex,"$$$$");i=i.replace(t,n)}return i}findNextDelimitedString(e){var t=te.DelimiterRegex.exec(e);return t?t[0]:null}}te.DelimiterRegex=/%%[$a-zA-Z_][$a-zA-Z0-9_]*(\.[$a-zA-Z_][$a-zA-Z0-9_]*)*%%/;te.GTRegex=/>/g;te.LTRegex=/</g;te.DoubleQuoteRegex=/"/g;te.SingleQuoteRegex=/'/g;te.DollarRegex=/[$]/g;te.DelimiterLength=2;class ie extends ee{constructor(e){super();this._template=e.content;this.containerType="include"}process(e,t){return new re(t,{htmlElementSource:document,templateId:this._template}).createTemplateText(e)}}class ne extends ee{constructor(e,t){super();this._negate=!1;this._useCapabilities=!1;this._decisionVariable=e.content;if("!"===this._decisionVariable[0]){this._negate=!0;this._decisionVariable=this._decisionVariable.substr(1)}if("@"===this._decisionVariable[0]){this._useCapabilities=!0;this._decisionVariable=this._decisionVariable.substr(1)}this.containerType="if"}process(e,t){var i="",n=(this._useCapabilities?t:e)[this._decisionVariable];if("function"==typeof n){n=n.call(e)}this._negate&&(n=!n);if(n)for(var s=0;s<this.blocks.length;s++)i+=this.blocks[s].process(e,t);return i}}class se extends ee{constructor(e,t){super();this._iterationVariable=e.content;this.containerType="forEach"}process(e,t){var i="",n=e[this._iterationVariable];if(n){var s,o;for(s=0;s<n.length;s++){var r=n[s];for(o=0;o<this.blocks.length;o++)i+=this.blocks[o].process(r,t)}}return i}}class oe{loadBlocks(e,t){for(var i,n,s,o,r=(new Q).findRanges(t),a=[e],l=0;l<r.length;l++)if("text"===(i=r[l]).rangeType)a[a.length-1].addBlock(new te(i));else if("include"===i.rangeType)a[a.length-1].addBlock(new ie(i));else if(i.isStart){"if"===i.rangeType?n=new ne(i,t):"forEach"===i.rangeType&&(n=new se(i,t));if(!n)throw new Error("unrecognized block type "+i.rangeType);a[a.length-1].addBlock(n);a.push(n);n=null}else{if((o=i.rangeType)!==(s=a[a.length-1].containerType))throw new Error("the current container ("+s+") is missing an end tag. Found a ("+o+") end tag instead");a.pop()}}}class re{constructor(e,t,i,n){this._templateId="";this._blocks=[];this.containerType="template";this._capabilities=e;if(t){this._htmlElementSource=t.htmlElementSource;this._templateId=t.templateId;var s=this._htmlElementSource.getElementById(this._templateId);if(!s)throw new Error("Template with id "+this._templateId+" is not valid.");var o=s.innerHTML,r=(o=this.removeInternodalWhitespace(o),this.localize(o,n));this.initialize(r)}else this.initialize(i)}addBlock(e){this._blocks.push(e)}createTemplateText(e){return this.processBlocks(e)}createTemplateElement(e){var t,i=this._htmlElementSource.createElement("div");i.innerHTML=this.createTemplateText(e);for(var n=0;n<i.childNodes.length;n++){if(i.childNodes[n].nodeType===Node.TEXT_NODE&&!i.childNodes[n].textContent.match(/^\s+$/))return i;if(i.childNodes[n].nodeType===Node.ELEMENT_NODE){if(t)return i;t=i.childNodes[n]}}return t}appendChild(e,t,i){var n=this.createTemplateElement(t);i&&n.classList.add(i);e.appendChild(n)}replaceChildren(e,t,i){e.innerHTML="";this.appendChild(e,t,i)}localize(e,t){if(!t)return e;var i,n=re.LocalizationRegex.exec(e);if(!n||0===n.length)return e;for(var s=0;s<n.length;s++){var o=(i=n[s]).substring(re.DelimiterLength,i.length-re.DelimiterLength),r=t.getString(o);e=e.replace(i,r)}return e}removeInternodalWhitespace(e){return e=(e=(e=e.trim()).replace(/>\s*\n\s*</g,"><")).replace(/<\/>/g,"")}initialize(e){(new oe).loadBlocks(this,e)}processBlocks(e){for(var t="",i=0;i<this._blocks.length;i++)t+=this._blocks[i].process(e,this._capabilities);return t}}re.LocalizationRegex=/%L%[a-zA-Z]+%L%/;re.DelimiterLength=3;var ae=i(57),le=i(20);class de{constructor(e,t,i,n,s,o,r){this._alternateTemplates=[];this._handlersAdded=[];this.htmlElementSource=e;this.listViewDivId=t;this.listRoot=e.getElementById(t);if(!this.listRoot)throw new Error("Can't find list root element with id '"+t+"'.");this._defaultTemplate=this.createTemplate(s,i,r);if(!this.listRoot)throw new Error("Can't find default template element with id '"+i+"'.");this.model=n;o&&o.forEach(e=>{var t=this.createTemplate(s,e.templateId);this._alternateTemplates.push({selectionFunction:e.templateMatchFunction,template:t})})}createTemplate(e,t,i){return new re(e,{htmlElementSource:this.htmlElementSource,templateId:t},null,i)}addAutoRemoveHandlers(e,t,i,n){var s=e=>this.eventHandler(n,e);i.forEach(i=>{for(var n=[],o=e.querySelectorAll("."+i),r=0;r<o.length;r++)n.push(o[r]);e.classList.contains(i)&&n.push(e);n.forEach(e=>{e.addEventListener(t,s);this._handlersAdded.push({element:e,event:t,handler:s})})})}addHandler(e,t,i,n){e.addEventListener(t,e=>this.eventHandler(n,e,i))}updateView(){return new Promise(e=>{this.model.load(()=>{this.renderView();e()})})}renderView(){this.clearView();this.preViewProcessing();for(var e=0;e<this.model.length;e++){this.preItemViewProcessing(e);let t=this.renderItem(this.model.item(e),"BPT-List-Item");this.listRoot.appendChild(t);this.postItemViewProcessing(e,t)}this.postViewProcessing();this.renderViewCallback&&this.renderViewCallback()}renderItem(e,t){var i=this.chooseTemplate(e).createTemplateElement(e);t&&i.classList.add(t);return i}renderItemWithTemplate(e,t,i){let n=this.createTemplate(t,i,null),s=null;n&&(s=n.createTemplateElement(e));return s}renderItemText(e){return this.chooseTemplate(e).createTemplateText(e)}clearView(){this.removeAllHandlers();Object(ae.a)(this.listRoot).children().remove()}removeAllHandlers(){this._handlersAdded.forEach(e=>{e.element.removeEventListener(e.event,e.handler)});this._handlersAdded=[]}setFocus(e){this.setTabIndex(e);e.focus()}setTabIndex(e,t=1){for(var i=this.listRoot.querySelectorAll("[tabIndex='1']"),n=0;n<i.length;n++)i[n].removeAttribute("tabIndex");e.setAttribute("tabIndex",t.toString())}postViewProcessing(){this.addAutoRemoveHandlers(this.listRoot,"mouseenter",[de.TOOLTIP_ITEM],e=>{var t=e.target.getAttribute("data-tooltip");t&&le.c({content:t});return!0});this.addAutoRemoveHandlers(this.listRoot,"mouseleave",[de.TOOLTIP_ITEM],()=>{le.a();return!0})}preViewProcessing(){}preItemViewProcessing(e){}postItemViewProcessing(e,t){}chooseTemplate(e){var t=null;this._alternateTemplates.forEach(i=>{i.selectionFunction(e)&&(t=i.template)});t||(t=this._defaultTemplate);return t}eventHandler(e,t,i){if(!b.a.isContextMenuUp()){var n=t.target;if(n){var s;if(i&&i.length&&n.classList){s=!1;for(var o=0;o<i.length;o++)if(n.classList.contains(i[o])){s=!0;break}}else s=!0;if(s&&!e(t)){t.preventDefault();t.stopPropagation()}}}}}de.TOOLTIP_ITEM="BPT-Tooltip-Item";class ce{constructor(e,t,i,n,s,o,r){this._idPropertyName=e;this._sortPropertyName=t;this._insertBeforeCallback=i;this._updateCallback=n;this._deleteCallback=s;this._isChanged=o;this._clearDirtyFlag=r;this._isChanged||(this._isChanged=((e,t)=>e!==t))}reconcile(e,t){null!==e&&void 0!==e||(e=[]);null!==t&&void 0!==t||(t=[]);this._sortPropertyName&&t.sort((e,t)=>{var i=e[this._sortPropertyName],n=t[this._sortPropertyName];return i===n?0:i<n?-1:1});for(var i=0,n=0;i<e.length||n<t.length;)if(n>=t.length)this._deleteCallback(e[i++]);else if(i>=e.length)this._insertBeforeCallback(t[n++],i<e.length?e[i]:null);else if(t[n][this._idPropertyName]===e[i][this._idPropertyName]){if(this._isChanged(t[n],e[i])){this._updateCallback(t[n],e[i]);this._clearDirtyFlag&&this._clearDirtyFlag(t[n])}n++;i++}else t[n][this._sortPropertyName]>e[i][this._sortPropertyName]?this._deleteCallback(e[i++]):this._insertBeforeCallback(t[n++],e[i])}}class he extends de{constructor(e,t,i,n,s,o,r,a,l,d,c){super(e,t,i,n,s,o,r);this.objectsPreviouslyRendered=[];this.htmlElementSource=e;this.listViewDivId=t;this.idPropertyName=a;this._sortPropertyName=l;this.idPropertyName&&this._sortPropertyName&&(this.listReconciler=new ce(a,l,this.insertBefore.bind(this),this.update.bind(this),this.deleteItem.bind(this),d,c))}renderView(){if(this.listReconciler){this.preViewProcessing();this.listReconciler.reconcile(this.objectsPreviouslyRendered,this.model.cache);this.objectsPreviouslyRendered=this.model.cache.slice(0);this.postViewProcessing();this.renderViewCallback&&this.renderViewCallback()}else super.renderView()}beforeUpdate(e,t,i){}afterUpdate(e,t,i){}beforeDelete(e,t){}afterDelete(){}clearView(){super.clearView();this.objectsPreviouslyRendered=[]}insertBefore(e,t){var i=this.renderItem(e,he.ListItemClassName);if(t){var n=this.listRoot.querySelector("[data-listid='"+t[this.idPropertyName]+"']");n?this.listRoot.insertBefore(i,n):this.listRoot.appendChild(i)}else this.listRoot.appendChild(i)}update(e,t){var i=this.listRoot.querySelector("[data-listid='"+t[this.idPropertyName]+"']");if(i){this.beforeUpdate(e,t,i);var n=this.renderItemText(e);i.outerHTML=n;i.classList.add(he.ListItemClassName);this.afterUpdate(e,t,i)}}deleteItem(e){var t=this.listRoot.querySelector("[data-listid='"+e[this.idPropertyName]+"']");if(t){this.beforeDelete(e,t);t.parentNode.removeChild(t);this.afterDelete()}}}he.ListItemClassName="BPT-List-Item";const ue=(e,t)=>b.a.loadString(e,t);function pe(e,t){for(;e;){if(e.classList.contains(t))return e;e=e.parentElement}return null}class ge{static isCurrentFocusOnInput(){var e=document.activeElement;return ge.isTextArea(e)||ge.isInputText(e)}static isTextArea(e){if(!e)return!1;var t=e.tagName;return"string"==typeof t&&"TEXTAREA"===t.toUpperCase()}static isInputText(e){if(!e)return!1;var t=e.tagName;return"string"==typeof t&&("INPUT"===t.toUpperCase()&&e.hasAttribute("type")&&"text"===e.getAttribute("type"))}static findDescendentByClass(e,t){return e?e.querySelector("."+t):null}}class me extends he{constructor(e,t,i,n,s,o,r,a,l,d,c,h){super(e,t,i,n,s,r,a,l,d,c,h);this._expansionChangeCallback=o;this.addClickHandlerThatExpandsAndCollapsesChildren();this.addKeyboardNavigationHandlers();this.addFocusSettingDivClickHandler()}postViewProcessing(){super.postViewProcessing();var e=this.getMenuConfig();e&&(this._contextMenuController=new _e(this,this.listRoot,e));var t=ge.findDescendentByClass(this.listRoot,me.HEADER_CLASS);t&&(t.tabIndex=1)}findHeaderOrChild(e){for(;e.parentElement&&!e.classList.contains(me.HEADER_CLASS)&&!e.classList.contains(me.CHILD_VALUE_CONTAINER_CLASS);)e=e.parentElement;return e}getMenuConfig(){return null}beforeUpdate(e,t,i){this._lastItemHadFocus=!1;this._subItemWithFocus=null;if(this.idPropertyName){var n=this.htmlElementSource.activeElement;if(n){var s=ge.findDescendentByClass(i,me.HEADER_CLASS),o=pe(n,me.LIST_ITEM_CLASS),r=ge.findDescendentByClass(o,me.HEADER_CLASS);this._lastItemHadFocus=s===r;n.classList.contains(me.CHILD_VALUE_CONTAINER_CLASS)&&(this._subItemWithFocus=n.getAttribute("data-listsubid"))}}}afterUpdate(e,t){if(this._lastItemHadFocus){var i;this._subItemWithFocus&&(i=this.listRoot.querySelector("[data-listsubid='"+this._subItemWithFocus+"']"));i||(i=this.listRoot.querySelector("[data-listid='"+t[this.idPropertyName]+"'] > ."+me.HEADER_CLASS));i&&this.setFocus(i)}}beforeDelete(e,t){var i=pe(this.htmlElementSource.activeElement,me.LIST_ITEM_CLASS);this._lastItemHadFocus=i===t}afterDelete(){if(this._lastItemHadFocus){var e=ge.findDescendentByClass(this.listRoot,me.HEADER_CLASS);e&&this.setFocus(e)}}toggleExpander(e){var t=e.parentElement,i="true"===t.getAttribute("aria-expanded");t.setAttribute("aria-expanded",i?"false":"true");this._expansionChangeCallback&&this._expansionChangeCallback(e.parentElement.parentElement.getAttribute("data-listid"),!i)}collapseSection(e){e.parentElement.setAttribute("aria-expanded","false");this._expansionChangeCallback&&this._expansionChangeCallback(e.parentElement.parentElement.getAttribute("data-listid"),!0)}addClickHandlerThatExpandsAndCollapsesChildren(){this.addHandler(this.listRoot,"click",[me.EXPAND_ICON_CLASS],e=>{this.toggleExpander(e.target);return!1})}addKeyboardNavigationHandlers(){this.addHandler(this.listRoot,"keydown",null,e=>{if(e.ctrlKey||e.shiftKey||e.altKey)return!0;if(b.a.isContextMenuUp())return!0;if(ge.isCurrentFocusOnInput())return!0;var t=e.srcElement;if(e.key===D.h.DOWN)this.moveFocusDown(t);else if(e.key===D.h.UP)this.moveFocusUp(t);else if(e.key===D.h.LEFT)this.focusParentOrCollapse(t);else if(e.key===D.h.RIGHT)this.expandOrFocusChild(t);else if(e.key===D.h.HOME)this.moveFocusToFirst(t);else{if(e.key!==D.h.END)return!0;this.moveFocusToLast(t)}return!1})}focusParentOrCollapse(e){if(this.isChild(e)){var t=e.parentElement.parentElement.children[0];this.setFocus(t)}else{var i=ge.findDescendentByClass(e.parentElement,me.EXPAND_ICON_CLASS);if(i){"true"===i.parentElement.getAttribute("aria-expanded")&&this.toggleExpander(i)}}}expandOrFocusChild(e){if(!this.isChild(e))if("true"===e.getAttribute("aria-expanded")){var t=e.nextElementSibling;if(t&&t.children&&t.children.length){var i=t.children[0];this.setFocus(i)}}else{var n=ge.findDescendentByClass(e,me.EXPAND_ICON_CLASS);n&&this.toggleExpander(n)}}findFocusableUp(e){var t,i=e.previousElementSibling;if(i)return i;if(this.isChild(e)){t=e.parentElement.parentElement;return ge.findDescendentByClass(t,me.HEADER_CLASS)}var n=(t=e.parentElement).previousElementSibling;if(!n)return null;var s=ge.findDescendentByClass(n,me.HEADER_CLASS);if("true"===s.getAttribute("aria-expanded")&&n.children&&n.children.length>=2){return n.children[1].lastElementChild}return s}moveFocusUp(e){var t=this.findFocusableUp(e);t&&this.setFocus(t)}moveFocusToFirst(e){for(var t,i=e;t=this.findFocusableUp(i);)i=t;i&&this.setFocus(i)}findFocusableDown(e){var t,i=e.nextElementSibling;if(i&&this.isChild(e))return i;if(this.isChild(e))t=e.parentElement.parentElement;else{if("true"===e.getAttribute("aria-expanded")){var n=e.nextElementSibling;if(n&&n.children.length){return n.children[0]}}t=e.parentElement}var s=t.nextElementSibling;return s?ge.findDescendentByClass(s,me.HEADER_CLASS):null}moveFocusDown(e){var t=this.findFocusableDown(e);t&&this.setFocus(t)}moveFocusToLast(e){for(var t,i=e;t=this.findFocusableDown(i);)i=t;i&&this.setFocus(i)}isChild(e){return e.classList.contains(me.CHILD_VALUE_CONTAINER_CLASS)}addFocusSettingDivClickHandler(){this.addHandler(this.listRoot,"click",null,e=>{var t=this.findHeaderOrChild(e.target);t.focus&&this.setFocus(t);return!0})}}me.LIST_ITEM_CLASS="BPT-ExpandingList-Item";me.EXPAND_ICON_CLASS="BPT-ExpandingList-ExpandIcon";me.HEADER_CLASS="BPT-ExpandingList-Header";me.CHILD_VALUE_CONTAINER_CLASS="BPT-ExpandingList-Child-Value-Container";class _e{constructor(e,t,i){this._menuId="ExpandingViewContextMenu"+_e.Uid++;this._expandingView=e;this._elementListener=t;this._config=i;this.initialize();this._menuItems=[];var n=0;this._config.menuItems.forEach(e=>{if(e.isSeparator){let e={id:`separator${++n}`,type:U.MenuItemType.separator};this._menuItems.push(e)}else{let t="function"==typeof e.textIdentifier?e.textIdentifierFallback||"":e.textIdentifier,i={id:e.name,type:"function"==typeof e.isChecked?U.MenuItemType.checkbox:U.MenuItemType.command,label:b.a.loadString(t)};this._menuItems.push(i)}})}uninitialize(){this._elementListener.removeEventListener("contextmenu",this._contextMenuListener);this._elementListener.removeEventListener("keydown",this._keydownListener)}dismiss(){if(this._contextMenu){this._contextMenu.removeEventListener("dismiss",this._dismissHandler);this._contextMenu.dismiss();this._contextMenu.dispose();this._contextMenu=null}b.a.contextMenuUp(!1)}initialize(){this._contextMenuListener=(e=>this.onContextMenu(e));this._keydownListener=(e=>this.onKeydown(e));this._elementListener.addEventListener("contextmenu",this._contextMenuListener);this._elementListener.addEventListener("keydown",this._keydownListener)}onKeydown(e){var t=e.shiftKey&&!e.ctrlKey&&!e.altKey;if(121===e.keyCode&&t){var i=document.querySelector("#"+this._expandingView.listViewDivId+" :focus")||this._elementListener,n=i.getBoundingClientRect();this.showContextMenu(i,n.left,n.top);e.preventDefault();e.stopImmediatePropagation()}return!0}onContextMenu(e){var t=null,i=e.clientX,n=e.clientY;if(this._config.getSelectedItem)t=this._config.getSelectedItem(i,n);else if(this._expandingView)if(i<=0||n<=0){if(t=document.querySelector("#"+this._expandingView.listViewDivId+" :focus")){var s=t.getBoundingClientRect();i=s.left;n=s.top}}else(t=this._expandingView.findHeaderOrChild(document.elementFromPoint(i,n)))&&this._expandingView.setFocus(t);this.showContextMenu(t,i,n);e.preventDefault();e.stopImmediatePropagation();return!1}onMenuItemClicked(e,t,i){for(var n=0;n<this._menuItems.length;n++)if(this._menuItems[n].id===t){this._config.menuItems[n].execute(i);break}this.dismiss()}showContextMenu(e,t,i){this.dismiss();this._selection=e;if(!this._contextMenu){for(var n=0;n<this._menuItems.length;n++){this._menuItems[n].disabled=this.createIsDisabledFunction(this._config.menuItems[n].isDisabled);this._menuItems[n].checked=this.createIsDisabledFunction(this._config.menuItems[n].isChecked);"function"==typeof this._config.menuItems[n].textIdentifier?this._menuItems[n].label=ue(this._config.menuItems[n].textIdentifier(e)):this._menuItems[n].type!==U.MenuItemType.separator&&(this._menuItems[n].label=ue(this._config.menuItems[n].textIdentifier))}this._contextMenu=U.create(this._menuItems,this._menuId,null,null,(e,t)=>this.onMenuItemClicked(e,t.id,this._selection));this._dismissHandler=(()=>{this.dismiss()})}this._elementListener&&this._contextMenu.attach(this._elementListener);this._contextMenu.show(parseInt(t.toFixed(0)),parseInt(i.toFixed(0)));this._contextMenu.addEventListener("dismiss",this._dismissHandler);b.a.contextMenuUp(!0);return!1}createIsDisabledFunction(e){return e?()=>e(this._selection):()=>!1}}_e.Uid=0;const be=(e,t)=>b.a.loadString(e,t);class fe extends me{constructor(e,t,i,n,s){super(t,i,n,s,null,(e,t)=>s.setExpansionState(parseInt(e,10),t),[],null,"id",null,null,null);this.dmbpManager=e;this.dmbpModel=s;this._listElement=this.htmlElementSource.getElementById(this.listViewDivId);this.menuItems=[{name:"breakOnSubtreeModified",textIdentifier:"menuTextBreakOnSubtreeModified",isChecked:e=>this.checkBreakpointHasType(e,"subtree-modified"),execute:e=>this.onToggleBreakpointType(e,"subtree-modified"),isDisabled:e=>{return this.findViewModelForElement(e).isPending}},{name:"breakOnAttrModified",textIdentifier:"menuTextBreakOnAttrModified",isChecked:e=>this.checkBreakpointHasType(e,"attribute-modified"),execute:e=>this.onToggleBreakpointType(e,"attribute-modified"),isDisabled:e=>{return this.findViewModelForElement(e).isPending}},{name:"breakOnNodeRemoved",textIdentifier:"menuTextBreakOnNodeRemoved",isChecked:e=>this.checkBreakpointHasType(e,"node-removed"),execute:e=>this.onToggleBreakpointType(e,"node-removed"),isDisabled:e=>{let t=this.findViewModelForElement(e);return t.isPending||"html"===t.selector}},{name:"separator",isSeparator:!0,execute:e=>{}},{name:"enableDisableDmbp",textIdentifier:e=>{let t=this.findViewModelForElement(e);return t?t.isPending?fe.MENU_ENABLE:"enabled"===t.state?fe.MENU_DISABLE:fe.MENU_ENABLE:fe.MENU_ENABLE},textIdentifierFallback:fe.MENU_ENABLE,execute:e=>this.onToggleEnabled(e)},{name:"deleteDmbp",textIdentifier:"menuTextDeleteDmbp",execute:e=>this.onDeleteBreakpoint(e)},{name:"rebindDmbp",textIdentifier:"menuTextRebindDmbp",execute:e=>this.onRebindBreakpoint(e),isDisabled:e=>{let t=this.findViewModelForElement(e);return!!t&&!t.isPending}}];this.dmbpModel.addEventListener("modelChanged",e=>{this.model.length>0&&this.activateTab();this.updateView();this.updateButtonState()});this.addClickHandlerThatNavigatesToBoundElement();this.addClickHandlerForInlineActions();this.bindToolbarEvents();this.updateView()}postItemViewProcessing(e,t){let i=t.querySelectorAll(".BPT-ActionIcon");for(let e=0;e<i.length;e++){let t=i[e];t.dataset.tooltipId&&(t.dataset.pluginVsTooltip=be(t.dataset.tooltipId))}if(e===this.enableToggleRefocusIndex){this.setFocus(t);this.enableToggleRefocusIndex=void 0}}findHeaderOrChild(e){for(;e.parentElement&&!(e.classList.contains(me.HEADER_CLASS)||e.classList.contains(me.CHILD_VALUE_CONTAINER_CLASS)||e.classList.contains(fe.SUBSECTION_HEADER_CLASS));)e=e.parentElement;return e}bindToolbarEvents(){let e=this.htmlElementSource.querySelector(fe.TOOLBAR_ELEMENT_SELECTOR);this.rebindAllButton=e.querySelector(fe.REBIND_ALL_SELECTOR);this.rebindAllButton.addEventListener("click",()=>{this.dmbpModel.canRebindAll()&&this.dmbpModel.rebindAll()});this.rebindAllButton.addEventListener("keyup",e=>{32!==e.keyCode&&13!==e.keyCode||this.dmbpModel.canRebindAll()&&this.dmbpModel.rebindAll()});this.setToolbarButtonText(this.rebindAllButton,be("tooltipTextRebindAllDmbp"));this.toggleAllButton=e.querySelector(fe.TOGGLE_ENABLE_ALL_SELECTOR);this.toggleAllButton.addEventListener("click",()=>{this.dmbpModel.canToggleAll()&&this.dmbpModel.toggleAll()});this.toggleAllButton.addEventListener("keyup",e=>{32!==e.keyCode&&13!==e.keyCode||this.dmbpModel.canToggleAll()&&this.dmbpModel.toggleAll()});this.setToolbarButtonText(this.toggleAllButton,be(fe.TEXT_DISABLEALL_DMBP));this.deleteAllButton=e.querySelector(fe.DELETE_ALL_SELECTOR);this.deleteAllButton.addEventListener("click",()=>{this.dmbpModel.canDeleteAll()&&this.dmbpModel.deleteAll()});this.deleteAllButton.addEventListener("keyup",e=>{32!==e.keyCode&&13!==e.keyCode||this.dmbpModel.canDeleteAll()&&this.dmbpModel.deleteAll()});this.setToolbarButtonText(this.deleteAllButton,be("tooltipTextDeleteAllDmbp"))}setToolbarButtonText(e,t){e.dataset.pluginVsTooltip=t;let i=e.querySelector(`.${fe.ACTIONICON_CLASS}`);i&&(i.textContent=t)}findListItemElement(e){for(let t=e;t;t=t.parentElement)if(t.classList.contains(fe.LIST_ITEM_CLASS))return t;return null}updateButtonState(){let e=this.dmbpModel.canRebindAll();this.rebindAllButton.dataset.enabled=String(e);this.rebindAllButton.setAttribute("aria-disabled",String(!e));let t=this.dmbpModel.canToggleAll();this.toggleAllButton.dataset.enabled=String(t);this.toggleAllButton.setAttribute("aria-disabled",String(!t));let i=this.dmbpModel.canDeleteAll();this.deleteAllButton.dataset.enabled=String(i);this.deleteAllButton.setAttribute("aria-disabled",String(!i));this.dmbpModel.getToggleAllType()?this.setToolbarButtonText(this.toggleAllButton,be(fe.TEXT_ENABLEALL_DMBP)):this.setToolbarButtonText(this.toggleAllButton,be(fe.TEXT_DISABLEALL_DMBP))}findViewModelForElement(e){let t=this.findListItemElement(e);if(!t)return null;let i=parseInt(t.dataset.id,10);return this.dmbpModel.findBPVMByViewModelId(i)}getMenuConfig(){return this}canToggleEnabled(e){let t=this.findViewModelForElement(e);return!!t&&!t.isPending}onToggleEnabled(e){let t=this.findViewModelForElement(e);t&&(t.isPending?this.dmbpManager.attemptRebind(t.pendingId):this.dmbpManager.setDomMutationBreakpointEnabledState(t.breakpointId,"enabled"!==t.state))}canRebind(e){let t=this.findViewModelForElement(e);return!!t&&t.isPending}onRebindBreakpoint(e){let t=this.findViewModelForElement(e);t&&t.isPending&&this.dmbpManager.attemptRebind(t.pendingId)}onDeleteBreakpoint(e){let t=this.findViewModelForElement(e);t&&(t.isPending?this.dmbpManager.deletePendingBreakpoint(t.pendingId):this.dmbpManager.removeDomMutationBreakpoint(t.breakpointId))}onToggleBreakpointType(e,t){let i=this.findViewModelForElement(e);i&&(i.isPending?this.dmbpManager.attemptRebind(i.pendingId):this.dmbpManager.toggleBreakpointForElement(i.elementUniqueId,t))}checkBreakpointHasType(e,t){let i=this.findViewModelForElement(e);if(!i)return!1;let n=E.fromDmbpType(t);return i.types.indexOf(n)>-1}addClickHandlerThatNavigatesToBoundElement(){this.addHandler(this.listRoot,"click",[fe.SELECTOR_CLASS],e=>{let t=this.findViewModelForElement(e.srcElement);"unbound"!==t.state&&this.navigateToElementByUid(t.elementUniqueId)})}addClickHandlerForInlineActions(){this.addHandler(this.listRoot,"click",[fe.ACTIONICON_CLASS],e=>{switch(e.srcElement.parentElement.classList.item(0)){case fe.REBIND_ELEMENT_CLASS:this.onRebindBreakpoint(e.srcElement);break;case fe.DELETE_ELEMENT_CLASS:this.onDeleteBreakpoint(e.srcElement)}});this.addHandler(this.listRoot,"click",[fe.ENABLEMENT_TOGGLE_CLASS],e=>{this.onToggleEnabled(e.srcElement)});this.addHandler(this.listRoot,"keyup",[fe.LIST_ITEM_CLASS],e=>{let t=this.findListItemElement(e.srcElement);if(!t)return;let i=!1;if(46===e.keyCode){this.onDeleteBreakpoint(t);i=!0}else if(32===e.keyCode){this.canToggleEnabled(t)&&this.onToggleEnabled(t);i=!0;let e=this.getSelectedItemIndex();this.enableToggleRefocusIndex=e}if(i){e.preventDefault();e.stopImmediatePropagation()}})}findFocusableUp(e){return e&&(e.classList.contains(fe.LIST_ITEM_CLASS)||(e=this.findDmbpListItemFromElement(e)))?e.previousElementSibling:null}findFocusableDown(e){return e&&(e.classList.contains(fe.LIST_ITEM_CLASS)||(e=this.findDmbpListItemFromElement(e)))?e.nextElementSibling:null}setFocus(e){e=this.findDmbpListItemFromElement(e);let t=this._listElement.querySelectorAll(`.${fe.LIST_ITEM_CLASS}`);for(let i=0;i<t.length;i++){let n=t.item(i);n===e?n.classList.add(fe.SELECTED_ITEM_CLASS):n.classList.remove(fe.SELECTED_ITEM_CLASS)}super.setFocus(e)}findDmbpListItemFromElement(e){const t=fe.LIST_ITEM_CLASS;if(e.classList.contains(t))return e;let i=e.querySelector(`.${t}`);if(i)return i;for(;e;)if((e=e.parentElement).classList.contains(t))return e;return null}getSelectedItemIndex(){const e=fe.LIST_ITEM_CLASS;let t=this._listElement.querySelector(`.${e}`);if(!t)return-1;let i=0;for(;null!=t;){if(t.classList.contains(fe.SELECTED_ITEM_CLASS))return i;t=t.nextElementSibling;i++}return-1}}fe.LIST_ITEM_CLASS="BPT-DMBP-ListItem";fe.SELECTOR_CLASS="BPT-Dmbp-Selector";fe.SELECTED_ITEM_CLASS="BPT-DMBP-Selected";fe.REBIND_ALL_SELECTOR=".BPT-Icon-DMBP-RebindAll";fe.TOGGLE_ENABLE_ALL_SELECTOR=".BPT-Icon-DMBP-ToggleEnableAll";fe.DELETE_ALL_SELECTOR=".BPT-Icon-DMBP-DeleteAll";fe.REBIND_ELEMENT_CLASS="BPT-Icon-DMBP-Rebind";fe.DELETE_ELEMENT_CLASS="BPT-Icon-DMBP-Delete";fe.ACTIONICON_CLASS="BPT-ActionIcon";fe.ENABLEMENT_TOGGLE_CLASS="BPT-DMBP-EnablementToggle";fe.TOOLBAR_ELEMENT_SELECTOR="#dmbpToolbar";fe.SUBSECTION_HEADER_CLASS="BPT-ExpandingList-Collapsed-Section";fe.MENU_ENABLE="menuTextEnableDmbp";fe.MENU_DISABLE="menuTextDisableDmbp";fe.TEXT_ENABLEALL_DMBP="tooltipTextEnableAllDmbp";fe.TEXT_DISABLEALL_DMBP="tooltipTextDisableAllDmbp";var Ee=i(50);const Ce="dmbpBreakpointTemplate";class ye extends fe{constructor(e,t,i,n,s,o){super(t,i,n,ye.TEMPLATE_NAME_BREAKPOINT,o);this._debugger=e;this._dmbpManager=t;this._model=o;this.domTreeService=Ee.c.get("DomTreeService")}activateTab(){}navigateToElementByUid(e){s.b.activateTab(N.c.dom);this.domTreeService.trySelectNode(null,e)}}ye.TEMPLATE_NAME_BREAKPOINT=Ce;class Ie{constructor(){this.tabs=[];this.activeIndex=-1;this.containerElement=document.createElement("div");this.tabStrip=document.createElement("div");this.tabStrip.className="tabStrip";this.tabStrip.setAttribute("role","tablist");this.containerElement.className="controlsContainer";this.containerElement.appendChild(this.tabStrip);this.contentPane=document.createElement("div");this.contentPane.className="contentPane";this.containerElement.appendChild(this.contentPane);this.contentVisible=!0}addTab(e,t,i,n){const s=Object(l.b)(t),o=Object(l.b)(i),r=document.createElement("span");r.id="tab-"+e;r.className="tabTitle";r.innerText=s;r.tabIndex=n||1;r.setAttribute("data-plugin-vs-tooltip",o);r.setAttribute("aria-label",o);r.setAttribute("role","tab");r.setAttribute("aria-selected","true");const a=this.tabs.length,d=()=>{this.switchToTab(a);this.contentVisible||(this.contentVisible=!0)};r.addEventListener("click",d);r.addEventListener("focus",d);r.addEventListener("keydown",e=>{if(32===e.keyCode||13===e.keyCode){this.switchToTab(a);this.contentVisible||(this.contentVisible=!0)}else 37===e.keyCode?a>0?this.switchToTab(a-1):0===a&&this.switchToTab(this.tabs.length-1):39===e.keyCode&&(a<this.tabs.length-1?this.switchToTab(a+1):a===this.tabs.length-1&&this.switchToTab(0))});this.tabStrip.appendChild(r);const c=document.getElementById(e);c.classList.add("controlContents");this.contentPane.appendChild(c);this.tabs.push({titleElement:r,contentElement:c});if(-1===this.activeIndex){this.activeIndex=0;this.tabs[this.activeIndex].contentElement.classList.add("controlVisible");this.tabs[this.activeIndex].titleElement.classList.add("selected")}}switchToTab(e,t){if(this.tabs[e]){if(this.activeIndex!==e){this.tabs[this.activeIndex].contentElement.classList.remove("controlVisible");this.tabs[this.activeIndex].titleElement.classList.remove("selected");this.tabs[this.activeIndex].titleElement.tabIndex=-1;this.activeIndex=e;this.tabs[this.activeIndex].contentElement.classList.add("controlVisible");this.tabs[this.activeIndex].titleElement.classList.add("selected");this.tabs[this.activeIndex].titleElement.tabIndex=1;b.a.fireCustomEvent(this.tabs[this.activeIndex].contentElement,"tabActivated")}t||this.tabs[this.activeIndex].titleElement.focus()}}}var Se=i(119),Te=i(174),ve=i(54),ke=i(17),De=i(36),Me=i(31),xe=i(48),we=i(89);const Oe=Object(A.a)();let Pe;function Be(e,t=[],i=0,n=""){Pe=e;const s=Object(l.b)(e,...t),o=document.getElementById("errorOverlayAnchor");Oe.show(s,i,n,o)}function Re(e){e===Pe&&Oe.close()}var Le=i(52),Ae=i(21),Fe=i(63),Ne=i(111),We=i(99),je=i(7);const Ke=16,Ue={alignRight:Object(je.css)({marginLeft:"auto",marginRight:0}),base:Object(je.css)({"@media(-ms-high-contrast:active)":{backgroundColor:"Window"},display:"flex",flexDirection:"column",height:"100%",lineHeight:"1.6em",overflow:"hidden",width:"100%"}),buttonSelected:Object(je.css)({"@media(-ms-high-contrast:active)":{":hover":{backgroundColor:"Highlight"}},backgroundColor:"ActiveBorder"}),buttonUnselected:Object(je.css)({"@media(-ms-high-contrast:active)":{":hover":{backgroundColor:"Highlight"}}}),fileNameStyle:Object(je.css)({"@media(-ms-high-contrast:active)":{color:"WindowText"},fontSize:13,paddingRight:8}),fileRowStyle:Object(je.css)({display:"flex",fontSize:12,whiteSpace:"nowrap"}),highlightedText:Object(je.css)({"@media(-ms-high-contrast:active)":{backgroundColor:"Highlight",borderColor:"Highlight",color:"HighlightText"},backgroundColor:"#ffe6b3",borderColor:"#ffcc66",borderWidth:1}),icon:Object(je.css)({display:"block",margin:"auto"}),lineContent:Object(je.css)({"@media(-ms-high-contrast:active)":{color:"WindowText"},color:"#717171",paddingLeft:8,whiteSpace:"nowrap"}),lineNumber:Object(je.css)({"@media(-ms-high-contrast:active)":{color:"WindowText"},whiteSpace:"nowrap"}),monospace:Object(je.css)({display:"flex",fontFamily:"monospace",fontSize:13,paddingLeft:12}),numberStyle:Object(je.css)({"@media(-ms-high-contrast:active)":{background:"ButtonText",color:"ButtonFace"},background:"#B6B6B6",borderRadius:"1em",color:"white",marginLeft:"auto",marginRight:0,minWidth:18,paddingLeft:"0.2em",paddingRight:"0.2em",textAlign:"center"}),searchInput:Object(je.css)({"@media(-ms-high-contrast:active)":{backgroundColor:"Window",color:"WindowText"},borderWidth:0,flex:1}),searchInputContainer:Object(je.css)({"@media(-ms-high-contrast:active)":{backgroundColor:"Window"},backgroundColor:"white",display:"flex",flex:1}),searchResult:Object(je.css)({"@media(-ms-high-contrast:active)":{backgroundColor:"Window"},display:"inline-block",height:"100%",lineHeight:"1.6em",overflowX:"scroll",overflowY:"scroll",padding:12,width:"100%"}),searchResultSummary:Object(je.css)({"@media(-ms-high-contrast:active)":{color:"WindowText"},marginLeft:"auto",marginRight:4}),toolbar:Object(je.css)({"@media(-ms-high-contrast:active)":{backgroundColor:"Window",borderBottom:"1px solid InactiveBorder"},alignItems:"center",backgroundColor:"#F3F3F3",borderBottom:"1px solid #D9D9D9",display:"flex",flexWrap:"wrap",fontFamily:'"Segoe UI"',paddingBottom:4,paddingLeft:4,paddingRight:6,paddingTop:4}),urlStyle:Object(je.css)({"@media(-ms-high-contrast:active)":{color:"WindowText"},color:"#717171",paddingRight:8})};class He extends u.PureComponent{constructor(){super(...arguments);this.refHandlers={LineContent:e=>this.lineContentElement=e};this.handleOpenFile=(()=>{this.props.openFile(this.props.lineNumber)});this.onKeyDown=(e=>{if(13!==e.keyCode&&32!==e.keyCode||!Object(D.i)(e))this.props.onKeyDown(e);else{this.handleOpenFile();e.preventDefault()}})}componentDidMount(){this.props.isFocused&&this.lineContentElement&&document.hasFocus()&&this.lineContentElement.focus()}componentDidUpdate(){this.props.isFocused&&this.lineContentElement&&document.hasFocus()&&this.lineContentElement.focus()}render(){return u.createElement("div",Object.assign({onClick:this.handleOpenFile,onKeyDown:this.onKeyDown,ref:this.refHandlers.LineContent,tabIndex:this.props.isFocused?1:-1},Ue.monospace),u.createElement("span",Object.assign({},Ue.lineNumber),"(",this.props.lineNumber,")"),u.createElement("span",Object.assign({},Ue.lineContent),this.renderLine()))}renderLine(){const e=this.props.lineText;let t=0;const i=[];for(const n of this.props.ranges){const s=n.start-1,o=n.end-1;if(o>dt)break;const r=e.substring(t,s);i.push(this.renderNormalText(r,t));const a=e.substring(s,o);i.push(this.renderHighlightedText(a,s));t=o}if(t!==e.length){const n=e.substr(t);i.push(this.renderNormalText(n,t))}return i}renderNormalText(e,t){return u.createElement("span",{key:`${this.props.url}|${this.props.lineNumber},${t}`},e)}renderHighlightedText(e,t){return u.createElement("span",Object.assign({key:`${this.props.url}|${this.props.lineNumber}|${t}`},Ue.highlightedText),e)}}class Ve extends u.PureComponent{constructor(){super(...arguments);this.refHandlers={FileContent:e=>this.fileContentElement=e};this.handleToggleExpanded=(()=>{this.props.toggleExpanded(this.props.url)});this.handleOpenFile=(e=>this.props.openFile(this.props.url,e));this.onKeyDown=(e=>{if(13!==e.keyCode&&32!==e.keyCode||!Object(D.i)(e))this.props.onKeyDown(e);else{this.props.toggleExpanded(this.props.url);e.preventDefault()}})}componentDidMount(){this.props.isFocused&&this.fileContentElement&&document.hasFocus()&&this.fileContentElement.focus()}componentDidUpdate(){this.props.isFocused&&this.fileContentElement&&document.hasFocus()&&this.fileContentElement.focus()}render(){return u.createElement("div",null,u.createElement("div",Object.assign({},Ue.fileRowStyle,{onKeyDown:this.onKeyDown,ref:this.refHandlers.FileContent,tabIndex:this.props.isFocused?1:-1}),this.renderTreeIcon(),u.createElement("span",Object.assign({},Ue.fileNameStyle),this.props.filename),u.createElement("span",Object.assign({},Ue.urlStyle),this.props.url),u.createElement("div",Object.assign({},Ue.numberStyle),this.props.numResults)),this.renderLineContent())}renderLineContent(){if(this.props.isExpanded)return this.props.results.map(e=>u.createElement(He,{id:e.id,isFocused:e.id===this.props.focusedIndex,key:`${this.props.url}|${e.lineNumber}`,lineNumber:e.lineNumber,lineText:e.lineText,onKeyDown:this.props.onKeyDown,openFile:this.handleOpenFile,ranges:e.ranges,url:this.props.url}))}renderTreeIcon(){return this.props.isExpanded?u.createElement(We.a,{onClick:this.handleToggleExpanded}):u.createElement(Ne.a,{onClick:this.handleToggleExpanded})}}class Ge extends u.PureComponent{constructor(e){super(e);this.handleScroll=(e=>{if(this.props.canLoadMoreResults){const t=e.target;t.scrollTop===t.scrollHeight-t.clientHeight&&this.props.loadMoreResults()}});this.renderResultsInFile=(e=>u.createElement(Ve,{filename:e.filename,focusedIndex:this.props.focusedIndex,id:e.id,key:e.url,isExpanded:e.isExpanded,numResults:e.numResults,openFile:this.props.openFile,results:e.results,toggleExpanded:this.props.toggleExpanded,url:e.url,isFocused:e.id===this.props.focusedIndex,onKeyDown:this.props.onKeyDown}))}render(){if(!this.props.results||0===this.props.results.size)return null;const e=this.props.results.map(this.renderResultsInFile);return u.createElement("div",Object.assign({id:"findInFilesResults"},Ue.searchResult,{onScroll:this.handleScroll}),e)}getResults(){return this.props.results}}var ze=i(24);class Xe extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"0 0 16 16"},this.props),u.createElement("path",{fill:"#555555",d:"M10.798 7l-1.83-2h6.032v2h-4.202zm-2.292-6h-3.207l1.337 1.52 1.87-1.52zm-5.506 8.531v1.469h12v-2h-10.813l-.024.021c-.3.299-.716.479-1.163.51zm0 5.469h12v-2h-12v2zm3.323-8h.631l-.347-.266-.284.266zm8.677-4v-2h-3.289l-1.743 2h5.032z"}),u.createElement("path",{fill:"#A1260D",d:"M7.246 4.6l2.856-3.277-.405-.002-3.176 2.581-2.607-2.962c-.336-.221-.786-.2-1.082.096-.308.306-.319.779-.069 1.12l2.83 2.444-3.339 2.466c-.339.338-.339.887 0 1.225.339.337.888.337 1.226 0l3.063-2.867 3.33 2.555h.466l-3.093-3.379z"}))}}class qe extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"3 3 16 16"},this.props),u.createElement("polygon",{fill:"#555555",points:"12.597,11.042 15.4,13.845 13.844,15.4 11.042,12.598 8.239,15.4 6.683,13.845 9.485,11.042 6.683,8.239 8.238,6.683 11.042,9.486 13.845,6.683 15.4,8.239"}))}}class Je extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"-1 0 16 16"},this.props),u.createElement("path",{fill:"#555555",d:"M14 1v9h-1v-8h-8v-1h9zm-11 2v1h8v8h1v-9h-9zm7 2v9h-9v-9h9zm-2 2h-5v5h5v-5z"}),u.createElement("rect",{x:"4",y:"9",fill:"#00539C",width:"3",height:"1"}))}}class $e extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"0 0 16 16"},this.props),u.createElement("path",{fill:"#555555",d:"M12.6 6.134l-.094.071c-.269.333-.746 1.096-.91 2.375.057.277.092.495.092.545 0 2.206-1.794 4-4 4-1.098 0-2.093-.445-2.817-1.164-.718-.724-1.163-1.718-1.163-2.815 0-2.206 1.794-4 4-4l.351.025v1.85s1.626-1.342 1.631-1.339l1.869-1.577-3.5-2.917v2.218l-.371-.03c-3.176 0-5.75 2.574-5.75 5.75 0 1.593.648 3.034 1.695 4.076 1.042 1.046 2.482 1.694 4.076 1.694 3.176 0 5.75-2.574 5.75-5.75-.001-1.106-.318-2.135-.859-3.012z"}))}}const Ze={base:Object(je.css)({backgroundColor:"transparent",border:0,borderRadius:0,height:24,marginLeft:2,marginRight:2,minWidth:0,overflow:"hidden",padding:0,width:24}),selected:Object(je.css)({":active":{backgroundColor:"#B2D7F0"},":hover":{backgroundColor:"#D9EBF7"},"@media (-ms-high-contrast:active)":{border:"2px solid #AAAAAA"},backgroundColor:"#F0F7FC",border:"1px solid #3399FF",color:"white"}),unselected:Object(je.css)({":active":{backgroundColor:"#B2D7F0"},":hover":{backgroundColor:"#D9EBF7"}})};class Ye extends u.PureComponent{constructor(){super(...arguments);this.onMouseOverHandler=(e=>{this.props.onMouseOver&&this.props.onMouseOver(e)});this.onClickHandler=(e=>{this.props.onClick&&this.props.onClick(e)})}render(){return u.createElement("button",Object.assign({"aria-label":this.props.label,className:this.props.className,disabled:this.props.disabled,id:this.props.id,tabIndex:1,title:this.props.label},this.getStyleClass(),{onClick:this.onClickHandler,onMouseOver:this.onMouseOverHandler}),this.props.icon)}getStyleClass(){const e=this.props.baseStyle||Ze.base;if(this.props.disabled)return e;const t=this.props.selectedStyle||Ze.selected,i=this.props.unselectedStyle||Ze.unselected;return this.props.selected?Object(je.css)(e,t):Object(je.css)(e,i)}}const Qe=Object(je.css)({fill:"#424242"});class et extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"0 0 16 16"},this.props),u.createElement("g",{id:"outline"},u.createElement("rect",{opacity:"0",width:"16",height:"16"})),u.createElement("g",{id:"icon_x5F_bg"},u.createElement("path",Object.assign({},Qe,{d:"M7.611 11.834l-.891-2.35h-3.562l-.838 2.35h-1.095l3.217-8.402h1.02l3.24 8.402h-1.091zm-2.531-6.814l-.044-.135-.038-.156-.029-.152-.024-.126h-.023l-.021.126-.032.152-.038.156-.044.135-1.307 3.574h2.918l-1.318-3.574z"})),u.createElement("path",Object.assign({},Qe,{d:"M13.02 11.834v-.938h-.023c-.199.352-.456.62-.771.806s-.673.278-1.075.278c-.313 0-.588-.045-.826-.135s-.438-.212-.598-.366-.281-.338-.363-.551-.124-.442-.124-.688c0-.262.039-.502.117-.721s.198-.412.36-.58.367-.308.615-.419.544-.19.888-.237l1.811-.252c0-.273-.029-.507-.088-.7s-.143-.351-.252-.472-.241-.21-.396-.267-.325-.085-.513-.085c-.363 0-.714.064-1.052.193s-.638.31-.904.54v-.984c.082-.059.196-.121.343-.188s.312-.128.495-.185.378-.104.583-.141.407-.056.606-.056c.699 0 1.229.194 1.588.583s.539.942.539 1.661v3.902h-.96zm-1.454-2.83c-.273.035-.498.085-.674.149s-.313.144-.41.237-.165.205-.202.334-.055.276-.055.44c0 .141.025.271.076.393s.124.227.22.316.215.16.357.211.308.076.495.076c.242 0 .465-.045.668-.135s.378-.214.524-.372.261-.344.343-.557.123-.442.123-.688v-.609l-1.465.205z"}))))}}class tt extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"0 0 16 16"},this.props),u.createElement("g",{fill:"#555555"},u.createElement("path",{d:"M12.301 6.518l-2.772.262 2.086 1.788-1.594 1.392-1.201-2.682-1.201 2.682-1.583-1.392 2.075-1.788-2.771-.262.696-2.126 2.358 1.392-.599-2.784h2.053l-.602 2.783 2.359-1.392.696 2.127z"}),u.createElement("rect",{x:"3",y:"10",width:"3",height:"3"})))}}const it=Object(je.css)({fill:"#555555"});class nt extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"0 0 16 16"},this.props),u.createElement("g",{id:"outline"},u.createElement("rect",{opacity:"0",width:"16",height:"16"})),u.createElement("g",{id:"icon_x5F_bg"},u.createElement("rect",Object.assign({x:"13",y:"4"},it,{width:"1",height:"8"})),u.createElement("path",Object.assign({},it,{d:"M11.225 8.387c-.078-.299-.199-.562-.36-.786s-.365-.401-.609-.53-.534-.193-.866-.193c-.198 0-.38.024-.547.073-.165.049-.316.117-.453.205-.136.088-.257.194-.365.318l-.179.258v-3.154h-.893v7.422h.893v-.575l.126.175c.087.102.189.19.304.269.117.078.249.14.398.186.149.046.314.068.498.068.353 0 .666-.071.937-.212.272-.143.499-.338.682-.586.183-.25.321-.543.414-.879.093-.338.14-.703.14-1.097-.001-.342-.04-.663-.12-.962zm-1.479-.607c.151.071.282.176.39.314.109.14.194.313.255.517.051.174.082.371.089.587l-.007.125c0 .327-.033.62-.1.869-.067.246-.161.453-.278.614-.117.162-.26.285-.421.366-.322.162-.76.166-1.069.015-.153-.075-.286-.175-.393-.296-.085-.096-.156-.216-.218-.367 0 0-.179-.447-.179-.947 0-.5.179-1.002.179-1.002.062-.177.136-.318.224-.43.114-.143.256-.259.424-.345.168-.086.365-.129.587-.129.19 0 .364.037.517.109z"})),u.createElement("rect",Object.assign({x:".987",y:"2"},it,{width:"14.013",height:"1.023"})),u.createElement("rect",Object.assign({x:".987",y:"12.968"},it,{width:"14.013",height:"1.023"})),u.createElement("path",Object.assign({},it,{d:"M1.991 12.031l.728-2.031h2.219l.778 2.031h1.082l-2.485-7.158h-.941l-2.441 7.086-.025.072h1.085zm1.827-5.609h.022l.914 2.753h-1.841l.905-2.753z"}))))}}const st={selectedStyle:Ue.buttonSelected,unselectedStyle:Ue.buttonUnselected};class ot extends u.PureComponent{constructor(e){super(e);this.displayMatchCaseTooltip=(()=>this.props.showTooltip("vs_base_browser_ui_findinput_findInputCheckboxes_1"));this.displayRegexTooltip=(()=>this.props.showTooltip("vs_base_browser_ui_findinput_findInputCheckboxes_3"));this.displaySearchAllFilesTooltip=(()=>this.props.showTooltip("FindInFilesSearchBoxText"));this.displayWholeWordTooltip=(()=>this.props.showTooltip("vs_base_browser_ui_findinput_findInputCheckboxes_2"));this.onSearchInputChange=(e=>{this.props.onSearchInputChange(e.target.value)});this.onKeyPress=(e=>{13===e.charCode&&this.props.onFindInFiles()})}render(){const e=Object(l.b)("FindInFilesSearchBoxText");return u.createElement("div",Object.assign({},Ue.searchInputContainer),u.createElement("input",Object.assign({id:"findInFilesSearchBox",placeholder:e,onChange:this.onSearchInputChange,onKeyPress:this.onKeyPress,onMouseOver:this.displaySearchAllFilesTooltip,tabIndex:1},Ue.searchInput)),u.createElement(Ye,Object.assign({icon:u.createElement(et,{height:Ke,style:Ue.icon,width:Ke}),label:Object(l.b)("vs_base_browser_ui_findinput_findInputCheckboxes_1"),onClick:this.props.onToggleMatchCase,onMouseOver:this.displayMatchCaseTooltip,selected:this.props.searchParams.matchCase},st)),u.createElement(Ye,Object.assign({icon:u.createElement(nt,{height:Ke,style:Ue.icon,width:Ke}),label:Object(l.b)("vs_base_browser_ui_findinput_findInputCheckboxes_2"),onClick:this.props.onToggleWholeWord,onMouseOver:this.displayWholeWordTooltip,selected:this.props.searchParams.wholeWord},st)),u.createElement(Ye,Object.assign({icon:u.createElement(tt,{height:Ke,style:Ue.icon,width:Ke}),label:Object(l.b)("vs_base_browser_ui_findinput_findInputCheckboxes_3"),onClick:this.props.onToggleRegex,onMouseOver:this.displayRegexTooltip,selected:this.props.searchParams.isRegex},st)))}}class rt extends u.PureComponent{constructor(e){super(e);this.displayClearSearchResultsTooltip=(()=>this.props.showTooltip("ClearResultsButtonTooltip"));this.displayCloseTooltip=(()=>this.props.showTooltip("CloseButtonTooltip"));this.displayCollapseAllTooltip=(()=>this.props.showTooltip("CollapseAll"));this.displayRefreshTooltip=(()=>this.props.showTooltip("Refresh"));this.state={searchBox:void 0}}render(){return u.createElement("div",Object.assign({id:"findInFilesToolbar"},Ue.toolbar),u.createElement(ot,{onFindInFiles:this.props.onFindInFiles,onSearchInputChange:this.props.onSearchInputChange,onToggleMatchCase:this.props.onToggleMatchCase,onToggleRegex:this.props.onToggleRegex,onToggleWholeWord:this.props.onToggleWholeWord,searchParams:this.props.searchParams,showTooltip:this.props.showTooltip}),u.createElement(Ye,{baseStyle:Object(je.compose)(Ze.base,Ue.icon),icon:u.createElement($e,{height:Ke,width:Ke}),id:"findInFilesRefresh",label:Object(l.b)("ResourceGridRefresh"),onClick:this.props.onRefresh,onMouseOver:this.displayRefreshTooltip,unselectedStyle:Object(je.compose)(Ze.unselected,Ue.buttonUnselected)}),u.createElement(Ye,{icon:u.createElement(Je,{height:Ke,style:Ue.icon,width:Ke}),label:Object(l.b)("CollapseAll"),onClick:this.props.onCollapseAll,onMouseOver:this.displayCollapseAllTooltip,unselectedStyle:Object(je.compose)(Ze.unselected,Ue.buttonUnselected)}),u.createElement(Ye,{icon:u.createElement(Xe,{height:Ke,style:Ue.icon,width:Ke}),label:Object(l.b)("ClearResultsButtonTooltip"),onClick:this.props.onClearResults,onMouseOver:this.displayClearSearchResultsTooltip,unselectedStyle:Object(je.compose)(Ze.unselected,Ue.buttonUnselected)}),u.createElement("span",Object.assign({},Ue.searchResultSummary),this.props.summary),u.createElement(Ye,{baseStyle:Object(je.compose)(Ze.base,Ue.alignRight),icon:u.createElement(qe,{height:Ke,style:Ue.icon,width:Ke}),label:Object(l.b)("CloseButtonTooltip"),onClick:this.props.onClose,onMouseOver:this.displayCloseTooltip,unselectedStyle:Object(je.compose)(Ze.unselected,Ue.buttonUnselected)}))}}const at=10,lt=50,dt=300,ct=10,ht=500;class ut extends u.PureComponent{constructor(e){super(e);this.handleFindInFiles=(async()=>{V.b.logPerformance({id:"Debugger_FindInFiles_Start"});const e=await this.props.debuggerShell.findInFiles(this.state.searchParams);this.setState({focusedIndex:e.length>0?e[0].id:void 0});const t=Ae.List(e.slice(0,lt).map(e=>Object.assign({},e,{focusedIndex:this.state.focusedIndex,isExpanded:e.results.length<ct,onKeyDown:this.onKeyDown,openFile:this.openFileToResult,toggleExpanded:this.toggleExpanded,isFocused:this.state.focusedIndex===e.id}))),i=this.getResultsSummary(e);this.setState(n=>Object.assign({},n,{canLoadMoreResults:e.length>lt,displayedResults:t,previousSearchString:n.searchParams.searchString,results:Ae.List(e),summary:i}));V.b.logPerformance({id:"Debugger_FindInFiles_Stop"})});this.loadMoreResults=(()=>{this.setState(e=>{const t=e.displayedResults.size,i=t+lt,n=e.results.slice(t,i).map(t=>Object.assign({},t,{focusedIndex:this.state.focusedIndex,isExpanded:!(t.numResults>ct),onKeyDown:this.onKeyDown,openFile:this.openFileToResult,sizeSearchString:e.previousSearchString.length,toggleExpanded:this.toggleExpanded,isFocused:this.state.focusedIndex===t.id})).toList(),s=e.displayedResults.concat(n).toList();return Object.assign({},e,{canLoadMoreResults:e.results.size>i,displayedResults:s})})});this.toggleExpanded=(e=>{const t=this.state.results.findKey(t=>t.url===e),i=Object.assign({},this.state.displayedResults.get(t));if(i){i.isExpanded=!i.isExpanded;this.setState(e=>{const n=e.displayedResults.splice(t,1,i).toList();return Object.assign({},e,{displayedResults:n})})}});this.onClose=(()=>{this.props.debuggerShell.toggleFindInFiles(g.c.Ui)});this.onCollapseAll=(()=>{this.setState(e=>{const t=e.displayedResults.map(e=>{const t=Object.assign({},e);t.isExpanded=!1;return t}).toList();return Object.assign({},e,{displayedResults:t})})});this.onClearResults=(()=>{this.setState(e=>Object.assign({},e,{displayedResults:Ae.List(),results:Ae.List(),summary:Object(l.b)("vs_editor_contrib_find_browser_findWidget_13")}))});this.onSearchInputChange=(e=>{this.setState(t=>{const i=Object.assign({},t);i.searchParams=Object.assign({},t.searchParams,{searchString:e});return i})});this.onToggleMatchCase=(()=>{this.setState(e=>{const t=Object.assign({},e);t.searchParams=Object.assign({},e.searchParams,{matchCase:!e.searchParams.matchCase});return t})});this.onToggleRegex=(()=>{this.setState(e=>{const t=Object.assign({},e);t.searchParams=Object.assign({},e.searchParams,{isRegex:!e.searchParams.isRegex});return t})});this.onToggleWholeWord=(()=>{this.setState(e=>{const t=Object.assign({},e);t.searchParams=Object.assign({},e.searchParams,{wholeWord:!e.searchParams.wholeWord});return t})});this.onKeyDown=(e=>{if(e.key===D.h.UP&&Object(D.i)(e)){this.navigateUp();e.preventDefault()}else if(e.key===D.h.DOWN&&Object(D.i)(e)){this.navigateDown();e.preventDefault()}});this.openFileToResult=((e,t)=>this.props.debuggerShell.debuggerManager.showDocument(e,t,1));this.showTooltip=(e=>{Object(le.c)({resource:e})});this.navigateUp=(()=>{const e=this.getRowAbove();e&&this.setState(t=>Object.assign({},t,{focusedIndex:e}))});this.navigateDown=(()=>{const e=this.getRowBelow();e&&this.setState(t=>Object.assign({},t,{focusedIndex:e}))});this.state={canLoadMoreResults:!1,displayedResults:Ae.List(),previousSearchString:"",results:Ae.List(),searchParams:{isRegex:!1,matchCase:!1,searchString:"",wholeWord:!1},summary:Object(l.b)("vs_editor_contrib_find_browser_findWidget_13")};this.throttledLoadMoreResults=Object(Fe.e)(this.loadMoreResults,this,ht)}componentDidMount(){document.getElementById("findInFilesSearchBox").focus()}render(){return u.createElement("div",Object.assign({},Ue.base),u.createElement(rt,{searchParams:this.state.searchParams,onClearResults:this.onClearResults,onClose:this.onClose,onCollapseAll:this.onCollapseAll,onFindInFiles:this.handleFindInFiles,onRefresh:this.handleFindInFiles,onSearchInputChange:this.onSearchInputChange,onToggleMatchCase:this.onToggleMatchCase,onToggleRegex:this.onToggleRegex,onToggleWholeWord:this.onToggleWholeWord,showTooltip:this.showTooltip,summary:this.state.summary}),u.createElement(Ge,{canLoadMoreResults:this.state.canLoadMoreResults,loadMoreResults:this.throttledLoadMoreResults,results:this.state.displayedResults,openFile:this.openFileToResult,toggleExpanded:this.toggleExpanded,onKeyDown:this.onKeyDown,focusedIndex:this.state.focusedIndex}))}getResultsSummary(e){const t=e.length;if(0===t)return Object(l.b)("vs_editor_contrib_find_browser_findWidget_13");const i=e.reduce((e,t)=>e+t.numResults,0);return Object(l.b)("FindInFilesResultsSummary",i,t)}isFocused(e){return e.id===this.state.focusedIndex}getRowAbove(){const e=this.state.displayedResults;let t,i=e.find(e=>this.isFocused(e));if(i){if(0===(t=e.keyOf(i)))return i.id;const n=e.get(t-1);return n.isExpanded?n.results[n.results.length-1].id:n.id}{let n;this.state.results.forEach((e,s)=>{e.results.forEach((o,r)=>{if(this.isFocused(o)){i=e;t=s;n=r}})});return 0===n?e.get(t).id:i.results[n-1].id}}getRowBelow(){const e=this.state.displayedResults;let t=e.find(e=>this.isFocused(e));if(t){if(t.isExpanded)return t.results[0].id;{const i=e.keyOf(t);return i===e.size-1?t.id:e.get(i+1).id}}{let i,n,s;this.state.results.forEach((e,o)=>{e.results.forEach((r,a)=>{if(this.isFocused(r)){t=e;s=o;i=r;n=a}})});return n===t.results.length-1&&s===e.size-1?i.id:n===t.results.length-1?e.get(s+1).id:t.results[n+1].id}}}var pt=i(122),gt=i(62),mt=i(73),_t=i(87);class bt{constructor(e,t,i){this._controller=e;const n=Object(l.b)("WatchWindowNameColumn"),s=Object(l.b)("WatchWindowValueColumn"),o=Object(l.b)("WatchWindowIconColumn"),r=t.clientWidth-bt.DEFAULT_ICON_COLUMN_FIXED_WIDTH,a=this._controller.isDataTip?bt.DEFAULT_COLUMN_SIZE:r*bt.DEFAULT_COLUMN_PERCENT_WIDTH,d=new gt.a(bt.WATCH_NAME_COLUMN,n,n,a,!1);d.getColumnValue=((e,t,i,n)=>n[e].displayName);d.getCellCSSClass=((e,t,i,n)=>this.getCellCSSClass(e,t,i,n));d.getGlyphClass=((e,t,i,n)=>this.getCellGlyphClass(e,t,i,n));d.getCellTooltip=((e,t,i,n)=>{const s=n[e];return s.displayName!==s.watchName?Object(l.b)("WatchesSourceMappedWatchTooltip",s.displayName,s.watchName):s.watchName});d.hasMixedContent=!0;d.hasGlyph=!0;d.indent=!0;const c=this._controller.isDataTip?bt.EXPANDED_COLUMN_SIZE:r*bt.DEFAULT_COLUMN_PERCENT_WIDTH,h=new gt.a(bt.WATCH_VALUE_COLUMN,s,s,c,!1);h.getColumnValue=((e,t,i,n)=>n[e].displayValue);h.getCellCSSClass=((e,t,i,n)=>this.getCellCSSClass(e,t,i,n));const u=new gt.a(bt.WATCH_ICON_COLUMN,o,o,bt.DEFAULT_ICON_COLUMN_FIXED_WIDTH,!1);u.getCellCSSClass=((e,t,i,n)=>this.getCellCSSClass(e,t,i,n));u.hasHTMLContent=!0;if(this._controller.isDataTip)this._columnInfo=[d,h];else{this._intellisenseControl=this._controller.intellisenseControl;d.getEditBox=(()=>{if(this._intellisenseControl)return this._intellisenseControl.inputElement});d.percentWidth=bt.DEFAULT_COLUMN_PERCENT_WIDTH;h.percentWidth=bt.DEFAULT_COLUMN_PERCENT_WIDTH;u.fixed=!0;this._columnInfo=[d,h,u]}this._container=t;this.createGrid(this._container,i);this._container.addEventListener("click",e=>this.buttonsCallback(this._controller.isDataTip,e));if(!this._controller.isDataTip){this._deleteAllWatchesButton=document.getElementById("deleteAllWatchesButton");this._addWatchButton=document.getElementById("addWatchButton");j.a.setupButton(this._deleteAllWatchesButton,"WatchesDeleteAllTooltip",()=>{this._controller.deleteAll(g.c.Ui)},!1);j.a.setupButton(this._addWatchButton,"WatchesAddWatchTooltip",()=>{this.promptToAddWatch(g.c.Ui)});this._container.addEventListener("contextmenu",e=>{this.showContextMenu(e)})}this.refreshView()}dispose(){if(this._delayedRenderCookie){window.clearTimeout(this._delayedRenderCookie);this._delayedRenderCookie=void 0}}setViewState(e){this._grid.setViewState(e);this._addWatchButton&&j.a.changeButtonStatus(this._addWatchButton,e);this._deleteAllWatchesButton&&this._controller.hasUserWatches()&&j.a.changeButtonStatus(this._deleteAllWatchesButton,e)}getActualHeight(){return this.getObjectsCount()*bt.GRID_LINE_HEIGHT}isViewEnabled(){return this._options.isGridEnabled}refreshView(e,t){this._delayedRenderCookie&&window.clearTimeout(this._delayedRenderCookie);this._delayedRenderCookie=window.setTimeout(()=>{V.b.logPerformance({id:H.b.Debugger_WatchWindowView_RefreshView_Start});this._controller.isDataTip||!j.a.isEnabled(this._deleteAllWatchesButton)||this._controller.hasUserWatches()?this._controller.isDataTip||j.a.isEnabled(this._deleteAllWatchesButton)||!this._controller.hasUserWatches()||j.a.changeButtonStatus(this._deleteAllWatchesButton,!0):j.a.changeButtonStatus(this._deleteAllWatchesButton,!1);let i=this._grid.getSelectedRowIndex();const n=this._controller.getWatches();(-1===i&&n.length>0||i>=n.length)&&(i=0);this._grid.setDataSource(n,this._controller.getExpandStates(),this._columnInfo,void 0,i,e,t);V.b.logPerformance({id:H.b.Debugger_WatchWindowView_RefreshView_Stop});this._delayedRenderCookie=void 0},bt.DELAYED_RENDER_INTERVAL)}layout(){this._grid.layoutOnResize()}getExpandStates(){return this._grid.getExpandStates()}getObjectsCount(){return this._grid.getExpandedCount()}promptToAddWatch(e){this._grid.scrollToBottom(()=>this.createAddWatchTextBox(e));this.selectDataIndex(this._grid.getDataSource().length-1)}selectDataIndex(e){this._grid.setSelectedDataIndex(e)}scrollToBottom(e){e&&this._grid.scrollToBottom(()=>e())}containsValidExpression(e){return!e.fake&&e.uid!==_t.a.LOCALS_EXPANDO_ID&&0!==e.fullName.indexOf(_t.a.EXCEPTION_WATCHITEM_PREFIX)}getExpressionInputBoxAtIndex(e){return new Promise(t=>{const i=this._grid.getRowInfo(e),n=i.row.children[bt.NAME_COLUMN];new MutationObserver((e,i)=>{if(n.firstChild instanceof HTMLInputElement){i.disconnect();window.setImmediate(()=>{t(n.firstChild)})}}).observe(n,{childList:!0,subtree:!0});this._grid.createEditBox(i.dataIndex,bt.NAME_COLUMN,n)})}createAddWatchTextBox(e){Object(V.c)(V.a.ADD_WATCH,e,()=>{const e=this._grid.getRowInfo(this._grid.getDataSource().length-1);if(e){const t=e.row.children[bt.NAME_COLUMN];this._grid.createEditBox(e.dataIndex,bt.NAME_COLUMN,t)}})}buttonsCallback(e,t){const i=t.target;if(0===t.button&&this._options.isGridEnabled){const n=this._grid.getDataSource();if(i.classList.contains("deleteWatch")&&!e){const e=this._grid.getRowInfoFromEvent(t,".grid-row");if(e){const t=n[e.dataIndex];if(t){this._controller.deleteWatch(t.uid,g.c.Ui);this.refreshView()}}}else if(i.classList.contains("showAll")){const e=this._grid.getRowInfoFromEvent(t,".grid-row");if(e){const t=n[e.dataIndex];t&&this.requestRemainingProperties(t,e.dataIndex)}}else if(i.classList.contains("grid-cell")&&!e){const e=this._grid.getRowInfoFromEvent(t,".grid-row");if(e){const i=n[e.dataIndex];i&&i.uid===_t.a.ADD_WATCH_PLACEHOLDER&&this._grid.onEditCell(t)}}}}requestRemainingProperties(e,t){e.parentWatch&&e.parentWatch.getChildren(1).then(e=>{const i=this.getRowsAndExpandState(e);this._grid.insertAdditionalDynamicData(i,t)})}createGrid(e,t){this._childDataCallback=((e,t)=>{e.getChildren(0).then(e=>{const i=this.getRowsAndExpandState(e);t(i)})});this._preEditValueCallback=((e,t)=>{if(t===bt.NAME_COLUMN){const t=this._grid.getDataSource()[e];if(t&&t.uid===_t.a.ADD_WATCH_PLACEHOLDER){this._options.commitOnTab=!0;const t=this._grid.getRowInfo(e);if(t){t.row.children[bt.NAME_COLUMN].innerText=""}}}});this._commitEditValueCallback=((e,t,i)=>{const n=this._grid.getDataSource()[t];n&&(i===bt.NAME_COLUMN?e&&""!==e?this._controller.editWatch(n.uid,e):n.uid!==_t.a.ADD_WATCH_PLACEHOLDER&&this._controller.deleteWatch(n.uid,g.c.Internal):this._controller.onValueEdit(n.uid,e))});this._postEditValueCallback=((e,t)=>{this._options.commitOnTab=!1;if(t===bt.NAME_COLUMN){const t=this._grid.getDataSource()[e];if(t&&t.uid===_t.a.ADD_WATCH_PLACEHOLDER){const i=this._grid.getRowInfo(e);if(i){i.row.children[bt.NAME_COLUMN].innerText=t.watchName}}this._controller.intellisenseContext.intellisenseMenu.isOpen=!1}});this._options=new gt.c(this._childDataCallback,this._columnInfo,void 0,this._preEditValueCallback,this._commitEditValueCallback,this._postEditValueCallback);if(this._controller.isDataTip)this._options.keyboardEventHandler={keys:[D.h.C,D.h.ENTER,D.h.SPACEBAR],handler:(e,t,i)=>this.keyboardEventHandler(e,t,i)};else{this._options.keyboardEventHandler={keys:[D.h.C,D.h.DEL,D.h.ENTER,D.h.SPACEBAR,D.h.F10],handler:(e,t,i)=>this.keyboardEventHandler(e,t,i)};this._options.disableRightClickSelection=!1;this._options.keepSelection=!0}this._options.drawRowSplitters=!0;this._options.expandedCountChangedCallback=t;this._options.extendViewportBy=50;this._grid=new gt.h(e,this._options);this._options.onRowToggleCallback=((e,t,i)=>{const n=e[t];n.watchState=i?mt.a.EXPANDED:mt.a.COLLAPSED})}getCellCSSClass(e,t,i,n){return n[e].watchItemCSS[t]}getCellGlyphClass(e,t,i,n){const s=n[e];return s.isReturnValue?mt.a.RETURN_VALUE_CLASS_NAME:s.watchName===s.displayName?s.typeClass:s.typeClass+bt.WATCH_GLYPH_MAPPED_SUFFIX}getRowsAndExpandState(e){let t=[];for(const i of e)t=t.concat(i.getDescendants());const i=[];for(const e of t)i.push(e.getExpandState());return{itemsWithPlaceholders:t,expandStates:i}}keyboardEventHandler(e,t,i){const n=t[i];if(!n)return!1;switch(e.key){case D.h.C:if(!e.shiftKey&&e.ctrlKey&&!e.altKey){this.copyWatchToClipboard(n,g.c.KeyboardShortcut);e.preventDefault();return!0}return!1;case D.h.DEL:n.isUserWatch&&this._controller.deleteWatch(n.uid,g.c.KeyboardShortcut);break;case D.h.ENTER:n.uid===_t.a.ADD_WATCH_PLACEHOLDER?this.createAddWatchTextBox(g.c.KeyboardShortcut):-1!==n.uid.indexOf(mt.a.SHOWALL_WATCHITEM_SUFFIX)&&this.requestRemainingProperties(n,i);break;case D.h.SPACEBAR:-1!==n.uid.indexOf(mt.a.SHOWALL_WATCHITEM_SUFFIX)&&this.requestRemainingProperties(n,i);break;case D.h.F10:if(e.shiftKey&&!e.ctrlKey&&!e.altKey){this.showContextMenu(e);e.preventDefault()}}return!0}createMenuItems(){const e=[];e.push({id:"menuItemAddWatchWindowView",callback:()=>{this._controller.addWatch(this._contextMenuWatchItem.fullName,g.c.ContextMenu)},label:Object(l.b)("WatchesContextMenuAddWatch"),type:U.MenuItemType.command,disabled:()=>!this.containsValidExpression(this._contextMenuWatchItem)});e.push({id:"menuItemCopyWatchWindowView",callback:()=>{this.copyWatchToClipboard(this._contextMenuWatchItem,g.c.ContextMenu)},label:Object(l.b)("WatchesContextMenuCopy"),type:U.MenuItemType.command,disabled:()=>this._contextMenuWatchItem.uid===_t.a.ADD_WATCH_PLACEHOLDER||this._contextMenuWatchItem.uid===_t.a.LOCALS_EXPANDO_ID});e.push({id:"menuItemEditValueWatchWindowView",callback:()=>{this.onEditValue()},label:Object(l.b)("WatchesContextMenuEditValue"),type:U.MenuItemType.command,disabled:()=>!this._options.isGridEnabled||this._contextMenuWatchItem.readOnly});e.push({id:"menuItemSep1WatchWindowView",type:U.MenuItemType.separator});e.push({id:"menuItemDeleteWatchWindowView",callback:()=>{this.onDelete()},label:Object(l.b)("WatchesContextMenuDelete"),type:U.MenuItemType.command,disabled:()=>!this._options.isGridEnabled||!this._contextMenuWatchItem.isUserWatch});e.push({id:"menuItemDeleteAllWatchWindowView",callback:()=>{this.onDeleteAll()},label:Object(l.b)("WatchesContextMenuDeleteAll"),type:U.MenuItemType.command,disabled:()=>!this._options.isGridEnabled||!this._controller.hasUserWatches()});return e}showContextMenu(e){if(this._grid){if(this._contextMenu){this._contextMenu.dispose();this._contextMenu=void 0}const t=this._grid.getRowInfoFromEvent(e,".grid-row")||this._grid.getRowInfo(this._grid.getSelectedDataIndex());if(t){this._contextMenuSelection=t.dataIndex;this._contextMenuWatchItem=this._grid.getDataSource()[this._contextMenuSelection];this._contextMenu=U.create(this.createMenuItems(),"watchesContextMenu");let i=0,n=0;if(e instanceof MouseEvent){i=e.pageX;n=e.pageY}if(i<=0&&n<=0){const e=t.row.getBoundingClientRect();i=e.left;n=e.top}this._contextMenu.show(i,n)}}e.preventDefault();e.stopImmediatePropagation()}onEditValue(){Object(V.c)(V.a.EDIT_WATCH,g.c.ContextMenu,()=>{window.setImmediate(()=>{const e=this._grid.getRowInfo(this._contextMenuSelection);if(e){const t=e.row.children[bt.VALUE_COLUMN];this._grid.createEditBox(e.dataIndex,bt.VALUE_COLUMN,t)}})})}onDelete(){this._controller.deleteWatch(this._contextMenuWatchItem.uid,g.c.ContextMenu)}onDeleteAll(){this._controller.deleteAll(g.c.ContextMenu)}copyWatchToClipboard(e,t){Object(V.c)(V.a.COPY_WATCH,t,()=>{try{const t=e.getCopyString();Object(K.copyPlainText)(t)}catch(e){}})}}bt.DEFAULT_COLUMN_SIZE=140;bt.EXPANDED_COLUMN_SIZE=240;bt.NAME_COLUMN=0;bt.VALUE_COLUMN=1;bt.GRID_LINE_HEIGHT=20;bt.TWO_COLUMN_WIDTH=bt.DEFAULT_COLUMN_SIZE+bt.EXPANDED_COLUMN_SIZE;bt.DEFAULT_COLUMN_PERCENT_WIDTH=.5;bt.DEFAULT_ICON_COLUMN_FIXED_WIDTH=20;bt.DELAYED_RENDER_INTERVAL=10;bt.WATCH_NAME_COLUMN="watchName";bt.WATCH_VALUE_COLUMN="watchValue";bt.WATCH_ICON_COLUMN="watchIcon";bt.WATCH_GLYPH_MAPPED_SUFFIX="Mapped";class ft{constructor(e,t,i){this._editor=e;this._editorWindow=t;this._debuggerManager=i;this.setupDataTipEvents()}static couldHaveSideEffects(e){const t=e.replace(/[\s]/,"");return t.indexOf("++")>0||t.indexOf("--")>0||(!!t.match("[^=!<>]=[^=]")||!!t.match(ft.OPTIONAL_PARENS_REGEX))}get dataTipsEnabled(){return this._dataTipsEnabled}set dataTipsEnabled(e){this._dataTipsEnabled=e;this._dataTipsEnabled||this.hideImmediately(!1)}get watchController(){return this._watchWindowController}hideAfterDelay(){this._dataTipVisible&&!this._hideDataTipTimeoutToken&&(this._hideDataTipTimeoutToken=setTimeout(()=>this.hideImmediately(!0),ft.DATATIP_DISMISS_TIME))}hideImmediately(e){e||this.cancelPendingDataTip();this.dismissElement();this.cancelPendingHide()}showAfterDelay(e,t,i){this.cancelPendingDataTip();const n=this.getTokenInfo(i);if(n)if(this._dataTipVisible&&this.areTokensEqual(n,this._lastTokenInfo))this.cancelPendingHide();else{const s=this._dataTipVisible?ft.DATATIP_DISMISS_TIME:ft.DATATIP_SHOW_TIME;this._showDataTipDelay=ve.a.timeout(s);this._showDataTipDelay.then(()=>{this._positionLeft=e;this._positionTop=t+10;this._showDataTipDelay=void 0;let s=this.isPositionInWhitespace(i);const o={lineNumber:i.lineNumber,column:i.column};if(s&&i.column>1){o.column-=1;s=this.isPositionInWhitespace(o)}if(s)this._lastTokenInfo=void 0;else{this.showImmediately(o);this._lastTokenInfo=n}})}}showImmediately(e){V.b.logPerformance({id:H.b.Debugger_EditorWindow_CreateDataTipFromPosition_Start});document.body.addEventListener("click",this._handleGlobalClick);document.body.addEventListener("keypress",this._handleGlobalKeypress);const t=this._editor.getSelection();if(!t||t.isEmpty()||!t.containsPosition(e)){const t=this.parseExpression(e);return this.displayElement(t.evalText||t.text,t.text)}{const e=this._editor.getModel();if(e){const i=e.getValueInRange(t).trim(),n=this._debuggerManager.documentController.currentDoc,s=n.sourceMapContainsLocalVariablesMapping()?n.getGeneratedIdentifierName(i):null;return this.displayElement(s||i,i)}}V.b.logPerformance({id:H.b.Debugger_EditorWindow_CreateDataTipFromPosition_Stop});return ke.a}parseExpression(e){const t=this._editor.getModel();if(!t)return ft.NO_RESULT;const i=t.getLineContent(e.lineNumber),n=monaco.editor.tokenize(i,"javascript");if(!n||!n.length)return ft.NO_RESULT;const s=n[0],o=this.getTokenIndex(i,s,e.column);if(-1===o)return ft.NO_RESULT;const r=s[o],a=this.getTokenEnd(i,s,o),l=i.substring(r.offset,a);let d=r.type;if(d.lastIndexOf(".html")>=0||d.lastIndexOf(".css")>=0)return ft.NO_RESULT;if(d.lastIndexOf(".js")>=0){if("key"===(d=d.substr(0,d.length-3))||d.indexOf("comment")>=0)return ft.NO_RESULT;if("delimiter"===d&&"."!==l)return ft.NO_RESULT;if("string"===d||"number"===d)return ft.NO_RESULT;if(d.indexOf("keyword")>=0&&("null"===l||"true"===l||"false"===l||"debugger"===l))return ft.NO_RESULT}const c=this.calculateEntireToken(i,o,s,a,e),h=this._debuggerManager.documentController.currentDoc;if(h.isAuthored){const e=h.getGeneratedIdentifierName(c.text);c.evalText=e;if(null===e)return ft.NO_RESULT}return c}setupDataTipEvents(){this._dataTipElement=document.getElementById("dataTipElement");this._dataTipElement.style.display="none";this._dataTipElement.setAttribute("aria-hidden","true");this._innerContainer=document.createElement("div");this._innerContainer.className="popoverInnerContainer";this._dataTipElement.appendChild(this._innerContainer);this._watchWindowController=new pt.a(this._debuggerManager,!0);this._watchWindowView=new bt(this._watchWindowController,this._innerContainer,()=>this.redrawCallback());this._watchWindowController.view=this._watchWindowView;this._addToWatchesLink=document.createElement("a");this._addToWatchesLink.setAttribute("href","");this._addToWatchesLink.id="addToWatchesLink";this._addToWatchesLink.innerText=Object(l.b)("AddToWatchesWindowLink");this._innerContainer.appendChild(this._addToWatchesLink);this._dataTipElement.addEventListener("mouseenter",()=>this.abortPendingActions());this._dataTipElement.addEventListener("mouseover",()=>this.abortPendingActions());this._dataTipElement.addEventListener("mouseleave",()=>this.hideImmediately());this._editor.onMouseMove(e=>this.handleMouseMove(e));this._editor.onKeyDown(()=>this.hideImmediately());this._editor.onDidChangeModel(()=>this.hideImmediately());this._editor.onDidChangeCursorSelection(()=>this.hideImmediately());this._editor.onDidScrollChange(()=>this.hideImmediately());this._handleGlobalClick=(e=>{this._dataTipElement.contains(e.target)||this.hideImmediately()});this._handleGlobalKeypress=(e=>{"Esc"===e.key&&this.hideImmediately()})}isPositionInWhitespace(e){let t;const i=this._editor.getModel();if(i){t=i.getLineContent(e.lineNumber);return ft.WHITESPACE_REGEX.test(t.charAt(e.column-1))}return!0}areTokensEqual(e,t){return!(!e||!t)&&(e.lineNumber===t.lineNumber&&e.startColumn===t.startColumn&&e.endColumn===t.endColumn)}cancelPendingDataTip(){if(this._showDataTipDelay){this._showDataTipDelay.cancel();this._showDataTipDelay=void 0}}cancelPendingHide(){if(void 0!==this._hideDataTipTimeoutToken){clearTimeout(this._hideDataTipTimeoutToken);this._hideDataTipTimeoutToken=void 0}}abortPendingActions(){this.cancelPendingHide();this.cancelPendingDataTip()}handleMouseMove(e){this.hideAfterDelay();this.cancelPendingDataTip();if(this._dataTipsEnabled&&this._debuggerManager.executionController.isExecutionPaused&&!this._editorWindow.contextMenu.isShowing){e.target.type===monaco.editor.MouseTargetType.CONTENT_TEXT&&this.showAfterDelay(e.event.posx,e.event.posy,e.target.position)}}displayElement(e,t=e){this.abortPendingActions();let i=e;if(i){i=i.trim();this._dataTipVisible&&this.hideImmediately(!0);if(0===i.length)return ke.a;this._addToWatchesLink.onclick=(()=>{this._debuggerManager.watchController.addWatch(i,g.c.Ui);return!1});this._watchWindowController.setViewState(!0);this._dataTipVisible=!0;return this._watchWindowController.addWatch(i,g.c.Internal,t).then(e=>{if(e){this._dataTipElement.style.display="block";this._dataTipElement.setAttribute("aria-hidden","false");this.redrawCallback()}else this.hideImmediately()})}return ke.a}redrawCallback(){if(this._dataTipVisible){const e=ft.MIN_TOP+ft.EDGE_PADDING,t=this._debuggerManager.debuggerShell.getFindResultsTop(),i=Math.min(document.body.clientHeight,t)-ft.EDGE_PADDING,n=ft.EDGE_PADDING,s=document.body.offsetWidth-ft.EDGE_PADDING,o=this._watchWindowView.getActualHeight()+ft.WINDOW_VERTICAL_PADDING,r=i-e,a=Math.min(o,r,ft.MAX_HEIGHT);let l=ft.WINDOW_BASIC_WIDTH;a<o&&(l+=ft.WINDOW_SCROLLBAR_WIDTH);let d=this._positionTop,c=this._positionLeft;d+a>i&&(d=Math.max(e,i-a));c+l>s&&(c=Math.max(n,s-l));this._dataTipElement.style.height=a+"px";this._dataTipElement.style.width=l+"px";this._dataTipElement.style.top=d+"px";this._dataTipElement.style.left=c+"px";this._watchWindowController.layout()}}dismissElement(){document.body.removeEventListener("click",this._handleGlobalClick);document.body.removeEventListener("keypress",this._handleGlobalKeypress);this._hideDataTipTimeoutToken=void 0;this._dataTipVisible=!1;if(this._dataTipElement){this._dataTipElement.style.display="none";this._dataTipElement.setAttribute("aria-hidden","true")}if(this._watchWindowController){this._watchWindowController.deleteAll(g.c.Internal);this._watchWindowController.setViewState(!1)}}getTokenInfo(e){let t=null;const i=this._editor.getModel();i&&i.tokenIterator(e,e=>{t=e.next()});return t}getTokenEnd(e,t,i){let n=i+1;const s=t.length-1;n>s&&(n=s);return n===i?e.length:t[n].offset}getTokenIndex(e,t,i){let n=-1;for(let s=0;s<t.length;s++){const o=t[s].offset+1,r=this.getTokenEnd(e,t,s);if(o<=i&&r>=i){n=s;break}}return n}calculateEntireToken(e,t,i,n,s){const o=i[t];let r=o.offset;r>0&&(r=this.findEarlierStart(r,t,e,s,i));let a=e.substring(r,n).trim();"."===a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));ft.couldHaveSideEffects(a)&&(a="");return{text:a,range:new monaco.Range(s.lineNumber,o.offset+1,s.lineNumber,n+1)}}findEarlierStart(e,t,i,n,s){if(this._editor.getModel()){let n=-1,o=0;for(let e=t;e>-1;e--){const t=s[e],r=this.getTokenEnd(i,s,e),a=i.substring(t.offset,r),l=t.type;if(0!==l.indexOf("delimiter.array.")&&0!==l.indexOf("delimiter.parenthesis.")&&0!==l.indexOf("delimiter.bracket.")){if(0!==o);else if(0===l.indexOf("delimiter.")&&"."===a);else if(0===l.indexOf("identifier."));else if(0!==l.indexOf("string.")){if(0===l.indexOf("keyword.")&&"this"===a.trim()){n=t.offset;break}n=r;break}}else if((o+=this.getBracketCount(a))>0){n=r;break}}return n>=0?n:e}return e}getBracketCount(e){return e.match(/[\[({]/)?1:e.match(/[\])}]/)?-1:0}}ft.WINDOW_VERTICAL_PADDING=38;ft.MAX_HEIGHT=300+ft.WINDOW_VERTICAL_PADDING;ft.WINDOW_SCROLLBAR_WIDTH=24;ft.WINDOW_BASIC_WIDTH=8+bt.TWO_COLUMN_WIDTH+ft.WINDOW_SCROLLBAR_WIDTH;ft.DATATIP_SHOW_TIME=.2*Object(L.i)();ft.DATATIP_DISMISS_TIME=1.5*Object(L.i)();ft.OPTIONAL_PARENS_REGEX=/[\]\)\$}\w\d]\(/;ft.WHITESPACE_REGEX=new RegExp("\\s");ft.NO_RESULT={text:""};ft.MIN_TOP=30;ft.EDGE_PADDING=10;class Et{constructor(e,t,i,n){this._editorWindow=e;this._executionController=t;this._breakpointController=i;this._languageServiceController=n}get isShowing(){return this._isShowing}show(e,t,i,n,s,o){if(!this._editorWindow.displayedDoc)return;let r=e,a=t;if(r<=0&&a<=0){const e=document.querySelector(".monaco-editor .cursors-layer > .cursor");if(e){const t=e.getBoundingClientRect();r=t.right-1;a=t.bottom-14}}this._menuEditorPosition=s;if(this._contextMenu){this._contextMenu.dispose();this._contextMenu=null}this._menuBreakpoints=null;o?this._menuBreakpoints=this._breakpointController.getBreakpointsStartingAtLine(this._editorWindow.displayedDoc,this._menuEditorPosition.lineNumber):n&&(this._menuBreakpoints=[n]);this._editorWindow.dataTips.hideImmediately(!1);this._contextMenu=U.create(this.createMenuItems(i),"editorMenu");this._isShowing=!0;this._contextMenu.show(r,a);this._contextMenu.addEventListener("dismiss",()=>{this._isShowing=!1})}hide(){this._contextMenu&&this._contextMenu.dismiss()}createMenuItems(e){const t=[],i=this._editorWindow.displayedDoc.isRuntimeDoc,n=this._editorWindow.displayedDoc.canEditBreakpoints,s=[];t.push({accessKey:Object(l.b)("/Common/AccessKeyCtrlC"),callback:()=>this.onCopyMenuItem(),disabled:()=>{const e=this._editorWindow.getEditorSelection();return!e||e.isEmpty()},id:"menuItemCopyEditorContextMenu",label:Object(l.b)("BreakpointsContextMenuCopy"),type:U.MenuItemType.command});t.push({callback:()=>this.onCopyLocation(),id:"menuItemCopyLocationEditorContextMenu",label:Object(l.b)("BreakpointsContextMenuCopyLocation"),type:U.MenuItemType.command});t.push({accessKey:Object(l.b)("/Common/AccessKeyCtrlAltP"),callback:()=>this.onShowFileInPicker(),id:"menuItemShowFileInPicker",label:Object(l.b)("ShowInPicker"),type:U.MenuItemType.command});t.push({id:"menuItemEditCommandsSeparatorEditorContextMenu",type:U.MenuItemType.separator});t.push({callback:()=>this.onGoToDefinition(),disabled:()=>!this._languageServiceController.canGoToDefinition(),id:"menuItemGoToDefinition",label:Object(l.b)("GoToDefinition"),type:U.MenuItemType.command});t.push({callback:()=>this.onFindAllReferences(),id:"menuItemFindAllReferences",label:Object(l.b)("FindAllReferences"),type:U.MenuItemType.command});t.push({id:"menuItemNavigationCommandsSeparatorEditorContextMenu",type:U.MenuItemType.separator});if(this._menuBreakpoints&&this._menuBreakpoints.length>0&&n){s.push({accessKey:1===this._menuBreakpoints.length?Object(l.b)("/Common/AccessKeyF9"):"",callback:()=>this.onRemoveBreakpoint(),disabled:()=>!1,id:"menuItemRemoveBreakpointEditorContextMenu",label:Object(l.b)(this._menuBreakpoints.length<=1?"EditorContextMenuRemoveBreakpoint":"EditorContextMenuRemoveAllBreakpoints"),type:U.MenuItemType.command});let e=!1;for(const t of this._menuBreakpoints)if(t.isEnabled){e=!0;break}e?s.push({accessKey:1===this._menuBreakpoints.length?Object(l.b)("/Common/AccessKeyCtrlF9"):"",callback:()=>this.onDisableBreakpoint(),disabled:()=>!1,id:"menuItemDisableBreakpointEditorContextMenu",label:Object(l.b)(this._menuBreakpoints.length<=1?"EditorContextMenuDisableBreakpoint":"EditorContextMenuDisableAllBreakpoints"),type:U.MenuItemType.command}):s.push({accessKey:1===this._menuBreakpoints.length?Object(l.b)("/Common/AccessKeyCtrlF9"):"",callback:()=>this.onEnableBreakpoint(),disabled:()=>!1,id:"menuItemEnableBreakpointEditorContextMenu",label:Object(l.b)(this._menuBreakpoints.length<=1?"EditorContextMenuEnableBreakpoint":"EditorContextMenuEnableAllBreakpoints"),type:U.MenuItemType.command});if(1===this._menuBreakpoints.length){const e=this._menuBreakpoints[0];e.isTracepoint?s.push({accessKey:Object(l.b)("/Common/AccessKeyAltF9"),callback:(t,i)=>this.onEditBreakpoint(t,i,e),id:"menuItemAddTraceEditorContextMenu",label:Object(l.b)("BreakpointsContextMenuAddTraceMessage"),type:U.MenuItemType.command}):s.push({accessKey:Object(l.b)("/Common/AccessKeyAltF9"),callback:(t,i)=>this.onEditBreakpoint(t,i,e),id:"menuItemAddConditionEditorContextMenu",label:Object(l.b)("BreakpointsContextMenuAddCondition"),type:U.MenuItemType.command})}}else{s.push({accessKey:Object(l.b)("/Common/AccessKeyF9"),callback:(e,t)=>this.onInsertBreakpoint(e,t,!1),disabled:()=>!n,id:"menuItemInsertBreakpointEditorContextMenu",label:Object(l.b)("EditorContextMenuInsertBreakpoint"),type:U.MenuItemType.command});Object(T.isEdpEnabled)()&&!Object(T.isEdpFeatureEnabled)("Tracepoints")||s.push({callback:(e,t)=>this.onInsertBreakpoint(e,t,!0),disabled:()=>!n,id:"menuItemInsertTracepointEditorContextMenu",label:Object(l.b)("EditorContextMenuInsertTracepoint"),type:U.MenuItemType.command})}t.push({callback:()=>()=>{},disabled:()=>!1,id:"menuItemBreakpointsEditorContextMenu",label:Object(l.b)("BreakpointsWindowTitle"),submenu:s,type:U.MenuItemType.command});t.push({id:"menuItemBreakpointControlSeparatorEditorContextMenu",type:U.MenuItemType.separator});t.push({accessKey:Object(l.b)("/Common/AccessKeyCtrlG"),callback:()=>this._editorWindow.showGoToLinePrompt(),id:"menuItemGoToLineEditorContextMenu",label:Object(l.b)("GoToLineCommand"),type:U.MenuItemType.command});Object(T.isEdpEnabled)()&&!Object(T.isEdpFeatureEnabled)("ShowNextStatement")||t.push({accessKey:Object(l.b)("/Common/AccessKeyAltNumStar"),callback:()=>this.onShowNextStatement(),disabled:()=>!this._executionController.isExecutionPaused,id:"menuItemShowNextStatementEditorContextMenu",label:Object(l.b)("ShowNextStatement"),type:U.MenuItemType.command});Object(T.isEdpEnabled)()&&!Object(T.isEdpFeatureEnabled)("RunToCursor")||t.push({accessKey:Object(l.b)("/Common/AccessKeyCtrlF10"),callback:()=>this.onRunToCursor(),disabled:()=>this._executionController.isDebuggingDisabled||!i,id:"menuItemRunToCursorEditorContextMenu",label:Object(l.b)("EditorContextMenuRunToCursor"),type:U.MenuItemType.command});Object(T.isEdpEnabled)()&&!Object(T.isEdpFeatureEnabled)("SetNextStatement")||t.push({accessKey:Object(l.b)("/Common/AccessKeyCtrlShiftF10"),callback:()=>this.onSetNextStatement(),disabled:()=>!this._executionController.isExecutionPaused||!i||!e,id:"menuItemSetNextStatementEditorContextMenu",label:Object(l.b)("EditorContextMenuSetNextStatement"),type:U.MenuItemType.command});if(this._executionController.debuggerManager.isBreakCompleted){t.push({id:"menuItemExecutionControlSeparatorEditorContextMenu",type:U.MenuItemType.separator});t.push({accessKey:Object(l.b)("/Common/AccessKeyCtrlW"),callback:()=>this.onAddToWatch(),disabled:()=>!this._executionController.isExecutionPaused||!i,id:"menuItemAddToWatchEditorContextMenu",label:Object(l.b)("EditorContextMenuAddToWatch"),type:U.MenuItemType.command})}t.push({callback:()=>this._editorWindow.openLink(),disabled:()=>!this._editorWindow.isLinkEnabled(this._menuEditorPosition),id:"menuItemOpenLink",label:Object(l.b)("EditorContextMenuOpenLink"),type:U.MenuItemType.command});return t}onCopyMenuItem(){Object(V.c)(V.a.EDITOR_COPY,g.c.ContextMenu,()=>{const e=this.getCopyText();e&&Object(K.copyPlainText)(e)})}onCopyLocation(){Object(V.c)(V.a.EDITOR_COPY_LOCATION,g.c.ContextMenu,()=>{const e=new xe.a(this._editorWindow.displayedDoc,this._menuEditorPosition.lineNumber,this._menuEditorPosition.column).startDisplayText;Object(K.copyPlainText)(e)})}onShowFileInPicker(){this._editorWindow.debuggerManager.debuggerShell.highlightOpenFile()}getCopyText(){const e=this._editorWindow.getEditorSelection();return e?this._editorWindow.getEditorRangeContents(e):""}onGoToDefinition(){this._languageServiceController.goToDefinition(g.c.ContextMenu)}onFindAllReferences(){this._editorWindow.findAllReferences(g.c.ContextMenu)}onEditBreakpoint(e,t,i){this._breakpointController.promptToModifyConditionOrTracepoint(i,V.a.SET_CONDITION_IN_EDITOR,g.c.ContextMenu)}onSetNextStatement(){this._executionController.setNextStatement(new xe.a(this._editorWindow.displayedDoc,this._menuEditorPosition.lineNumber,this._menuEditorPosition.column),g.c.ContextMenu)}onShowNextStatement(){this._editorWindow.goToActiveFrame(g.c.ContextMenu)}onInsertBreakpoint(e,t,i){const n=this._editorWindow.adjustInsertionColumn(this._menuEditorPosition.lineNumber,this._menuEditorPosition.column);this._breakpointController.addCodeBreakpoint(new xe.a(this._editorWindow.displayedDoc,this._menuEditorPosition.lineNumber,n),V.a.TOGGLE_BREAKPOINT_IN_EDITOR,g.c.ContextMenu,i)}onRemoveBreakpoint(){a.a.isTrue(null!==this._menuBreakpoints);for(const e of this._menuBreakpoints)this._breakpointController.deleteBreakpoint(e,V.a.DELETE_BREAKPOINT_IN_WINDOW,g.c.ContextMenu);this._menuBreakpoints=null}onEnableBreakpoint(){Object(V.c)(V.a.SET_BREAKPOINT_STATE_IN_EDITOR,g.c.ContextMenu,()=>{a.a.isTrue(null!==this._menuBreakpoints);for(const e of this._menuBreakpoints)this._breakpointController.setEnabledState(e,!0);this._menuBreakpoints=null})}onDisableBreakpoint(){Object(V.c)(V.a.SET_BREAKPOINT_STATE_IN_EDITOR,g.c.ContextMenu,()=>{a.a.isTrue(null!==this._menuBreakpoints);for(const e of this._menuBreakpoints)this._breakpointController.setEnabledState(e,!1);this._menuBreakpoints=null})}onRunToCursor(){this._executionController.runToCursor(this._editorWindow.displayedDoc,this._menuEditorPosition,g.c.ContextMenu)}onAddToWatch(){this._executionController.debuggerManager.watchController.addWatchByCurrentEditorPosition(g.c.ContextMenu,this._menuEditorPosition)}}var Ct=i(167),yt=i(171);class It{constructor(e,t,i,n){this._editor=n;const s=i.getTrimmedRange(e);this.exceptionViewZone={afterLineNumber:s.endLineNumber,afterColumn:s.endColumn,heightInLines:1,domNode:It.makeDomNode(t)};this.id=It.NO_ZONE_ID;this.location=e.copy();this.message=t;this._listenerRegistration=this.location.changesCompleted.addHandler(()=>{this.location.startPosition&&this.moveLocation(this.location.startPosition.doc,this.location)})}static makeDomNode(e){const t=document.createElement("div"),i=document.createElement("div");i.className="exceptionGlyph";t.appendChild(i);t.appendChild(document.createTextNode(e));t.className="exceptionViewZone";t.id="exceptionViewZone";Object(yt.a)(t);return t}cleanUp(){this.id!==It.NO_ZONE_ID&&this.removeFromEditor();this._listenerRegistration&&this._listenerRegistration.unregister();this.location&&this.location.cleanup()}removeFromEditor(){this.id!==It.NO_ZONE_ID&&this._editor.changeViewZones(e=>{e.removeZone(this.id);this.id=It.NO_ZONE_ID})}addToEditor(e){this.id===It.NO_ZONE_ID&&this.location.startPosition&&this.location.startPosition.doc===e&&this._editor.changeViewZones(e=>{const t={afterLineNumber:this.exceptionViewZone.afterLineNumber,afterColumn:this.exceptionViewZone.afterColumn,heightInLines:1,domNode:It.makeDomNode(this.message)};this.exceptionViewZone=t;this.id=e.addZone(this.exceptionViewZone)})}moveLocation(e,t){if(this.location.startPosition&&this.location.startPosition.doc===e&&e.isOpen){const i=e.editorState;this.removeFromEditor();if(i&&t){const e=i.getTrimmedRange(t);this.exceptionViewZone.afterLineNumber=e.endLineNumber}this.addToEditor(e)}}}It.NO_ZONE_ID=-1;class St{constructor(e,t,i,n,s,o,r){this.propertyChanged=new v.a;this.editorUpdated=new v.a;this._requestedIsWritable=!1;this._effectiveIsWritable=!1;this._isEditorLoaded=!1;this._decorationInfos={};this._locationUpdateRegistrations={};this.updateEditorTheme=(()=>{this._editor&&this._editor.updateOptions({theme:Se.a})});this._documentController=t;this._breakpointController=i;this._executionController=n;this._languageServiceController=s;this._persistenceManager=e.persistenceManager;this._debuggerManager=e;this._pendingTooltip=void 0;this._wordWrapEnabled=!1;this._editorElement=o;this._editorContextMenu=new Et(this,this._executionController,this._breakpointController,this._languageServiceController);setTimeout(()=>{r()},0)}static destroyDocEditorState(e){const t=e.editorState;if(t){t.model&&t.model.dispose();e.editorState=void 0}}loadEditor(){return new Promise(e=>{Object(Te.a)();window.require(["vs/editor/editor.main"],()=>{Object(Se.b)();window.require(["vs/editor/contrib/referenceSearch/common/referenceSearch","vs/editor/contrib/goToDeclaration/common/goToDeclaration","vs/language/css/monaco.contribution"],(t,i)=>{V.b.logPerformance({id:H.b.Debugger_Editor_Create_Start});monaco.languages.css.cssDefaults.setDiagnosticsOptions(this.cssValidationSettings);this._provideReferences=t&&t.provideReferences;this._getDeclarationsAtPosition=i&&i.getDeclarationsAtPosition;this._editor=monaco.editor.create(this._editorElement,{scrollbar:{vertical:"visible",horizontal:"visible",useShadows:!1,verticalHasArrows:!0,horizontalHasArrows:!0,handleMouseWheel:!0,verticalScrollbarSize:17,horizontalScrollbarSize:17,arrowSize:30},readOnly:!this._effectiveIsWritable,scrollBeyondLastLine:!0,roundedSelection:!0,quickSuggestions:!1,autoClosingBrackets:!0,automaticLayout:!1,glyphMargin:!0,hover:!1,contextmenu:!1,wrappingColumn:this.wordWrapEnabled===d.a.On?0:St.WRAPPING_COLUMN,selectOnLineNumbers:!1,theme:Se.a,fontSize:12,lineHeight:18});this._editorElement.setAttribute("aria-label",Object(l.b)("editor_tab_trap_warning"));this._editor.addCommand(monaco.KeyMod.Alt|monaco.KeyCode.KEY_W,()=>{},"");this._editor.addCommand(monaco.KeyCode.F1,()=>{},"");this._editor.addCommand(monaco.KeyCode.F12,()=>{},"");this._editor.addCommand(monaco.KeyMod.Shift|monaco.KeyCode.F12,()=>{},"");Object(Me.b)().addEventListener("themeinitialize",this.updateEditorTheme);Object(Me.b)().addEventListener("themechanged",this.updateEditorTheme);this._editor.onDidDispose(()=>{Object(Me.b)().removeEventListener("themeinitialize",this.updateEditorTheme);Object(Me.b)().removeEventListener("themechanged",this.updateEditorTheme)});window.open=(e=>this.onUrlClicked(e));this.propertyChanged.invoke("wordWrapEnabled");V.b.logPerformance({id:H.b.Debugger_Editor_Create_Stop});this._dataTips=new ft(this._editor,this,this._debuggerManager);window.addEventListener("resize",()=>{V.b.logPerformance({id:H.b.Debugger_Editor_Layout_Start});this._editor&&this._editor.layout();V.b.logPerformance({id:H.b.Debugger_Editor_Layout_Stop})});this._editor.onDidChangeModelContent(e=>this.onModelContentChanged(e));this._editor.onMouseMove(e=>this.onMouseMove(e));this._editor.onMouseLeave(()=>this.clearTooltip());this.setupControls();e(this._editor)})})})}get previousSelectionLocation(){return this._previousSelectionLocation}get displayedDoc(){return this._displayedDoc}get exceptionViewZone(){return this._exceptionViewZone}get dataTips(){return this._dataTips}get contextMenu(){return this._editorContextMenu}get debuggerManager(){return this._debuggerManager}get wordWrapEnabled(){return this._editor&&this._wordWrapEnabled?d.a.On:d.a.Off}set wordWrapEnabled(e){a.a.areNotEqual(e,d.a.Disabled);const t=this.wordWrapEnabled;this._wordWrapEnabled=e===d.a.On;this._editor&&this._editor.updateOptions({wrappingColumn:this._wordWrapEnabled?0:St.WRAPPING_COLUMN});this.wordWrapEnabled!==t&&this.propertyChanged.invoke("wordWrapEnabled")}get effectiveIsWritable(){this.synchronizeIsWritable();return this._effectiveIsWritable}get requestedIsWritable(){return this._requestedIsWritable}set requestedIsWritable(e){this._requestedIsWritable=e;this.synchronizeIsWritable()}get editorPosition(){return this._editor&&this._editor.getPosition()||{lineNumber:1,column:1}}set editorPosition(e){this._editor&&this._editor.setPosition(e)}get rootElement(){return this._editorElement}get showDocumentLocation(){return this._showDocumentLocation}get showDocumentDoc(){return this._showDocumentDoc}get currentModel(){return this._editor&&this._editor.getModel()}get provideReferences(){return this._provideReferences}get getDeclarationsAtPosition(){return this._getDeclarationsAtPosition}get cssValidationSettings(){return{lint:{emptyRules:"ignore",compatibleVendorPrefixes:"ignore",vendorPrefix:"ignore",duplicateProperties:"ignore",importStatement:"ignore",boxModel:"ignore",universalSelector:"ignore",zeroUnits:"ignore",fontFaceProperties:"ignore",hexColorLength:"ignore",argumentsInColorFunction:"ignore",unknownProperties:"ignore",unknownVendorSpecificProperties:"ignore",propertyIgnoredDueToDisplay:"ignore",important:"ignore",float:"ignore",idSelector:"ignore"}}}focus(){this._editor&&this._editor.focus()}getEditorSelection(){return this._editor&&this._editor.getSelection()}getEditorRangeContents(e){const t=this._editor&&this._editor.getModel();return t?t.getValueInRange(e):""}isActive(){return b.a.nodeInDocument(document.activeElement,this._editorElement)}documentAsLibraryStateChanged(e){}documentUrlChanged(e){}documentUpdated(e,t){e.isOpen&&(e===this._displayedDoc?e.getText().then(t=>{this.updateDisplayedText(e,t,!0)}):St.destroyDocEditorState(e))}closeDocument(e){if(this._displayedDoc===e){this._displayedDoc=void 0;const t=this._pendingSelectionLocation;if(t&&t.startPosition&&t.endPosition){this._previousSelectionLocation=new xe.a(e,t.startPosition.line,t.startPosition.column,e,t.endPosition.line,t.endPosition.column,t.rawLocation);this._pendingSelectionLocation=void 0}else if(this._editor){const t=this._editor.getSelection();t&&(this._previousSelectionLocation=new xe.a(e,t.startLineNumber,t.startColumn,e,t.endLineNumber,t.endColumn))}this.clearEditorState();if(this._editor){this.dataTips.dataTipsEnabled=!1;this.setEditorModel(void 0)}}if(this._showDocumentDoc===e){this._showDocumentDoc=void 0;this._showDocumentLocation&&this._showDocumentLocation.cleanup();this._showDocumentLocation=void 0}St.destroyDocEditorState(e)}async openDocument(e,t,i){if(!this._isEditorLoaded){this._isEditorLoaded=!0;try{this._editor=await this.loadEditor()}catch(e){this._isEditorLoaded=!1}}i&&i.rawLocation&&this._persistenceManager.updateEditorPosition(i.rawLocation.offset);if(e===this._displayedDoc&&this._editor){e.editorState&&e.editorState.model!==this._editor.getModel()&&this.setEditorModel(e.editorState.model,e);if(i&&i.startPosition&&!this._pendingSelectionLocation){this.revealRange(i,2===t);this.editorPosition=i}return}if(0===t){if(this._persistenceManager.isPrettyPrintEnabled(e)){await e.getText();return}this.editorUpdated.invoke(e);return}a.a.isTrue(e.isOpen&&e===this._documentController.currentDoc,"Doc failed to open");this._editor&&(this.dataTips.dataTipsEnabled=!1);this.saveLoadedDoc();this.clearEditorState();this._previousSelectionLocation=void 0;this._displayedDoc=e;const n=e.editorState;if(n){this.setEditorModel(n.model,e);this.editorUpdated.invoke(e)}else e.editorState=new Ct.a;return ke.a.then(()=>{if(!n){this._pendingSelectionLocation=void 0;this.updateDisplayedText(e,Object(l.b)("OpenFileProgress",e.url.toString()),!1);return e.getText().then(t=>{e.hasText||(this._pendingSelectionLocation=i);this.updateDisplayedText(e,t,!0)})}}).then(()=>{this.restoreEditorState(e);this.displaySyntaxErrorInfo(e);if(i&&i.startPosition&&!this._pendingSelectionLocation){this.revealRange(i,2===t);this.editorPosition=i}this._debuggerManager.testEventObject.fireEvent("editorDocumentOpened")})}doLayout(e){this._editor&&window.setImmediate(()=>{V.b.logPerformance({id:H.b.Debugger_Editor_Layout_Start});this._editor&&this._editor.layout();V.b.logPerformance({id:H.b.Debugger_Editor_Layout_Stop});e&&this._editor&&this._editor.focus()})}breakStateChanged(e){this._editorContextMenu.hide();e||this.destroyExceptionDisplays();const t=this._documentController.currentDoc;if(t){t.breakStateChanged();this.requestedIsWritable=t.isEditable}else this.synchronizeIsWritable()}exceptionFilterChanged(e){}breakCallComplete(){}justMyCodeStateChanged(e){}createExceptionDisplays(e,t){let i;e.startPosition&&(i=e.startPosition.doc.editorState);if(e.startPosition&&e.startPosition.doc.isOpen&&i&&this._editor){this._exceptionViewZone=new It(e,t,i,this._editor);this.displayedDoc&&this._exceptionViewZone&&this._exceptionViewZone.addToEditor(this.displayedDoc);this._decorationInfos[St.EXCEPTION_DECORATION_ID]=i.addExceptionDecoration({startLineNumber:e.endLineNumber+1,startColumn:0,endLineNumber:e.endLineNumber+1,endColumn:1})}}destroyExceptionDisplays(){const e=this._decorationInfos[St.EXCEPTION_DECORATION_ID];if(e&&e.editorState){e.editorState.removeDecorationInfo(e);delete this._decorationInfos[St.EXCEPTION_DECORATION_ID]}if(this._exceptionViewZone){this._exceptionViewZone.cleanUp();this._exceptionViewZone=void 0}}addSetNextStatementErrorViewZone(e){if(e.startPosition&&e.startPosition.doc.editorState){this.removeSetNextStatementErrorViewZone(e.startPosition.doc);const t=document.createElement("div"),i=document.createElement("div");i.className="exceptionGlyph";t.appendChild(i);t.appendChild(document.createTextNode(Object(l.b)("SetNextStatementFailed")));t.className="setNextStatementErrorViewZone";const n={afterLineNumber:e.endLineNumber,heightInLines:1,domNode:t};e.startPosition.doc.editorState.viewZoneSetNextStatement=n;this._documentController.currentDoc===e.startPosition.doc&&this._editor&&this._editor.changeViewZones(e=>{this._setNextStatementViewZoneId=e.addZone(n)})}}removeSetNextStatementErrorViewZone(e){if(e.editorState&&e.editorState.viewZoneSetNextStatement){this._documentController.currentDoc===e&&this._setNextStatementViewZoneId&&this._editor&&this._editor.changeViewZones(e=>{void 0!==this._setNextStatementViewZoneId&&e.removeZone(this._setNextStatementViewZoneId);this._setNextStatementViewZoneId=void 0});e.editorState.viewZoneSetNextStatement=void 0}}activeFrameChanged(e){if((!e||this.isInstructionPointerFrame(e))&&this._instructionPointerFrameLocation&&this._instructionPointerFrameLocation.startPosition&&this._instructionPointerFrameLocation.startPosition.doc.isOpen){const e=this._decorationInfos[St.IP_DECORATION_ID];if(e&&e.editorState){e.editorState.removeDecorationInfo(e);delete this._decorationInfos[St.IP_DECORATION_ID]}this.removeSetNextStatementErrorViewZone(this._instructionPointerFrameLocation.startPosition.doc)}if(this._activeFrameLocation&&this._activeFrameLocation.startPosition&&this._activeFrameLocation.startPosition.doc.isOpen){const e=this._decorationInfos[St.ACTIVE_FRAME_DECORATION_ID];if(e&&e.editorState){e.editorState.removeDecorationInfo(e);delete this._decorationInfos[St.ACTIVE_FRAME_DECORATION_ID]}}if(!e||this.isInstructionPointerFrame(e)){this._instructionPointerFrameLocation=void 0;this._activeFrameLocation=void 0}e&&this.isInstructionPointerFrame(e)||(this._activeFrameLocation=void 0);e&&e.location&&(this.isInstructionPointerFrame(e)?this._instructionPointerFrameLocation=Object(Le.g)(e,this.debuggerManager.getDocFromStackFrame(e)):this._activeFrameLocation=Object(Le.g)(e,this.debuggerManager.getDocFromStackFrame(e)));this._dataTips&&this._dataTips.watchController.activeFrameChanged(e);this.updateExecutionDecorations()}getLocalMatches(e){const t=this._editor&&this._editor.getModel();if(t){return t.findMatches(e,!1,!1,!1,!1,!1).map(e=>e.range)}return[]}addDecorations(e,t,i){let n=[];const s=this._editor&&this._editor.getModel();if(e&&s){const o={className:t,showInOverviewRuler:i,stickiness:monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges};n=s.deltaDecorations([],e.map(e=>({range:e,options:o})))}return n}removeDecorations(e,t){const i=t&&t.editorState&&t.editorState.model;e&&i&&i.deltaDecorations(e,[])}selectRange(e,t){if(this._editor){this.revealRange(e,t);this._editor.setSelection(e)}}getLineCount(){const e=this._documentController.currentDoc&&this._documentController.currentDoc.editorState;return e&&e.model?e.model.getLineCount():0}getLineContents(e){const t=this._editor&&this._editor.getModel();return t&&e>0&&e<=t.getLineCount()?t.getLineContent(e):""}getRawLineTokens(e){const t=this.getLineContents(e),i=this._editor&&this._editor.getModel();if(i&&e>0&&e<=i.getLineCount()){const e=monaco.editor.tokenize(t,i.getModeId());return[].concat.apply([],e)}return[]}revealPosition(e,t){this.revealRange({startLineNumber:e.lineNumber,startColumn:e.column,endLineNumber:e.lineNumber,endColumn:e.column},t)}revealRange(e,t=!0){const i=this._editor&&this._displayedDoc&&this._displayedDoc.editorState&&this._displayedDoc.editorState.model;if(!i||!this._editor)return;V.b.logPerformance({id:H.b.Debugger_RevealRange_Start});V.b.logPerformance({id:H.b.Debugger_Editor_RevealPosition_Start});this._editor.revealRangeInCenter(e);const n={lineNumber:e.startLineNumber,column:e.startColumn},s=i.getLineCount();this._editor.getScrollTop()>this._editor.getTopForLineNumber(Math.min(e.startLineNumber,s))&&this._editor.revealPosition(n);V.b.logPerformance({id:H.b.Debugger_Editor_RevealPosition_Stop});this._editor.setPosition(n);t&&this._editor.focus();V.b.logPerformance({id:H.b.Debugger_RevealRange_Stop})}goToLineFromString(e){const t=e.split(",");let i,n;i=parseInt(t[0],10);if(t.length>0){n=parseInt(t[1],10);isNaN(i)&&!isNaN(n)&&(i=this._editor&&this._editor.getPosition().lineNumber||1)}else n=0;if(!isNaN(i)||!isNaN(n)){n||(n=0);this.revealRange({startLineNumber:i,startColumn:n,endLineNumber:i,endColumn:n})}}goToLineCol(e,t=0){this.revealRange({startLineNumber:e,startColumn:t,endLineNumber:e,endColumn:t})}adjustInsertionColumn(e,t){const i=this._editor&&this._editor.getModel();if(i){const n=i.getLineContent(e);if(n){const e=n.search(/\S/)+1;return Math.max(t,e)}}return t}breakpointChanged(e,t){if(this._decorationInfos[e.breakpointId]){this.breakpointRemoved(e,t);this.breakpointAdded(e)}}breakpointAdded(e){if(e.location){this._locationUpdateRegistrations[e.breakpointId]=e.location.changesCompleted.addHandler(()=>{const t=this._decorationInfos[e.breakpointId];if(t&&t.editorState){t.editorState.removeDecorationInfo(t);delete this._decorationInfos[e.breakpointId]}if(e.location&&e.location.startPosition){const t=e.location.startPosition.doc.editorState;t&&(this._decorationInfos[e.breakpointId]=t.addBreakpointDecoration(e))}});if(e.location.startPosition&&e.location.startPosition.doc.isOpen){const t=e.location.startPosition.doc.editorState;if(t&&t.model){this._decorationInfos[e.breakpointId]=t.addBreakpointDecoration(e);this.updateExecutionDecorations()}}}}breakpointRemoved(e,t=e.breakpointId){if(t in this._decorationInfos){const e=this._decorationInfos[t];e&&e.editorState&&e.editorState.removeDecorationInfo(e);delete this._decorationInfos[t]}const i=this._locationUpdateRegistrations[t];if(i){i.unregister();delete this._locationUpdateRegistrations[t]}}setCursorDecorationLocation(e){const t=this.getValidEditorStateFromLocation(e);if(t){const i=this._decorationInfos[St.IP_CURSOR_ID];if(i&&i.editorState){i.editorState.removeDecorationInfo(i);delete this._decorationInfos[St.IP_CURSOR_ID]}this._decorationInfos[St.IP_CURSOR_ID]=t.displayCursorDecoration(e)}}setTextSpotlightDecorationLocation(e){const t=this.getValidEditorStateFromLocation(e);if(t){this.hideTextSpotlightDecoration();this._decorationInfos[St.TEXTSPOTLIGHT_DECORATION_ID]=t.displayTextSpotlightDecoration(e)}}hideTextSpotlightDecoration(){const e=this._decorationInfos[St.TEXTSPOTLIGHT_DECORATION_ID];if(e&&e.editorState){e.editorState.removeDecorationInfo(e);delete this._decorationInfos[St.TEXTSPOTLIGHT_DECORATION_ID]}}conditionPromptInvoked(e){}tracepointPromptInvoked(e){}pendingBreakpointAdded(e){this._decorationInfos[e.breakpointId]={}}showGoToLinePrompt(){this._editor&&this._editor.getAction("editor.action.gotoLine").run()}onUrlClicked(e){const t=this.parseLinkUrl(e);this._debuggerManager.showDocument(t,1,1,void 0,!0)}parseLinkUrl(e){const t=new De.a(e);return this._documentController.workspaceUriMapper.getExternalUri(t).toString()}isLinkEnabled(e){return this.editorRangeHasLink(e.lineNumber,e.column)}openLink(){if(!this._editor)return;this._editor.focus();const e=this._editor.getAction("editor.action.openLink");e&&e.run()}setSource(e){if(!this.effectiveIsWritable)throw new Error("Editor is not currently writable.");this.displayedDoc&&this.updateDisplayedText(this.displayedDoc,e,!0)}async save(e=g.c.Ui){V.b.logPerformance({id:"Debugger_SaveFile_Start"});if(this.effectiveIsWritable)return Object(V.c)(V.a.EDITOR_SAVE,e,async()=>{this.requestedIsWritable=!1;if(!this._editor)return;const e=this._editor.getValue(),t=this._documentController.currentDoc;if(!t)return;if(await this.saveIfRevertingEditsToDoc(t,e)){this.displaySaveSucceeded(t);this.makeEditorWritable(t);return}let i;try{const n=await this._documentController.editSource(t,e);a.a.hasValue(n);i=n;this._documentController.currentDoc&&t.isRevision(this._documentController.currentDoc)&&(this._displayedDoc=i);this._debuggerManager.documentController.deletePreviewDoc(t.frontendId);i.isPrettyPrintedTextSaved=t.isPrettyPrintedTextSaved||t.prettyPrintEnabled;await i.setUnformattedText(e,!1,d.a.Off);await Promise.all(this._breakpointController.getBreakpoints(t).map(e=>{const t=this._decorationInfos[e.breakpointId],n=t.editorState.model.getDecorationRange(t.decorationId);return this._breakpointController.updateBreakpointAfterSave(e,new xe.a(i,n.startLineNumber,n.startColumn))}));this.displaySaveSucceeded(t)}catch(e){if(e&&"SourceEditError"===e.name&&e.line>0){const t=e,i=`${Object(l.b)("SourceEditError")} ${t.message} (${t.line}, ${t.column})`;Object(A.a)().show(i,0,"",document.getElementById("hEditorConsoleSplitter"),!1)}else Object(A.a)().show(Object(l.b)("FailedToApplyEditsPrefix"),0,"",document.getElementById("hEditorConsoleSplitter"),!1);W.a.setAlertMessage(Object(l.b)("FailedToApplyEditsPrefix"))}finally{this.makeEditorWritable(t);V.b.logPerformance({id:"Debugger_SaveFile_Stop"})}});if(this._displayedDoc&&this._displayedDoc.isNormallyEditable){this._displayedDoc.isLastRevision?this._debuggerManager.executionController.isExecutionPaused?Be("CannotSaveExecutionPaused"):this._displayedDoc.prettyPrintState===d.a.On&&Be("CannotSavePrettyPrintOn"):Be("CannotSavePreviewDoc");V.b.logPerformance({id:"Debugger_SaveFile_Stop"})}}findAllReferences(e){Object(V.c)(V.a.FIND_REFERENCES,e,()=>{this._editor.getAction("editor.action.referenceSearch.trigger").run()})}async findInFiles(e,t){this._editor||await this.loadEditor();const i=e.map(e=>{return(async()=>{const i=await e.getText(),n=monaco.editor.createModel(i);return this.findInFile(e,n,t)})()});return(await Promise.all(i)).filter(e=>e)}goToActiveFrame(e){this._debuggerManager.debuggerShell.onActiveFrameChanged(this._debuggerManager.activeStackFrame,!0);V.b.logExecuteCommand(V.a.SHOW_NEXT_STATEMENT,e)}updateShowDocumentLocation(e,t){this._showDocumentLocation&&this._showDocumentLocation.cleanup();this._showDocumentDoc=e;this._showDocumentLocation=new we.a(t.rawLocation,t);this.setCursorDecorationLocation(t)}displaySyntaxErrorInfo(e){if(e&&e.syntaxErrorInfo){this.destroyExceptionDisplays();const t={doc:e,line:e.syntaxErrorInfo.lineNumber,column:e.syntaxErrorInfo.columnNumber},i=e.getRawLocation(t);this.createExceptionDisplays(new we.a(i),e.syntaxErrorInfo.messageText)}}onModelContentChanged(e){const t=this._documentController.currentDoc;if(t)if(t.isEditPending){const e=this._editor.getValue();t.getText().then(i=>{i===e&&this._documentController.endEdit(t)})}else this._documentController.beginEdit(t)}findInFile(e,t,i){const n=t.findMatches(i.searchString,!1,i.isRegex,i.matchCase,i.wholeWord,!1);if(0===n.length)return null;const s=new Map;let o=0;for(const e of n){const i=e.range.startLineNumber;let n=e.range.startColumn,r=e.range.endColumn;if(s.has(i)){const e=s.get(i);n-o<dt&&e.ranges.push({start:n,end:r});e.numResults++;s.set(i,e)}else{let e=t.getLineContent(i);if(r>dt){o=n-at;e=e.slice(o,o+dt)+"…";n-=o;r-=o}else if(e.length>dt){o=0;e=e.slice(0,dt)+"…"}else o=0;const a={ranges:[{start:n,end:r}],id:Object(P.c)(),lineNumber:i,lineText:e,numResults:1};s.set(i,a)}}let r=e.url.pathname.split("/");const a=0===(r=r.filter(e=>e)).length?"(index)":decodeURI(r.pop()),l=Array.from(s.values()).reduce((e,t)=>e+t.ranges.length,0);return{id:Object(P.c)(),filename:a,numResults:l,results:Array.from(s.values()),url:e.url.raw}}makeEditorWritable(e){this._documentController.currentDoc&&e.isRevision(this._documentController.currentDoc)&&(this.requestedIsWritable=!0)}async saveIfRevertingEditsToDoc(e,t){if(await e.getText()===t){e.endEdit();e.isCommitPending&&e.endCommit();return Promise.resolve(!0)}return Promise.resolve(!1)}displaySaveSucceeded(e){let t=Object(l.b)("SaveSucceeded");e.sourceMap&&(t+="\n"+Object(l.b)("SourcemapLost"));R.b.dispatch(Object(B.j)(e.url.raw,t,"info"));W.a.setAlertMessage(t)}getValidEditorStateFromLocation(e){if(e.startPosition&&e.startPosition.doc.isOpen){const t=e.startPosition.doc.editorState;if(t&&t.model)return t}}synchronizeIsWritable(){let e=this._requestedIsWritable;this._displayedDoc&&this._displayedDoc.isEditable&&!this._displayedDoc.isCommitPending&&!this._executionController.isExecutionPaused||(e=!1);if(e!==this._effectiveIsWritable){this._effectiveIsWritable=e;this._editor&&this._editor.updateOptions({readOnly:!this._effectiveIsWritable})}}updateDisplayedText(e,t,i){if(!this._editor)return;const n=this._editor.getModel(),s=n?n.getValue():null;if(e.editorState&&e===this._displayedDoc&&(null===s||!e.editorState.model||t.length!==s.length||t!==s)){const n=e.editorState,s=this.isActive();n.model&&n.model.dispose();const o=e.getMimeTypeCandidates().join(",");V.b.logPerformance({id:H.b.Debugger_Editor_CreateModel_Start});const r=monaco.Uri.parse(e.getMonacoUri(this._documentController.workspaceUriMapper).toString()),a=monaco.editor.createModel(t,o,r);V.b.logPerformance({id:H.b.Debugger_Editor_CreateModel_Stop});n.model=a;if(this._documentController.currentDoc===e){this.setEditorModel(a,e);this.updateViewAfterDocumentTextUpdated(e,s)}if(i){this._debuggerManager.testEventObject.fireEvent("editorDocumentUpdated",e);this.editorUpdated.invoke(e)}this._debuggerManager.debuggerShell.logOnEditorLoadTelemetry(e,t.length)}}updateViewAfterDocumentTextUpdated(e,t){this.refreshDecorations(e);this.updateSelectionAndViewport(e,t);if(this._exceptionViewZone){const t=this._debuggerManager.instructionPointerFrame,i=Object(Le.g)(t,this.debuggerManager.getDocFromStackFrame(t));this._exceptionViewZone.moveLocation(e,i)}}updateSelectionAndViewport(e,t){if(this._currentSelectionLocation&&this._documentController.currentDoc===e){const i=e.createDocumentLocation(this._currentSelectionLocation.rawLocation.offset,this._currentSelectionLocation.rawLocation.length);if(i.startPosition){if(!this._displayedDoc||i.startPosition.doc!==this._displayedDoc)return;this.selectRange(i,t)}}else if(this._activeFrameLocation&&this._activeFrameLocation.startPosition&&this._documentController.currentDoc===this._activeFrameLocation.startPosition.doc)this.revealRange(this._activeFrameLocation);else if(this._instructionPointerFrameLocation&&this._instructionPointerFrameLocation.startPosition&&this._documentController.currentDoc===this._instructionPointerFrameLocation.startPosition.doc)this.revealRange(this._instructionPointerFrameLocation);else{const i=this._persistenceManager.getOffsetForDoc(e);i>0&&this.revealPosition(e.createDocumentLocation(i,0),t)}}saveLoadedDoc(){if(this._displayedDoc&&this._displayedDoc.editorState&&this._editor){V.b.logPerformance({id:H.b.Debugger_Editor_SaveViewState_Start});this._displayedDoc.editorState.viewState=this._editor.saveViewState();V.b.logPerformance({id:H.b.Debugger_Editor_SaveViewState_Stop})}}setEditorModel(e,t){t&&(this.requestedIsWritable=t.isEditable&&!t.isCommitPending);const i=this.wordWrapEnabled;V.b.logPerformance({id:H.b.Debugger_Editor_SetModel_Start});this._editor&&e&&this._editor.setModel(e);this.wordWrapEnabled!==i&&this.propertyChanged.invoke("wordWrapEnabled");V.b.logPerformance({id:H.b.Debugger_Editor_SetModel_Stop})}clearEditorState(){this._exceptionViewZone&&this._exceptionViewZone.removeFromEditor();this._editor&&this._editor.changeViewZones(e=>{this._setNextStatementViewZoneId&&e.removeZone(this._setNextStatementViewZoneId)});this._displayedDoc=void 0;this._currentSelectionLocation=void 0}restoreEditorState(e){if(e.editorState&&this._editor){this._exceptionViewZone&&this._exceptionViewZone.addToEditor(e);this._editor.changeViewZones(t=>{e.editorState&&e.editorState.viewZoneSetNextStatement&&(this._setNextStatementViewZoneId=t.addZone(e.editorState.viewZoneSetNextStatement))});const t=this._editorElement.querySelector("textarea.inputarea");t&&(t.tabIndex=1);if(e.editorState.viewState){V.b.logPerformance({id:H.b.Debugger_Editor_RestoreViewState_Start});this._editor.restoreViewState(e.editorState.viewState);V.b.logPerformance({id:H.b.Debugger_Editor_RestoreViewState_Stop})}this._dataTips.dataTipsEnabled=e.isRuntimeDoc}}refreshDecorations(e){if(e.isOpen){const t=e.editorState;if(t&&t.model){const i=this._breakpointController.getBreakpoints(e);for(const e of i){const i=this._decorationInfos[e.breakpointId];if(i&&i.editorState){i.editorState.removeDecorationInfo(i);delete this._decorationInfos[e.breakpointId]}this._decorationInfos[e.breakpointId]=t.addBreakpointDecoration(e)}this.updateExecutionDecorations();if(this._showDocumentDoc&&this._showDocumentDoc===e&&this._showDocumentLocation){this.setCursorDecorationLocation(this._showDocumentLocation);this.addChangesCompletedHandler(this._showDocumentLocation,St.IP_CURSOR_ID)}}}}addChangesCompletedHandler(e,t){e&&(this._locationUpdateRegistrations[t]=e.changesCompleted.addHandler(()=>{const i=this._decorationInfos[t];if(i&&i.editorState){i.editorState.removeDecorationInfo(i);delete this._decorationInfos[t]}if(e.startPosition&&e.startPosition.doc.editorState){const i=e.startPosition.doc.editorState;t===St.IP_DECORATION_ID?this._decorationInfos[t]=i.displayInstructionPointerDecoration(e):t===St.ACTIVE_FRAME_DECORATION_ID?this._decorationInfos[t]=i.displayActiveFrameDecoration(e):t===St.IP_CURSOR_ID?this._decorationInfos[t]=i.displayCursorDecoration(e):t===St.TEXTSPOTLIGHT_DECORATION_ID&&(this._decorationInfos[t]=i.displayTextSpotlightDecoration(e))}}))}updateExecutionDecorations(){[St.IP_DECORATION_ID,St.ACTIVE_FRAME_DECORATION_ID].forEach(e=>{const t=this._decorationInfos[e];if(t&&t.editorState){t.editorState.removeDecorationInfo(t);delete this._decorationInfos[e]}if(this._locationUpdateRegistrations[e]){this._locationUpdateRegistrations[e].unregister();delete this._locationUpdateRegistrations[e]}});if(this._instructionPointerFrameLocation&&this._instructionPointerFrameLocation.startPosition&&this._instructionPointerFrameLocation.startPosition.doc.editorState){const e=this._instructionPointerFrameLocation.startPosition.doc.editorState;this._decorationInfos[St.IP_DECORATION_ID]=e.displayInstructionPointerDecoration(this._instructionPointerFrameLocation);this.addChangesCompletedHandler(this._instructionPointerFrameLocation,St.IP_DECORATION_ID)}if((!this._instructionPointerFrameLocation||!this._activeFrameLocation||!xe.a.areEqual(this._activeFrameLocation,this._instructionPointerFrameLocation))&&this._activeFrameLocation&&this._activeFrameLocation.startPosition&&this._activeFrameLocation.startPosition.doc.editorState){const e=this._activeFrameLocation.startPosition.doc.editorState;this._decorationInfos[St.ACTIVE_FRAME_DECORATION_ID]=e.displayActiveFrameDecoration(this._activeFrameLocation);this.addChangesCompletedHandler(this._activeFrameLocation,St.ACTIVE_FRAME_DECORATION_ID)}}showContextMenu(e){this._editorContextMenu.hide();le.a();if(this._documentController.currentDoc){let t,i=!1,n=0,s=0;if(e){i=e.target.type===monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN||e.target.type===monaco.editor.MouseTargetType.GUTTER_LINE_NUMBERS;n=e.event.posx;s=e.event.posy;t=e.target.position}if(t){const e=this.getEditorSelection();e&&e.containsPosition(t)||(this.editorPosition=t)}else t=this.editorPosition;const o=new xe.a(this._documentController.currentDoc,t.lineNumber,t.column);let r,a=!0;const l=new Promise(e=>{this._executionController.canSetNextStatement(o).then(t=>{a=t;e()})});let d;d=i||!this._documentController.currentDoc.isRuntimeDoc?ke.a:new Promise(e=>{const t=this.adjustInsertionColumn(o.lineNumber,o.column),i=new xe.a(o.startPosition.doc,o.lineNumber,t);this._breakpointController.getBreakpointAtLocation(i).then(t=>{r=t;e()})});const c=ve.a.timeout(St.CONTEXTMENU_SHOW_TIMEOUT),h=()=>{this._editorContextMenu.show(n,s,a,r,t,i)};Promise.race([c,Promise.all([l,d])]).then(h,h)}if(e){e.event.preventDefault();e.event.stopPropagation()}}setupControls(){if(this._editor){this._editor.onMouseDown(e=>{if(e.event.leftButton){this._editorContextMenu.hide();if(e.target.type===monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN||e.target.type===monaco.editor.MouseTargetType.GUTTER_LINE_NUMBERS){const t=e.target.position.lineNumber;let i=e.target.range?e.target.range.startColumn:e.target.position.column;const n=e.target.range?e.target.range.endColumn:void 0;if(0===i){const e=this._editor&&this._editor.getModel();if(e){const n=e.getLineContent(t);if(n){const e=n.match(/^\s*/);e&&e.length>0&&(i=e[0].length+1)}}}this.toggleBreakpoint(g.c.Ui,t,i,n,!0)}}});this._editor.onContextMenu(e=>{this.showContextMenu(e)});this._editor.onDidChangeCursorSelection(e=>{const t=e.selection;this.displayedDoc&&(this._currentSelectionLocation=new xe.a(this.displayedDoc,t.startLineNumber,t.startColumn,this.displayedDoc,t.endLineNumber,t.endColumn));this._documentController.currentDoc&&this._persistenceManager.updateEditorPosition(this.getCurrentOffset())});document.addEventListener("keydown",e=>this.onKeyDown(e));s.b.addEventListener("keydown",e=>this.onKeyDown(e));this._editor.addCommand(monaco.KeyMod.chord(monaco.KeyCode.Ctrl,monaco.KeyCode.F10),()=>{this.showContextMenu()},"")}}onKeyDown(e){let t=!1;if(this._documentController.currentDoc&&this._editor&&this._editor.getModel()){this._persistenceManager.updateEditorPosition(this.getCurrentOffset());if(120===e.keyCode&&!e.ctrlKey&&!e.shiftKey&&!e.altKey||66===e.keyCode&&e.ctrlKey&&!e.shiftKey&&!e.altKey){const e=this._editor.getPosition();this.toggleBreakpoint(g.c.KeyboardShortcut,e.lineNumber,e.column);t=!0}else if(120!==e.keyCode||e.ctrlKey||e.shiftKey||!e.altKey)if(120!==e.keyCode||!e.ctrlKey||e.shiftKey||e.altKey)if(121===e.keyCode&&e.ctrlKey&&e.shiftKey&&!e.altKey){if(this._executionController.isExecutionPaused){const e=this._editor.getPosition();this._executionController.setNextStatement(new xe.a(this._documentController.currentDoc,e.lineNumber,e.column),g.c.KeyboardShortcut)}t=!0}else if(121!==e.keyCode||!e.ctrlKey||e.shiftKey||e.altKey)if(69!==e.keyCode||!e.ctrlKey||e.altKey||e.shiftKey)if(68!==e.keyCode||!e.ctrlKey||e.shiftKey||e.altKey)if(83!==e.keyCode||!e.ctrlKey||e.shiftKey||e.altKey){if(80===e.keyCode&&e.ctrlKey&&e.altKey&&!e.shiftKey){this.debuggerManager.debuggerShell.highlightOpenFile();t=!0}}else{this.save(g.c.KeyboardShortcut);t=!0}else{this._languageServiceController.goToDefinition(g.c.KeyboardShortcut);t=!0}else{V.b.logExecuteCommand(V.a.FOCUS_TO_EDITOR,g.c.KeyboardShortcut);const e=this.editorPosition;e&&this.revealPosition(e);t=!0}else{if(this._executionController.isExecutionPaused){const e=this._editor.getPosition();this._executionController.runToCursor(this._documentController.currentDoc,e,g.c.KeyboardShortcut)}t=!0}else{const e=this._editor.getPosition();this.setBreakpointState(e.lineNumber,e.column,g.c.KeyboardShortcut);t=!0}else{const e=this._editor.getPosition();this.setBreakpointCondition(e.lineNumber,e.column);t=!0}}if(t){e.preventDefault();e.stopImmediatePropagation();return!1}return!0}getCurrentOffset(){if(!this._displayedDoc)return 0;const e=this._editor&&this._editor.getPosition();if(e){const t={doc:this._displayedDoc,line:e.lineNumber,column:e.column};return this._displayedDoc.getRawLocation(t).offset}return 0}toggleBreakpoint(e,t,i,n,s,o){Object(V.c)(V.a.TOGGLE_BREAKPOINT_IN_EDITOR,e,()=>{const e=this._documentController.currentDoc;if(e)if(e.canEditBreakpoints){a.a.hasValue(e.editorState,"toggleBreakpoint for an invalid document");const o=this.adjustInsertionColumn(t,i),r=new xe.a(e,t,o,e,t,n||o);s?this._breakpointController.addOrRemoveAllBreakpointsAtLocation(r):this._breakpointController.addOrRemoveBreakpointAtLocation(r)}else this.showBreakpointsErrorMessage(e)})}setBreakpointCondition(e,t,i){const n=this._documentController.currentDoc;if(n)if(n.canEditBreakpoints){a.a.hasValue(n&&n.editorState,"setBreakpointCondition for an invalid document");this._breakpointController.getBreakpointAtLocation(new xe.a(n,e,t)).then(e=>{e&&this._breakpointController.promptToModifyConditionOrTracepoint(e,V.a.SET_CONDITION_IN_EDITOR,g.c.KeyboardShortcut)})}else this.showBreakpointsErrorMessage(n)}setBreakpointState(e,t,i,n){Object(V.c)(V.a.SET_BREAKPOINT_STATE_IN_EDITOR,i,()=>{const i=this._documentController.currentDoc;if(i)if(i.canEditBreakpoints){a.a.hasValue(i&&i.editorState,"setBreakpointState for an invalid document");this._breakpointController.getBreakpointAtLocation(new xe.a(i,e,t)).then(e=>{e&&this._breakpointController.setEnabledState(e,!e.isEnabled)})}else this.showBreakpointsErrorMessage(i)})}showBreakpointsErrorMessage(e){e.isEditPending?Be("CannotEditBkpsEditsPending"):e.isLastRevision||Be("CannotEditBkpsPreviewDoc")}onMouseMove(e){this.clearTooltip();if(e.target.range){const t=e.target.range.startLineNumber,i=e.target.range.startColumn,n=e.target.range.endColumn;this.editorRangeHasLink(t,i,n)&&(this._pendingTooltip=window.setTimeout(()=>{if(!this.contextMenu.isShowing){const e=Object(l.b)("EditorTooltipOpenLink");le.c({content:e})}},ft.DATATIP_SHOW_TIME))}}editorRangeHasLink(e,t,i=t){if(!this._editor)return!1;const n=this._editor.getLineDecorations(e),s=this._editor.getModel().getLineMaxColumn(e);return n.some(n=>{const o=n.range.startLineNumber===e?n.range.startColumn:1,r=n.range.endLineNumber===e?n.range.endColumn:s;return Boolean(o<=t&&i<=r&&n.options.inlineClassName&&n.options.inlineClassName.indexOf("detected-link")>=0)})}clearTooltip(){le.a();if(this._pendingTooltip){window.clearTimeout(this._pendingTooltip);this._pendingTooltip=void 0}}isInstructionPointerFrame(e){return e.callFrameId===this._debuggerManager.instructionPointerFrame.callFrameId}}St.IP_DECORATION_ID="Decoration:InstructionPointer";St.IP_CURSOR_ID="Decoration:Cursor";St.EXCEPTION_DECORATION_ID="Decoration:ExceptionOverlay";St.ACTIVE_FRAME_DECORATION_ID="Decoration:ActiveFrame";St.BP_DECORATION_PREFIX="Decoration:Breakpoint:";St.WRAPPING_COLUMN=300;St.CONTEXTMENU_SHOW_TIMEOUT=100;St.TEXTSPOTLIGHT_DECORATION_ID="Decoration:TextSpotlight";var Tt=i(112);class vt{constructor(e,t){this._controller=e;this._controller.registerListener(this);this._debuggerShell=t;this._exceptionMenu=new Tt.a;this._exceptionMenu.model=this._controller;this._exceptionMenu.menuItemsTemplateId="Debugger.exceptionMenuDropDown";this._exceptionMenu.dismissOnMenuItemClick=!0;document.getElementById("toolbar").appendChild(this._exceptionMenu.rootElement);this._exceptionMenu.addClickHandlerToMenuItem("breakOnNoneMenuItem",()=>this.setExceptionFilter(0));this._exceptionMenu.addClickHandlerToMenuItem("breakOnUnhandledExceptionsMenuItem",()=>this.setExceptionFilter(1));this._exceptionMenu.addClickHandlerToMenuItem("breakOnAllExceptionsMenuItem",()=>this.setExceptionFilter(2));this._toolbar=new m.a("Common.defaultToolbarTemplate");this._toolbar.title=Object(l.b)("DebuggerTitle");this._toolbar.model=this._controller;this._toolbar.panelTemplateId="Debugger.debuggerButtonsPanel";document.getElementById("toolbar").appendChild(this._toolbar.rootElement);this._toolbar.addClickHandlerToButton("continueButton",()=>{this._controller.continueExecution(V.a.START_DEBUGGING,g.c.Ui)});this._breakButton=this._toolbar.getNamedElement("breakButton").control;this._toolbar.addClickHandlerToButton("breakButton",()=>{this._breakButton.isChecked=!0;this._controller.breakAny(g.c.Ui)});this._toolbar.addClickHandlerToButton("stepIntoButton",()=>this._controller.stepInto(g.c.Ui));this._toolbar.addClickHandlerToButton("stepOverButton",()=>this._controller.stepOver(g.c.Ui));this._toolbar.addClickHandlerToButton("stepOutButton",()=>this._controller.stepOut(g.c.Ui));this._toolbar.addClickHandlerToButton("findInFilesButton",()=>this._debuggerShell.toggleFindInFiles(g.c.Ui));if(!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("WebWorkers")){this._breakWorkerButton=this._toolbar.getNamedElement("breakWorkerButton").control;this._toolbar.addClickHandlerToButton("breakWorkerButton",()=>{this._breakWorkerButton.isChecked?V.b.logExecuteCommand(V.a.BREAK_ON_NEW_WORKERS_ON,g.c.Ui):V.b.logExecuteCommand(V.a.BREAK_ON_NEW_WORKERS_OFF,g.c.Ui)})}else this._toolbar.getNamedElement("breakWorkerButton").style.display="none";this._breakOnExceptionButton=this._toolbar.getNamedElement("breakOnExceptionButton").control;this._exceptionMenu.targetButtonElement=this._breakOnExceptionButton.rootElement;this._breakOnExceptionButton.click.addHandler(()=>V.b.logExecuteCommand(V.a.SHOW_BREAK_ON_ERROR_MENU,g.c.Ui));this._breakOnExceptionButton.rootElement.setAttribute("aria-expanded","false");this.setExceptionMenuButtonAriaLabel(this._controller.exceptionFilter);if(!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("JustMyCode")){this._jmcButton=this._toolbar.getNamedElement("jmcButton").control;this._toolbar.addClickHandlerToButton("jmcButton",()=>{this._jmcButton.isChecked?V.b.logExecuteCommand(V.a.TOGGLE_JMC_MODE_ON,g.c.Ui):V.b.logExecuteCommand(V.a.TOGGLE_JMC_MODE_OFF,g.c.Ui);this._debuggerShell.callstackWindow.enableJMC(this._jmcButton.isChecked)})}else this._toolbar.getNamedElement("jmcButton").style.display="none";this._breakOnExceptionButton.rootElement.addEventListener("keydown",e=>{if(this._breakOnExceptionButton.isEnabled&&40===e.keyCode&&e.ctrlKey&&!e.altKey){this._breakOnExceptionButton.click.invoke(e);e.preventDefault();return!1}return!0});document.addEventListener("keydown",e=>this.onKeyDown(e))}getActiveElement(){return this._toolbar.getActiveElement()}getButton(e){switch(e.toLowerCase()){case"break":return this._breakButton.rootElement;case"breakonexception":return this._breakOnExceptionButton.rootElement;case"breakworker":return this._breakWorkerButton.rootElement;case"findinfiles":return this._toolbar.getNamedElement("findInFilesButton");case"jmc":return this._jmcButton.rootElement;case"stepinto":return this._toolbar.getNamedElement("stepIntoButton");case"stepover":return this._toolbar.getNamedElement("stepOverButton");case"stepout":return this._toolbar.getNamedElement("stepOutButton");case"continue":return this._toolbar.getNamedElement("continueButton");case"sourcemap":return this._toolbar.getNamedElement("sourceMapButton");default:return null}}breakStateChanged(e,t){}exceptionFilterChanged(e){this.setExceptionMenuButtonAriaLabel(e)}breakCallComplete(){}setExceptionFilter(e){this._controller.setExceptionFilter(e,g.c.Ui)}setExceptionMenuButtonAriaLabel(e){if(this._exceptionMenu.targetButtonElement){let t=Object(l.b)("BreakOnExceptionButtonTooltip");switch(e){case 0:t=`${t};${Object(l.b)("BreakOnExceptionButtonNone")}`;break;case 1:t=`${t};${Object(l.b)("BreakOnExceptionButtonUnhandled")}`;break;case 2:t=`${t};${Object(l.b)("BreakOnExceptionButtonAll")}`}this._exceptionMenu.targetButtonElement.setAttribute("aria-label",t)}}onKeyDown(e){let t=!1;if(Object(D.g)(e))if(122!==e.keyCode||!e.shiftKey||e.ctrlKey||e.altKey)if(69===e.keyCode&&e.ctrlKey&&e.shiftKey&&!e.altKey){V.b.logExecuteCommand(V.a.SHOW_BREAK_ON_ERROR_MENU,g.c.KeyboardShortcut);if(this._breakOnExceptionButton.isEnabled){this._exceptionMenu.show();t=!0}}else if(66===e.keyCode&&e.ctrlKey&&e.shiftKey&&!e.altKey){this._controller.breakAny(g.c.KeyboardShortcut);t=!0}else if(87!==e.keyCode||!e.altKey||e.ctrlKey||e.shiftKey)if(74!==e.keyCode||e.altKey||!e.ctrlKey||e.shiftKey){if(77===e.keyCode&&!e.altKey&&e.ctrlKey&&e.shiftKey){this._controller.debuggerManager.documentController.toggleSourceMapsForCurrentDoc(g.c.KeyboardShortcut);t=!0}else if(80===e.keyCode&&e.ctrlKey&&e.shiftKey&&!e.altKey){const e=this._controller.debuggerManager.documentController.currentDoc;if(e&&e.prettyPrintState!==d.a.Disabled){e.prettyPrintState===d.a.On?V.b.logExecuteCommand(V.a.TOGGLE_PRETTY_PRINT_OFF,g.c.KeyboardShortcut):V.b.logExecuteCommand(V.a.TOGGLE_PRETTY_PRINT_ON,g.c.KeyboardShortcut);e.prettyPrintState=e.prettyPrintState===d.a.On?d.a.Off:d.a.On}else e&&e.prettyPrintState===d.a.Disabled&&V.b.logExecuteCommand(V.a.TOGGLE_PRETTY_PRINT_DISABLED,g.c.KeyboardShortcut);t=!0}else if(87===e.keyCode&&e.ctrlKey&&e.shiftKey&&!e.altKey){this._breakWorkerButton.isChecked?V.b.logExecuteCommand(V.a.BREAK_ON_NEW_WORKERS_OFF,g.c.KeyboardShortcut):V.b.logExecuteCommand(V.a.BREAK_ON_NEW_WORKERS_ON,g.c.KeyboardShortcut);this._breakWorkerButton.isChecked=!this._breakWorkerButton.isChecked;t=!0}}else{this._jmcButton.isChecked?V.b.logExecuteCommand(V.a.TOGGLE_JMC_MODE_OFF,g.c.KeyboardShortcut):V.b.logExecuteCommand(V.a.TOGGLE_JMC_MODE_ON,g.c.KeyboardShortcut);this._jmcButton.isChecked=!this._jmcButton.isChecked;this._debuggerShell.callstackWindow.enableJMC(this._jmcButton.isChecked);t=!0}else{Object(P.a)(this.toggleWordWrap,this,vt.TOGGLE_WORD_WRAP_SHORTCUT_DEBOUNCE_INTERVAL);t=!0}else{this._controller.stepOut(g.c.KeyboardShortcut);t=!0}else if(116===e.keyCode||119===e.keyCode){this._controller.continueExecution(V.a.START_DEBUGGING,g.c.KeyboardShortcut);t=!0}else if(121===e.keyCode){this._controller.stepOver(g.c.KeyboardShortcut);t=!0}else if(122===e.keyCode){this._controller.stepInto(g.c.KeyboardShortcut);t=!0}if(t){e.preventDefault();e.stopImmediatePropagation();return!1}return!0}toggleWordWrap(){const e=this._controller.debuggerManager.documentController.currentDoc;if(e&&e.editorWindow.wordWrapEnabled!==d.a.Disabled){e.editorWindow.wordWrapEnabled===d.a.On?V.b.logExecuteCommand(V.a.TOGGLE_WORD_WRAP_OFF,g.c.KeyboardShortcut):V.b.logExecuteCommand(V.a.TOGGLE_WORD_WRAP_ON,g.c.KeyboardShortcut);e.editorWindow.wordWrapEnabled=e.editorWindow.wordWrapEnabled===d.a.On?d.a.Off:d.a.On}else e&&e.editorWindow.wordWrapEnabled===d.a.Disabled&&V.b.logExecuteCommand(V.a.TOGGLE_WORD_WRAP_DISABLED,g.c.KeyboardShortcut)}}vt.TOGGLE_WORD_WRAP_SHORTCUT_DEBOUNCE_INTERVAL=375;var kt=i(150),Dt=i(123),Mt=i(71),xt=i(69),wt=i(56),Ot=i(65),Pt=i(42),Bt=i(27),Rt=i(59);const Lt="/Common/DOMExplorerMissingElementError";class At{constructor(e){this.narratorHelper=e;this._breakpoints=new Map;this._idsToUids=new Map;this._uidsToIds=new Map;this._pendingBreakpoints=new Map;this._unbounds=[];this._bpSet=[];this._bpEnabledChanged=[];this._bindFailed=[];this._pageChanged=[];this._bindPending=[];this._bindingMetrics=[];this._pendingRemoved=[]}addBreakpoint(e,t,i,n,s,o,r){this._breakpoints.set(e,{types:i,isEnabled:n,selector:s,documentUrl:o,elementUniqueId:e,breakpointId:t});this._idsToUids.set(t,e);this._uidsToIds.set(e,t);r&&this._pendingBreakpoints.delete(r);this.onDmbpSet(e,t,i,n,s,o)}unbindBreakpoint(e,t){let i=this._idsToUids.get(e);if(i){let n=this._breakpoints.get(i);this._breakpoints.delete(i);this._idsToUids.delete(e);this._uidsToIds.delete(i);this.onDmbpUnbound(i,n?n.selector:"",t)}}changeEnabledState(e,t){let i=this._idsToUids.get(e);if(i){let e=this._breakpoints.get(i);if(e){e.isEnabled=t;this.onDmbpEnabledChanged(i,t)}}}addPendingBreakpoints(e){for(let t of e)this._pendingBreakpoints.set(t.pendingId,t)}removePendingBreakpoint(e){this._pendingBreakpoints.delete(e);this.onPendingBreakpointRemoved(e)}unloadDocument(e,t=!1){if(t){this._pendingBreakpoints.clear();this._uidsToIds.clear();this._idsToUids.clear();this._breakpoints.clear()}else{let t=[];this._pendingBreakpoints.forEach(i=>{i.documentUrl===e&&t.push(i.pendingId)});for(let e of t)this._pendingBreakpoints.delete(e);let i=[],n=[];this._breakpoints.forEach(t=>{if(t.documentUrl===e){i.push(t.breakpointId);n.push(t.elementUniqueId)}});for(let e of i)this._idsToUids.delete(e);for(let e of n){this._uidsToIds.delete(e);this._breakpoints.delete(e)}}}onDmbpSet(e,t,i,n,s,o){}onDmbpUnbound(e,t,i){}onDmbpEnabledChanged(e,t){}onPendingBreakpointRemoved(e){this.fireEvent("domMutationPendingBreakpointRemoved",e)}isBreakpointSet(e,t){let i=this._breakpoints.get(e);return!!i&&i.types.indexOf(t)>-1}getBreakpointState(e){return this._breakpoints.get(e)}getBreakpointsTypesForElement(e){let t=this._breakpoints.get(e);return t?t.types.slice():[]}getDomMutationBreakpointEnabledState(e){let t=this.getBreakpointById(e);return!!t&&t.isEnabled}getBreakpointById(e){let t=this._idsToUids.get(e);return t?this._breakpoints.get(t):null}toggleBreakpointForElement(e,t){var i=this.getBreakpointsTypesForElement(e);if(-1===i.indexOf(t)){let n=i.slice();n.push(t);this.setDomMutationBreakpoint(e,n).catch(()=>{this.showError(this.getResourceString(Lt))});return!0}if(1===i.length){let t=this._uidsToIds.get(e);t&&this.removeDomMutationBreakpoint(t).catch(()=>{this.showError(this.getResourceString(Lt))})}else{i.splice(i.indexOf(t),1);this.setDomMutationBreakpoint(e,i).catch(()=>{this.showError(this.getResourceString(Lt))})}return!1}getBreakpoints(){let e=[];this._breakpoints.forEach(t=>{e.push(t)});return e}getPendingBreakpoints(){let e=[];this._pendingBreakpoints.forEach(t=>{e.push(t)});return e}getPendingBreakpointById(e){return this._pendingBreakpoints.get(e)}addEventListener(e,t){switch(e){case"domMutationBreakpointSet":this._bpSet.push(t);break;case"domMutationBreakpointUnbound":this._unbounds.push(t);break;case"domMutationBreakpointEnabledChanged":this._bpEnabledChanged.push(t);break;case"domMutationBreakpointBindingFailed":this._bindFailed.push(t);break;case"domMutationBreakpointPageChanged":this._pageChanged.push(t);break;case"domMutationBreakpointPendingRegistration":this._bindPending.push(t);break;case"domMutationBreakpointBindingMetrics":this._bindingMetrics.push(t);break;case"domMutationPendingBreakpointRemoved":this._pendingRemoved.push(t)}}removeEventListener(e,t){let i=-1;switch(e){case"domMutationBreakpointSet":(i=this._bpSet.indexOf(t))>-1&&this._bpSet.splice(i,1);break;case"domMutationBreakpointUnbound":(i=this._unbounds.indexOf(t))>-1&&this._unbounds.splice(i,1);break;case"domMutationBreakpointEnabledChanged":(i=this._bpEnabledChanged.indexOf(t))>-1&&this._bpEnabledChanged.splice(i,1);break;case"domMutationBreakpointBindingFailed":(i=this._bindFailed.indexOf(t))>-1&&this._bpEnabledChanged.splice(i,1);break;case"domMutationBreakpointPageChanged":(i=this._pageChanged.indexOf(t))>-1&&this._pageChanged.splice(i,1);break;case"domMutationBreakpointPendingRegistration":(i=this._bindPending.indexOf(t))>-1&&this._bindPending.splice(i,1);break;case"domMutationBreakpointBindingMetrics":(i=this._bindingMetrics.indexOf(t))>-1&&this._bindingMetrics.splice(i,1);break;case"domMutationPendingBreakpointRemoved":(i=this._pendingRemoved.indexOf(t))>-1&&this._pendingRemoved.splice(i,1)}}fireEvent(e,t){switch(e){case"domMutationBreakpointSet":this.triggerCallbacks(this._bpSet,t);break;case"domMutationBreakpointUnbound":this.triggerCallbacks(this._unbounds,t);break;case"domMutationBreakpointEnabledChanged":this.triggerCallbacks(this._bpEnabledChanged,t);break;case"domMutationBreakpointBindingFailed":this.triggerCallbacks(this._bindFailed,t);break;case"domMutationBreakpointPageChanged":this.triggerCallbacks(this._pageChanged,t);break;case"domMutationBreakpointPendingRegistration":this.triggerCallbacks(this._bindPending,t);break;case"domMutationBreakpointBindingMetrics":this.triggerCallbacks(this._bindingMetrics,t);break;case"domMutationPendingBreakpointRemoved":this.triggerCallbacks(this._pendingRemoved,t)}}tryAnnounce(e){this.narratorHelper&&this.narratorHelper.tryNarratorAnnounce(e)}showError(e){}triggerCallbacks(e,t){for(const i of e)i(t)}}var Ft=i(91);const Nt="AriaChangeStateAdd",Wt="AriaChangeStateRemove",jt="ElementDomMutationTooltip";Object(Ft.initializeServices)();class Kt extends At{constructor(e,t,i){super(i);this._rpc=e;this._persistenceManager=t;this._initialized=!1;this._currentPendingBreakpointId=1;this._pendingBreakpointData=new Map;this._loadingBreakpoints=!1;this._eventSource=Ee.c.registerWithEvents("DmbpService",this)}setDomMutationBreakpoint(e,t){return this._rpc.setDomMutationBreakpoint(e,t)}attemptRebind(e){const t=this._pendingBreakpointData.get(e);return t?this._rpc.attemptDomMutationBreakpointRebind(t.documentUrl,t.selector,t.types,t.wasPreviouslyEnabled,e):Promise.reject(new Error("No such pending breakpoint."))}attemptDmbpRebind(e){return this.attemptRebind(e)}removeDomMutationBreakpoint(e){return this._rpc.removeDomMutationBreakpoint(e)}setDomMutationBreakpointEnabledState(e,t){return this._rpc.setDomMutationBreakpointEnabledState(e,t)}deletePendingBreakpoint(e){this.removePendingBreakpoint(e);this.saveBreakpoints();return Promise.resolve()}catchupState(){const e=[];for(const t of this.getBreakpoints())e.push({breakpointId:t.breakpointId,documentUrl:t.documentUrl,elementUniqueId:t.elementUniqueId,isEnabled:t.isEnabled,selector:t.selector,types:t.types});for(const t of this.getPendingBreakpoints())e.push({breakpointId:null,documentUrl:t.documentUrl,elementUniqueId:null,isEnabled:t.wasPreviouslyEnabled,pendingBreakpointId:t.pendingId,selector:t.selector,types:t.types});return Promise.resolve({breakpoints:e})}deletePendingDmbpBreakpoint(e){return this.deletePendingBreakpoint(e)}onDomMutationBreakpointSet(e){this.addBreakpoint(e.elementUniqueId,e.breakpointId,e.types,e.isEnabled,e.selector,e.documentUrl,e.pendingBreakpointId);this._pendingBreakpointData.has(e.pendingBreakpointId)&&this._pendingBreakpointData.delete(e.pendingBreakpointId);this.fireEvent("domMutationBreakpointSet",e);this._eventSource.fireEvent("breakpointSet",e);this.saveBreakpoints()}onDomMutationBreakpointUnbound(e){const t=this.getBreakpointById(e.breakpointId);if(t){this.unbindBreakpoint(e.breakpointId,e.isRemoved);this.fireEvent("domMutationBreakpointUnbound",e);this._eventSource.fireEvent("breakpointUnbound",e);if(e.isRemoved)this.saveBreakpoints();else{const e={documentUrl:t.documentUrl,selector:t.selector,wasPreviouslyEnabled:t.isEnabled,types:t.types,pendingId:this._currentPendingBreakpointId++};this.addPendingBreakpoints([e]);this._pendingBreakpointData.set(e.pendingId,e);const i={breakpoints:[e]};this.fireEvent("domMutationBreakpointPendingRegistration",i);this._eventSource.fireEvent("breakpointPendingRegistration",i)}}}onDomMutationBreakpointEnabledChanged(e){this.changeEnabledState(e.breakpointId,e.isEnabled);this.fireEvent("domMutationBreakpointEnabledChanged",e);this._eventSource.fireEvent("breakpointEnabledChanged",e);this.saveBreakpoints()}onDomMutationBreakpointBindingFailed(e){this.fireEvent("domMutationBreakpointBindingFailed",e);this._eventSource.fireEvent("breakpointBindingFailed",e)}onDomMutationBreakpointPageChanged(e){this.unloadDocument(e.oldDocumentUrl,e.isTopLevelDocument);this.fireEvent("domMutationBreakpointPageChanged",e);this._eventSource.fireEvent("pageChanged",e);e.isTopLevelDocument&&e.newDocumentUrl&&this._persistenceManager.getDomMutationBreakpoints(e.newDocumentUrl).then(t=>{this._mostRecentUrl=e.newDocumentUrl;this.loadPendingBreakpoints(e.navigationCookie,t)})}onDomMutationBreakpointBindingMetrics(e){this.fireEvent("domMutationBreakpointBindingMetrics",e);this._eventSource.fireEvent("bindingMetrics",e)}loadPendingBreakpoints(e,t){this._loadingBreakpoints=!0;const i=t.map(e=>({documentUrl:e.url,selector:e.selector,wasPreviouslyEnabled:e.isEnabled,types:e.types,pendingId:this._currentPendingBreakpointId++}));this.addPendingBreakpoints(i);i.forEach(e=>{this._pendingBreakpointData.set(e.pendingId,e)});const n={breakpoints:i};this.fireEvent("domMutationBreakpointPendingRegistration",n);this._eventSource.fireEvent("breakpointPendingRegistration",n);const s={navigationCookie:e,urls:{}},o=i.reduce((e,t)=>{let i=e.urls[t.documentUrl];i||(i=e.urls[t.documentUrl]=[]);i.push({selector:t.selector,isEnabled:t.wasPreviouslyEnabled,types:t.types,pendingBreakpointId:t.pendingId});return e},s);this._rpc.rehydrateDomMutationBreakpoints(o);this._loadingBreakpoints=!1}initAtFirstConnection(){if(this._initialized)return;let e;this._rpc.dmbpQueryDocuments().then(t=>{this._mostRecentUrl=t.documents[0];e=t.navigationCookie;return Promise.all(t.documents.map(e=>this._persistenceManager.getDomMutationBreakpoints(e)))}).then(e=>e.reduce((e,t)=>e.concat(t),[])).then(t=>{void 0!==e&&this.loadPendingBreakpoints(e,t);this._initialized=!0})}unloadOnDetach(){this._loadingBreakpoints=!0;this._rpc.dmbpClearOnUnload();this.getBreakpoints().forEach(e=>{this.onDomMutationBreakpointUnbound({breakpointId:e.breakpointId,isRemoved:!0})});this._loadingBreakpoints=!1;this._initialized=!1}getResourceString(e,t){return Object(l.b)(e,t)}onDmbpSet(e,t,i,n,s,o){const r=e=>b.a.loadString(e),a=`${r(Nt)} ${r(jt)} ${s}`;this.narratorHelper.tryNarratorAnnounce(a)}onDmbpUnbound(e,t,i){if(i){const e=e=>b.a.loadString(e),i=`${e(Wt)} ${e(jt)} ${t}`;this.narratorHelper.tryNarratorAnnounce(i)}}onPendingBreakpointRemoved(e){super.onPendingBreakpointRemoved(e);this._eventSource.fireEvent("pendingBreakpointRemoved",{pendingBreakpointId:e})}getBreakpointsForStorage(){const e=new Map;return this.getBreakpoints().map(e=>({url:e.documentUrl,selector:e.selector,types:e.types,isEnabled:e.isEnabled})).concat(this.getPendingBreakpoints().map(e=>({url:e.documentUrl,selector:e.selector,types:e.types,isEnabled:e.wasPreviouslyEnabled}))).reduce((t,i)=>{const n=e.get(i.selector);if(n)for(const e of i.types){-1===n.types.indexOf(e)&&n.types.push(e)}else{t.push(i);e.set(i.selector,i)}return t},[])}saveBreakpoints(){if(this._loadingBreakpoints)return;const e=this.getBreakpointsForStorage();this._mostRecentUrl&&this._persistenceManager.saveDomMutationBreakpoints(this._mostRecentUrl,e)}}var Ut=i(53);class Ht{constructor(e){this._doc=e;this._id=x.a.NextModelId++}get id(){return this._id}get modelName(){return Ht.ModelName}get modelType(){return Ht.ModelType}get displayName(){return this._doc.displayName}get tooltip(){return this._doc.tooltip}get doc(){return this._doc}get texts(){this._doc=this._doc.latestRevision;this._doc.isPrettyPrintedTextSaved||this._doc.prettyPrintEnabled?this._doc.originalRevision.prettyPrintState=d.a.On:this._doc.originalRevision.prettyPrintState=d.a.Off;return Promise.all([this.originalText,this.modifiedText]).then(e=>({original:e[0],modified:e[1]}))}get editorState(){return this._editorState}set editorState(e){this._editorState=e}get modifiedText(){return this._doc.editorState?Promise.resolve(this._doc.editorState.model.getValue()):this._doc.getText()}get originalText(){return this._doc.originalRevision.getText()}}Ht.ModelName="DocDiff";Ht.ModelType="DocDiff";class Vt{constructor(e){this._docDiff=e}get diffModel(){return this._diffModel}refresh(){return this._docDiff.texts.then(e=>{let t=!1;const i=this._docDiff.doc.getMimeTypeCandidates().join(",");this._diffModel||(this._diffModel={});if(!this._diffModel.original||e.original!==this._diffModel.original.getValue()){this._diffModel.original&&this._diffModel.original.dispose();this._diffModel.original=monaco.editor.createModel(e.original,i);t=!0}if(!this._diffModel.modified||e.modified!==this._diffModel.modified.getValue()){this.diffModel.modified&&this.diffModel.modified.dispose();this._diffModel.modified=monaco.editor.createModel(e.modified,i);t=!0}return t})}destroy(){this._diffModel.original&&this._diffModel.original.dispose();this._diffModel.modified&&this._diffModel.modified.dispose();this._diffModel=null}}class Gt{constructor(){this._rootElement=document.createElement("div");this._rootElement.className="resourceHandler";window.addEventListener("resize",()=>{this._diffEditor&&this._diffEditor.layout()})}get rootElement(){return this._rootElement}doLayout(){this._diffEditor.layout()}openDiff(e,t){this._diffEditor||this.initialize();e.editorState||(e.editorState=new Vt(e));const i=this._displayedDiff===e;this._displayedDiff=e;return e.editorState.refresh().then(n=>{if(e===this._displayedDiff){i&&!n||this._diffEditor.setModel(e.editorState.diffModel);t&&this._diffEditor.focus()}})}closeDiff(e){if(this._displayedDiff===e){this._diffEditor.setModel(null);this._displayedDiff=null}e.editorState.destroy();e.editorState=null}initialize(){this._diffEditor=monaco.editor.createDiffEditor(this._rootElement,{contextmenu:!1,readOnly:!0,scrollbar:{vertical:"visible",horizontal:"visible",useShadows:!1,verticalHasArrows:!0,horizontalHasArrows:!0,handleMouseWheel:!0,verticalScrollbarSize:17,horizontalScrollbarSize:17,arrowSize:30},glyphMargin:!0})}}class zt{constructor(e){this._resourceViewController=e.resourceViewController;this._diffMap=new Map;this._resourceViewController.registerListener(this)}open(e,t){this._docDiffWindow||(this._docDiffWindow=new Gt);const i=e;return this._docDiffWindow.openDiff(i,2===t).then(()=>this._docDiffWindow)}close(e,t){this._docDiffWindow.closeDiff(e)}resourceRemoved(e){if(e instanceof Ut.b){const t=e;if(this._diffMap.has(t.frontendId)){const e=this._diffMap.get(t.frontendId);this._diffMap.delete(t.frontendId);t.nextRevision?this._diffMap.set(t.latestRevision.frontendId,e):this._resourceViewController.resourceRemoved(e)}}}onAttach(){this.doLayout()}doLayout(){this._docDiffWindow.doLayout()}openDiffForDoc(e){this._resourceViewController.open(this.getDiffForDoc(e))}get wasRecentlyEditing(){return!1}clearRecentlyEditingState(){}getDiffForDoc(e){let t=this._diffMap.get(e.frontendId);if(!t){t=new Ht(e);this._resourceViewController.resourceAdded(t);this._diffMap.set(e.frontendId,t)}return t}}var Xt=i(104);class qt{constructor(){this._internalMap={};this._valueToKey=[]}getFirstValue(e){const t=this._internalMap[e];if(t&&t.length>0)return t[0]}getValues(e){return this._internalMap[e]||[]}add(e,t){this._internalMap[e]=this._internalMap[e]||[];-1===this._internalMap[e].indexOf(t)&&this._internalMap[e].push(t);this._valueToKey[t]=e}remove(e){const t=this._valueToKey[e],i=this._internalMap[t];if(i){const t=i.indexOf(e);if(t>=0){i.splice(t,1);delete this._valueToKey[e];return!0}}return!1}}class Jt{constructor(e){this._docs=[];this._runtimeIdToFrontendIdMap=new Map;this._runtimeIdToInstanceIdMap=new Map;this._instanceIdToFrontendIdMap=new Map;this._urlToFrontendIdMap=new qt;this._longDocumentIdToFrontendIdMap=new Map;this._styleSheetKeyToFrontendIdMap=new Map;this._parentUrlToStyleSheetIds=new Map;this._longDocumentIdRequests=new Map;this._workspaceUriMapper=e}static isFileProtocol(e){return e.substring(0,Jt.FILE_PROTOCOL_PREFIX.length).toLowerCase()===Jt.FILE_PROTOCOL_PREFIX}onDocAdded(e){if(this._docs[e.frontendId]&&e.firstRunTimeId){this._runtimeIdToFrontendIdMap.set(e.firstRunTimeId,e.frontendId);if(e.rootInstance){this._runtimeIdToInstanceIdMap.set(e.firstRunTimeId,e.rootInstance.id);this._longDocumentIdToFrontendIdMap.set(e.rootInstance.longDocumentId,e.frontendId)}}else{this._docs[e.frontendId]=e;if(e.firstRunTimeId){if(e.rootInstance){this._runtimeIdToInstanceIdMap.set(e.firstRunTimeId,e.rootInstance.id);this._longDocumentIdToFrontendIdMap.set(e.rootInstance.longDocumentId,e.frontendId)}this._runtimeIdToFrontendIdMap.set(e.firstRunTimeId,e.frontendId)}const t=e.url;if(t){const i=this.getKeyForUrl(t);i&&this._urlToFrontendIdMap.add(i,e.frontendId)}}e.rootInstance&&this._instanceIdToFrontendIdMap.set(e.rootInstance.id,e.frontendId);if(e.styleSheetInfo){this._styleSheetKeyToFrontendIdMap.set(e.styleSheetInfo.key,e.frontendId);const t=this._parentUrlToStyleSheetIds.get(e.styleSheetInfo.parentKey)||new Set;t.add(e.frontendId);this._parentUrlToStyleSheetIds.set(e.styleSheetInfo.parentKey,t)}if(e.rootInstance){const t=e.rootInstance.longDocumentId;if(this._longDocumentIdRequests.has(t)){const i=this._longDocumentIdRequests.get(t);this._longDocumentIdRequests.delete(t);if(i)for(const t of i)t(e)}}}onInstanceAdded(e,t){this._runtimeIdToFrontendIdMap.set(t.runtimeId,e.frontendId);this._longDocumentIdToFrontendIdMap.set(t.longDocumentId,e.frontendId);this._runtimeIdToInstanceIdMap.set(t.runtimeId,t.id);this._instanceIdToFrontendIdMap.set(t.id,e.frontendId);if(this._longDocumentIdRequests.has(t.longDocumentId)){const i=this._longDocumentIdRequests.get(t.longDocumentId);this._longDocumentIdRequests.delete(t.longDocumentId);if(i)for(const t of i)t(e)}}onInstanceRemoved(e,t){const i=t.runtimeId;for(const t of e.instances)if(t.runtimeId===i){this._runtimeIdToFrontendIdMap.delete(i);this._longDocumentIdToFrontendIdMap.delete(t.longDocumentId);this._instanceIdToFrontendIdMap.delete(t.id);this._runtimeIdToInstanceIdMap.delete(i)}}getInstanceIdFromRuntimeId(e){return this._runtimeIdToInstanceIdMap.get(e)}contains(e){return b.a.isNumber(e.frontendId)&&void 0!==this._docs[e.frontendId]}onDocUrlChanged(e){const t=this.getKeyForUrl(e.url);this._urlToFrontendIdMap.remove(e.frontendId);this._urlToFrontendIdMap.add(t,e.frontendId)}getFrontendIdByStyleSheetKey(e){if(e)return this._styleSheetKeyToFrontendIdMap.get(e)}getFrontendIdByUrl(e){if(e){const t=this.getKeyForUrl(new De.a(e));return this._urlToFrontendIdMap.getFirstValue(t)}}getDocsWithSameUrl(e){const t=[];if(e){const i=this.getKeyForUrl(new De.a(e));for(const e of this._urlToFrontendIdMap.getValues(i))t.push(this._docs[e])}return t}getDocByFrontendId(e){return this._docs[e]}getDocFromInstanceId(e){const t=this._instanceIdToFrontendIdMap.get(e);if(void 0!==t)return this._docs[t]}getDocByRuntimeId(e){if(e){const t=this._runtimeIdToFrontendIdMap.get(e);if(void 0!==t)return this._docs[t]}}getRuntimeIdFromLongId(e){for(const t of this._docs)for(const i of t.instances)if(i.longDocumentId===e)return i.runtimeId}getDocByLongDocumentId(e){const t=this._longDocumentIdToFrontendIdMap.get(e);if(void 0!==t)return this._docs[t]}waitForDocWithLongDocumentId(e){if(this._longDocumentIdToFrontendIdMap.has(e)){const t=this._longDocumentIdToFrontendIdMap.get(e);if(void 0!==t)return Promise.resolve(this._docs[t])}const t=this._longDocumentIdRequests.get(e)||[];this._longDocumentIdRequests.has(e)||this._longDocumentIdRequests.set(e,t);return new Promise(e=>t.push(e))}getDocByMonacoUrl(e){const t=new De.a(e.toString(!0)),i=this._workspaceUriMapper.getExternalUri(t),n=this.getKeyForUrl(i),s=this._urlToFrontendIdMap.getFirstValue(n);return void 0===s?void 0:this.getDocByFrontendId(s)}getDocs(){const e=[];this._docs.forEach(t=>{e.push(t)});return e}getIdsWithParentUrl(e){return this._parentUrlToStyleSheetIds.get(e)}onDocRemoved(e){if(e&&this._docs[e.frontendId]){e.url&&this._urlToFrontendIdMap.remove(e.frontendId);if(e.styleSheetInfo){this._styleSheetKeyToFrontendIdMap.delete(e.styleSheetInfo.key);const t=this._parentUrlToStyleSheetIds.get(e.styleSheetInfo.parentKey);if(t){t.delete(e.frontendId);t.size||this._parentUrlToStyleSheetIds.delete(e.styleSheetInfo.parentKey)}}delete this._docs[e.frontendId]}}getKeyForUrl(e){let t=e.toString();e.scheme===De.a.UriSchemeFile&&(t=t.toLowerCase());return t}}Jt.FILE_PROTOCOL_PREFIX="file://";class $t{constructor(){this._nextWorkspaceId=0;this._externalOriginToWorkspaceMap=new Map;this._workspaceToExternalOriginMap=new Map;this._freeWorkspaceIds=new Array}get size(){return this._workspaceToExternalOriginMap.size}isWorkspaceUri(e){if(!e)throw new TypeError("Argument not optional: uri.");return e.scheme===$t.UriSchemeF12}hasWorkspace(e){if(!e)throw new TypeError("Argument not optional: workspaceUri.");if(e.scheme!==$t.UriSchemeF12)throw new URIError("Invalid workspace Uri.");const t=e.origin;return this._workspaceToExternalOriginMap.has(t)}getWorkspaceUri(e,t=!1){if(!e)throw new TypeError("Argument not optional: sourceUri.");if(this.isWorkspaceUri(e))return e;const i=e.origin,n=e.getComponents(496,1);let s=this._externalOriginToWorkspaceMap.get(i);if(!s||t){let e="workspace";0!==i.length||0!==n.length&&"/"===n.charAt(0)||(e+="-relative");const t=(s=De.a.create({scheme:$t.UriSchemeF12,hostname:e,port:this.getNextWorkspace()})).origin;this._externalOriginToWorkspaceMap.set(i,s);this._workspaceToExternalOriginMap.set(t,new De.a(i))}return new De.a(s,n)}getExternalUri(e){if(!e)throw new TypeError("Argument not optional: sourceUri.");if(!this.isWorkspaceUri(e))return e;const t=e.origin,i=this._workspaceToExternalOriginMap.get(t);if(!i)throw new Error("Unknown workspace.");const n=e.getComponents(496,1);return"workspace-relative"===e.hostname&&n.length>0&&"/"===n.charAt(0)?new De.a(n.substr(1)):new De.a(i,n)}deleteWorkspace(e){if(!e)throw new TypeError("Argument not optional: workspaceUri.");if(e.scheme!==$t.UriSchemeF12)throw new URIError("Invalid workspace Uri.");const t=e.origin,i=this._workspaceToExternalOriginMap.get(t);if(!i)return!1;const n=i.origin;this._workspaceToExternalOriginMap.delete(t);this._externalOriginToWorkspaceMap.delete(n);this._freeWorkspaceIds.push(e.port);return!0}getNextWorkspace(){if(this._freeWorkspaceIds.length>0)return this._freeWorkspaceIds.shift();if(this._nextWorkspaceId>0&&this._nextWorkspaceId-1===$t.MAX_WORKSPACE_ID)throw new Error("Out of workspaces.");return this._nextWorkspaceId++}}$t.UriSchemeF12="f12";$t.MAX_WORKSPACE_ID=Math.pow(2,32)-1;class Zt{constructor(e){this._previewDocsMap=new Map;this._telemetryStartTime={};this._debuggerManager=e;this._persistenceManager=this._debuggerManager.persistenceManager;this._persistenceManager.registerManualPersistModelName(Ut.b.ModelName);this._workspaceUriMapper=new $t;this._docTable=new Jt(this._workspaceUriMapper);this._listeners=[];this._docEventRegistrations=[];this._docListUpdated=new v.a;this._nextETWKey=0;this._docOpenedTraceKeys=[];this._docSwitchTraceKeys=[];e.jmcController.propertyChanged.addHandler(this.onJmcControllerPropertyChanged.bind(this));this._unparentedStyleSheetsByParent=new Map;this._unparentedStyleSheetsByKey=new Map}get isInSourceMapSwitch(){return this._isInSourceMapSwitch}get currentDoc(){const e=this._debuggerManager.resourceViewController.currentModel;return e instanceof Ut.b?e:e instanceof Xt.a?this._docTable.getDocFromInstanceId(e.id):void 0}get editorWindow(){return this._editorWindow}set editorWindow(e){this._editorWindow=e;e&&e.editorUpdated.addHandler(t=>{const i=e.currentModel;let n=-1;i&&(n=i.getValueLength());this.traceStopEvent(t,H.b.Debugger_OpenDocument_Stop,this._docOpenedTraceKeys,n);this.traceStopEvent(t,H.b.Debugger_SwitchDocument_Stop,this._docSwitchTraceKeys,n)})}get workspaceUriMapper(){return this._workspaceUriMapper}registerListener(e){-1===this._listeners.indexOf(e)&&this._listeners.push(e)}documentTextOrMimeTypeUpdated(e,t,i,n,s){if(!e)return;const o=e.mimeType!==n;e.mimeType=n;e.isOpen&&t&&(i?e.appendUnformattedText(t):e.setUnformattedText(t));for(const t of this._listeners)t.documentUpdated(e,o)}documentContentAppended(e,t){return e.onDocumentContentUpdated(t)}styleSheetAdded(e){const t=e.styleSheetInfo.key,i=e.styleSheetInfo.parentKey,n=e.styleSheetInfo.isImported?this.getDocFromStyleSheetKey(i):this.getDocFromUrl(i);if(n){a.a.hasValue(e.instances);e.rootInstance&&e.rootInstance.updateParent(n);this.documentAdded(e);const i=this._unparentedStyleSheetsByParent.get(t);if(i){i.forEach(e=>this.styleSheetAdded(e));this._unparentedStyleSheetsByParent.delete(t)}}else{const n=this._unparentedStyleSheetsByParent.get(i)||new Set;n.add(e);this._unparentedStyleSheetsByParent.set(i,n);this._unparentedStyleSheetsByKey.set(t,e)}}styleSheetRemoved(e,t){const i=e instanceof Ut.b,n=i?e.styleSheetInfo:e;let s=i?e:this.getDocFromStyleSheetKey(n.key);if(s){this.documentRemoved(s,{leaveInstances:!!t&&t.leaveInstances});s.previousRevision&&this.styleSheetRemoved(s.previousRevision)}else{s=this._unparentedStyleSheetsByKey.get(n.key);const e=this._unparentedStyleSheetsByParent.get(n.parentKey);if(s&&e){e.delete(s);this._unparentedStyleSheetsByKey.delete(n.key);e.size||this._unparentedStyleSheetsByParent.delete(n.parentKey)}}}documentAdded(e,t,i=!0){this._docEventRegistrations[e.frontendId]||(this._docEventRegistrations[e.frontendId]=[e.propertyChanged.addHandler(t=>this.onDocPropertyChanged(e,t)),e.locationsInvalidated.addHandler(t=>this.onDocLocationsInvalidated(e,t))]);let n=!1;if(this._docTable.contains(e))this._docTable.getDocByFrontendId(e.frontendId)||this._docTable.onDocAdded(e);else{this._docTable.onDocAdded(e);i&&this._debuggerManager.persistenceManager.persistResourceAdded(e);n=!0}e.isRemovedViaSourceMapChange=!1;n&&this._debuggerManager.jmcController.documentAdded(e);this._debuggerManager.resourceViewController.resourceAdded(e,t);e.rootInstance&&this._debuggerManager.resourceViewController.resourceAdded(e.rootInstance,t);const s=e.previousRevision;if(s){this._debuggerManager.resourceViewController.replace(s,e);s.close();this.documentRemoved(s,{leaveInTable:!0})}const o=e.styleSheetInfo?e.styleSheetInfo.key:e.url.raw,r=this._unparentedStyleSheetsByParent.get(o);if(r&&(e.isRuntimeDoc||e.styleSheetInfo)){r.forEach(e=>{this.styleSheetAdded(e);this._unparentedStyleSheetsByKey.delete(e.styleSheetInfo.key)});this._unparentedStyleSheetsByParent.delete(o)}return this._isInSourceMapSwitch?ke.a:this.updateDocListAfterSourceMapStateChange(e)}documentInstanceAdded(e,t){const i=new Xt.a(e,{},t,this._debuggerManager);t.instances.push(i);this._docTable.onInstanceAdded(t,i);this._debuggerManager.resourceViewController.resourceAdded(i,!1);return i}getInstanceFromRuntimeId(e,t){const i=this._docTable.getInstanceIdFromRuntimeId(t);return void 0===i?void 0:this.getInstanceFromInstanceId(e,i)}instanceRemoved(e,t,i){const n=!!i&&i.leaveInTable,s=!!i&&i.leaveInstances,o=e.instances.indexOf(t);if(o>=0){this._debuggerManager.resourceViewController.resourceRemoved(t);if(!n&&!s){this._docTable.onInstanceRemoved(e,t);e.instances.splice(o,1)}}}documentRemoved(e,t){const i=!!t&&t.leaveInTable;e.isOpen&&this._debuggerManager.resourceViewController.close(e,!0,!this.isInSourceMapSwitch,!0);const n=e.instances.slice();for(const i of n)this.instanceRemoved(e,i,t);this._debuggerManager.resourceViewController.resourceRemoved(e);if(i)e.isRemovedViaSourceMapChange=!0;else{e.previousRevision&&this.documentRemoved(e.previousRevision);this._debuggerManager.persistenceManager.persistResourceRemoved(e);this._docTable.onDocRemoved(e);if(e.sourceMap&&e.sourceMap.sources)for(const t of e.sourceMap.sources)this.documentRemoved(t);e instanceof Ut.a&&this._previewDocsMap.delete(e.nextRevision.frontendId);const t=this._docEventRegistrations[e.frontendId];if(t){for(const e of t)e.unregister();delete this._docEventRegistrations[e.frontendId]}}const s=e.styleSheetInfo?e.styleSheetInfo.key:e.url.raw,o=this._docTable.getIdsWithParentUrl(s);if(o){const t=[];o.forEach(e=>t.push(e));t.forEach(t=>{const i=this._docTable.getDocByFrontendId(t);if(i&&i.rootInstance&&i.rootInstance.getParent()===e){this.styleSheetRemoved(i,{leaveInTable:!1,leaveInstances:!0});i.rootInstance.updateParent();this.styleSheetAdded(i)}})}}documentLibraryStateChanged(e){for(const t of this._listeners)t.documentAsLibraryStateChanged(e);e.propertyChanged.invoke("libraryState")}getOpenDocs(){const e=[],t=this.getDocs();for(const i of t)i.isOpen&&e.push(i);return e}getDocFromRuntimeId(e){return this._docTable.getDocByRuntimeId(e)}getDocFromFrontendId(e){return this._docTable.getDocByFrontendId(e)}getDocFromInstanceId(e){return this._docTable.getDocFromInstanceId(e)}getRuntimeIdFromLongId(e){return this._docTable.getRuntimeIdFromLongId(e)}getInstanceFromInstanceId(e,t){for(const i in e.instances)if(e.instances[i].id===t)return e.instances[i]}getDocsWithSameUrl(e){return this._docTable.getDocsWithSameUrl(e)}updateInstance(e,t){this._docTable.onInstanceAdded(e,t)}getDocFromMonacoUrl(e){return this._docTable.getDocByMonacoUrl(e)}getDocs(){const e=this._docTable.getDocs();for(let t=e.length-1;t>=0;t--)e[t].isAuthored||e[t].sourceMapState!==d.a.On||e.splice(t,1);return e}getDocFromUrl(e){const t=this._docTable.getFrontendIdByUrl(e);if(void 0!==t)return this._docTable.getDocByFrontendId(t)}getNonRuntimeDoc(e){const t=this.getDocFromUrl(e);if(t&&!t.isRuntimeDoc)return t}toggleSourceMapsForCurrentDoc(e){if(!this.currentDoc)return ke.a;const t=this.currentDoc,i=this.currentDoc.rawDoc||this.currentDoc;if(!i.sourceMap||i.sourceMap.sourceMapState===d.a.Disabled)return ke.a;let n;n=t.sourceMapState===d.a.On?V.a.TOGGLE_SOURCE_MAPS_OFF:t.sourceMapState===d.a.Off?V.a.TOGGLE_SOURCE_MAPS_ON:V.a.TOGGLE_SOURCE_MAPS_DISABLED;return Object(V.c)(n,e,()=>new Promise(e=>{this._docListUpdated.addOne(()=>{this._isAnotherUpdateDocListQueued||e()});i.sourceMap.sourceMapState===d.a.Off?i.sourceMap.sourceMapState=d.a.On:i.sourceMap.sourceMapState===d.a.On&&(i.sourceMap.sourceMapState=d.a.Off)}))}getTranslatedLocation(e,t,i){const n=this.getDocFromUrl(e);if(n){const e=n.sourceMap;if(e&&n.sourceMapState===d.a.On){const s=e.getOriginalSourceLocation(new Mt.a(t-1,i-1,n.frontendId));return{documentPath:e.sources[s.file].url.toString(),oneBasedLine:s.line+1,oneBasedColumn:s.column+1}}}return{documentPath:e,oneBasedLine:t,oneBasedColumn:i}}open(e,t,i){R.b.dispatch(Object(B.b)(e.url.raw));if(e&&!e.isOpen&&void 0===this._docOpenedTraceKeys[e.frontendId]){const t=this._nextETWKey++;this._docOpenedTraceKeys[e.frontendId]=t;V.b.logPerformance({id:H.b.Debugger_OpenDocument_Start,message:i&&i.isUserInitiated?"UserInitiated":"Persisted",key:t});this._telemetryStartTime[t]=Date.now()}return this.openDocument(e,t,i&&i.location).then(e=>{if(e){this.doLayout(2===t);return this._editorWindow}})}close(e,t){this.closeDocument(e,t)}doLayout(e){this._editorWindow&&this._editorWindow.doLayout(e)}beginEdit(e){if(!e.isEditable||e.isEditPending)return;e.beginEdit();let t;"text/javascript"===e.mimeType?t=V.a.JS_FILE_DIRTIED:"text/css"===e.mimeType&&(t=V.a.CSS_FILE_DIRTIED);t&&V.b.logExecuteCommand(t,g.c.NotSpecified)}endEdit(e){e.endEdit()}editSource(e,t){return e.styleSheetInfo?this.editCSSSource(e,t):this._debuggerManager.editSource(e,t).then(t=>{const i=[];for(const e of t)i.push(this._docTable.waitForDocWithLongDocumentId(e));return Promise.all(i).then(t=>{const i=t[0];if(!i){a.a.fail("EOI document not created successfully");return Promise.reject(Error("Failed to create new document"))}e.endEdit();return i})})}getOrCreatePreviewDoc(e,t){const i=this._previewDocsMap.get(e.frontendId);if(i)return i;{const i=new Ut.a(e,t,this._debuggerManager);this._previewDocsMap.set(e.frontendId,i);this.documentAdded(i);return i}}deletePreviewDoc(e){const t=this._previewDocsMap.get(e);t&&this.documentRemoved(t)}getDocByLongDocumentId(e){return this._docTable.getDocByLongDocumentId(e)}get wasRecentlyEditing(){return!1}clearRecentlyEditingState(){}getDocPropertiesForTabControl(e){const t=e instanceof Ht?e.doc:e;return{url:t.url.toString(),isPreviewTab:!t.isLastRevision,isEditPending:t.isEditPending,previousRevision:t.previousRevision,nextRevision:t.nextRevision,propertyChanged:t.propertyChanged}}onTabControlContextMenu(e){const t=[];if(e instanceof Ut.b){const i=e;t.push({id:"menuItemSep1TabControl",type:U.MenuItemType.separator});t.push({id:"menuItemCopyUrlTabControl"+i.id,callback:()=>{V.b.logExecuteCommand(V.a.COPY_URL_FROM_TAB,g.c.ContextMenu);Object(K.copyPlainText)(i.url.toString())},label:Object(l.b)("ContextMenuCopyURL"),type:U.MenuItemType.command});t.push({id:"menuItemSep2TabControl",type:U.MenuItemType.separator});t.push({id:"menuItemMarkAsLibraryTabControl"+i.id,callback:()=>{i.setIsLibraryFile(!i.isLibraryFile,g.c.ContextMenu)},label:Object(l.b)("TabContextMenuMarkAsLibraryCode"),type:U.MenuItemType.checkbox,checked:()=>i.isLibraryFile,disabled:()=>!i.isRuntimeDoc||i.isDynamicCode});t.push({id:"menuItemSep3TabControl",type:U.MenuItemType.separator});t.push({id:"menuItemAddSourceMapTabControl"+i.id,callback:()=>{i.loadSourceMapFromFileSystem(g.c.ContextMenu)},label:Object(l.b)("TabContextMenuAddSourceMap"),type:U.MenuItemType.command,disabled:()=>!i.canAddSourceMap()})}return t}async editCSSSource(e,t){const i=(await this._debuggerManager.editCSSSource(e,t)).map(e=>this.getDocFromStyleSheetKey(e)).filter(e=>!!e).map(e=>e.setUnformattedText(t));await Promise.all(i);let n;if(e.previousRevision){n=e;e.endCommit()}else{n=Ut.b.createNonRuntimeCssDoc(e.styleSheetInfo,this._debuggerManager,!0);e.endCommit(n);this.styleSheetAdded(n)}e.endEdit();return n}getDocFromStyleSheetKey(e){const t=this._docTable.getFrontendIdByStyleSheetKey(e);if(void 0!==t)return this._docTable.getDocByFrontendId(t)}closeDocument(e,t){e.close();V.b.logPerformance({id:H.b.Debugger_CloseDocument_Start});if(!(e.isRuntimeDoc||"text/css"===e.mimeType||this.hasLoadedAuthoredDocs(e)||e instanceof Ut.a)){this._docTable.onDocRemoved(e);e.isAuthored&&!this._isInSourceMapSwitch&&e.rawDoc&&this._debuggerManager.resourceViewController.close(e.rawDoc,!0,!0)}this._editorWindow&&this._editorWindow.closeDocument(e);this._debuggerManager.persistenceManager.persistResourceClosed(e,t);V.b.logPerformance({id:H.b.Debugger_CloseDocument_Stop})}async openDocument(e,t,i){if(!e||!this._docTable.contains(e))return!1;e.open();if(0!==t&&e!==this.currentDoc&&void 0===this._docSwitchTraceKeys[e.frontendId]&&void 0===this._docOpenedTraceKeys[e.frontendId]){const t=this._nextETWKey++;this._docSwitchTraceKeys[e.frontendId]=t;V.b.logPerformance({id:H.b.Debugger_SwitchDocument_Start,key:t})}this._editorWindow&&await this._editorWindow.openDocument(e,t,i);this._debuggerManager.persistenceManager.persistResourceOpened(e,t,{location:i});await e.getText();return!0}traceStopEvent(e,t,i,n){if(e&&"number"==typeof i[e.frontendId]){V.b.logPerformance({id:t,key:i[e.frontendId]});if(t===H.b.Debugger_OpenDocument_Stop){V.b.logExecuteCommand(V.a.DEBUGGER_OPEN_DOCUMENT_END,g.c.NotSpecified,2,g.b.Telemetry,{durationMs:Date.now()-this._telemetryStartTime[i[e.frontendId]],selectedDocID:e.frontendId,documentLength:n});delete this._telemetryStartTime[i[e.frontendId]]}delete i[e.frontendId]}}hasLoadedAuthoredDocs(e){const t=e.sourceMap&&e.sourceMap.sources;if(t)for(const e of t)if(this._docTable.getDocByFrontendId(e.frontendId))return!0;return!1}updateDocListAfterSourceMapStateChange(e){let t=e;const i=!!this._editorWindow&&this._editorWindow.isActive();if(this._isInSourceMapSwitch){if(!this._isAnotherUpdateDocListQueued&&t.sourceMapState===d.a.Disabled){this._isAnotherUpdateDocListQueued=!0;this._docListUpdated.addOne(()=>{this.updateDocListAfterSourceMapStateChange(t);this._isAnotherUpdateDocListQueued=!1})}return ke.a}t.rawDoc&&(t=t.rawDoc);const n=t.sourceMap&&t.sourceMap.sources;if(!n)return ke.a;this._isInSourceMapSwitch=!0;const s=this._editorWindow&&this._editorWindow.previousSelectionLocation;if(s){const e=s.rawLocation;if(e.doc===t||n.indexOf(e.doc)>=0){const n=t.createDocumentLocation(e.offset,e.length);if(n.startPosition&&s.startPosition&&n.startPosition.doc!==s.startPosition.doc){const e=i?2:1;return this._debuggerManager.resourceViewController.open(n.startPosition.doc,{activation:e,params:{location:n},softOpen:!0}).then(()=>{this._isInSourceMapSwitch=!1;this._editorWindow&&this._editorWindow.selectRange(n,i);n.startPosition&&this._docListUpdated.invoke(n.startPosition.doc);this._debuggerManager.debuggerShell.tabControl.animation=!0})}}}this._isInSourceMapSwitch=!1;this._docListUpdated.invoke();return ke.a}onDocPropertyChanged(e,t){switch(t){case"url":this._docTable.onDocUrlChanged(e);for(const t of this._listeners)t.documentUrlChanged(e);break;case"sourceMapState":return this.updateDocListAfterSourceMapStateChange(e)}return ke.a}onDocLocationsInvalidated(e,t){this._debuggerManager.breakpointController.updateBreakpointLocations(e);t&&this.fireUpdated(e)}fireUpdated(e){for(const t of this._listeners)t.documentUpdated(e)}onJmcControllerPropertyChanged(e){if("isJustMyCodeEnabled"===e){const e=this.currentDoc;e&&e.propertyChanged.invoke("libraryState")}}}class Yt{constructor(e){this.propertyChanged=new v.a;this.pendingSetExecutionPausedPromise=Promise.resolve();this._debuggerManager=e;this._persistenceManager=this._debuggerManager.persistenceManager;this._listeners=[];this._executionPaused=!1;this._isDebuggingDisabled=Ot.a();this._breakOnAnyNewWorkerStartingEnabled=!1;this._breakState=this._isDebuggingDisabled?d.a.Disabled:d.a.Off;this._profilingStartedHandler=(()=>{this.onProfilingStateChange(!0)});this._profilingStoppedHandler=(()=>{this.onProfilingStateChange(!1)})}static isStepAction(e){switch(e){case 2:case 3:case 4:case 6:return!0;case 0:case 1:case 5:return!1;default:a.a.fail("Unknown BreakResumeAction")}return!1}static areISourceLocationsEqual(e,t){return e&&t&&e.docId===t.docId&&e.start===t.start&&e.length===t.length}get debuggerManager(){return this._debuggerManager}get isExecutionPaused(){return this._executionPaused}setExecutionPaused(e){if(e!==this._executionPaused){let t=ke.a;e&&(t=this.removeAnyPseudoBreakpoint());this.pendingSetExecutionPausedPromise=t.then(()=>{this._executionPaused=e;this.breakStateChanged();this.propertyChanged.invoke("isExecutionPaused");this.propertyChanged.invoke("allowDisconnectDebugging")});return this.pendingSetExecutionPausedPromise}return ke.a}get isDebuggingDisabled(){return this._isDebuggingDisabled}set isDebuggingDisabled(e){if(e!==this._isDebuggingDisabled){this._isDebuggingDisabled=e;this.breakStateChanged();e&&this._debuggerManager.breakpointController.unresolveAllBreakpoints();this.propertyChanged.invoke("isDebuggingDisabled")}}get breakState(){return this._breakState}set breakState(e){if(this._breakState!==e){this._breakState=e;this.propertyChanged.invoke("breakState")}}get exceptionFilter(){return this._exceptionFilter}get breakOnAnyNewWorkerStartingEnabled(){return this._breakOnAnyNewWorkerStartingEnabled}set breakOnAnyNewWorkerStartingEnabled(e){if(this._breakOnAnyNewWorkerStartingEnabled!==e){this._breakOnAnyNewWorkerStartingEnabled=e;this.propertyChanged.invoke("breakOnAnyNewWorkerStartingEnabled");this._debuggerManager.causeBreak(this._breakOnAnyNewWorkerStartingEnabled?1:3).then(()=>{this._debuggerManager.testEventObject.fireEvent("breakOnNewWorkerToggled")})}}get allowDisconnectDebugging(){return!this.isExecutionPaused&&!Ot.a()}get isDebuggingDisconnected(){return this.isDebuggingDisabled}set isDebuggingDisconnected(e){this.setIsDebuggingDisconnected(e)}setIsDebuggingDisconnected(e){return e!==this.isDebuggingDisconnected&&this.allowDisconnectDebugging?e?this._debuggerManager.disableDynamicDebugging().then(e=>{this.isDebuggingDisabled=0===e;this.propertyChanged.invoke("isDebuggingDisconnected")}):this._debuggerManager.enableDynamicDebugging().then(e=>{this.isDebuggingDisabled=0!==e;this.propertyChanged.invoke("isDebuggingDisconnected")}):ke.a}initialize(e){s.b.addEventListener("profilingstarted",this._profilingStartedHandler);s.b.addEventListener("profilingstopped",this._profilingStoppedHandler);this.onProfilingStateChange(this._isDebuggingDisabled);this.reinitialize(e)}uninitialize(){s.b.removeEventListener("profilingstarted",this._profilingStartedHandler);s.b.removeEventListener("profilingstopped",this._profilingStoppedHandler)}reinitialize(e){const t=this._persistenceManager.getSetting(Yt.EXCEPTION_FILTER_KEY),i=parseInt(t,10);this._exceptionFilter=null;isNaN(i)?e?this.setExceptionFilter(e,g.c.Internal):this.setExceptionFilter(0,g.c.Internal):this.setExceptionFilter(i,g.c.Internal)}setExceptionFilter(e,t){let i;switch(e){case 0:i=V.a.BREAK_ON_NO_EXCEPTIONS;break;case 1:i=V.a.BREAK_ON_UNHANDLED_EXCEPTIONS;break;case 2:i=V.a.BREAK_ON_ALL_EXCEPTIONS}return Object(V.c)(i,t,()=>{let t=ke.a;e!==this._exceptionFilter&&(t=this._debuggerManager.setExceptionFilter(e).then(t=>{if(t){this._exceptionFilter=e;for(const e of this._listeners)e.exceptionFilterChanged(this._exceptionFilter);this.propertyChanged.invoke("exceptionFilter");this._persistenceManager.setSetting(Yt.EXCEPTION_FILTER_KEY,""+e);this._persistenceManager.saveDebuggerData()}return t}));return t})}registerListener(e){this._listeners.push(e)}continueExecution(e,t){return Promise.resolve().then(()=>Object(V.c)(e,t,()=>this._debuggerManager.isBreakCompleted?this._debuggerManager.resume(1).then(e=>{this._debuggerManager.testEventObject.fireEvent("debuggerRunning");return e?this.setExecutionPaused(!1):ke.a}):ke.a))}breakAny(e){Object(V.c)(V.a.BREAK_ANY,e,()=>{this._debuggerManager.isBreakCompleted||this.isDebuggingDisabled||this._debuggerManager.causeBreak(0).then(()=>{for(const e of this._listeners)e.breakCallComplete();this.breakState=d.a.On;this._debuggerManager.testEventObject.fireEvent("breakSet")})})}stepInto(e){return Promise.resolve().then(()=>Object(V.c)(V.a.STEP_INTO,e,()=>{V.b.logPerformance({id:H.b.Debugger_StepInto_Start});return this._debuggerManager.isBreakCompleted?this._debuggerManager.resume(2).then(e=>{V.b.logPerformance({id:"Debugger_StepInto_Stop"});if(e)return this.setExecutionPaused(!1)}):ke.a}))}stepOut(e){return Promise.resolve().then(()=>Object(V.c)(V.a.STEP_OUT,e,()=>{V.b.logPerformance({id:H.b.Debugger_StepOut_Start});return this._debuggerManager.isBreakCompleted?this._debuggerManager.resume(4).then(e=>{V.b.logPerformance({id:"Debugger_StepOut_Stop"});if(e)return this.setExecutionPaused(!1)}):ke.a}))}stepOver(e){return Promise.resolve().then(()=>Object(V.c)(V.a.STEP_OVER,e,()=>{V.b.logPerformance({id:H.b.Debugger_StepOver_Start});return this._debuggerManager.isBreakCompleted?this._debuggerManager.resume(3).then(e=>{V.b.logPerformance({id:"Debugger_StepOver_Stop"});if(e)return this.setExecutionPaused(!1)}):ke.a}))}abort(){this._debuggerManager.isBreakCompleted&&this._debuggerManager.resume(0).then(e=>{e&&this.setExecutionPaused(!1)})}canSetNextStatement(e){return!this.isDebuggingDisabled&&e.startPosition.doc.isRuntimeDoc&&this._debuggerManager.isBreakCompleted?this._debuggerManager.canSetNextStatement(e):Promise.resolve(!1)}setNextStatement(e,t){if(!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("SetNextStatement"))return Object(V.c)(V.a.SET_NEXT_STATEMENT,t,()=>this.isDebuggingDisabled||!e.startPosition.doc.isRuntimeDoc?Promise.resolve(!1):this._debuggerManager.setNextStatement(e).then(t=>{t?this._debuggerManager.debuggerShell.editorWindow.destroyExceptionDisplays():this._debuggerManager.debuggerShell.editorWindow.addSetNextStatementErrorViewZone(e)}))}runToCursor(e,t,i){if(!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("RunToCursor")){V.b.logPerformance({id:"Debugger_RunToCursor_Start"});return Object(V.c)(V.a.RUN_TO_CURSOR,i,()=>{if(!this.isDebuggingDisabled&&e.isRuntimeDoc)return this.removeAnyPseudoBreakpoint().then(()=>{const i=new xe.a(e,t.lineNumber,t.column),n=[];for(const t of e.instances)n.push(this._debuggerManager.addCodeBreakpoint(t.runtimeId,i,!0));return Promise.all(n).then(async e=>{e&&(this._pseudoBreakpoints=e);await this.continueExecution(V.a.START_DEBUGGING,g.c.Internal);V.b.logPerformance({id:"Debugger_RunToCursor_Stop"})})});V.b.logPerformance({id:"Debugger_RunToCursor_Stop"})})}}removeAnyPseudoBreakpoint(e){let t=ke.a;if(this._pseudoBreakpoints&&this._pseudoBreakpoints.length&&(!e||e===this._pseudoBreakpoints[0].location.startPosition.doc)){const e=this._pseudoBreakpoints.map(e=>e.breakpointId);e.some(e=>this._debuggerManager.breakpointController.hasBreakpointWithId(e))||(t=Promise.all(e.map(e=>this._debuggerManager.removeBreakpoint(e))));this._pseudoBreakpoints=null}return t}hasPseudoBreakpoint(){return Boolean(this._pseudoBreakpoints&&this._pseudoBreakpoints.length)}updateAlertMessage(){W.a.setAlertMessage(this.isExecutionPaused?Object(l.b)("PausedInDebuggerAlert"):"")}breakStateChanged(){for(const e of this._listeners)e.breakStateChanged(this._executionPaused,this._isDebuggingDisabled);this.updateAlertMessage();this.breakState=this._executionPaused||this._isDebuggingDisabled?d.a.Disabled:d.a.Off}onProfilingStateChange(e){let t=Promise.resolve(!e);if(e){this.continueExecution(V.a.START_DEBUGGING,g.c.Internal);Be("ProfilingRunningMessage",void 0,0,"https://go.microsoft.com/fwlink/?LinkId=290645");t=this._debuggerManager.disableDynamicDebugging()}else{Re("ProfilingRunningMessage");this._debuggerManager.isAttached&&(t=this._debuggerManager.enableDynamicDebugging())}t.then(e=>{this.isDebuggingDisabled=0!==e;this.propertyChanged.invoke("allowDisconnectDebugging")})}}Yt.EXCEPTION_FILTER_KEY="DebuggerExceptionFilter";class Qt{static isIStackFrameContained(e,t,i,n){let s=!1;if(t.length>=e.length&&e.length>0){s=!0;for(let o=1;o<=e.length;o++){const r=e[e.length-o],a=t[t.length-o];if(!Yt.areISourceLocationsEqual(r.location,a.location)){if(1!==o){s=!1;break}if(!i||i!==n||r.location.docId!==a.location.docId||r.functionName!==a.functionName){s=!1;break}}}}return s}constructor(e){this._debuggerManager=e;this._beginResumeAction=1;this._beginResumeFrames=[];this._latestResumeAction=1;this._libraryCodeDocToAllowStepping=null;this._steppedIntoLibrary=!1;this._currentlySteppingThroughDocument=!1;this._asyncBreakRequested=!1;this._previouslyHitEventType=null}get isJustMyCodeEnabled(){return this._debuggerManager.jmcController.isJustMyCodeEnabled}justMyCodeStateChanged(e){!e&&this._asyncBreakRequested&&6===this._latestResumeAction&&this._debuggerManager.causeBreak(0)}ensureBreakInUserCode(){this._steppedIntoLibrary=!1}setJMCResumeInfo(e,t,i){if(this.isJustMyCodeEnabled){(i||1===t)&&(this._libraryCodeDocToAllowStepping=null);if(!i){this._beginResumeAction=t;this._beginResumeFrames=1!==t?e:[];this._currentlySteppingThroughDocument=!1;this._asyncBreakRequested=!1;this._previouslyHitEventType=null}this._latestResumeAction=t}}getJMCBreakAction(e,t,i,n,s){const o={ignoreBreak:!1,ignoreBreakAction:1,activeFrameIndex:-1,isLibraryFile:!1};if(this.isJustMyCodeEnabled&&e&&e.length>0){const r=1===t&&!!i,l=this.getDocFromStackFrame(e[0]);0===t&&this.queryStepAction(e,o,i);if(!o.ignoreBreak){let d=l&&l.isLibraryFile;if(!d&&l&&l.isDynamicCode&&e.length>1)for(let t=1;t<e.length;t++){const i=this.getDocFromStackFrame(e[t]);if(i&&!i.isDynamicCode){d=i&&i.isLibraryFile;break}}o.isLibraryFile=d;if(d){switch(t){case 0:case 5:if(this._libraryCodeDocToAllowStepping!==l){o.ignoreBreak=!0;o.ignoreBreakAction=6;this._libraryCodeDocToAllowStepping=null}else o.ignoreBreak=!1;5===t&&(this._asyncBreakRequested=!0);break;case 6:this.queryErrorAction(l,e,n,s,o);break;case 1:if(r){this.setJMCResumeInfo(e,2,!1);o.ignoreBreak=!0;o.ignoreBreakAction=6;this._currentlySteppingThroughDocument=!0;this._previouslyHitEventType=i}else{o.ignoreBreak=!1;this._libraryCodeDocToAllowStepping=l}break;case 2:case 3:case 7:case 4:case 8:case 100:o.ignoreBreak=!1;this._libraryCodeDocToAllowStepping=l;break;default:a.a.fail("Unknown BreakReason")}this._steppedIntoLibrary=!0}else{this._libraryCodeDocToAllowStepping=null;if(0===t&&this._steppedIntoLibrary&&Yt.isStepAction(this._latestResumeAction)){if(Qt.isIStackFrameContained(this._beginResumeFrames,e,this._previouslyHitEventType,i)){if(this._beginResumeFrames.length===e.length){o.ignoreBreak=!0;o.ignoreBreakAction=this._beginResumeAction}}else if(this._previouslyHitEventType){o.ignoreBreak=!0;o.ignoreBreakAction=1}}this._steppedIntoLibrary=!1}}if(!o.ignoreBreak&&l&&!l.hasSourceMapping(e[0].location.start)){o.ignoreBreak=!0;o.ignoreBreakAction=2}if(o.ignoreBreak){if(6===o.ignoreBreakAction&&!this._asyncBreakRequested&&!r){let t=!1;for(const i of e)if(i.location.docId!==e[0].location.docId){t=!0;break}if(!t){this._currentlySteppingThroughDocument=!0;this._debuggerManager.testEventObject.fireEvent("onlyLibraryCodeOnStack")}}}else this._currentlySteppingThroughDocument=!1}return o}getDocFromStackFrame(e){return this._debuggerManager.documentController.getDocFromRuntimeId(e.location.docId)}queryStepAction(e,t,i){if(this._currentlySteppingThroughDocument&&Yt.isStepAction(this._latestResumeAction)&&Yt.isStepAction(this._beginResumeAction)&&2!==this._beginResumeAction){const n=this._beginResumeFrames,s=n[n.length-1],o=s.location.start+s.location.length,r=e[e.length-1].location.start;if(Qt.isIStackFrameContained(n,e,this._previouslyHitEventType,i)||n.length===e.length&&o===r){t.ignoreBreak=!0;t.ignoreBreakAction=4}else{t.ignoreBreak=!1;this._currentlySteppingThroughDocument=!1}}}queryErrorAction(e,t,i,n,s){let o=-1;for(let e=0;e<t.length;e++){if(!this.getDocFromStackFrame(t[e]).isLibraryFile||t[e].isInTryBlock){o=e;break}}if(-1===o&&i)this._libraryCodeDocToAllowStepping=e;else if(-1===o&&!i||this.getDocFromStackFrame(t[o]).isLibraryFile&&!n){const e=Yt.isStepAction(this._latestResumeAction)?6:1;s.ignoreBreak=!0;s.ignoreBreakAction=e;this._currentlySteppingThroughDocument=!0}else{s.ignoreBreak=!1;s.activeFrameIndex=o}}}var ei=i(33);class ti{constructor(e){this.propertyChanged=new v.a;this._debuggerManager=e;this._persistenceManager=e.persistenceManager;this._listeners=[];this._jmcUrlCache={};this._isJustMyCodeAvailable=!0;this._isJustMyCodeEnabled=this._persistenceManager.getSetting(ti.JMC_SETTINGS_KEY,!0)}get debuggerManager(){return this._debuggerManager}get isJustMyCodeAvailable(){return this._isJustMyCodeAvailable}get isJustMyCodeEnabled(){return this._isJustMyCodeAvailable&&this._isJustMyCodeEnabled}set isJustMyCodeEnabled(e){if(e!==this._isJustMyCodeEnabled){V.b.logPerformance({id:H.b.Debugger_ToggleJMC_Start});this._isJustMyCodeEnabled=e;this._persistenceManager.setSetting(ti.JMC_SETTINGS_KEY,this._isJustMyCodeEnabled);this._persistenceManager.saveDebuggerData();for(const t of this._listeners)t.justMyCodeStateChanged(e);this._debuggerManager.jmcBreakController.justMyCodeStateChanged(e);this.propertyChanged.invoke("isJustMyCodeEnabled");V.b.logPerformance({id:H.b.Debugger_ToggleJMC_Stop})}}registerListener(e){this._listeners.push(e)}initialize(){const e=Object(F.g)();e.listen("jmcAvailabilityChanged",e=>this.onJMCAvailabilityChanged(e));e.listen("jmcRulesChanged",e=>this.onJMCRulesChanged(e));return this.checkAvailability()}getJMCTypeForUrl(e){const t=this._jmcUrlCache[e];if(void 0!==t)return t;this._jmcUrlCache[e]=ei.a.UserCode;ei.d(e).then(t=>{this.updateJMCCache(e,t)});return this._jmcUrlCache[e]}setJMCTypeForUrl(e,t){const i=this._jmcUrlCache[e];if(i!==t){V.b.logPerformance({id:H.b.Debugger_SpecifyUrlAsJMCType_Start});if(t===ei.a.Unsure){a.a.fail("F12 does not support setting a url to the 'Unsure' type");return Promise.resolve(!1)}return ei.j(e,t).then(t=>{this.updateJMCCache(e,t);this._debuggerManager.executionController.breakState===d.a.On&&this._debuggerManager.executionController.breakAny(g.c.Internal);V.b.logPerformance({id:H.b.Debugger_SpecifyUrlAsJMCType_Stop});return Promise.resolve(t!==i)})}return Promise.resolve(!1)}documentAdded(e){}onJMCAvailabilityChanged(e){this.checkAvailability()}onJMCRulesChanged(e){this.updateJMCCache(e.url,e.currentType)}checkAvailability(){return ei.e().then(e=>{this._isJustMyCodeAvailable=e;this.propertyChanged.invoke("isJustMyCodeAvailable");this.propertyChanged.invoke("isJustMyCodeEnabled");return e?Promise.resolve(void 0):ei.c()}).then(e=>{if(void 0!==e){let t,i;switch(e.name){case"jmcLoadError":t="JMCLoadError";i=e.message;break;case"jmcSaveError":t="JMCSaveError";i=e.message;break;case"jmcParseError":t="JMCJsonParseError";i=void 0;break;default:t="JMCLoadError"}Be(t,[i])}})}updateJMCCache(e,t){const i=this._jmcUrlCache[e];this._jmcUrlCache[e]=t;if(i!==t){const t=this._debuggerManager.documentController.getDocs(),i=new De.a(e);for(const e of t){const t=e.rawDoc&&e.rawDoc.url||e.url;De.a.equals(t,i)&&this._debuggerManager.documentController.documentLibraryStateChanged(e)}}}}ti.JMC_SETTINGS_KEY="isJMCEnabled";var ii=i(157);class ni{constructor(){this._isCanceled=!1}get isCanceled(){return this._isCanceled}cancel(){this._isCanceled=!0}}class si{constructor(){this._lastTextValue="";this._lastSearchExpression="";this._searchExpressionUpdated=!1;this._currentSearchToken="";this._currentSearchTokenStart=-1;this._currentSearchTokenEnd=-1;this._currentIntellisenseChoicesPromise=null;this._menuShouldOpenAfterPromiseCompletes=!1;this._currentIntellisenseChoices=null;this._performingCommit=!1;this._nextETWKey=0}get textEditorBridge(){return this._intellisenseContext.textEditorBridge}get intellisenseMenu(){return this._intellisenseContext.intellisenseMenu}get currentSearchToken(){return this._currentSearchToken}get currentSearchTokenStart(){return this._currentSearchTokenStart}get currentSearchTokenEnd(){return this._currentSearchTokenEnd}get onIntellisenseResultsAvailable(){return this._onIntellisenseResultsAvailable}set onIntellisenseResultsAvailable(e){this._onIntellisenseResultsAvailable=e}setCurrentIntellisenseChoices(e){this._currentIntellisenseChoices=e}attach(e){this._intellisenseContext=e;this.textEditorBridge.onTextChanged=(e=>this.textEditorBridge_textChanged(e));this.textEditorBridge.onCaretPositionChanged=(e=>this.textEditorBridge_caretPositionChanged(e));this.textEditorBridge.onSelectionLengthChanged=(e=>this.textEditorBridge_selectionLengthChanged(e));this.textEditorBridge.onMenuRequested=(()=>this.textEditorBridge_menuRequested());this.intellisenseMenu.onSelectionChanged=(e=>this.intellisenseMenu_selectionChanged(e));this.intellisenseMenu.onChoiceCommitted=((e,t)=>this.intellisenseMenu_choiceCommitted(e,t));this.intellisenseMenu.onClosing=(()=>this.intellisenseMenu_closing());this._lastTextValue=this.textEditorBridge.text}detach(){if(this._currentIntellisenseChoicesPromise){this._currentIntellisenseChoicesPromise.cancel();this._currentIntellisenseChoicesPromise=null;this._menuShouldOpenAfterPromiseCompletes=!1}this._currentSearchToken="";this._currentSearchTokenStart=-1;this._currentSearchTokenEnd=-1;this._currentIntellisenseChoices=null;this._lastTextValue="";this.textEditorBridge.onTextChanged=null;this.textEditorBridge.onCaretPositionChanged=null;this.textEditorBridge.onSelectionLengthChanged=null;this.textEditorBridge.onMenuRequested=null;this.intellisenseMenu.onSelectionChanged=null;this.intellisenseMenu.onChoiceCommitted=null;this.intellisenseMenu.onClosing=null;this._intellisenseContext=null}getCurrentFilteredIntellisenseCompletionList(){return this._currentIntellisenseChoices&&this._currentIntellisenseChoices.length>0?this.intellisenseMenu.filteredIntellisenseChoices:[]}clearLastValues(){this._currentSearchToken="";this._currentSearchTokenStart=-1;this._currentSearchTokenEnd=-1;this._currentIntellisenseChoices=null;this._lastTextValue=""}getCurrentExpression(e,t,i=-1){this.fireGetCurrentExpressionStartEvent(i);var n=e.substr(0,t),s=e.substr(t),o={text:"",offset:t},r=!1,a=!1,l=!1;if(n&&n.length>0){for(var d=0;d<n.length;++d){var c=r||a;if("\\"===n[d]&&c)l=!0;else{"'"!==n[d]||l?'"'!==n[d]||l||(a=!r&&!a):r=!r&&!a;l=!1}}if(r||a){this.fireGetCurrentExpressionEndEvent(i);return o}}var h=n.match(/var\s+\S+$/);if(h&&h.length>0){this.fireGetCurrentExpressionEndEvent(i);return o}var u=n.match(si.JAVASCRIPT_BEGIN_EXPRESSION_REGEX),p="";u&&(p=u[0]);var g=s.match(si.JAVASCRIPT_END_EXPRESSION_REGEX),m="";g&&(m=g[0]);if((p+m).match(/^\d/)){this.fireGetCurrentExpressionEndEvent(i);return o}this.fireGetCurrentExpressionEndEvent(i);return{text:p+m,offset:n.length-p.length}}getSearchTokenFromFullExpression(e){var t={text:"",offset:e.length},i=e.match(si.JAVASCRIPT_BEGIN_SEARCH_TOKEN_REGEX);if(i&&i.length>0){t.text=i[0];t.offset=e.length-t.text.length;return t}return t}getIntellisenseChoices(e,t,i,n){t(null)}onMenuSelectionChanged(e){}onMenuChoiceCommitted(e,t){this.textEditorBridge.insertText(this.currentSearchTokenStart,this.currentSearchTokenEnd,e.text)}onMenuClosing(){}fireGetCurrentExpressionStartEvent(e){}fireGetCurrentExpressionEndEvent(e){}fireUpdateIntellisenseStartEvent(e){}fireUpdateIntellisenseEndEvent(e){}completePromiseResults(e,t){this._currentIntellisenseChoicesPromise=null;this._menuShouldOpenAfterPromiseCompletes=!1;this._currentIntellisenseChoices=e;t||(t=this._etwKey);this.updateMenu(this._text,this._searchTokenUpdated,this._menuWillBeOpen,this._forceMenuOpen,t)}getIntellisenseChoicesAsync(e,t){var i=new ni;return new ve.a((n,s,o)=>{this.getIntellisenseChoices(e,n,i,t)},()=>{i.cancel();this.fireUpdateIntellisenseEndEvent(t);return!0})}updateIntellisense(e,t,i=!1){if(!this._performingCommit){var n=this._nextETWKey++,s=this.getCurrentExpression(e,t,n);if(s.text.length>0||i){this.fireUpdateIntellisenseStartEvent(n);var o=this.getSearchTokenFromFullExpression(s.text),r=o.text!==this._currentSearchToken||i,a=!o.text.match("^"+this._currentSearchToken)&&!this._currentSearchToken.match("^"+o.text)||1===o.text.length;this._currentSearchToken=o.text;this._currentSearchTokenEnd=s.offset+s.text.length;this._currentSearchTokenStart=this._currentSearchTokenEnd-this._currentSearchToken.length;var l=s.text.substr(0,o.offset-1),d=r&&a||this._lastSearchExpression!==l,c=this._searchExpressionUpdated;this._searchExpressionUpdated=!1;var h=this.intellisenseMenu.isOpen,u=this._menuShouldOpenAfterPromiseCompletes;if(d||!this._currentIntellisenseChoices){if(this._currentIntellisenseChoicesPromise){this._currentIntellisenseChoicesPromise.cancel();this._currentIntellisenseChoicesPromise=null;this._menuShouldOpenAfterPromiseCompletes=!1}this.intellisenseMenu.isOpen=!1;this.intellisenseMenu.placementTargetIndex=this.currentSearchTokenStart;if(0!==s.text.indexOf(".")&&s.text.indexOf("..")<0){this._currentIntellisenseChoicesPromise=this.getIntellisenseChoicesAsync(l,n);this._lastSearchExpression=l;c=!0}}var p=!1;if(t>0&&e.length>=t){p=!!e[t-1].match(/\s/)}var g=this.intellisenseMenu.isOpen||h||u||i;this._lastTextValue.length!==e.length-1||p||1!==this._currentSearchToken.length&&!c?this._searchExpressionUpdated=c:g=!0;this._text=e;this._searchTokenUpdated=r;this._menuWillBeOpen=g;this._forceMenuOpen=i;this._etwKey=n;if(this._currentIntellisenseChoicesPromise){this._menuShouldOpenAfterPromiseCompletes=g;this._currentIntellisenseChoicesPromise.then(e=>{this.completePromiseResults(e,n)})}else this.updateMenu(e,r,g,i,n)}else{this.intellisenseMenu.isOpen=!1;this.intellisenseMenu.intellisenseChoices=null;this._currentSearchToken="";this._currentSearchTokenStart=-1;this._currentSearchTokenEnd=-1;this._currentIntellisenseChoices=null;this.fireOnIntellisenseResultsAvailable()}this._lastTextValue=e}}updateMenu(e,t,i,n,s){this.intellisenseMenu.currentEtwKey=s;if(this._currentIntellisenseChoices&&this._currentIntellisenseChoices.length>0){if(i){if(this.intellisenseMenu.intellisenseChoices!==this._currentIntellisenseChoices){this.intellisenseMenu.intellisenseChoices=this._currentIntellisenseChoices.filter(e=>!si.IGNORED_OPTIONS.some(t=>e.optionName===t));this._currentIntellisenseChoices=this.intellisenseMenu.intellisenseChoices;t=!0}t&&this.intellisenseMenu.setFilter(this._currentSearchToken);this.fireOnIntellisenseResultsAvailable()}n?this.intellisenseMenu.forceOpen():this.intellisenseMenu.isOpen=i}else this.fireOnIntellisenseResultsAvailable();this.fireUpdateIntellisenseEndEvent(s)}fireOnIntellisenseResultsAvailable(){this._onIntellisenseResultsAvailable&&this._onIntellisenseResultsAvailable()}textEditorBridge_textChanged(e){this.updateIntellisense(e,this.textEditorBridge.caretPosition)}textEditorBridge_caretPositionChanged(e){0===this.textEditorBridge.selectionLength&&this.updateIntellisense(this.textEditorBridge.text,e)}textEditorBridge_selectionLengthChanged(e){e>0&&(this.intellisenseMenu.isOpen=!1)}textEditorBridge_menuRequested(){this.updateIntellisense(this.textEditorBridge.text,this.textEditorBridge.caretPosition,!0)}intellisenseMenu_selectionChanged(e){this.onMenuSelectionChanged(e)}intellisenseMenu_choiceCommitted(e,t){this._performingCommit=!0;this.onMenuChoiceCommitted(e,t);this.intellisenseMenu.isOpen=!1;this._lastTextValue=this.textEditorBridge.text;this.textEditorBridge.focusEditor();this._performingCommit=!1}intellisenseMenu_closing(){this.onMenuClosing()}}si.VALID_JAVASCRIPT_VARIABLE_LETTERS="$0-9A-Z_a-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶ-ͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԧԱ-Ֆՙա-և֑-ֽֿׁ-ׂׄ-ׇׅא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠࢢ-ࢬࣤ-ࣾऀ-ॣ०-९ॱ-ॷॹ-ॿঁ-ঃঅ-ঌএ-ঐও-নপ-রলশ-হ়-ৄে-ৈো-ৎৗড়-ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹ਼ਾ-ੂੇ-ੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલ-ળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଵ-ହ଼-ୄେ-ୈୋ-୍ୖ-ୗଡ଼-ଢ଼ୟ-ୣ୦-୯ୱஂ-ஃஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఁ-ఃఅ-ఌఎ-ఐఒ-నప-ళవ-హఽ-ౄె-ైొ-్ౕ-ౖౘ-ౙౠ-ౣ౦-౯ಂ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕ-ೖೞೠ-ೣ೦-೯ೱ-ೲം-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿං-ඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟෲ-ෳก-ฺเ-๎๐-๙ກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘-༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲ-ᝳក-៓ៗៜ-៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤜᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶᴀ-ᷦ᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌-‍‿-⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙-゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚗꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꩻꪀ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯪ꯬-꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︦︳-︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ";si.JAVASCRIPT_BEGIN_EXPRESSION_REGEX=new RegExp("[\\."+si.VALID_JAVASCRIPT_VARIABLE_LETTERS+"]+$");si.JAVASCRIPT_END_EXPRESSION_REGEX=new RegExp("^["+si.VALID_JAVASCRIPT_VARIABLE_LETTERS+"]+");si.JAVASCRIPT_BEGIN_SEARCH_TOKEN_REGEX=new RegExp("["+si.VALID_JAVASCRIPT_VARIABLE_LETTERS+"]+$");si.JAVASCRIPT_VALID_JS_VARIABLENAME_REGEX=new RegExp("^["+si.VALID_JAVASCRIPT_VARIABLE_LETTERS+"]+$");si.EVAL_RESULT_NAME="__IE_DEVTOOLBAR_CONSOLE_EVAL_RESULT";si.EVAL_ERROR="__IE_DEVTOOLBAR_CONSOLE_EVAL_ERROR";si.EVAL_ERRORCODE="__IE_DEVTOOLBAR_CONSOLE_EVAL_ERRORCODE";si.IGNORED_OPTIONS=["__proto__",si.EVAL_RESULT_NAME,si.EVAL_ERROR,si.EVAL_ERRORCODE];class oi extends si{constructor(e){super();this._debuggerManager=e;this._cachedLocalsInfo=null;this._callbackMap=new Map}static createInvoker(e,t){return'__BROWSERTOOLS_DEBUGGER.performBreakmodeIntellisense("'+e+'", "'+t.searchExpression+'", window, '+t.searchContext+", "+JSON.stringify(t.locals)+")"}static getNextId(){return oi.INTELLISENSE_ID_PREFIX+oi.IdCounter++}getIntellisenseChoices(e,t,i,n){this.fireGetIntellisenseItemsStartEvent(n);if(wt.c()||wt.b())this.getLocalsInfo().then(s=>{if(i.isCanceled){this.fireGetIntellisenseItemsEndEvent(n);t([])}else{const o={locals:s.map(e=>e.name),searchExpression:e,searchContext:"window"},r=o.searchExpression.split(".");if(r.length>0&&o.locals.indexOf(r[0])>=0){o.searchContext=r[0];o.searchExpression=r.slice(1).join(".")}const a=oi.getNextId(),l={cancelToken:i,completeCallback:t,etwKey:n};this._callbackMap.set(a,l);this._debuggerManager.getIntellisenseChoices(a,o)}});else{this.fireGetIntellisenseItemsEndEvent(n);t([])}}onIntellinsenseRequestComplete(e,t){if(this._callbackMap.has(e)){const i=this._callbackMap.get(e);if(!i)return;this.fireGetIntellisenseItemsEndEvent(i.etwKey);if(i.cancelToken.isCanceled)i.completeCallback([]);else{const e=[];if(t&&t.choices)for(const i of t.choices)i.name.match(si.JAVASCRIPT_VALID_JS_VARIABLENAME_REGEX)&&0!==i.name.indexOf(oi.BROWSERTOOLS_OBJECTS_PREFIX)&&e.push(new ii.a(i.name,i.info));i.completeCallback(e)}this._callbackMap.delete(e)}}activeFrameChanged(){this._cachedLocalsInfo=null}navigateTo(e){return ke.a}fireGetCurrentExpressionStartEvent(e){V.b.logPerformance({id:H.b.Debugger_Intellisense_Provider_Get_Expression_Start,key:e})}fireGetCurrentExpressionEndEvent(e){V.b.logPerformance({id:H.b.Debugger_Intellisense_Provider_Get_Expression_Stop,key:e})}fireUpdateIntellisenseStartEvent(e){V.b.logPerformance({id:H.b.Debugger_Intellisense_Provider_Update_Start,key:e})}fireUpdateIntellisenseEndEvent(e){V.b.logPerformance({id:H.b.Debugger_Intellisense_Provider_Update_Stop,key:e})}fireGetIntellisenseItemsStartEvent(e){V.b.logPerformance({id:H.b.Debugger_Intellisense_Provider_Get_Items_Start,key:e})}fireGetIntellisenseItemsEndEvent(e){V.b.logPerformance({id:H.b.Debugger_Intellisense_Provider_Get_Items_Stop,key:e})}getLocalsInfo(){return this._cachedLocalsInfo?Promise.resolve(this._cachedLocalsInfo):this._debuggerManager.watchController.getLocalsForCurrentStackFrame().then(e=>{this._cachedLocalsInfo=e;return e})}}oi.BROWSERTOOLS_OBJECTS_PREFIX="__BROWSERTOOLS";oi.INTELLISENSE_ID_PREFIX="DebuggerIntellisense:";oi.IdCounter=0;var ri=i(83);class ai{constructor(e,t,i){this.propertyChanged=new v.a;this._controller=e;this._location=t;const n=i.split("\n")[t.startLineNumber-1]||"",s=Math.max(0,t.startColumn-1-ai.CONTEXT_CHARS),o=t.endColumn-1+ai.CONTEXT_CHARS;this._preview=n.slice(s,o).trim();this._location.propertyChanged.addHandler(()=>this.propertyChanged.invoke("locationText"))}get location(){return this._location}get locationText(){return this._location.startDisplayText}get url(){return this._location.startPosition.doc.url.toString()}get previewText(){return this._preview}select(e=!1,t=!0){const i=this._controller,n=this._location,s=n.startPosition,o=s.doc,r=n.endPosition,a=new xe.a(o,s.line,s.column,r.doc,r.line,r.column,n.rawLocation);return i.open(o,a,e).then(()=>{const s=i.editorWindow,r=s.getRawLineTokens(n.startLineNumber),a=s.getLineContents(n.startLineNumber);if(!t||!(r&&r.length&&a)){this.highlightResult(o,n,e);return}const l=n.startColumn-1,d=r.length;let c=0;for(;c+1<d&&r[c+1].offset<=l;)c++;const h=c+2;if(h<d&&/identifier.[jt]s/.test(r[h].type)){const e=a.slice(r[c].offset,r[c+1].offset);switch(r[c].type){case"keyword.declare.js":case"keyword.declare.ts":c=h;break;case"keyword.js":case"keyword.ts":["get","set"].indexOf(e)>=0&&(c=h);break;case"keyword.visibility.ts":["private","public"].indexOf(e)>=0&&(c=h)}}let u;u=c+1<r.length?r[c+1].offset:a.length;u+=1;const p={startLineNumber:n.startLineNumber,startColumn:r[c].offset+1,endLineNumber:n.startLineNumber,endColumn:u};this.highlightResult(o,p,e)})}cleanup(){this._location.cleanup()}highlightResult(e,t,i){i?this._controller.editorWindow.selectRange(t):this._controller.editorWindow.setTextSpotlightDecorationLocation(new xe.a(e,t.startLineNumber,t.startColumn,e,t.startLineNumber,t.endColumn))}}ai.CONTEXT_CHARS=50;class li{constructor(e){this.propertyChanged=new v.a;this._debuggerManager=e}get editorWindow(){this._editorWindow||(this._editorWindow=this._debuggerManager.debuggerShell.editorWindow);return this._editorWindow}open(e,t,i=!1){return this._debuggerManager.resourceViewController.open(e,{activation:i?2:1,params:{location:t}})}goToDefinition(e){return Object(V.c)(V.a.GO_TO_DEFINITION,e,()=>{if(this.canGoToDefinition()){const e=this.getPosition();if(e)return this.findDeclaration(this.editorWindow.currentModel,e).then(e=>e?this.makeResult(e):null).then(e=>{if(e)return e.select(!0).then(()=>!0);this.editorWindow.focus();return!1})}return Promise.resolve(!1)})}canGoToDefinition(){return this.getPosition()&&this.editorWindow.getDeclarationsAtPosition&&ri.a.mediaTypeSupportsFindRefs(this.editorWindow.displayedDoc.mimeType)}findDeclaration(e,t){return this.editorWindow.getDeclarationsAtPosition?this.editorWindow.getDeclarationsAtPosition(e,t).then(e=>e&&e.length?e[0]:null):Promise.resolve(null)}makeResult(e){let t=this._debuggerManager.documentController.getDocFromMonacoUrl(e.uri);if(t){t=t.latestRevision;const i=e.range,n=t.getRawLocation({doc:t,line:i.startLineNumber,column:i.startColumn},!1),s=new xe.a(t,i.startLineNumber,i.startColumn,t,i.endLineNumber,i.endColumn),o=new we.a(n,s,!!t.rawDoc);return t.getText().then(e=>new ai(this,o,e))}return null}getPosition(){const e=this.editorWindow.getEditorSelection();return e?e.getStartPosition():null}}li.MONACO_EDITOR_PROTOCOL="f12";var di=i(133),ci=i(81);const hi=Object(ci.b)();class ui extends di.a{constructor(e){super(ui.DEBUGGER_SETTINGS_KEY);this._debuggerManager=e;this.isAttached=!1;this._debuggerData={resourceDisplayData:[]};this._propertyChangeRegistrations=[];this._activeResourceDataItemsMap={};this._resourceDisplayDataItems={};this.isInitialized=this.initialize();V.b.logPerformance({id:H.b.Debugger_Persistence_DataLoad_Start});this._dmbpStorage=hi.getSettings(ui.DEBUGGER_DMBP_KEY);this._deferredNonDocModels=[];this._manualPersistModelNames=[]}static persistenceKeyEquals(e,t){return e.toLowerCase()===t.toLowerCase()}registerManualPersistModelName(e){this._manualPersistModelNames.push(e)}saveDebuggerData(e=!0){if(this.isAttached){V.b.logPerformance({id:H.b.Debugger_Persistence_SaveState_Start});this.isAttached=e;hi.saveSettings(ui.DEBUGGER_DATA_KEY,this.fetchDebuggerData());V.b.logPerformance({id:H.b.Debugger_Persistence_SaveState_Stop})}}applyState(){V.b.logPerformance({id:H.b.Debugger_Persistence_AddWatches_Start});const e=this._debuggerData.watches;if(e)for(const t of e)this._debuggerManager.watchController.addWatch(t.expression,g.c.Internal);V.b.logPerformance({id:H.b.Debugger_Persistence_AddWatches_Stop});V.b.logPerformance({id:H.b.Debugger_Persistence_AddBreakpoints_Start});const t=this._debuggerData.breakpoints;t&&this._debuggerManager.breakpointController.addPendingBreakpoints(t);V.b.logPerformance({id:H.b.Debugger_Persistence_AddBreakpoints_Stop})}resourceAdded(e){this._manualPersistModelNames.indexOf(e.modelName)<0&&this.persistResourceAdded(e)}persistResourceAdded(e){if(e.shouldBePersisted){this._debuggerData.resourceDisplayData=this._debuggerData.resourceDisplayData||[];for(const t of this._debuggerData.resourceDisplayData)ui.persistenceKeyEquals(t.key,e.persistenceKey)&&(this._resourceDisplayDataItems[t.key]=t);e.persistedPropNames&&e.propertyChanged&&(this._propertyChangeRegistrations[e.id]=e.propertyChanged.addHandler(t=>{if(e.persistedPropNames&&e.persistedPropNames.indexOf(t)>=0){this.getResourceDisplayData(e.persistenceKey)[t]=e[t];this.saveDebuggerData()}}));if(this._debuggerData.openResources)for(const t of this._debuggerData.openResources)if(ui.persistenceKeyEquals(e.persistenceKey,t.key)&&!this.isAlreadyOpen(e.persistenceKey))if(e instanceof Ut.b||!this._deferredNonDocModels){if(!(e instanceof Ut.b&&e.nextRevision)){this.openModel(e,t);if(this._deferredNonDocModels){this._deferredNonDocModels.forEach(e=>this.openModel(e,t));this._deferredNonDocModels=void 0}break}}else this._deferredNonDocModels.push(e)}}resourceClosed(e,t){this._manualPersistModelNames.indexOf(e.modelName)<0&&this.persistResourceClosed(e,t)}persistResourceClosed(e,t){if(e.shouldBePersisted&&this._debuggerData.openResources)for(let i=0;i<this._debuggerData.openResources.length;i++){const n=this._debuggerData.openResources[i];if(ui.persistenceKeyEquals(e.persistenceKey,n.key)){this._activeResourceDataItemsMap.hasOwnProperty(n.key)&&delete this._activeResourceDataItemsMap[n.key];t||this._debuggerData.openResources.splice(i,1);this.saveDebuggerData();break}}}resourceOpened(e,t,i){this._manualPersistModelNames.indexOf(e.modelName)<0&&this.persistResourceOpened(e,t,i)}persistResourceOpened(e,t,i){if(e.shouldBePersisted){const n=this._debuggerData.openResources||[];for(const s of n)if(ui.persistenceKeyEquals(e.persistenceKey,s.key)){if(i&&i.location){const e=i;e.location&&e.location.startPosition&&(s.offset=e.location.rawLocation.offset)}0!==t&&(this._activeResourceDataItem=s);return}const s={key:e.persistenceKey};n.push(s)>ui.MAX_PERSISTED_RESOURCES&&n.shift();this._activeResourceDataItem=s;this._debuggerData.openResources=n;this.saveDebuggerData()}else this._activeResourceDataItem=void 0}resourceRemoved(e){this._manualPersistModelNames.indexOf(e.modelName)<0&&this.persistResourceRemoved(e)}persistResourceRemoved(e){const t=this._propertyChangeRegistrations[e.id];if(t){delete this._propertyChangeRegistrations[e.id];t.unregister()}}updateEditorPosition(e){this._activeResourceDataItem&&(this._activeResourceDataItem.offset=e)}getOffsetForDoc(e){let t=0;if(this._activeResourceDataItemsMap.hasOwnProperty(e.persistenceKey)){const i=this._activeResourceDataItemsMap[e.persistenceKey];void 0!==i.offset&&(t=i.offset)}return t}isPrettyPrintEnabled(e){const t=this.getResourceDisplayData(e.persistenceKey,!1).prettyPrintEnabled;return"boolean"==typeof t&&t}isSourceMapEnabled(e){const t=this.getResourceDisplayData(e.url.toString(),!1).sourceMapEnabled;return"boolean"!=typeof t||t}disableDmbpPersistence(){const e=!this._disableDmbpPersistence;this._disableDmbpPersistence=!0;return e}saveDomMutationBreakpoints(e,t){if(this._disableDmbpPersistence)return;const i=t.filter(t=>t.url===e).reduce((e,t)=>{let i=e[t.url];if(i)i.push(t);else{i=[t];e[t.url]=i}return e},{[e]:[]});this._dmbpStorage.then(e=>{for(const t of Object.keys(i))e[t]=i[t];this._dmbpStorage=Promise.resolve(e);hi.saveSettings(ui.DEBUGGER_DMBP_KEY,e)})}getDomMutationBreakpoints(e){return this._dmbpStorage.then(t=>t[e]||[])}initialize(){return this.loadDebuggerData(ui.DEBUGGER_DATA_KEY).then(e=>{this._debuggerData=e;V.b.logPerformance({id:H.b.Debugger_Persistence_DataLoad_Stop})})}loadDebuggerData(e){return hi.getSettings(e).then(e=>this._debuggerData=e,()=>this._debuggerData={})}openModel(e,t){V.b.logPerformance({id:H.b.Debugger_Persistence_TabOpen_Start});this._activeResourceDataItemsMap[t.key]=t;this._debuggerManager.resourceViewController.open(e,{activation:0}).then(()=>{V.b.logPerformance({id:H.b.Debugger_Persistence_TabOpen_Stop})})}isAlreadyOpen(e){const t=this._debuggerManager.resourceViewController.openModels;for(const i of t)if(i.persistenceKey){const t=i;if(ui.persistenceKeyEquals(t.persistenceKey,e))return!0}return!1}fetchDebuggerData(){this._debuggerData=this._debuggerData||{};this._debuggerData.watches=this.fetchWatchesData();this._debuggerData.breakpoints=this.fetchBreakpointsData();return this._debuggerData}fetchWatchesData(){let e;const t=this._debuggerManager.watchController.getWatches();if(t.length>0){e=[];for(const i of t)i.isUserWatch&&e.push({expression:i.watchName})}return e}fetchBreakpointsData(){let e;const t=this._debuggerManager.breakpointController.getBreakpoints();if(t.length>0){e=[];for(const i of t)i.eventTypes?e.push({condition:i.condition,eventTypes:i.eventTypes,isEnabled:i.isEnabled,isTracepoint:i.isTracepoint}):i.location&&e.push({condition:i.condition,displayUrl:i.location.startPosition&&i.location.startPosition.doc.url.toString(),isEnabled:i.isEnabled,isTracepoint:i.isTracepoint,oneBasedStartColumn:i.location.startColumn,oneBasedStartLine:i.location.startLineNumber,rawLocation:i.rawLocation,url:i.location.rawLocation.doc.url.raw})}return e}getResourceDisplayData(e,t=!0){const i=e.toLowerCase();let n=this._resourceDisplayDataItems[i];if(!n){n={key:i};if(t){this._resourceDisplayDataItems[i]=n;this._debuggerData.resourceDisplayData||(this._debuggerData.resourceDisplayData=[]);this._debuggerData.resourceDisplayData.push(n);this._debuggerData.resourceDisplayData.length>ui.MAX_PERSISTED_RESOURCES&&this._debuggerData.resourceDisplayData.shift()}}return n}}ui.DEBUGGER_DATA_KEY="JavaScriptDebuggerData";ui.DEBUGGER_DMBP_KEY="DomMutationDebuggerData";ui.DEBUGGER_SETTINGS_KEY="JavaScriptDebuggerSettings";ui.MAX_PERSISTED_RESOURCES=100;class pi{constructor(e,t,i){this._resources=new Set;this._resourceVC=e;this._removeDoc=t;this._testEventObject=i}removeAll(){this._removingAll=!0;const e=[];this._resources.forEach(t=>{t instanceof Ut.b?e.push(this._removeDoc(t)):t instanceof Xt.a||this._resourceVC.resourceRemoved(t)});return Promise.all(e).then(()=>{this._resources=new Set;this._removingAll=!1})}resourceAdded(e,t){this._testEventObject.fireEvent("filePickerResourceAdded",{model:e});this._removingAll||this._resources.add(e)}resourceRemoved(e){this._removingAll||this._resources.delete(e)}}class gi extends Error{constructor(e=Object(l.b)("SourceEditError"),t=0,i=0){super();this.name="SourceEditError";this.message=e;this.line=t;this.column=i}}class mi{constructor(e,t){this.initializedSelfTest=!1;this._markToolReady=Object(P.f)(()=>{Rt.markToolReady(N.c.debugger);Bt.startPreload(N.c.debugger)});this.isAttached=Object(T.isEdpEnabled)();this.rpcClient=Object(F.g)();this.debuggerShell=t;this._rpcWrapper=e;this._previousRevisions=new Map;this._nextRevisions=new Map;this._waitingForProfilingStopped=!1;this._testEventObject=new xt.a;this.persistenceManager=new ui(this);this.isInitialized=this.persistenceManager.isInitialized;this.intellisenseProvider=new oi(this);this._dmbpManager=new Kt(e,this.persistenceManager,t);const i=t&&t.documentToolbar;this.breakpointController=new G.a(this);this.executionController=new Yt(this);this.jmcController=new ti(this);this.jmcBreakController=new Qt(this);this.resourceViewController=new x.a(document.getElementById("resourcesView"),i,!0,!0);this.languageServiceController=new li(this);this.documentController=new Zt(this);this.watchController=new pt.a(this,!1);this.docDiffHandler=new zt(this);this._resourceTable=new pi(this.resourceViewController,this.removeDocOnDetach.bind(this),this._testEventObject);this.rpcClient.listen("notificationFromRemote|ms:debugger",e=>{const{event:t,params:i}=e;this._rpcWrapper.jsonDiagOMRpcNotificationReceive(t,i)});this.rpcClient.listen("notificationFromRemoteDebuggerOM",e=>{const{event:t,params:i}=e;this._rpcWrapper.jsonRpcNotificationReceive(t,i)});this.rpcClient.listen("debuggerRemoteAttached",()=>{this.isAttached=!0;this.onConnect()});this.rpcClient.listen("debuggerRemoteDetached",()=>{this.isAttached=!1;this.onDetached()});this.rpcClient.listen("triggerSteppingFromConsole",e=>{this.triggerSteppingFromConsole(e)});this.rpcClient.listen("consoleStateChange",e=>{e.shown&&e.isSplit?this.splitConsoleOpen=!0:this.splitConsoleOpen=!1});this.resourceViewController.registerHandler(Ut.b.ModelName,this.documentController);this.resourceViewController.registerHandler(Ht.ModelName,this.docDiffHandler);this.resourceViewController.registerListener(this.persistenceManager);this.resourceViewController.registerListener(this._resourceTable);L.w&&this.rpcClient.listen("syntaxError",e=>this.onSyntaxError(e));this.registerPluginMethodHandlers()}get testEventObject(){return this._testEventObject}get isBreakCompleted(){return this._breakCompleted&&this.executionController.isExecutionPaused}get isDebuggerReady(){return this._debuggerLaunched||Ot.a()&&this._isDebuggerSourceRundownComplete}get activeStackFrame(){return this._activeFrame}get instructionPointerFrame(){return this._instructionPointerFrame}get prettyPrintEnabledForActiveDocument(){const e=this.documentController.currentDoc;return e?e.prettyPrintState:d.a.Disabled}get dmbpManager(){return this._dmbpManager}onDetached(){this._dmbpManager.unloadOnDetach();return this.waitOnRuntimeEditSemaphoreIfNeeded(()=>{this._debuggerLaunched=!1;this._latestDmbp=void 0;this.executionController.isDebuggingDisabled=!0;this.executionController.setExecutionPaused(!1);this.executionController.uninitialize();this.persistenceManager.saveDebuggerData(!1);this.breakpointController.deleteAll(g.c.Internal,!0);this.watchController.deleteAll(g.c.Internal);this.debuggerShell.tabControl.animation=!1;this.debuggerShell.tabControl.closePreviewTab(!1);R.b.dispatch(Object(B.h)());this._breakCompleted=!1;this.clearActiveFrame();this.watchController.disableWatchesWindow()}).then(()=>this._resourceTable.removeAll())}registerPluginMethodHandlers(){this.rpcClient.register("breakModeCommand",async e=>this.executeBreakModeCommand(e));this.rpcClient.register("addToWatch",async e=>{this.watchController.addWatch(e,g.c.Internal)});this.rpcClient.register("showDocument",async(e,t=1,i=1,n="")=>{this.showDocument(e,t||1,i||1,n)});this.rpcClient.register("getCurrentCallFrameId",async()=>{if(this._activeFrame)return this._activeFrame.callFrameId});this.rpcClient.register("getLocalsForCurrentStackFrame",async()=>{return await this.watchController.getLocalsForCurrentStackFrame()});this.rpcClient.register("getTranslatedLocation",async(e,t=1,i=1)=>this.documentController.getTranslatedLocation(e,t,i));this.rpcClient.register("breakAny",async e=>{this.executionController.breakAny(e)});this.rpcClient.register("executeOnTargetPage",(e,t)=>this.executeOnTargetPage(e,t));this.rpcClient.register("downloadUrl",e=>this.downloadUrl(e));window.setImmediate(()=>{Object(L.A)(N.c.debugger)})}onResumeScriptExecution(){this.isBreakCompleted?this.executionController.abort():this.executionController.isExecutionPaused&&(this._abortBreak=!0)}onConnect(){if(Ot.a()){Be("ProfilingRunningMessage",void 0,0,"https://go.microsoft.com/fwlink/?LinkId=290645");this.initializeOnProfilerStopped()}else this.initializeDebugger();this._dmbpManager.initAtFirstConnection()}onStyleSheetAdded(e){let t=this.documentController.getDocFromUrl(e.url);t&&!t.styleSheetInfo?t.makeStyleSheetDoc(e):t=Ut.b.createNonRuntimeCssDoc(e,this);this.documentController.styleSheetAdded(t)}onStyleSheetRemoved(e){this.documentController.styleSheetRemoved(e)}initializeOnProfilerStopped(){if(!this._waitingForProfilingStopped){this._waitingForProfilingStopped=!0;const e=()=>{s.b.removeEventListener("profilingstopped",e);this._waitingForProfilingStopped=!1;this.isAttached&&this.initializeDebugger()};this._rpcWrapper.triggerSourceRundown().then(e=>{switch(e){case 0:this._isDebuggerSourceRundownComplete=!0;this.testEventObject.fireEvent("debuggerLaunched");return}});s.b.addEventListener("profilingstopped",e)}}async initializeDebugger(e){let t;await this.jmcController.initialize();const i=Ot.a();i&&(t=1);switch(t=await this.enableDynamicDebugging()){case 0:this.initializeOnConnectionSuccess(e);break;case 2:case 1:this.executionController.isDebuggingDisabled=!0;let n="";2===t&&(n="\n"+Object(l.b)("DebuggerFailedToConnectAnotherAttached"));i?this.initializeOnProfilerStopped():Be("DebuggerFailedToConnect",[n],0,mi.DEBUGGER_FAILED_CONNECT_FWLINK);break;default:a.a.fail(`Unknown ConnectionResult "${t}". Has something been added to the enum?`)}}executeOnTargetPage(e,t){return this._rpcWrapper.executeOnTargetPage(e,t)}enableDynamicDebugging(){return this.isAttached?this._rpcWrapper.enableDynamicDebugging():Promise.resolve(1)}disableDynamicDebugging(){return this.isAttached?this._rpcWrapper.disableDynamicDebugging():Promise.resolve(0)}getBreakpointIdFromLocation(e){return e.rawLocation.doc.getText().then(()=>this._rpcWrapper.getBreakpointIdFromSourceLocation(e.rawLocation.doc,this.getRawOffset(e)))}async addCodeBreakpoint(e,t,i,n,s=!1){if(e&&t){await t.rawLocation.doc.getText();const o=await this._rpcWrapper.addCodeBreakpoint(e,this.getRawOffset(t),i,n,s);if(o.failed)return;return await this.createOrResolveBreakpointFromInfo(o)}}addEventBreakpoint(e,t,i,n,s){return this._rpcWrapper.addEventBreakpoint(e,t,i,n).then(e=>{const t=this.createBreakpointFromInfo(e);s&&s(t);return t})}addPendingBreakpoint(e){return this._rpcWrapper.addPendingBreakpoint(e)}causeBreak(e,t){return this._rpcWrapper.causeBreak(e,t)}getSourceText(e,t,i){return this._rpcWrapper.getSourceText(e,t,i)}editCSSSource(e,t){e.beginCommit();return this._rpcWrapper.editCSSSource(e,t).then(e=>{this.logFileSaved("css");return e})}editSource(e,t){this._runtimeEditSemaphore||(this._runtimeEditSemaphore=new kt.a(1));return this.waitOnRuntimeEditSemaphoreIfNeeded(()=>{if(!e.isEditable)throw new Error("Doc does not support editing.");e.beginCommit();const i=[];for(const n of e.instances){const e=n.longDocumentId;if(void 0===e)continue;const s=this._rpcWrapper.editSource(e,t,n.iframeIndex).then(t=>{if(t.error){this.logFileSaved("js",!1,t.error.message);return Promise.reject(new gi(t.error.message,t.error.line,t.error.column))}if(!t.newDocId){this.logFileSaved("js",!1,"Invalid newDocID");return Promise.reject(new gi("Invalid newDocID"))}this.logFileSaved("js");this._previousRevisions.set(t.newDocId,e);this._nextRevisions.set(e,t.newDocId);return t.newDocId});i.push(s)}return Promise.all(i).then(null,t=>{e.isCommitPending&&e.endCommit();return Promise.reject(t)})})}removeBreakpoint(e){return this._rpcWrapper.removeBreakpoint(e)}setBreakpointEnabledState(e,t){return this._rpcWrapper.setBreakpointEnabledState(e,t)}setBreakpointCondition(e,t,i){return this._rpcWrapper.setBreakpointCondition(e,t,i)}resume(e,t){this._breakCompleted=!1;this._latestDmbp=void 0;return this.watchController.waitForRefreshPromise.then(()=>{if(!t){const t=()=>{this.watchController.disableWatchesWindow();this.debuggerShell.switchToBreakpointWindow();this.clearActiveFrame()};2===e||4===e||3===e?this._clearWatchesAndCallstacksTimeout=window.setTimeout(t,100):t()}R.b.dispatch(Object(B.h)());this.jmcBreakController.setJMCResumeInfo(this._latestStackFrames,e,t);return this._rpcWrapper.resume(e).then(t=>{wt.f();this.testEventObject.fireEvent("resumeComplete",e);this.debuggerShell.tabControl.closePreviewTab(Yt.isStepAction(e));return t})})}setExceptionFilter(e){return this._rpcWrapper.setExceptionFilter(e)}getNextDocContainingMatch(e,t){return t&&0!==t.length?this.queueMatchQuery(e,t,0):Promise.resolve(null)}getFrames(e){return this._rpcWrapper.getFrames(e)}getCurrentThreadDescription(){return this._rpcWrapper.getCurrentThreadDescription()}eval(e,t){return this._rpcWrapper.eval(e,t)}getLocals(e){return this._rpcWrapper.getLocals(e)}getChildProperties(e,t,i){return this._rpcWrapper.getChildProperties(e,t,i)}setPropertyValueAsString(e,t){return this._rpcWrapper.setPropertyValueAsString(e,t)}canSetNextStatement(e){return e.rawLocation.doc.getText().then(()=>{a.a.hasValue(document,"Can set next statement has been called for a document which does not have a formatter.");return this._rpcWrapper.canSetNextStatement(e.rawLocation.doc,this.getRawOffset(e))})}setNextStatement(e){a.a.hasValue(document,"Set next statement has been called for a document which does not have a formatter.");return e.rawLocation.doc.getText().then(()=>this._rpcWrapper.setNextStatement(e.rawLocation.doc,this.getRawOffset(e)))}togglePrettyPrintEnabledForActiveDocument(){const e=this.documentController.currentDoc;e&&(e.prettyPrintState=e.prettyPrintState===d.a.On?d.a.Off:d.a.On)}async showDocument(e,t,i,n,s=!1){Object(L.e)(N.c.debugger);let o=this.documentController.getDocFromUrl(e);if(!o){o=Ut.b.createNonRuntimeDoc(e,n,this);this.documentController.documentAdded(o)}if(o){const e=(o=o.latestRevision).sourceMap;if(o.isAuthored&&o.isBrokenFile){const e=o.getRawLocation({doc:o,line:t,column:i}),n=e.doc.getDisplayPosition(e.offset);await this.showDocument(o.rawDoc.url.toString(),n.line,n.column,void 0,s)}else if(e&&o.sourceMapState===d.a.On){const n=e.getOriginalSourceLocation(new Mt.a(t-1,i-1,o.frontendId));await this.showDocument(e.sources[n.file].url.toString(),n.line+1,n.column+1,void 0,s)}else{await o.getText();if(s)this.resourceViewController.open(o);else{const e=o.rawPositionToRawOffset(t,i),n=o.getDisplayPosition(e)||{doc:o,line:t,column:i},s=new xe.a(n.doc,n.line,n.column);await this.resourceViewController.open(n.doc,{params:{location:s}});o.editorWindow.updateShowDocumentLocation(o,s)}}}}downloadUrl(e,t="",i){let n=e,s=i;const o=b.a.parseBase64DataUriContent(n),r=b.a.parseDataUriMimeType(n);if(o)return Promise.resolve({content:o,errorMessage:"",mimeType:r,success:!0,url:""});if(!b.a.isAbsoluteUrl(n)){const e=this.documentController.getDocFromRuntimeId(this._rootDocId);e&&(n=b.a.pathCombine(e.getPathFromUrl(e.url.toString()),n))}if(!b.a.isAbsoluteUrl(n))return Promise.resolve({content:o,errorMessage:"",mimeType:r,success:!1,url:n});"boolean"!=typeof s&&(s=!this.executionController.isExecutionPaused);return this._rpcWrapper.downloadUrl(n,t,s)}executeBreakModeCommand(e){if(this.isBreakCompleted&&this._activeFrame){this.eval(this._activeFrame.callFrameId,e);return!0}return!1}onAddDocuments(e){V.b.logPerformance({id:H.b.Debugger_OnAddDocuments_Info});return this.waitOnRuntimeEditSemaphoreIfNeeded(async()=>{const t=[];for(const i of e)t.push(this.onAddDocumentCore(i));return await Promise.all(t)})}onBreak(e){const{breakEventType:t,breakReason:i,description:n,threadDescription:s}=e;let{callFrames:o}=e;return this.waitOnRuntimeEditSemaphoreIfNeeded(async()=>{V.b.logPerformance({id:H.b.Debugger_OnBreak_Start});if(6===i&&0===this.executionController.exceptionFilter){this.ignoreBreak(1);return}let r=!1;if(!this.jmcController.isJustMyCodeEnabled){this.startBreak(s.isWorker);r=!0}o=await this.getFrames(0);this._latestStackFrames=o;this._instructionPointerFrame=o[0];const a="XmlHttpRequest response"===t,l=this.getJMCBreakAction(e);if(l.ignoreBreak)if(l.isLibraryFile&&a){this.jmcBreakController.ensureBreakInUserCode();this.resume(6,!0)}else this.ignoreBreak(l.ignoreBreakAction);else{-1!==l.activeFrameIndex?this.setActiveFrame(o[l.activeFrameIndex]):this.setActiveFrame(this._instructionPointerFrame);if(1===i&&o.length>0&&!this.executionController.hasPseudoBreakpoint()&&!t){const e=Object.assign({},o[0].location),t=this.documentController.getDocFromRuntimeId(e.docId);t.firstRunTimeId!==e.docId&&(e.docId=t.firstRunTimeId);const i=this.breakpointController.getBreakpoints();i.filter(e=>e.location&&e.location.rawLocation&&e.location.rawLocation.doc===t);let n=!1;for(const t of i)if(Yt.areISourceLocationsEqual(t.rawLocation,e)){if(t.isEnabled){n=!0;break}this.resume(1,!0);return}if(!n){this.resume(1,!0);return}}if(this._clearWatchesAndCallstacksTimeout){window.clearTimeout(this._clearWatchesAndCallstacksTimeout);this._clearWatchesAndCallstacksTimeout=0}Object(L.e)(N.c.debugger);if(!r||this.jmcController.isJustMyCodeEnabled){await this.startBreak(s.isWorker);r=!0}this._breakCompleted=!0;await this.debuggerShell.onActiveFrameChanged(this.activeStackFrame,!0);if(6===i&&this.debuggerShell&&this._activeFrame){const e=Object(Le.g)(this._activeFrame,this.getDocFromStackFrame(this._activeFrame));this.debuggerShell.editorWindow.createExceptionDisplays(e,n)}this.executionController.updateAlertMessage();this.testEventObject.fireEvent("debuggerBroken");if(this._abortBreak){this.executionController.abort();this._abortBreak=!1}V.b.logPerformance({id:H.b.Debugger_OnBreak_Stop})}})}getJMCBreakAction(e){const{callFrames:t,breakReason:i,breakEventType:n,firstChance:s,isUserUnhandled:o}=e;return this.jmcBreakController.getJMCBreakAction(t,i,n,s,o)}onDebuggerEvent(e,t,i){const n={fileName:i};switch(e){case 0:return;case 3:n.messageText=Object(l.b)("AsmjsCompilationFailed",t);n.messageType=5;this.rpcClient.broadcast("onDebuggerEvent",n);break;case 2:n.messageText=Object(l.b)("AsmjsCompilationSucceeded",t);n.messageType=3;this.rpcClient.broadcast("onDebuggerEvent",n);break;case 1:n.messageText=Object(l.b)("AsmjsDetectedMessage");n.messageType=5;this.rpcClient.broadcast("onDebuggerEvent",n);break;default:a.a.fail("Unknown debugger event")}Object(A.a)().show(n.messageText,10*Object(L.i)())}onUnhandledException(e,t,i,n){return this.waitOnRuntimeEditSemaphoreIfNeeded(async()=>{const s=this.documentController.getDocFromRuntimeId(e),o={columnNumber:0,fileName:"",lineNumber:0,messageId:"SCRIPT"+i,messageText:t};if(s){s.firstParent&&s.firstParent.isContentScriptEngine&&s.firstParent.url&&(o.fromContentScriptEngine=s.firstParent.url.raw.substr(Ut.b.CONTENT_SCRIPT_PROTOCOL.length));await s.getText();const e=s.getDisplayPosition(n,!1)||{line:1,column:1,doc:s};o.fileName=s.url.toString();o.lineNumber=e.line-1;o.columnNumber=e.column-1;this.rpcClient.broadcast("onUnhandledException",o)}else this.rpcClient.broadcast("onUnhandledException",o)})}onSetRootDocument(e){return this.waitOnRuntimeEditSemaphoreIfNeeded(async()=>{if(!e)return;this._rootDocId=e;const t=this.documentController.getDocFromRuntimeId(e);if(L.t===N.b.ServiceWorker){if("about:blank"===t.url.raw)return;this.resourceViewController.open(t,{activation:0})}t&&"text/html"===t.mimeType&&this.debuggerShell.filePicker.highlightFile(t.url.raw);try{await this.initializeSelfTest()}finally{this._markToolReady()}})}async initializeSelfTest(){if(Pt.b()&&!this.initializedSelfTest){this.initializedSelfTest=!0;(await i.e(0).then(i.bind(null,243))).init(this.debuggerShell)}}onRemoteScriptError(e,t,i,n,s){window.reportError(e,t,i,s,n);return Promise.resolve()}onDebugOutput(e){return ke.a}onAttachFailed(){return ke.a}onRemoveDocuments(e){return this.waitOnRuntimeEditSemaphoreIfNeeded(()=>{const t=[];for(const i of e)t.push(this.onRemoveDocumentCore(i));return Promise.all(t)})}onResolveBreakpoint(e,t){return this.waitOnRuntimeEditSemaphoreIfNeeded(()=>this.createOrResolveBreakpointFromInfo(t,e))}onUpdateDocuments(e){return this.waitOnRuntimeEditSemaphoreIfNeeded(()=>{for(const t of e){let e;void 0!==t.id&&(e=this.documentController.getDocFromRuntimeId(t.id));a.a.hasValue(e,"onUpdateDocuments received for docId not yet added.");if(e&&e.isRuntimeDoc){const i=new De.a(t.url||"");t.url&&!De.a.equals(e.url,i)&&(e.url=i);e.mimeType!==t.mimeType&&this.documentController.documentTextOrMimeTypeUpdated(e,"",!0,t.mimeType);e.onMoreTextAvailable(t.length)}}})}onIntellinsenseRequestComplete(e,t){this.intellisenseProvider.onIntellinsenseRequestComplete(e,t)}onSyntaxError(e){const t=e;let i;if(t&&(i=this.documentController.getDocFromUrl(t.fileName))){i.addSyntaxErrorLocation(t);i.editorState&&i.editorState.model&&i.editorWindow.displaySyntaxErrorInfo(i)}}onDomMutationBreak(e){this._latestDmbp=e;V.b.logExecuteCommand(V.a.DMBP_HIT,g.c.NotSpecified)}refreshBrowser(){this._rpcWrapper.refreshBrowser()}onDomMutationBreakpointSet(e,t,i,n,s,o,r){const a={selector:e,elementUniqueId:t,breakpointId:i,types:n,isEnabled:s,documentUrl:o};isNaN(r)||(a.pendingBreakpointId=r);this._dmbpManager.onDomMutationBreakpointSet(a)}onDomMutationBreakpointUnbound(e,t){this._dmbpManager.onDomMutationBreakpointUnbound({breakpointId:e,isRemoved:t})}onDomMutationBreakpointEnabledChanged(e,t){this._dmbpManager.onDomMutationBreakpointEnabledChanged({breakpointId:e,isEnabled:t})}onDomMutationBreakpointBindingFailed(e,t){this._dmbpManager.onDomMutationBreakpointBindingFailed({pendingBreakpointId:e,reason:t})}onDomMutationBreakpointPageChanged(e,t,i,n){this._dmbpManager.onDomMutationBreakpointPageChanged({isTopLevelDocument:i,navigationCookie:n,newDocumentUrl:t,oldDocumentUrl:e})}onDomMutationBreakpointBindingMetrics(e,t){this._dmbpManager.onDomMutationBreakpointBindingMetrics({totalBreakpoints:e,failedBindings:t})}checkForDomMutationBreakpointEvent(){return this._latestDmbp}getIntellisenseChoices(e,t){this.isBreakCompleted&&this._activeFrame&&this._rpcWrapper.getIntellisenseChoices(e,t,this._activeFrame.callFrameId)}onEdpConnectionSuccess(){this.initializeOnConnectionSuccess()}setActiveFrame(e){this._activeFrame=e}getDocFromStackFrame(e){let t;return t=!e.isAsync||Object(T.isEdpEnabled)()?this.documentController.getDocFromRuntimeId(e.location.docId):this.documentController.getDocByLongDocumentId(e.location.docId)}clearActiveFrame(){this.setActiveFrame(void 0);this.debuggerShell.editorWindow.activeFrameChanged();this.watchController.activeFrameChanged();this.intellisenseProvider.activeFrameChanged();wt.d()}removeDocOnDetach(e){if(e.styleSheetInfo){this.documentController.styleSheetRemoved(e.styleSheetInfo);return ke.a}return this.removeDocument(e)}getRawOffset(e){return"number"==typeof e.rawLocation.offset?e.rawLocation.offset:e.startPosition?e.rawLocation.doc.getRawLocation(e.startPosition).offset:0}async startBreak(e){await this.executionController.setExecutionPaused(!0);this.watchController.enableWatchesWindow();this._rpcWrapper.onExecutionPaused();wt.e(e)}ignoreBreak(e){V.b.logPerformance({id:H.b.Debugger_OnBreak_Stop});this._latestDmbp=void 0;this.resume(e,!0)}createBreakpointFromInfo(e,t,i){const n=new q.a(e.breakpointId,e.location,e.eventTypes,t,i,e.isBound);"boolean"==typeof e.isTracepoint&&(n.isTracepoint=e.isTracepoint);"string"==typeof e.condition&&(n.condition=e.condition);n.isEnabled=e.isEnabled||!1;return n}async createOrResolveBreakpointFromInfo(e,t){let i,n,s;if(e.location){if(e.location.docId===Dt.a){const t=this.breakpointController.getBreakpoint(e.breakpointId);if(t){t.isBound=e.isBound;this.breakpointController.breakpointChanged(t);return Promise.resolve(t)}this.removeBreakpoint(t.breakpointId);return null}if(s=this.documentController.getDocFromRuntimeId(e.location.docId)){i=s.createDocumentLocation(e.location.start,e.location.length);n=s.url.toString()}}let o=this.createBreakpointFromInfo(e,i,n);if(!e.isPseudoBreakpoint&&e.location&&s){await s.getText();o.location=new we.a({doc:s.rawDoc||s,offset:e.location.start,length:e.location.length});if(t){const e=this.breakpointController.resolveBreakpointById(t,o);if(e){const t=e.equals(o);t||e.isEnabled||await this.breakpointController.setEnabledState(o,!1);o=e;t&&await this.breakpointController.bindRemainingInstancesForBreakpoint(s,o.rawLocation.docId,o)}else await this.removeBreakpoint(t)}else this.breakpointController.breakpointChanged(o);return o}return o}async queueMatchQuery(e,t,i){let n=i;for(;n<t.length;){const i=t[n];if(await this.isDocContainingMatch(e,i))return i;n++}return null}async isDocContainingMatch(e,t){a.a.hasValue(t,"Searching for matches on an undefined doc");if(t.hasText){if(t.editorState&&t.editorState.model){return t.editorState.model.findMatches(e,!1,!0,!1,!1,!1).map(e=>e.range).length>0}{const i=await t.getText(),n=new RegExp(e,"gi");return Boolean(i&&n.test(i))}}return!!t.isRuntimeDoc&&this._rpcWrapper.isDocContainingMatch(e,t)}async onAddDocumentCore(e){const t="javascript:";e.url&&e.url.toLowerCase().substring(0,t.length)===t&&(e.url="javascript:<URI>");let i,n;void 0!==e.longDocumentId&&(n=this._previousRevisions.get(e.longDocumentId));void 0!==n&&(i=this.documentController.getDocByLongDocumentId(n));let s=this.documentController.getNonRuntimeDoc(e.url);const o=this.getRuntimeDoc(e);if(s){if(void 0!==e.parentId){const t=this.documentController.getDocFromRuntimeId(e.parentId);s.makeRuntimeDocument(e,t,!!i)}}else{if(o){s=o;const t=this.documentController.documentInstanceAdded(e,s);await this.breakpointController.addExistingBreakpoints(t);return s}s=new Ut.b(e,void 0,this,!!i);i&&(i.isCommitPending?i.endCommit(s):i.nextRevision=s)}let r=!0;void 0!==e.longDocumentId&&this._nextRevisions.has(e.longDocumentId)&&(r=!1);await this.documentController.documentAdded(s,!1,r);return s}getRuntimeDoc(e){if("text/html"===e.mimeType||"text/css"===e.mimeType)return;let t=[];e.url&&(t=this.documentController.getDocsWithSameUrl(e.url));const i=this.getPreviousVersions(e.longDocumentId);for(const e of t){const t=this.getLongDocIdsForDoc(e);if(!i.some(e=>t.indexOf(e)>-1)&&e.isRuntimeDoc)return e}}getPreviousVersions(e){const t=[];if(void 0!==e){let i=e;for(;this._previousRevisions.has(i);){const e=this._previousRevisions.get(i);if(void 0!==e){i=e;t.push(i)}}}return t}getLongDocIdsForDoc(e){return e.instances?e.instances.map(e=>e.longDocumentId):[]}async onRemoveDocumentCore(e){const t=this.documentController.getDocFromRuntimeId(e);if(!t)throw new Error("onRemoveDocuments received for document not in table.");const i=this.documentController.getInstanceFromRuntimeId(t,e);if(i&&t.instances.length>1){this.documentController.instanceRemoved(t,i);this._previousRevisions.delete(i.longDocumentId)}else{this._previousRevisions.delete(t.rootInstance.longDocumentId);await this.removeDocument(t)}}removeDocument(e){return this.executionController.removeAnyPseudoBreakpoint(e).then(()=>{this.breakpointController.unresolveCodeBreakpoints(e);return this.documentController.documentRemoved(e)})}waitOnRuntimeEditSemaphoreIfNeeded(e){const t=this._runtimeEditSemaphore;return t?Object(kt.c)(t.wait().then(e),()=>{t.release();t.isEmpty&&(this._runtimeEditSemaphore=void 0)}):Promise.resolve(e())}logFileSaved(e,t=!0,i=""){V.b.logExecuteCommand(V.a.FILE_SAVED,g.c.Ui,2,g.b.Telemetry,{type:e,success:t,errorMessage:i})}initializeOnConnectionSuccess(e){this.executionController.isDebuggingDisabled=!1;this.debuggerShell.tabControl.animation=!0;if(this._debuggerLaunched)this.executionController.reinitialize();else{this.persistenceManager.applyState();this.persistenceManager.isAttached=!0;this.executionController.initialize(e);this.rpcClient.listen("consoleOutput",()=>{this.watchController.refreshAllWatchItems(!1)})}this._debuggerLaunched=!0;this.testEventObject.fireEvent("debuggerLaunched");Re("DebuggerFailedToConnect")}triggerSteppingFromConsole(e){if(Object(L.u)())switch(e){case"continueExecution":this.executionController.continueExecution(V.a.START_DEBUGGING,g.c.KeyboardShortcut);break;case"stepOver":this.executionController.stepOver(g.c.KeyboardShortcut);break;case"stepInto":this.executionController.stepInto(g.c.KeyboardShortcut);break;case"stepOut":this.executionController.stepOut(g.c.KeyboardShortcut);break;default:a.a.fail("Unexpected")}}}mi.DEBUGGER_FAILED_CONNECT_FWLINK="https://go.microsoft.com/fwlink/?LinkID=313120";const _i="No rootInstance for provided doc",bi="debuggerDiagOMPort",fi="debuggerPort";class Ei{constructor(){this._eventQueue=[];this.enableEdp=!1;this._urlToCallbacksMap={};this._debuggerManagerReady=new Promise(e=>{this._setDebuggerManagerReady=e});if(Object(T.isEdpEnabled)()){this.enableEdp=!0;this.jsonRpcMethodCall=this.jsonEdpRpcMethodCall;this.jsonDiagOMRpcMethodCall=this.jsonEdpRpcMethodCall;Object(F.g)().listen("notificationFromEdp",e=>{const{event:t,params:i}=e;this.jsonEdpRpcNotificationReceive(t,i)});this.enableDynamicDebugging()}else{this.jsonRpcMethodCall=this.jsonDebugOMRpcMethodCall;this.jsonDiagOMRpcMethodCall=this.jsonDiagOMRpcMethodCallImpl}}onDebuggerLoadComplete(e){this._setDebuggerManagerReady&&this._setDebuggerManagerReady(e)}onExecutionPaused(){for(const e in this._urlToCallbacksMap)this._urlToCallbacksMap.hasOwnProperty(e)&&this.jsonDiagOMRpcMethodCall("downloadUrl",[e,null,!1])}jsonDiagOMRpcMethodCallImpl(e,t){return Bt.callRemote(bi,e,t)}setDomMutationBreakpoint(e,t){return this.jsonDiagOMRpcMethodCall("setDomMutationBreakpoint",[e,t])}attemptDomMutationBreakpointRebind(e,t,i,n,s=NaN){return this.jsonDiagOMRpcMethodCall("attemptDomMutationBreakpointRebind",[e,t,i,n,s])}removeDomMutationBreakpoint(e){return this.jsonDiagOMRpcMethodCall("removeDomMutationBreakpoint",[e])}setDomMutationBreakpointEnabledState(e,t){return this.jsonDiagOMRpcMethodCall("setDomMutationBreakpointEnabledState",[e,t])}rehydrateDomMutationBreakpoints(e){return this.jsonDiagOMRpcMethodCall("rehydrateDomMutationBreakpoints",[JSON.stringify(e)])}dmbpClearOnUnload(){return this.jsonDiagOMRpcMethodCall("dmbpClearOnUnload",[])}executeOnTargetPage(e,t){return this.jsonDiagOMRpcMethodCall("executeOnTargetPage",[e,t])}enableDynamicDebugging(){const e="1"===s.b.utilities.getEnvironmentVariable("F12REMOTESCRIPTSDEBUGENABLED");return this.jsonRpcMethodCall("enableDynamicDebugging",[e])}disableDynamicDebugging(){return this.jsonRpcMethodCall("disableDynamicDebugging",[])}async getBreakpointIdFromSourceLocation(e,t){if(e.rootInstance)return this.jsonRpcMethodCall("getBreakpointIdFromSourceLocation",[e.rootInstance.runtimeId,t]);throw new Error("No rootInstance for requested doc")}addCodeBreakpoint(e,t,i=!1,n="",s=!1){return this.jsonRpcMethodCall("addCodeBreakpoint",[e,t,n,s,i])}addEventBreakpoint(e,t,i,n){return this.jsonRpcMethodCall("addEventBreakpoint",[e,t,i,n,!1])}addPendingBreakpoint(e){return this.jsonRpcMethodCall("addPendingBreakpoint",[e])}causeBreak(e,t){return this.jsonRpcMethodCall("causeBreak",[e,t])}async getSourceText(e,t,i){if(e.rootInstance)return this.jsonRpcMethodCall("getSourceText",[e.rootInstance.runtimeId,t,i]);throw new Error(_i)}setEditCSSEnabled(e){return this.jsonDiagOMRpcMethodCall("setEditCSSEnabled",[e])}editCSSSource(e,t){return this.jsonDiagOMRpcMethodCall("editCSSSource",[e.styleSheetInfo.key,t])}editSource(e,t,i){return this.jsonDiagOMRpcMethodCall("editSource",[e,t,i])}removeBreakpoint(e){return this.jsonRpcMethodCall("removeBreakpoint",[e])}setBreakpointEnabledState(e,t){return this.jsonRpcMethodCall("setBreakpointEnabledState",[e,t])}setBreakpointCondition(e,t,i,n,s){return Object(T.isEdpEnabled)()?this.jsonRpcMethodCall("setBreakpointCondition",[e,t,i,n,s]):this.jsonRpcMethodCall("setBreakpointCondition",[e,t,i])}resume(e){return this.jsonRpcMethodCall("resume",[e])}setExceptionFilter(e){return this.jsonRpcMethodCall("setExceptionFilter",[e])}async isDocContainingMatch(e,t){if(t.rootInstance)return this.jsonRpcMethodCall("isDocContainingMatch",[e,t.rootInstance.runtimeId]);throw new Error(_i)}getFrames(e){return this.jsonRpcMethodCall("getFrames",[e])}getCurrentThreadDescription(){return this.jsonRpcMethodCall("getCurrentThreadDescription",[])}eval(e,t){return this.jsonRpcMethodCall("eval",[e,t])}async getIntellisenseChoices(e,t,i){if(this.enableEdp){const n=await this.jsonRpcMethodCall("getIntellisenseChoicesOnCallFrame",[i,t]);this.jsonDiagOMRpcNotificationReceive("onIntellisenseRequestComplete",[e,n])}else this.eval(i,oi.createInvoker(e,t))}getLocals(e){return this.jsonRpcMethodCall("getLocals",[e])}getChildProperties(e,t,i){return this.jsonRpcMethodCall("getChildProperties",[e,t,i])}setPropertyValueAsString(e,t){return this.jsonRpcMethodCall("setPropertyValueAsString",[e,t])}triggerSourceRundown(){return this.jsonRpcMethodCall("triggerSourceRundown",[])}async canSetNextStatement(e,t){if(e.rootInstance)return this.jsonRpcMethodCall("canSetNextStatement",[e.rootInstance.runtimeId,t]);throw new Error(_i)}async setNextStatement(e,t){if(e.rootInstance)return this.jsonRpcMethodCall("setNextStatement",[e.rootInstance.runtimeId,t]);throw new Error(_i)}downloadUrl(e,t,i){a.a.isTrue(b.a.isAbsoluteUrl(e),"downloadUrl must be invoked with an absolute URL as the first param. Was invoked with "+e);return new Promise(n=>{this._urlToCallbacksMap[e]?this._urlToCallbacksMap[e].push(n):this._urlToCallbacksMap[e]=[n];return this.jsonDiagOMRpcMethodCall("downloadUrl",[e,t,i])})}dmbpQueryDocuments(){return this.jsonDiagOMRpcMethodCall("dmbpQueryDocuments",[])}jsonDiagOMRpcNotificationReceive(e,t){this.queueEvent("diagOM",e,t)}jsonRpcNotificationReceive(e,t){this.queueEvent("debuggerOM",e,t)}refreshBrowser(){return this.jsonDiagOMRpcMethodCall("refreshBrowser",[])}queueEvent(e,t,i){this._eventQueue.push({type:e,event:t,params:i});this.processQueue()}processQueue(){if(!this._eventQueueCurrentItem&&this._eventQueue.length){this._eventQueueCurrentItem=this._eventQueue.shift();if(this._eventQueueCurrentItem){let e;const t=()=>{this._eventQueueCurrentItem=void 0;this.processQueue()};(e="debuggerOM"===this._eventQueueCurrentItem.type?this.jsonRpcNotificationReceiveImpl(this._eventQueueCurrentItem.event,this._eventQueueCurrentItem.params):this.jsonDiagOMRpcNotificationReceiveImpl(this._eventQueueCurrentItem.event,this._eventQueueCurrentItem.params)).then(t,t)}}}jsonEdpRpcNotificationReceive(e,t){"onDownloadUrlComplete"===e?this.queueEvent("diagOM",e,t):this.queueEvent("debuggerOM",e,t)}jsonRpcNotificationReceiveImpl(e,t){switch(e){case"onAddDocuments":a.a.isTrue(t&&0!==t.length);return this._debuggerManagerReady.then(e=>{return e.onAddDocuments(t)});case"onEdpConnectionEstablished":a.a.isTrue(t&&0===t.length);return this._debuggerManagerReady.then(e=>e.onEdpConnectionSuccess());case"onRemoveDocuments":a.a.isTrue(t&&0!==t.length);return this._debuggerManagerReady.then(e=>e.onRemoveDocuments(t));case"onUpdateDocuments":a.a.isTrue(t&&0!==t.length);return this._debuggerManagerReady.then(e=>e.onUpdateDocuments(t));case"onBreak":a.a.areEqual(1,t.length);return this._debuggerManagerReady.then(e=>e.onBreak(t[0]));case"onResumeScriptExecution":return this._debuggerManagerReady.then(e=>e.onResumeScriptExecution());case"onDebuggerEvent":a.a.areEqual(3,t.length);return this._debuggerManagerReady.then(e=>e.onDebuggerEvent(t[0],t[1],t[2]));case"onUnhandledException":a.a.areEqual(4,t.length);return this._debuggerManagerReady.then(e=>e.onUnhandledException(t[0],t[1],t[2],t[3]));case"onResolveBreakpoint":a.a.areEqual(2,t.length);return this._debuggerManagerReady.then(e=>e.onResolveBreakpoint(t[0],t[1]));case"onDebugOutput":a.a.areEqual(1,t.length);return this._debuggerManagerReady.then(e=>e.onDebugOutput(t[0]));case"onAttachFailed":a.a.areEqual(0,t.length);return this._debuggerManagerReady.then(e=>e.onAttachFailed());case"onSetRootDocument":a.a.areEqual(1,t.length);return this._debuggerManagerReady.then(e=>e.onSetRootDocument(t[0]));case"onDebuggerOMScriptError":a.a.areEqual(5,t.length);return this._debuggerManagerReady.then(e=>e.onRemoteScriptError(t[0],t[1],t[2],t[3],t[4]));case"onDomMutationBreak":a.a.areEqual(1,t.length);return this._debuggerManagerReady.then(e=>e.onDomMutationBreak(t[0]));case"heartbeat":a.a.areEqual(1,t.length);return Object(F.g)().call("ms:header","heartbeat",t);default:return Promise.resolve()}}jsonDiagOMRpcNotificationReceiveImpl(e,t){switch(e){case"onDownloadUrlComplete":a.a.areEqual(5,t.length);this.onDownloadUrlComplete(t[0],t[1],t[2],t[3],t[4]);return Promise.resolve();case"onIntellisenseRequestComplete":a.a.areEqual(2,t.length);return this._debuggerManagerReady.then(e=>e.onIntellinsenseRequestComplete(t[0],t[1]));case"styleSheetAdded":a.a.areEqual(1,t.length);return this._debuggerManagerReady.then(e=>e.onStyleSheetAdded(t[0]));case"styleSheetRemoved":a.a.areEqual(1,t.length);return this._debuggerManagerReady.then(e=>e.onStyleSheetRemoved(t[0]));case"onDomMutationBreakpointSet":a.a.areEqual(7,t.length);return this._debuggerManagerReady.then(e=>e.onDomMutationBreakpointSet(t[0],t[1],t[2],t[3],t[4],t[5],t[6]));case"onDomMutationBreakpointUnbound":a.a.areEqual(2,t.length);return this._debuggerManagerReady.then(e=>e.onDomMutationBreakpointUnbound(t[0],t[1]));case"onDomMutationBreakpointEnabledChanged":a.a.areEqual(2,t.length);return this._debuggerManagerReady.then(e=>e.onDomMutationBreakpointEnabledChanged(t[0],t[1]));case"onDomMutationBreakpointBindingFailed":a.a.areEqual(2,t.length);return this._debuggerManagerReady.then(e=>e.onDomMutationBreakpointBindingFailed(t[0],t[1]));case"onDomMutationBreakpointPageChanged":a.a.areEqual(4,t.length);return this._debuggerManagerReady.then(e=>e.onDomMutationBreakpointPageChanged(t[0],t[1],t[2],t[3]));case"onDomMutationBreakpointBindingMetrics":a.a.areEqual(2,t.length);return this._debuggerManagerReady.then(e=>e.onDomMutationBreakpointBindingMetrics(t[0],t[1]));default:a.a.failDebugOnly(`Unknown debugger message ${e}`);return Promise.resolve()}}onDownloadUrlComplete(e,t,i,n,s){if(this._urlToCallbacksMap[t]){for(const o of this._urlToCallbacksMap[t])o({success:e,url:t,content:i,mimeType:n,errorMessage:s});delete this._urlToCallbacksMap[t]}}jsonDebugOMRpcMethodCall(e,t=[]){return Bt.callRemote(fi,e,t)}jsonEdpRpcMethodCall(e,t){return Object(F.g)().call("ms:host","callEdp",[e,t])}}var Ci=i(29),yi=i(100);class Ii extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"0 0 28 28"},this.props),u.createElement("path",{d:"m15.988 5.8223v5.8672h-6.668c-4.1634-0.28708-5.2647-5.2434-7.3917-9.3996-2.5014 3.07-3.5239 19.605 7.3917 19.605h6.668v5.8672l5.9863-5.4844 5.9863-5.4863-5.9863-5.4844z",fill:"#119f4a"}))}}class Si extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"0 0 28 28"},this.props),u.createElement("path",{d:"m9.1523 0.42374v8.2754h-8.622v10.493h8.622v8.1951h5.4682l13.203-13.505-13.203-13.458z",fill:"#fff"}),u.createElement("path",{d:"m10.174 2.0391v7.8496h-8.5661v8.0332h8.5661v7.8496h4.3887l11.621-11.887-11.621-11.846z",fill:"#f28421"}))}}const Ti=Object(je.css)({height:"calc(100% - 26px)",position:"relative"}),vi=Object(je.css)({height:"100%",overflowX:"hidden",overflowY:"auto",position:"relative",whiteSpace:"nowrap"}),ki=Object(je.css)({"@media (-ms-high-contrast:active)":{background:"Highlight",color:"HighlightText"},backgroundColor:"rgba(191, 205, 219, 0.25)"}),Di=Object(je.css)(Object(je.hover)(ki),{cursor:"default",msUserSelect:"none",whiteSpace:"nowrap"}),Mi=Object(je.css)(Di,{backgroundColor:"rgba(214, 214, 214, .28)","@media (-ms-high-contrast:active)":{background:"Highlight",color:"HighlightText"}}),xi=Object(je.css)(Di,{height:"20px",minHeight:"18px",overflow:"hidden",padding:"0px 4px 0px 4px",textOverflow:"ellipsis"}),wi=Object(je.css)({display:"inline-block",height:"20px",minHeight:"18px",padding:"0px 4px 0px 0px",verticalAlign:"top",whiteSpace:"nowrap",width:"50%"}),Oi=Object(je.css)(wi,{paddingLeft:"24px"}),Pi=Object(je.css)(wi,{paddingLeft:"2px"}),Bi=Object(je.css)({height:"100%",overflow:"hidden",textOverflow:"ellipsis"}),Ri=Object(je.css)({height:"20px",margin:"3px 20px 3px 20px",textAlign:"right"}),Li=16,Ai=16,Fi={cursor:"pointer",marginTop:1,verticalAlign:"text-bottom"},Ni={cursor:"pointer",float:"left",margin:"0px 5px 0px 5px",verticalAlign:"text-bottom"},Wi={baseStyle:Object(je.css)({border:"1px solid transparent",marginLeft:"6px",minWidth:0,padding:"0px",verticalAlign:"text-bottom"}),selectedStyle:Object(je.css)({"@media(-ms-high-contrast:active)":{":hover":{backgroundColor:"Highlight"}},backgroundColor:"ActiveBorder"}),unselectedStyle:Object(je.css)({"@media(-ms-high-contrast:active)":{":hover":{backgroundColor:"Highlight"}}})};class ji extends u.Component{constructor(e){super(e);this.refHandlers={row:e=>this.row=e};this.handleContextMenu=(e=>{e.preventDefault();e.stopPropagation();if(e.clientX&&e.clientY)this.props.onContextMenu(this.props.stackFrame,e.clientX,e.clientY);else if(e.currentTarget){const{left:t,top:i}=e.currentTarget.getBoundingClientRect();this.props.onContextMenu(this.props.stackFrame,t,i)}});this.onKeyDownHandler=(e=>{this.props.onKeyDown(e)});this.onMouseOverDocInfoHandler=(e=>{this.props.showTooltip(this.props.stackFrame.docInfo)});this.onMouseOverFunctionNameHandler=(e=>{this.props.showTooltip(Object(Le.j)(this.props.stackFrame.rawStackFrame,this.isLibraryCodeHidden()))});this.handleSelectFrame=(()=>{this.props.selectFrame(this.props.stackFrame.rawStackFrame)});this.handleOpenFrame=(()=>{this.props.openFrame(this.props.stackFrame.rawStackFrame)})}componentDidUpdate(){this.props.isSelected&&document.hasFocus()&&this.row&&this.row.focus()}render(){if(!this.props.isVisible)return null;const e=this.props.isSelected?Mi:Di;return u.createElement("div",Object.assign({},e,{onClick:this.handleSelectFrame,onContextMenu:this.handleContextMenu,onDoubleClick:this.handleOpenFrame,onKeyDown:this.onKeyDownHandler,ref:this.refHandlers.row,role:"treeitem",tabIndex:-1}),this.renderLeftCell(),u.createElement("div",Object.assign({},Pi,{onMouseOver:this.onMouseOverDocInfoHandler}),this.props.stackFrame.docInfo))}renderLeftCell(){let e,t=Oi;if(this.props.isInstructionPointerFrame){e=u.createElement(Si,{style:Ni});t=wi}else if(this.props.isSelected&&!this.isLibraryCodeHidden()){e=u.createElement(Ii,{style:Ni});t=wi}return u.createElement("div",Object.assign({},t,{onMouseOver:this.isLibraryCodeHidden()?null:this.onMouseOverFunctionNameHandler}),u.createElement("div",null,e),u.createElement("div",Object.assign({},Bi),Object(Le.j)(this.props.stackFrame.rawStackFrame,this.isLibraryCodeHidden())))}isLibraryCodeHidden(){return this.props.stackFrame.isLibraryCode&&this.props.hideLibraryFrames}}var Ki;!function(e){e[e.asyncStack=0]="asyncStack";e[e.dmbpStack=1]="dmbpStack";e[e.mainThread=2]="mainThread";e[e.workerThread=3]="workerThread"}(Ki||(Ki={}));class Ui extends u.PureComponent{constructor(e){super(e);this.handleClickExpandIcon=(()=>{this.setState({isExpanded:!this.state.isExpanded})});this.handleContextMenu=(e=>{e.preventDefault();e.stopPropagation();if(e.clientX&&e.clientY)this.props.onSectionTitleContextMenu(e.clientX,e.clientY);else if(e.currentTarget){const{left:t,top:i}=e.currentTarget.getBoundingClientRect();this.props.onSectionTitleContextMenu(t,i)}});let t=!0;this.props.sectionType===Ki.asyncStack&&this.props.hideAsyncFrames&&(t=!1);this.state={isExpanded:t}}render(){return u.createElement("div",null,this.renderTitle(),this.renderFrames())}componentWillReceiveProps(e){if(this.props.hideAsyncFrames!==e.hideAsyncFrames){let t=!0;e.sectionType===Ki.asyncStack&&e.hideAsyncFrames&&(t=!1);this.setState({isExpanded:t})}}renderTitle(){return u.createElement("div",Object.assign({},xi,{"aria-expanded":this.state.isExpanded,onContextMenu:this.handleContextMenu,onDoubleClick:this.handleClickExpandIcon,role:"treeitem",tabIndex:-1}),this.renderExpandIcon(),this.props.title)}renderFrames(){return this.props.stackFrames.map((e,t)=>{const i=(this.props.sectionType===Ki.mainThread||this.props.sectionType===Ki.workerThread)&&0===t;return u.createElement(ji,{key:e.rawStackFrame.callFrameId,hideLibraryFrames:this.props.hideLibraryFrames,isInstructionPointerFrame:i,isSelected:e.rawStackFrame===this.props.selectedFrame,isVisible:this.state.isExpanded,onContextMenu:this.props.onContextMenu,onKeyDown:this.props.onKeyDown,openFrame:this.props.openFrame,selectFrame:this.props.selectFrame,showTooltip:this.props.showTooltip,stackFrame:e})})}renderExpandIcon(){return this.props.sectionType===Ki.workerThread?u.createElement(We.a,{style:Fi,visibility:"hidden"}):this.state.isExpanded?u.createElement(We.a,{style:Fi,onClick:this.handleClickExpandIcon}):u.createElement(Ne.a,{style:Fi,onClick:this.handleClickExpandIcon})}}class Hi extends u.PureComponent{constructor(e){super(e);this.selectFrame=(e=>{this.setState({selectedFrame:e});Object(Le.k)(e)||e.callFrameId===Le.a||this.isLibraryCodeHidden(e)||this.props.activeFrameChanged(e,!1)});this.openFrame=(e=>{if(e.callFrameId!==Le.a)if(this.isLibraryCodeHidden(e))R.b.dispatch(Object(B.n)());else if(Object(Le.k)(e)){s.b.activateTab(N.c.dom);const t=e.callFrameId.split("#"),i=t[t.length-1];Ee.c.get("DomTreeService").trySelectNode(null,i)}else this.props.activeFrameChanged(e,!0)});this.onKeyDown=(e=>{let t=!1;if(38===e.keyCode){this.selectFrame(this.getPreviousFrame(this.state.selectedFrame));V.b.logExecuteCommand(g.a.GO_TO_PREVIOUS_FRAME_ON_STACK,g.c.KeyboardShortcut);t=!0}else if(40===e.keyCode){this.selectFrame(this.getNextStackFrame(this.state.selectedFrame));V.b.logExecuteCommand(g.a.GO_TO_NEXT_FRAME_ON_STACK,g.c.KeyboardShortcut);t=!0}else if(13!==e.keyCode||this.isLibraryCodeHidden(this.state.selectedFrame)){if(Object(D.c)(e)&&76===e.keyCode){this.toggleLibraryFrame(this.state.selectedFrame);t=!0}}else{this.openFrame(this.state.selectedFrame);V.b.logExecuteCommand(g.a.GO_TO_SOURCE,g.c.KeyboardShortcut);t=!0}if(t){e.preventDefault();e.stopPropagation()}});this.onSectionTitleContextMenu=(async(e,t)=>{const i=[{disabled:!1,id:"menuItemCopyAll",label:Object(l.b)("CallStackContextMenuCopyStack"),type:0}],n=await Object(yi.a)("filePickerContextMenu",i,e,t);n.wasItemSelected&&this.onContextMenuItemClicked(n.selectedItemId,void 0)});this.onContextMenu=(async(e,t,i)=>{const n=[{id:"menuItemGoToSource",label:Object(l.b)("CallstackContextMenuGoToSource"),type:0},{id:"separator1",label:"",type:2},{id:"menuItemCopyFrame",label:Object(l.b)("CallStackContextMenuCopyFrame"),type:0},{disabled:!1,id:"menuItemCopyAll",label:Object(l.b)("CallStackContextMenuCopyStack"),type:0}];this.isJSFile(e.rawStackFrame)&&!this.isLibraryCodeHidden(e.rawStackFrame)&&n.push({id:"separator2",label:"",type:2},{checked:this.isLibraryCode(e.rawStackFrame),disabled:!1,id:"menuItemLibraryCode",label:Object(l.b)("TabContextMenuMarkAsLibraryCode"),type:1});const s=await Object(yi.a)("filePickerContextMenu",n,t,i);s.wasItemSelected&&this.onContextMenuItemClicked(s.selectedItemId,e)});this.state={callStackSections:Ae.List(),selectedFrame:void 0}}componentWillReceiveProps(e){this.createCallStack(e)}render(){return u.createElement("div",Object.assign({tabIndex:0,onKeyDown:this.onKeyDown,"aria-label":Object(l.b)("CallstackWindowTitle")},vi),this.renderCallStack())}renderCallStack(){return this.state.callStackSections.map(e=>{const t=e.sectionType===Ki.workerThread?e.title:e.stackFrames[0].rawStackFrame.callFrameId;return u.createElement(Ui,{key:`Section_${t}`,hideAsyncFrames:this.props.hideAsyncFrames,hideLibraryFrames:this.props.hideLibraryFrames,onContextMenu:this.onContextMenu,onKeyDown:this.onKeyDown,onSectionTitleContextMenu:this.onSectionTitleContextMenu,openFrame:this.openFrame,stackFrames:e.stackFrames,sectionType:e.sectionType,selectFrame:this.selectFrame,selectedFrame:this.state.selectedFrame,showTooltip:this.props.showTooltip,title:e.title})})}async createCallStack(e){let t;if(e.breakEventInfo){if(e.breakEventInfo!==this.props.breakEventInfo){const i=e.getJMCBreakAction(e.breakEventInfo).activeFrameIndex;t=-1!==i?e.breakEventInfo.callFrames[i]:e.breakEventInfo.callFrames[0]}if(e.breakEventInfo!==this.props.breakEventInfo||e.urls!==this.props.urls){let t=[...e.breakEventInfo.callFrames];for(const i of Object(Le.d)(e.breakEventInfo))t=t.concat(i);await Promise.all(t.map(async t=>{const i=e.getDocFromStackFrame(t);i&&await i.getText()}))}}await Promise.resolve();const i=Ae.List([this.getDomMutationSection(),this.getMainThreadSection(),...this.getAsyncSections(),...this.getWebWorkerSections()].filter(Boolean));this.setState(e=>({callStackSections:i,selectedFrame:t||e.selectedFrame}))}createCallStackSection(e,t,i){const n=[];let s=!1;for(const e of t){const t=this.isLibraryCodeHidden(e),o=this.getStackFrameDocInfo(e,i,t,this.props.getDocFromStackFrame(e));if(s&&t)continue;const r=s=this.isLibraryCode(e);n.push({docInfo:o,copyText:this.getCopyText(e,i,t),isLibraryCode:r,rawStackFrame:e})}return{sectionType:i,stackFrames:n,title:e}}getDomMutationSection(){const e=this.props.checkForDomMutationBreakpointEvent();return e?this.createCallStackSection(Object(l.b)("callStackFrameDomMutationBreakpoints"),Object(Le.f)(e,this.props.getDmbpById),Ki.dmbpStack):null}getMainThreadSection(){const e=this.props.breakEventInfo?Object.assign({},this.props.breakEventInfo):void 0;return e&&!e.threadDescription.isWorker?this.createCallStackSection(Object(l.b)("DebuggerMainFrame"),Object(Le.h)(e),Ki.mainThread):null}getAsyncSections(){const e=this.props.breakEventInfo,t=[];e&&Object(Le.d)(e).forEach(e=>{t.push(this.createCallStackSection(Object(l.b)("AsyncStackTransition"),e,Ki.asyncStack))});return t}getWebWorkerSections(){const e=this.props.breakEventInfo,t=[];this.props.webWorkerThreads.isEmpty()||this.props.webWorkerThreads.forEach(i=>{let n=[];e&&e.threadDescription.isWorker&&i.id===e.threadDescription.id&&(n=e.callFrames);t.push(this.createCallStackSection(i.displayName,n,Ki.workerThread))});return t}onContextMenuItemClicked(e,t){switch(e){case"menuItemGoToSource":this.setState({selectedFrame:t.rawStackFrame});this.openFrame(t.rawStackFrame);V.b.logExecuteCommand(g.a.GO_TO_SOURCE,g.c.ContextMenu);break;case"menuItemCopyFrame":Object(Le.c)(t);V.b.logExecuteCommand(g.a.COPY_FRAME,g.c.ContextMenu);break;case"menuItemCopyAll":Object(Le.b)(this.state.callStackSections);V.b.logExecuteCommand(g.a.COPY_STACK,g.c.ContextMenu);break;case"menuItemLibraryCode":this.toggleLibraryFrame(t.rawStackFrame)}}toggleLibraryFrame(e){const t=this.props.getDocFromStackFrame(e);this.props.updateLibraryUrlState(t.url.raw,!this.isLibraryCode(e))}isLibraryCode(e){const t=this.props.getDocFromStackFrame(e),i=!!t&&(this.props.urls.get(t.url.raw)&&this.props.urls.get(t.url.raw).isLibraryFile);return e.isInternal||i}isLibraryCodeHidden(e){return this.isLibraryCode(e)&&this.props.hideLibraryFrames}isJSFile(e){const t=this.props.getDocFromStackFrame(e);return t&&(t.mimeType&&t.mimeType.includes("javascript")||t.url.raw.endsWith(".js"))}getNextStackFrame(e){const t=this.getAllStackFrames();return t[t.indexOf(e)+1]||t[t.length-1]}getPreviousFrame(e){const t=this.getAllStackFrames();return t[t.indexOf(e)-1]||t[0]}getAllStackFrames(){let e=[];this.state.callStackSections.forEach(t=>{e=e.concat(t.stackFrames.map(e=>e.rawStackFrame))});return e}getCopyText(e,t,i){let n="";const s=this.props.getDocFromStackFrame(e),o=Object(Le.g)(e,s);if(o&&o.startPosition&&o.startPosition.doc){n=`${Object(Le.j)(e,i)}`;n+=i?"":` [${Object(l.b)("CallStackLineColumn",o.lineNumber,o.column)}], ${Object(Le.i)(o)}`}else n=`${Object(Le.j)(e,i)} ${this.getStackFrameDocInfo(e,t,this.isLibraryCode(e),s)}`;return n}getStackFrameDocInfo(e,t,i,n){if(t===Ki.dmbpStack)return Object(Le.e)(e.location.dmbpLocationInfo);if(!i&&e.isInternal)return Object(l.b)("CallstackInternalFrame");if(i||!n)return"";const s=n.createDocumentLocation(e.location.start,e.location.length),o=new we.a(s.rawLocation,s);return`${Object(Le.i)(o)} (${s.startLineNumber}, ${s.startColumn})`}}class Vi extends u.PureComponent{render(){return u.createElement(ze.a,Object.assign({viewBox:"0 0 32 32"},this.props),u.createElement("circle",{cx:"9",cy:"9",r:"7",fill:"#167abf"}),u.createElement("rect",{x:"4",y:"8",width:"10",height:"2",fill:"#fff"}),u.createElement("rect",{x:"18.002",y:"3.9093",width:"11.998",height:"2.0907",fill:"#167abf"}),u.createElement("rect",{x:"18.002",y:"7.9093",width:"11.998",height:"2.0907",fill:"#167abf"}),u.createElement("rect",{transform:"rotate(-90)",x:"-22",y:"23.001",width:"11",height:"2",fill:"#167abf"}),u.createElement("path",{d:"m24 10-4.9989 4v3l4.9989-4 5.0011 4v-3z",fill:"#167abf"}),u.createElement("rect",{x:"2",y:"24",width:"28",height:"2",fill:"#167abf"}),u.createElement("rect",{x:"2",y:"28",width:"28",height:"2",fill:"#167abf"}))}}var Gi=i(166);class zi extends u.PureComponent{render(){const e=this.props.hideLibraryFramesSelected?Object(l.b)("CallstackWindowLibraryFramesHiddenTooltip"):Object(l.b)("CallstackWindowLibraryFramesVisibleTooltip"),t=()=>{this.props.showTooltip(e)},i=this.props.hideAsyncFramesSelected?Object(l.b)("CallstackWindowAsyncFramesHiddenTooltip"):Object(l.b)("CallstackWindowAsyncFramesVisibleTooltip"),n=()=>{this.props.showTooltip(i)},s=u.createElement(Gi.a,{height:Ai,width:Li,style:{color:"#555"}});return u.createElement("div",Object.assign({},Ri),u.createElement(Ye,Object.assign({disabled:!this.props.isJMCEnabled,icon:s,label:e,onClick:this.props.onToggleHideLibraryFrames,onMouseOver:t,selected:this.props.hideLibraryFramesSelected},Wi)),u.createElement(Ye,Object.assign({icon:u.createElement(Vi,{height:Ai,width:Li}),label:i,onClick:this.props.onToggleHideAsyncFrames,onMouseOver:n,selected:this.props.hideAsyncFramesSelected},Wi)))}}class Xi extends u.PureComponent{constructor(e){super(e);this.toggleHideAsyncFrames=(()=>{this.setState({hideAsyncFrames:!this.state.hideAsyncFrames},()=>{const e=this.state.hideAsyncFrames?g.a.TOGGLE_ASYNC_FRAMES_ON:g.a.TOGGLE_ASYNC_FRAMES_OFF;V.b.logExecuteCommand(e,g.c.Ui)})});this.toggleHideLibraryFrames=(()=>{R.b.dispatch(Object(B.n)());const e=this.props.libraryFramesHidden?g.a.TOGGLE_JMC_FRAMES_DISPLAY_OFF:g.a.TOGGLE_JMC_FRAMES_DISPLAY_ON;V.b.logExecuteCommand(e,g.c.Ui)});this.showTooltip=(e=>{Object(le.c)({content:e})});this.state={hideAsyncFrames:!1}}render(){return u.createElement("div",Object.assign({},Ti),u.createElement(zi,{hideAsyncFramesSelected:this.state.hideAsyncFrames,hideLibraryFramesSelected:this.props.libraryFramesHidden,isJMCEnabled:this.props.isJMCEnabled,onToggleHideAsyncFrames:this.toggleHideAsyncFrames,onToggleHideLibraryFrames:this.toggleHideLibraryFrames,showTooltip:this.showTooltip}),u.createElement(Hi,{activeFrameChanged:this.props.activeFrameChanged,breakEventInfo:this.props.breakEventInfo,checkForDomMutationBreakpointEvent:this.props.checkForDomMutationBreakpointEvent,getDmbpById:this.props.getDmbpById,getDocFromStackFrame:this.props.getDocFromStackFrame,getJMCBreakAction:this.props.getJMCBreakAction,hideAsyncFrames:this.state.hideAsyncFrames,hideLibraryFrames:this.props.libraryFramesHidden&&this.props.isJMCEnabled,showTooltip:this.showTooltip,updateLibraryUrlState:this.props.updateLibraryUrlState,urls:this.props.urls,webWorkerThreads:this.props.webWorkerThreads}))}}function qi(e){return{breakEventInfo:e.debugger.breakEventInfo,isJMCEnabled:e.debugger.isJMCEnabled,libraryFramesHidden:e.debugger.libraryFramesHidden,urls:e.debugger.urls,webWorkerThreads:e.debugger.webWorkerThreads}}function Ji(e){return{updateLibraryUrlState:(t,i)=>e(Object(B.o)(t,i))}}var $i=Object(Ci.b)(qi,Ji)(Xi);function Zi(e,t,i,n,s,o){Object(R.a)();Object(p.render)(u.createElement(Ci.a,{store:R.b},u.createElement($i,{activeFrameChanged:t,checkForDomMutationBreakpointEvent:i,getDmbpById:n,getDocFromStackFrame:s,getJMCBreakAction:o})),e);return{enableJMC:r,toggleShowLibraryFrames:a};function r(e){R.b.dispatch(Object(B.i)(e))}function a(){R.b.dispatch(Object(B.n)())}}var Yi=i(44),Qi=i(165),en=i(109);class tn extends u.PureComponent{constructor(){super(...arguments);this.handleMouseEnter=(()=>{Object(le.c)({content:this.props.tooltip})})}render(){const e="error"===(this.props.type||"error")?u.createElement(Yi.n,Object.assign({},on)):u.createElement(Yi.h,Object.assign({},rn));return u.createElement("div",Object.assign({},nn,{onMouseEnter:this.handleMouseEnter}),e)}}const nn=Object(je.css)({display:"inline-block"}),sn=Object(je.css)({verticalAlign:"text-bottom"}),on=Object(je.css)(sn,{color:"#F5BD00"}),rn=Object(je.css)(sn,{color:"#2A53CD"}),an="__index__";function ln(e,t){const i=[],n=new Map,s={key:t,displayName:t,isFolder:!0,children:[],originalUrl:t},o=new Map,r=e.filter(e=>{if(e.isDynamicCode&&!b.a.isAbsoluteUrl(e.url)){const i={parentKey:t,key:e.url,displayName:e.url,originalUrl:e.url};n.set(i.key,i);s.children.push(i.key);return!1}return!0}).map(e=>Object.assign({},e,{urlObject:new URL(e.url)})).filter(e=>{const t=e.url;if(o.has(t)){const e=o.get(t);o.set(t,e+1);return!1}o.set(t,1);return!0}),a=new Map;r.toList().forEach(e=>{const t=e.urlObject,s=dn(t);let r;if(a.has(s))r=a.get(s);else{const e={key:s,isRoot:!0,displayName:cn(t),children:[],originalUrl:s};a.set(s,e);i.push(e.key);n.set(e.key,e);r=e}hn(n,r,o,t,e)});i.forEach(e=>{const t=n.get(e);pn(n,t)});un(n,i);if(s.children.length){un(n,s.children);i.push(s.key);n.set(s.key,s)}return{roots:i,treeMap:n}}function dn(e){return e.host?`${e.protocol}//${e.host}`:e.protocol}function cn(e){return e.host?"http:"===e.protocol||"https:"===e.protocol?e.host:`${e.protocol}//${e.host}`:e.protocol}function hn(e,t,i,n,s){let o=n.pathname.split("/");const r=s.url.endsWith("/");o=o.filter(e=>e);if(n.search)if(0===o.length)o.push(n.search);else{const e=o.length-1;o[e]=o[e]+n.search}else r&&o.push(an);let a=t;const l=o.length-1;o.forEach((t,o)=>{const r=a.children&&a.children.map(t=>e.get(t)).find(e=>e&&e.displayName===t);if(r){a=r;return}const d=a.isRoot&&!n.host?`${a.key}${t}`:`${a.key}/${t}`,c=t===an?"(index)":t,h={parentKey:a.key,key:d,displayName:c,originalUrl:d};if(o===l){h.originalUrl=s.url;s.mimeType&&(h.mimeType=s.mimeType);const e=i.get(s.url)||1;e>1&&(h.duplicateCount=e)}else h.isFolder=!0;a.children||(a.children=[]);e.set(h.key,h);a.children.push(h.key);a=h})}function un(e,t){function i(t,i){const n=e.get(t),s=e.get(i);return n&&s?n.displayName<s.displayName?-1:n.displayName>s.displayName?1:0:0}const n=[t];for(;n.length;){const t=n.shift();t.sort(i);for(const i of t){const t=e.get(i);t&&t.children&&n.push(t.children)}}}function pn(e,t){const i=[t];for(;i.length;){const t=i.shift();t.children&&(t.children=t.children.map(t=>{const n=e.get(t);if(n.isFolder){let t;n.children&&1===n.children.length&&(t=e.get(n.children[0]));for(;t&&t.isFolder;){e.delete(n.key);n.key=t.key;n.displayName=`${n.displayName}/${t.displayName}`;n.children=t.children;n.originalUrl=t.originalUrl;e.set(n.key,n);t=n.children&&1===n.children.length?e.get(n.children[0]):void 0}i.push(n)}return n.key}))}}function gn(e){let t=e.currentKey;if(e.currentKey){const i=_n(e.treeMap,e.roots),n=Object.assign({},e,{treeMap:i});let s=!1;"next"===e.direction?(s=bn(n))||(s=En(n)):"previous"===e.direction&&(s=Cn(n))&&!s.wasParentOfOriginal&&(s=yn(n,s));s&&(t=s.itemKey)}t===mn&&(t=e.roots&&e.roots.length?e.roots[0]:"");return t}const mn="@@FAKEROOT@@";function _n(e,t){const i=new Map(e),n={key:mn,children:[],displayName:"",originalUrl:""};i.set(mn,n);t.forEach(t=>{const s=e.get(t),o=Object.assign({},s,{parentKey:mn});i.set(o.key,o);n.children.push(o.key)});return i}function bn(e){const t=e.currentKey,i=e.treeMap.get(t);return!!i&&(!!e.itemExpandedByKey.get(t,!1)&&(!(!i.children||!i.children.length)&&{itemKey:i.children[0]}))}function fn(e,t){const i=t.treeMap;let n=t.currentKey,s=i.get(n);for(;s&&s.parentKey;){const t=i.get(s.parentKey);if(!t)return!1;{const i=t.children.findIndex(e=>e===n);if("next"===e&&i>=0&&i<t.children.length-1)return{itemKey:t.children[i+1]};if("previous"===e)return i>0?{itemKey:t.children[i-1]}:{itemKey:t.key,wasParentOfOriginal:!0};n=s.parentKey;s=t}}return!1}function En(e){return fn("next",e)}function Cn(e){return fn("previous",e)}function yn(e,t){let i=t.itemKey,n=e.itemExpandedByKey.get(i,!1);for(;n;){const t=e.treeMap.get(i);if(!(t&&t.children&&t.children.length))break;i=t.children[t.children.length-1];n=e.itemExpandedByKey.get(i,!1)}return{itemKey:i}}var In=i(28);class Sn extends u.PureComponent{constructor(){super(...arguments);this.refHandlers={row:e=>this.row=e};this.handleClickExpandIcon=(e=>{e.preventDefault();e.stopPropagation();this.toggleExpand()});this.showContextMenu=(e=>{e.preventDefault();e.stopPropagation();if(e.clientX&&e.clientY)this.props.onContextMenu(this.props.item,e.clientX,e.clientY);else if(e.currentTarget){const{left:t,top:i}=e.currentTarget.getBoundingClientRect();this.props.onContextMenu(this.props.item,t,i)}});this.selectItem=(e=>{e.preventDefault();e.stopPropagation();this.props.onSelectItem(this.props.item)});this.handleKeyDown=(e=>{let t=!1;switch(e.keyCode){case 38:this.props.onNavigate("previous",this.props.item);t=!0;break;case 40:this.props.onNavigate("next",this.props.item);t=!0;break;case 37:this.isExpanded()&&this.toggleExpand();t=!0;break;case 39:this.isExpanded()||this.toggleExpand();t=!0;break;case 13:case 32:this.isExpandable()?this.toggleExpand():this.props.onSelectItem(this.props.item);t=!0}if(t){e.preventDefault();e.stopPropagation()}});this.handleMouseEnter=(()=>{this.props.onHoverItem(this.props.item)})}componentDidUpdate(e){this.isSelected()&&document.hasFocus()&&e.selectedKey!==this.props.selectedKey&&this.row.focus()}render(){const e=this.props.item,t=this.isExpanded(),i=this.isSelected();let n,o,r,a=vn,l=Mn;const d=this.props.renderItem(e);let c=-1;if(i){l=Object(je.css)(l,wn());c=1}else l=Object(je.css)(l,xn());if(this.isExpandable())if(this.isExpanded()){o=u.createElement(Yi.l,{style:Rn,onClick:this.handleClickExpandIcon});n=u.createElement(Ln,{itemKeys:e.children,itemMap:this.props.itemMap,isRoot:!1,itemExpandedByKey:this.props.itemExpandedByKey,selectedKey:this.props.selectedKey,onNavigate:this.props.onNavigate,onContextMenu:this.props.onContextMenu,onSelectItem:this.props.onSelectItem,onToggleExpand:this.props.onToggleExpand,onHoverItem:this.props.onHoverItem,renderItem:this.props.renderItem,renderKey:this.props.renderKey});i&&!s.b.utilities.isHighContrast()&&(r=u.createElement("div",Object.assign({},Bn)))}else o=u.createElement(Yi.k,{style:Rn,onClick:this.handleClickExpandIcon});else a=this.props.sizeForExpandable?Object(je.css)(a,Dn):Object(je.css)(a,kn);return u.createElement("div",{style:Tn,onClick:this.selectItem,onContextMenu:this.showContextMenu,onKeyDown:this.handleKeyDown,onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleClickExpandIcon},r,u.createElement("div",Object.assign({},l,{ref:this.refHandlers.row,tabIndex:c,"aria-expanded":t,role:"treeitem"}),o,u.createElement("div",Object.assign({},a),d)),n)}isExpanded(){return this.props.itemExpandedByKey.get(this.props.item.key,!1)}isExpandable(){return Boolean(this.props.item.children&&this.props.item.children.length)}isSelected(){return this.props.item.key===this.props.selectedKey}toggleExpand(){this.props.onToggleExpand(this.props.item)}}const Tn={position:"relative"},vn=Object(je.css)({flex:1}),kn=Object(je.css)({marginLeft:8}),Dn=Object(je.css)({marginLeft:16}),Mn=Object(je.css)({display:"flex"});function xn(){if(Object(In.b)()){const e=Object(In.c)("<COLOR_HIGHLIGHT>"),t=Object(In.c)("<COLOR_HIGHLIGHTTEXT>");return Object(je.css)({":hover":{color:t,backgroundColor:e}})}return Object(je.css)({":hover":{backgroundColor:"rgba(191, 205, 219, 0.25)"}})}function wn(){if(Object(In.b)()){const e=Object(In.c)("<COLOR_HIGHLIGHT>"),t=Object(In.c)("<COLOR_HIGHLIGHTTEXT>"),i=Object(In.c)("<COLOR_HOTLIGHT>"),n=Object(In.c)("<COLOR_WINDOW>");return Object(je.css)({color:t,backgroundColor:e,":focus":{color:i,backgroundColor:n}})}return Object(je.css)({backgroundColor:"rgba(191, 205, 219, 0.25)",":focus":{backgroundColor:"rgba(51, 153, 255, 0.25)"}})}const On=11,Pn=8,Bn=Object(je.css)({borderBottomColor:"#B6B6B6",borderLeftColor:"#B6B6B6",borderRightColor:"transparent",borderStyle:"solid",borderTopColor:"transparent",borderWidth:"1px",bottom:3,left:Pn,position:"absolute",top:On,width:4,zIndex:1}),Rn={marginTop:1};class Ln extends u.PureComponent{render(){const e=this.props.itemMap,t=this.props.itemKeys.map(t=>e.get(t)),i=t.some(e=>e.children&&e.children.length>0),n=t.map(t=>u.createElement(Sn,{key:t.key,item:t,itemMap:e,selectedKey:this.props.selectedKey,sizeForExpandable:i,itemExpandedByKey:this.props.itemExpandedByKey,onContextMenu:this.props.onContextMenu,onSelectItem:this.props.onSelectItem,onNavigate:this.props.onNavigate,onToggleExpand:this.props.onToggleExpand,onHoverItem:this.props.onHoverItem,renderItem:this.props.renderItem,renderKey:this.props.renderKey}));let s=Object(je.css)(An,this.props.style);this.props.isRoot&&(s=Object(je.css)(this.props.style));return u.createElement("div",Object.assign({},s),n)}}Ln.defaultProps={isRoot:!0};const An=Object(je.css)({paddingLeft:16}),Fn=200;class Nn extends u.PureComponent{constructor(e){super(e);this.recalculateTree=Object(P.e)(e=>{if(!this.isDisposed){const t=ln(e.files.valueSeq(),this.filePickerDynamicNodeName),i=this.getSelectedKey(t,this.state.selectedKey);this.setState({roots:t.roots,treeMap:t.treeMap,selectedKey:i})}},this,Fn);this.refHandlers={root:e=>this.root=e};this.renderItem=(e=>{const t=this.props.urls.get(e.originalUrl),i=t&&t.isOpen?jn:Wn,n=t&&t.hasPendingEdit?"*":null;let s,o;s=e.isFolder||e.isRoot?e.isRoot&&e.originalUrl.startsWith(en.a)?u.createElement(Yi.e,{style:Kn}):u.createElement(Yi.f,{style:Kn}):Object(Qi.a)(e.mimeType,Kn);if(t&&t.badgeText)o=u.createElement(tn,{type:t.badgeType,tooltip:t.badgeText});else if(e.duplicateCount){const t=Object(l.b)("CollapsedDocInstanceInfo",e.duplicateCount);o=u.createElement(tn,{type:"info",tooltip:t})}return u.createElement("div",Object.assign({},i),s," ",o," ",e.displayName,n)});this.onSelectItem=((e,t=!0)=>{e.isFolder||e.isRoot||!t||this.props.showDocument(e.originalUrl);this.setState({selectedKey:e.key})});this.onToggleExpand=(e=>{const t=this.state.itemExpandedByKey,i=t.get(e.key,!1);this.setState({itemExpandedByKey:t.set(e.key,!i)})});this.onNavigate=((e,t)=>{const i=gn({treeMap:this.state.treeMap,roots:this.state.roots,itemExpandedByKey:this.state.itemExpandedByKey,currentKey:t.key,direction:e});this.setState({selectedKey:i})});this.handleKeyDown=(e=>{let t=!1;if(Object(D.c)(e)&&76===e.keyCode){t=!0;this.toggleItemLibraryFileState(this.state.selectedKey)}if(t){e.preventDefault();e.stopPropagation()}});this.handleRootContextMenu=(e=>{e.preventDefault();e.stopPropagation();if(e.clientX&&e.clientY)this.showRootContextMenu(e.clientX,e.clientY);else if(e.currentTarget){const{left:t,top:i}=e.currentTarget.getBoundingClientRect();this.showRootContextMenu(t,i)}});this.handleContextMenu=(async(e,t,i)=>{this.onSelectItem(e,!1);const n=Boolean(e.children&&e.children.length),s=[...this.getBasicContextMenuActions(),{id:"separator1",label:"",type:2},{id:"menuItemExpandChildren",label:Object(l.b)("ExpandChildren"),type:0,disabled:!n},{id:"menuItemCollapseChildren",label:Object(l.b)("CollapseChildren"),type:0,disabled:!n}],o=!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("LibraryCode"),r=e.mimeType&&e.mimeType.includes("javascript")||e.originalUrl.endsWith(".js");if(!e.isFolder&&!e.isRoot&&o&&r){const t=this.props.urls.get(e.originalUrl),i=t&&t.isLibraryFile,n=Object(l.b)(i?"FilePickerMyCodeTooltip":"FilePickerLibraryCodeTooltip");s.push({id:"menuItemSetLibraryFile",checked:i,label:n,type:1})}const a=await Object(yi.a)("filePickerContextMenu",s,t,i);a.wasItemSelected&&this.onContextMenuItemClicked(a.selectedItemId)});this.onHoverItem=(e=>{Object(le.c)({content:e.originalUrl})});this.isDisposed=!1;this.nextRenderKey=0;this.filePickerDynamicNodeName=Object(l.b)("FilePickerDynamicNode");const t=ln(e.files.valueSeq(),this.filePickerDynamicNodeName),i=this.getSelectedKey(t,"");this.state={itemExpandedByKey:Ae.Map(),renderKey:"0",roots:t.roots,treeMap:t.treeMap,selectedKey:i}}componentWillUnmount(){this.isDisposed=!0}componentWillReceiveProps(e){if(this.props.files!==e.files)this.recalculateTree(e);else if(this.props.urls!==e.urls){this.nextRenderKey++;this.setState({renderKey:String(this.nextRenderKey)})}else e.revealFileUrl&&this.revealUrl(e.revealFileUrl)}render(){return u.createElement("div",{ref:this.refHandlers.root,style:Un,onKeyDown:this.handleKeyDown,onContextMenu:this.handleRootContextMenu},u.createElement(Ln,{itemKeys:this.state.roots,itemMap:this.state.treeMap,selectedKey:this.state.selectedKey,itemExpandedByKey:this.state.itemExpandedByKey,onContextMenu:this.handleContextMenu,onSelectItem:this.onSelectItem,onToggleExpand:this.onToggleExpand,onNavigate:this.onNavigate,onHoverItem:this.onHoverItem,renderItem:this.renderItem,renderKey:this.state.renderKey}))}async showRootContextMenu(e,t){const i=this.getBasicContextMenuActions(),n=await Object(yi.a)("filePickerContextMenu",i,e,t);n.wasItemSelected&&this.onContextMenuItemClicked(n.selectedItemId)}getBasicContextMenuActions(){return[{id:"menuItemExpandAll",label:Object(l.b)("ExpandAll"),type:0},{id:"menuItemCollapseAll",label:Object(l.b)("CollapseAll"),type:0}]}onContextMenuItemClicked(e){switch(e){case"menuItemExpandAll":this.expandAll();break;case"menuItemCollapseAll":this.collapseAll();break;case"menuItemExpandChildren":this.expandChild(this.state.selectedKey);break;case"menuItemCollapseChildren":this.collapseChild(this.state.selectedKey);break;case"menuItemSetLibraryFile":this.toggleItemLibraryFileState(this.state.selectedKey)}}getSelectedKey(e,t){return!e.roots.length||t&&e.treeMap.has(t)?t:e.roots[0]}expandAll(){this.setAllParentsExpandedState(!0)}collapseAll(){this.setAllParentsExpandedState(!1)}setAllParentsExpandedState(e){let t=this.state.itemExpandedByKey;for(const i of this.state.treeMap.values()){const n=i.children&&i.children.length,s=e&&i.displayName===this.filePickerDynamicNodeName;n&&!s&&(t=t.set(i.key,e))}this.setState({itemExpandedByKey:t})}expandChild(e){if(e){const t=this.state.itemExpandedByKey;this.setState({itemExpandedByKey:t.set(e,!0)})}}collapseChild(e){if(e){const t=this.state.itemExpandedByKey;this.setState({itemExpandedByKey:t.set(e,!1)})}}findItemByKey(e){return this.state.treeMap.get(e)}findItemByUrl(e){for(const t of this.state.treeMap.values())if(t.originalUrl===e)return t}toggleItemLibraryFileState(e){if(e){const t=this.findItemByKey(e);if(t){const e=this.props.urls.get(t.originalUrl),i=e&&e.isLibraryFile;this.props.updateLibraryUrlState(t.originalUrl,!i)}}}revealUrl(e){let t=this.state.itemExpandedByKey;const i=this.state.treeMap,n=this.findItemByUrl(e);if(n){let e=n;for(;e&&e.parentKey;){t=t.set(e.parentKey,!0);e=i.get(e.parentKey)}this.setState({itemExpandedByKey:t,selectedKey:n.key})}}}const Wn=Object(je.css)({display:"inline-block",whiteSpace:"nowrap"}),jn=Object(je.css)(Wn,{fontWeight:"bold"}),Kn={verticalAlign:"text-bottom"},Un={cursor:"default",lineHeight:"1.3335",minHeight:"100%",msUserSelect:"none"};function Hn(e){return{showDocument:t=>e(Object(B.m)(t)),updateLibraryUrlState:(t,i)=>e(Object(B.o)(t,i))}}function Vn(e){return{files:e.debugger.files,revealFileUrl:e.debugger.revealFileUrl,urls:e.debugger.urls}}var Gn=Object(Ci.b)(Vn,Hn)(Nn);function zn(e){Object(R.a)();e.classList.add("pinnedFilePicker");e.style.display="block";e.style.zIndex="1000";e.style.width="300px";e.style.overflow="auto";Object(p.render)(u.createElement(Ci.a,{store:R.b},u.createElement(Gn,null)),e);return{getTotalDocuments:$n,getRootNodes:Zn,getAllItems:Yn,highlightFile:Xn,resourceOpened:qn,resourceClosed:Jn}}function Xn(e){R.b.dispatch(Object(B.g)(e))}function qn(e){if(e instanceof Ut.b){const t=e.url.raw;R.b.dispatch(Object(B.k)(t,!0))}}function Jn(e){if(e instanceof Ut.b){const t=e.url.raw;R.b.dispatch(Object(B.k)(t,!1))}}function $n(){return R.b.getState().debugger.files.size}function Zn(){const{files:e}=R.b.getState().debugger,t=ln(e.valueSeq(),Object(l.b)("FilePickerDynamicNode"));return Qn(t.treeMap,t.roots)}function Yn(){let e=[];const t=Zn();e=e.concat(t);let i=t.slice(0);for(;i.length;){const t=i.shift();e.push(t);t.children.length&&(i=i.concat(t.children))}return e}function Qn(e,t=[]){return t.map(t=>{const i=e.get(t);return{children:Qn(e,i.children),displayName:i.displayName,mimeType:i.mimeType,url:i.originalUrl}})}const es=Object(A.a)(),ts="ControlsSplitPaneVericalModeColumns",is="ControlsSplitPaneVericalModeRows",ns="ControlsSplitPaneFirstVisable",ss="ControlsSplitPaneSecondVisable",os="splitterNS",rs="splitterEW",as=250,ls=3,ds=100,cs="DebuggerFilePickerWidth",hs="DebuggerFilePickerOpen",us="DebuggerFindInFilesHeight",ps=100,gs=200,ms=375,_s=matchMedia("(max-width: 680px) and (min-width: 1px)");class bs{constructor(){this.propertyChanged=new v.a;this.filePickerOpen=!1;this._throttledResizeSplitConsole=Object(P.e)(this.resizeFilePicker,this,ds);this._hDataWindowsSplitterBottomPx=bs.MIN_CONTROLS_HEIGHT;this._throttledResizeFindInFiles=Object(P.e)(this.resizeFindInFiles,this,ds);this._throttledToggleFindInFiles=Object(P.e)(this.keyboardToggleFindInFiles,this,ms);this._traceWriter=new O.a;window.addEventListener("load",()=>{Object(F.g)().call("ms:host","postPendingMessageToPlugin",[N.c.debugger]);this._traceWriter=new O.b});L.t===N.b.ExtensionBackground?document.body.classList.add("extensionBackgroundScriptMode"):L.t===N.b.ExtensionPopup&&document.body.classList.add("extensionPopupScriptMode");this._debuggerContent=document.getElementById("debuggerContent");this.editorContainer=document.getElementById("editorContainer");this._editorDataWindowsSplitter=document.getElementById("editorDataWindowsSplitter");this._leftBlockElement=document.getElementById("leftBlock");this._filePickerButton=document.getElementById("filePickerButton");this._filePickerElement=document.getElementById("filePickerMenu");this._filePickerSplitter=document.getElementById("filePickerSplitter");this._controlsSplitPane=document.getElementById("controlsSplitPane");this._dataWindowsSplitter=document.getElementById("dataWindowsSplitter");this._topDataWindowsParent=document.getElementById("topDataWindowsParent");this._bottomDataWindowsParent=document.getElementById("bottomDataWindowsParent");this._resizePane=document.getElementById("resizePane");this._currentResizeClientRect=null;this._findInFilesVisible=!1;this._editorContainerElement=document.getElementById("editorContainer");this._findInFilesElement=document.getElementById("findInFilesContainer");this._findInFilesSplitter=document.getElementById("findInFilesSplitter");this.setupEditorDataWindowsSplitter();this.setupDataWindowsSplitter();this.setupFilePickerSplitter();this.setupFindInFilesSplitter();addEventListener("activated",()=>{this.layoutErrorDisplay(!0)});this._topContainer=new Ie;this._topDataWindowsParent.appendChild(this._topContainer.containerElement);this._bottomContainer=new Ie;this._bottomDataWindowsParent.appendChild(this._bottomContainer.containerElement);this._topContainer.addTab("Watches","WatchesWindowTitle","WatchesWindowTitle");this._bottomContainer.addTab("Callstack","CallstackWindowTitle","CallstackWindowTitle");this._bottomContainer.addTab("BreakpointWindow","BreakpointsWindowTitle","BreakpointsWindowTitle",-1);Object(T.isEdpEnabled)()&&!Object(T.isEdpFeatureEnabled)("DomBreakpoints")||this._bottomContainer.addTab("DomBreakpointsWindow","/Common/DomMutationBreakpointsTabButtonText","/Common/DomMutationBreakpointsTabButtonTooltip",-1);document.querySelector("#root").setAttribute("aria-label",Object(l.b)("DebuggerTitle"));M.a.registerNavigationFrames([M.a.makeNavigationFrameFromCallback(document.body,()=>this._debuggerToolbar.getActiveElement()),M.a.makeNavigationFrameFromCallback(this._topContainer.containerElement,()=>this._topContainer.tabs[this._topContainer.activeIndex].titleElement),M.a.makeNavigationFrameFromCallback(this._bottomContainer.containerElement,()=>this._bottomContainer.tabs[this._bottomContainer.activeIndex].titleElement)]);M.a.registerFocusHandlers(N.c.debugger);this._documentToolbar=new m.a("Common.toolbarTemplateWithoutTitle");this._documentToolbar.rootElement.classList.add(x.a.HideResourceToolbarCssClass);document.getElementById("documentToolbar").appendChild(this._documentToolbar.rootElement)}get editorWindow(){return this._editorWindow}set editorWindow(e){this._editorWindow=e}get filePicker(){return this._filePicker}get tabControl(){return this._tabControl}get debuggerToolbar(){return this._debuggerToolbar}get callstackWindow(){return this._callstackWindow}get bottomContainer(){return this._bottomContainer}get debuggerManager(){return this._debuggerManager}get topContainer(){return this._topContainer}get traceWriter(){return this._traceWriter}get documentToolbar(){return this._documentToolbar}getIsShowingFindInFiles(){return this._findInFilesVisible}initializeUI(){const e=new Ei;this._debuggerManager=new mi(e,this);const t=document.createElement("div");t.classList.add("resourceHandler");t.classList.add("debuggerEditor");this._debuggerManager.resourceViewController.primeWithElement(t);this._editorWindow=new St(this._debuggerManager,this._debuggerManager.documentController,this._debuggerManager.breakpointController,this._debuggerManager.executionController,this._debuggerManager.languageServiceController,t,()=>{this._debuggerManager.breakpointController.registerListener(this._editorWindow);this._debuggerManager.executionController.registerListener(this._editorWindow);this._debuggerManager.documentController.registerListener(this._editorWindow);e.onDebuggerLoadComplete(this._debuggerManager)});this._debuggerManager.documentController.editorWindow=this._editorWindow;this._debuggerToolbar=new vt(this._debuggerManager.executionController,this);this._tabControl=new w.a(document.getElementById("tabControl"),this._debuggerManager.resourceViewController,this._debuggerManager.documentController.onTabControlContextMenu,this._debuggerManager.documentController.getDocPropertiesForTabControl);this.setupFilePickerButton();this._filePicker=zn(this._filePickerElement);this._debuggerManager.resourceViewController.registerListener(this._tabControl);this._debuggerManager.resourceViewController.registerListener(this._filePicker);this._breakpointWindow=new Z(this,this._debuggerManager.breakpointController,document.getElementById("BreakpointWindow"));this._debuggerManager.breakpointController.registerListener(this);this._debuggerManager.breakpointController.registerListener(this._breakpointWindow);this._callstackWindow=Zi(document.querySelector(".callstackwindow"),(e,t)=>this.onActiveFrameChanged(e,t),()=>this.debuggerManager.checkForDomMutationBreakpointEvent(),e=>this.debuggerManager.dmbpManager.getBreakpointById(e),e=>this.debuggerManager.getDocFromStackFrame(e),e=>this.debuggerManager.getJMCBreakAction(e));this._watchWindowView=new bt(this._debuggerManager.watchController,document.querySelector(".gridWatchContainer"));this._debuggerManager.watchController.view=this._watchWindowView;this._debuggerManager.executionController.registerListener(this);window.addEventListener("resize",()=>{this._currentResizeClientRect=null});document.addEventListener("keyup",this.onKeyUpOrDown.bind(this));document.addEventListener("keydown",this.onKeyDown.bind(this));_s.addListener(()=>{this.setupDataWindowsSplitterPosition();this._debuggerContent.style.msGridRows="";this._debuggerContent.style.msGridColumns="";this.layoutDocumentWindows();this._debuggerManager.watchController.layout()});const i=this.debuggerManager.jmcController.isJustMyCodeEnabled;this._callstackWindow.enableJMC(i);if(!Object(T.isEdpEnabled)()||Object(T.isEdpFeatureEnabled)("DomBreakpoints")){this._dmbpModel=new S(this._debuggerManager.dmbpManager,V.b);this._dmbpView=new ye(this,this._debuggerManager.dmbpManager,document,"dmbpList",ye.TEMPLATE_NAME_BREAKPOINT,this._dmbpModel);this._dmbpView.updateView()}const n=Object(L.r)(hs);n&&"true"!==n||this.showPicker();this._debuggerManager.resourceViewController.registerListener(this);this.setupDataWindowsSplitterPosition();Object(k.a)(e=>!!(e.target&&fs(e.target,"monaco-findInput")&&27===e.keyCode&&Object(D.i)(e)))}logOnEditorLoadTelemetry(e,t){const i=this._editorWindow.getLineCount(),n={averageLineColumnCount:Math.floor(t/i),numberScriptsLoaded:this._filePicker.getTotalDocuments(),selectedDocID:e.frontendId,selectedDocMimeType:e.mimeType,sourceMapState:e.sourceMapState,toolName:"Debugger",totalLineCount:i};V.b.logExecuteCommand(V.a.EDITOR_LOAD_DEBUGGER,g.c.NotSpecified,2,g.b.Telemetry,n)}getFindResultsTop(){return document.body.offsetHeight}getEditorDimensions(){return{width:this.editorContainer.offsetWidth,height:this.editorContainer.offsetHeight}}switchToBreakpointWindow(){this._bottomContainer.switchToTab(bs.BREAKPOINTS_WINDOW_TAB_INDEX,!0)}breakpointChanged(){this._bottomContainer.contentVisible&&!this._debuggerManager.executionController.isExecutionPaused&&this._bottomContainer.switchToTab(bs.BREAKPOINTS_WINDOW_TAB_INDEX,!0)}breakpointAdded(){this.breakpointChanged()}breakpointRemoved(){this.breakpointChanged()}conditionPromptInvoked(){}tracepointPromptInvoked(){}pendingBreakpointAdded(){}breakStateChanged(e){e&&this._bottomContainer.switchToTab(bs.CALLSTACK_WINDOW_TAB_INDEX,!0)}exceptionFilterChanged(){}breakCallComplete(){}justMyCodeStateChanged(){}resourceOpened(e,t){}layoutDocumentWindows(){this._debuggerManager.resourceViewController.doLayout();this.tabControl.doLayout();this.layoutErrorDisplay(!1)}tryNarratorAnnounce(e){W.a.setAlertMessage(e)}findInFiles(e){const t=this._debuggerManager.documentController.getDocs();return this._editorWindow.findInFiles(t,e)}toggleFindInFiles(e){const t=document.getElementById("findInFilesContainer"),i=this._debuggerToolbar.getButton("findinfiles");t.childElementCount>0?Object(V.c)(V.a.TOGGLE_FIND_IN_FILES_OFF,e,()=>{this._findInFilesElement.style.height="0px";this._findInFilesSplitter.style.display="none";this.editorWindow.doLayout();p.unmountComponentAtNode(t);this._findInFilesVisible=!1;i.setAttribute("data-plugin-vs-tooltip",Object(l.b)("FindInFilesButtonOffTooltip"))}):Object(V.c)(V.a.TOGGLE_FIND_IN_FILES_ON,e,()=>{let e=parseFloat(Object(L.r)(us));e&&!isNaN(e)||(e=gs);this._findInFilesElement.style.height=`${e}px`;this._findInFilesSplitter.style.display="block";this.editorWindow.doLayout();p.render(u.createElement(ut,{debuggerShell:this}),t);this._findInFilesVisible=!0;i.setAttribute("data-plugin-vs-tooltip",Object(l.b)("FindInFilesButtonOnTooltip"))})}showPicker(){if(!this.filePickerOpen){this.editorWindow.doLayout();this.layoutDocumentWindows();Object(L.E)(hs,"true");this._filePickerElement.style.display="block";this._filePickerButton.classList.add("activated");this._filePickerButton.setAttribute("aria-expanded","true");this.filePickerOpen=!0}}hidePicker(){if(this.filePickerOpen){this.editorWindow.doLayout();this._filePickerButton.classList.remove("activated");this._filePickerButton.setAttribute("aria-expanded","false");this._filePickerElement.style.display="none";this.filePickerOpen=!1;Object(L.E)(hs,"false")}}highlightOpenFile(){this.showPicker();this.filePicker.highlightFile(this.editorWindow.displayedDoc.url.raw)}async onActiveFrameChanged(e,t){const i=this._debuggerManager.getDocFromStackFrame(e),n=Object(Le.g)(e,i);this._editorWindow.activeFrameChanged(e);this.debuggerManager.setActiveFrame(e);if(!e.isAsync){this.debuggerManager.watchController.activeFrameChanged(e);this.debuggerManager.intellisenseProvider.activeFrameChanged()}let s=t?2:1;Object(L.u)()&&this._debuggerManager.splitConsoleOpen&&(s=1);await this._debuggerManager.resourceViewController.open(n.startPosition.doc,{activation:s,params:{location:n}})}layoutErrorDisplay(e){es.isShown&&es.resize(e)}onKeyDown(e){let t=!1;if(e.ctrlKey&&!e.altKey&&!e.shiftKey)if(9===e.keyCode){this._tabControl.selectNextTab(g.c.KeyboardShortcut);t=!0}else if(87===e.keyCode){this._debuggerManager.watchController.addWatchByCurrentEditorPosition(g.c.KeyboardShortcut);t=!0}else if(115===e.keyCode){V.b.logExecuteCommand(V.a.CLOSE_RESOURCE_VIEW,g.c.KeyboardShortcut);this._debuggerManager.resourceViewController.closeCurrent(!1);t=!0}else if(79===e.keyCode){V.b.logExecuteCommand(V.a.FILEPICKER_MENU_OPEN,g.c.KeyboardShortcut);this.showPicker();t=!0}if(e.ctrlKey&&!e.altKey&&e.shiftKey){if(9===e.keyCode){this._tabControl.selectPreviousTab(g.c.KeyboardShortcut);t=!0}else if(79===e.keyCode){if(this.filePickerOpen){V.b.logExecuteCommand(V.a.FILEPICKER_MENU_CLOSE,g.c.KeyboardShortcut);this.hidePicker()}t=!0}else if(70===e.keyCode){this._throttledToggleFindInFiles();e.preventDefault();return!1}const i=parseInt(e.key,10);if(!isNaN(i)&&i>=1&&i<=9){this._tabControl.trySelectTabByNumber(i,g.c.KeyboardShortcut);t=!0}}if(t){e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();return!1}return!0}onKeyUpOrDown(e){if(e.ctrlKey&&e.shiftKey&&!e.altKey){if(122===e.keyCode){this._breakpointWindow.toggleAll(g.c.KeyboardShortcut);e.preventDefault();return!1}if(74===e.keyCode){R.b.dispatch(Object(B.n)());e.preventDefault();return!1}}if(!e.ctrlKey&&e.altKey&&e.shiftKey){if(66===e.keyCode){V.b.logExecuteCommand(V.a.GO_TO_BREAKPOINT_WINDOW,g.c.KeyboardShortcut);this._bottomContainer.switchToTab(bs.BREAKPOINTS_WINDOW_TAB_INDEX);e.preventDefault();return!1}if(67===e.keyCode){V.b.logExecuteCommand(V.a.GO_TO_CALLSTACK_WINDOW,g.c.KeyboardShortcut);this._bottomContainer.switchToTab(bs.CALLSTACK_WINDOW_TAB_INDEX);return!1}if(87===e.keyCode){V.b.logExecuteCommand(V.a.GO_TO_WATCH_WINDOW,g.c.KeyboardShortcut);this._topContainer.switchToTab(bs.WATCHES_WINDOW_TAB_INDEX);return!1}if(84===e.keyCode){V.b.logExecuteCommand(V.a.GO_TO_TOGGLE_WINDOW,g.c.KeyboardShortcut);return!1}if(68===e.keyCode){V.b.logExecuteCommand(V.a.GO_TO_DMBP_WINDOW,g.c.KeyboardShortcut);this._bottomContainer.switchToTab(bs.DMBP_WINDOW_TAB_INDEX);return!1}}if(!e.ctrlKey&&e.altKey&&!e.shiftKey&&106===e.keyCode){this._debuggerManager.executionController.isExecutionPaused&&this.onActiveFrameChanged(this._debuggerManager.activeStackFrame,!0);e.preventDefault();return!1}return!0}keyboardToggleFindInFiles(){return this.toggleFindInFiles(g.c.KeyboardShortcut)}setupDataWindowsSplitter(){let e=!1;this._dataWindowsSplitter.addEventListener("mousedown",t=>{t.preventDefault();if(!e){const t=_s.matches?rs:os;document.body.classList.add(t);const i=Object(P.b)(e=>{e.preventDefault();e.buttons?this.handleDataWindowsResize(e.clientX,e.clientY):n(e)}),n=s=>{s.preventDefault();const o=this._debuggerContent.getBoundingClientRect().height,r=this._debuggerManager.persistenceManager;this._currentResizeClientRect=null;Object(L.E)(bs.H_DATA_WINDOWS_SPLITTER,""+this._hDataWindowsSplitterBottomPx/o);if(_s.matches){r.setSetting(ts,this._controlsSplitPane.style.msGridColumns);r.setSetting(is,this._controlsSplitPane.style.msGridRows)}r.setSetting(ns,this._topContainer.contentVisible);r.setSetting(ss,this._bottomContainer.contentVisible);document.body.classList.remove(t);document.removeEventListener("mousemove",i,!0);document.removeEventListener("mouseup",n,!0);this._resizePane.classList.remove("showResizePane");e=!1};document.addEventListener("mousemove",i,!0);document.addEventListener("mouseup",n,!0);this._resizePane.classList.add("showResizePane");e=!0}})}setupDataWindowsSplitterPosition(){const e=this._debuggerManager.persistenceManager;if(_s.matches){this._controlsSplitPane.style.msGridRows=e.getSetting(is,"");this._controlsSplitPane.style.msGridColumns=e.getSetting(ts,"");this._topContainer.contentVisible=e.getSetting(ns,!0);this._bottomContainer.contentVisible=e.getSetting(ss,!0)}else{const t=Object(L.r)(bs.H_DATA_WINDOWS_SPLITTER);this._hDataWindowsSplitterBottomPx=parseFloat(t);if(!isNaN(this._hDataWindowsSplitterBottomPx)&&this._hDataWindowsSplitterBottomPx<=1){this._controlsSplitPane.style.msGridRows="1fr 3px "+100*this._hDataWindowsSplitterBottomPx+"%";this._controlsSplitPane.style.msGridColumns="";this._topContainer.contentVisible=e.getSetting(ns,!0);this._bottomContainer.contentVisible=e.getSetting(ss,!0)}else{this._controlsSplitPane.style.msGridRows="";this._controlsSplitPane.style.msGridColumns="";this._topContainer.contentVisible=!0;this._bottomContainer.contentVisible=!0}}}handleDataWindowsResize(e,t){null===this._currentResizeClientRect&&(this._currentResizeClientRect=this._controlsSplitPane.getBoundingClientRect());const i=this._currentResizeClientRect;if(_s.matches){let t=i.width-e,n=e;if(e<0){t=1;n=0;this._topContainer.contentVisible=!0;this._bottomContainer.contentVisible=!1}else if(e>i.width){t=0;n=1;this._topContainer.contentVisible=!1;this._bottomContainer.contentVisible=!0}else{t=i.width-e;n=e;this._topContainer.contentVisible=!0;this._bottomContainer.contentVisible=!0}this._controlsSplitPane.style.msGridColumns=`${n}fr 3px ${t}fr`;this._controlsSplitPane.style.msGridRows="1fr"}else{const e=i.height-t+i.top;let n;if(t-i.top<bs.MIN_CONTROLS_HEIGHT){this._hDataWindowsSplitterBottomPx=i.height-bs.MIN_CONTROLS_HEIGHT;n=bs.MIN_CONTROLS_HEIGHT;this._topContainer.contentVisible=!1;this._bottomContainer.contentVisible=!0}else if(e>bs.MIN_CONTROLS_HEIGHT){this._hDataWindowsSplitterBottomPx=e;n=t-i.top;this._topContainer.contentVisible=!0;this._bottomContainer.contentVisible=!0}else{this._hDataWindowsSplitterBottomPx=bs.MIN_CONTROLS_HEIGHT;n=i.height-bs.MIN_CONTROLS_HEIGHT;this._topContainer.contentVisible=!0;this._bottomContainer.contentVisible=!1}n=Math.max(n,bs.MIN_CONTROLS_HEIGHT);this._hDataWindowsSplitterBottomPx=Math.max(this._hDataWindowsSplitterBottomPx,bs.MIN_CONTROLS_HEIGHT);this._controlsSplitPane.style.msGridRows=n+"fr 3px "+this._hDataWindowsSplitterBottomPx+"fr";this._controlsSplitPane.style.msGridColumns="1fr"}this._debuggerManager.watchController.layout()}setupFilePickerSplitter(){const e=this._filePickerElement;let t=parseFloat(Object(L.r)(cs,"250"));t=!t||isNaN(t)?as:Math.max(t,as);e.style.width=`${t}px`;const i=this._filePickerSplitter;let n=null;i.addEventListener("pointerdown",e=>{if(null===n){i.setPointerCapture(e.pointerId);n=e.pointerId;document.body.classList.add(rs);this._resizePane.classList.add("showResizePane");e.preventDefault()}});const s=e=>{if(null!==n&&n===e.pointerId){i.releasePointerCapture(e.pointerId);n=null;this._resizePane.classList.remove("showResizePane");document.body.classList.remove(rs);e.preventDefault()}};i.addEventListener("pointermove",e=>{if(null!==n&&e.pointerId===n){this._throttledResizeSplitConsole(e.pageX);e.preventDefault()}});i.addEventListener("pointerup",s);i.addEventListener("pointercancel",s)}resizeFilePicker(e){const t=this._filePickerElement;let i=e+ls;i=Math.max(i,as);const n=this._leftBlockElement.getBoundingClientRect().width-as;i=Math.min(i,n);t.style.width=`${i}px`;this.editorWindow.doLayout();this.layoutDocumentWindows();Object(L.E)(cs,String(i))}setupFilePickerButton(){const e=this._filePickerButton;e.setAttribute("data-plugin-vs-tooltip",Object(l.b)("FilePickerTooltip"));e.setAttribute("aria-label",Object(l.b)("FilePickerTooltip"));e.setAttribute("aria-expanded","false");e.setAttribute("aria-controls","filePickerMenu");e.addEventListener("click",t=>{if(e.classList.contains("activated")){V.b.logExecuteCommand(V.a.FILEPICKER_MENU_CLOSE,g.c.Ui);this.hidePicker()}else{V.b.logExecuteCommand(V.a.FILEPICKER_MENU_OPEN,g.c.Ui);this.showPicker()}t.stopImmediatePropagation();return!0});e.addEventListener("keydown",e=>{const t=()=>{V.b.logExecuteCommand(V.a.FILEPICKER_MENU_OPEN,g.c.KeyboardShortcut);this.showPicker()},i=()=>{V.b.logExecuteCommand(V.a.FILEPICKER_MENU_CLOSE,g.c.KeyboardShortcut);this.hidePicker()};if(13===e.keyCode||32===e.keyCode){this.filePickerOpen?i():t();e.preventDefault();return!1}if((40===e.keyCode&&e.ctrlKey&&!e.altKey||40===e.keyCode&&!e.ctrlKey&&e.altKey)&&!this.filePickerOpen){t();e.preventDefault();return!1}if((38===e.keyCode&&e.ctrlKey&&!e.altKey||38===e.keyCode&&!e.ctrlKey&&e.altKey)&&this.filePickerOpen){i();e.preventDefault();return!1}return!0})}setupEditorDataWindowsSplitter(){let e=!1;this._editorDataWindowsSplitter.addEventListener("mousedown",t=>{t.preventDefault();if(!e){this._currentResizeClientRect=this._debuggerContent.getBoundingClientRect();const t=_s.matches?os:rs;document.body.classList.add(t);const i=s=>{s.preventDefault();this._currentResizeClientRect=null;this.layoutDocumentWindows();this._debuggerManager.watchController.layout();document.body.classList.remove(t);document.removeEventListener("mousemove",n,!0);document.removeEventListener("mouseup",i,!0);this._resizePane.classList.remove("showResizePane");e=!1},n=Object(P.b)(e=>{e.preventDefault();e.buttons?this.setEditorSplitter(e):i(e)});this._editorDataWindowsSplitter.focus();document.addEventListener("mousemove",n,!0);document.addEventListener("mouseup",i,!0);this._resizePane.classList.add("showResizePane");e=!0}})}setEditorSplitter(e){null===this._currentResizeClientRect&&(this._currentResizeClientRect=this._debuggerContent.getBoundingClientRect());if(_s.matches){const{height:t}=document.getElementById("toolbar").getBoundingClientRect(),{height:i}=this._currentResizeClientRect;let n=e.clientY||0;i-(n-=t)<=bs.MIN_CONTROLS_HEIGHT?n=i-bs.MIN_CONTROLS_HEIGHT:n<bs.MIN_CONTROLS_HEIGHT&&(n=bs.MIN_CONTROLS_HEIGHT);const s=i-n;this._debuggerContent.style.msGridRows=`${n}fr 3px ${s}fr`;this._debuggerContent.style.msGridColumns="1fr"}else{let t=e.clientX||0;const i=this._currentResizeClientRect.width;if(i-t<bs.MIN_CONTROLS_WIDTH)t=i-bs.MIN_CONTROLS_WIDTH;else{const e=document.getElementById("filePickerMenu").getBoundingClientRect().width+bs.MIN_CONTROLS_WIDTH;t<e&&(t=e)}const n=i-t;this._debuggerContent.style.msGridColumns=t+"fr 3px "+n+"fr";this._debuggerContent.style.msGridRows="1fr"}this.layoutDocumentWindows();this._debuggerManager.watchController.layout()}setupFindInFilesSplitter(){const e=this._findInFilesElement;let t=parseFloat(Object(L.r)(us,"200"));t=!t||isNaN(t)?ps:Math.max(t,ps);e.style.height="0px";const i=this._findInFilesSplitter;let n=null;i.addEventListener("pointerdown",e=>{if(null===n){i.setPointerCapture(e.pointerId);n=e.pointerId;document.body.classList.add(os);this._resizePane.classList.add("showResizePane");e.preventDefault()}});const s=e=>{if(null!==n&&n===e.pointerId){i.releasePointerCapture(e.pointerId);n=null;this._resizePane.classList.remove("showResizePane");document.body.classList.remove(os);e.preventDefault()}};i.addEventListener("pointermove",e=>{if(null!==n&&e.pointerId===n){this._throttledResizeFindInFiles(e.clientY);e.preventDefault()}});i.addEventListener("pointerup",s);i.addEventListener("pointercancel",s)}resizeFindInFiles(e){const t=this._findInFilesElement;let i=document.body.clientHeight-e;i=Math.max(i,ps);const n=this._editorContainerElement.getBoundingClientRect().height-ps;i=Math.min(i,n);t.style.height=`${i}px`;this.editorWindow.doLayout();this.layoutDocumentWindows();Object(L.E)(us,String(i))}}bs.MIN_CONTROLS_WIDTH=180;bs.MIN_CONTROLS_HEIGHT=25;bs.H_DATA_WINDOWS_SPLITTER="DebuggerHDataWindowsSplitterPosition";bs.WATCHES_WINDOW_TAB_INDEX=0;bs.CALLSTACK_WINDOW_TAB_INDEX=0;bs.BREAKPOINTS_WINDOW_TAB_INDEX=1;bs.DMBP_WINDOW_TAB_INDEX=2;function fs(e,t){if(!e)throw new ReferenceError("Expected: node");let i=e.parentNode;for(;i;){if(Es(i)&&i.classList.contains(t))return!0;i=i.parentNode}return!1}function Es(e){return e.nodeType===Node.ELEMENT_NODE}class Cs extends u.PureComponent{render(){return u.createElement("div",null,"Placeholder for future Debugger Shell")}}function ys(e){return{atBreakpoint:e.debugger.atBreakpoint,files:e.debugger.files}}function Is(e){return{placeholder:()=>e({type:"PLACEHOLDER"})}}var Ss=Object(Ci.b)(ys,Is)(Cs);function Ts(){const e=Object(F.g)();e.call("ms:host","postPendingMessageToPlugin",[N.c.debugger]);e.listen("debuggerRemoteAttached",()=>{Bt.callRemote("debuggerPort","enableDynamicDebugging",[!1])});Object(R.a)();Object(p.render)(u.createElement(Ci.a,{store:R.b},u.createElement(Ss,null)),document.getElementById("root"))}h();document.addEventListener("DOMContentLoaded",async()=>{await Object(n.a)();Object(Ft.initializeServices)();if("1"===s.b.utilities.getEnvironmentVariable("REACT_DEBUGGER"))Ts();else{const e=new bs;window.debuggerShellForTestContractsOnly=e;e.initializeUI()}})},41:function(e,t,i){"use strict";i.d(t,"a",function(){return h});i.d(t,"b",function(){return u});var n=i(49),s=i(116),o=i.n(s),r=i(10),a=i(136),l=i(135),d=i(160);let c=!1;function h(){if(!c){c=!0;Object(r.g)().listen(l.a,({action:e})=>{u.dispatch(e)})}}const u=Object(n.e)(d.a,Object(n.a)(a.b,o.a))},48:function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(4),s=i(23),o=i(12),r=i(53);class a{static getPositionDisplayText(e){return e?s.a.fileLineColumnFormat(o.a.createShortenedUrlText(e.doc.url.toString()),e.line,e.column):""}static areEqual(e,t){return e.rawLocation.doc===t.rawLocation.doc&&e.rawLocation.offset===t.rawLocation.offset&&e.rawLocation.length===t.rawLocation.length&&e.startPosition.line===t.startPosition.line&&e.startPosition.column===t.startPosition.column&&e.endPosition.line===t.endPosition.line&&e.endPosition.column===t.endPosition.column}constructor(e,t,i,s,o,a,l){let d=t,c=i;if(d<=0||c<=0){n.a.failDebugOnly("Line and column numbers must be positive");d<=0&&(d=1);c<=0&&(c=1)}this._startPosition={doc:e,line:d,column:c};this._endPosition=this._startPosition;s instanceof r.b&&"number"==typeof o&&"number"==typeof a&&(this._endPosition={doc:s,line:o,column:a});if(l)this._rawLocation=l;else if(e){const e=this._startPosition.doc.getRawLocation(this._startPosition),t=this._endPosition.doc.getRawLocation(this._endPosition);if(e&&t){n.a.areEqual(e.doc,t.doc,"Can't create a DocumentLocation from different raw documents");this._rawLocation={doc:e.doc,offset:e.offset,length:t.offset-e.offset}}}}get rawLocation(){return this._rawLocation}get startPosition(){return this._startPosition}get endPosition(){return this._endPosition}get startDisplayText(){return a.getPositionDisplayText(this._startPosition)}get endDisplayText(){return a.getPositionDisplayText(this._endPosition)}get lineNumber(){return this._startPosition.line}get column(){return this._startPosition.column}get startLineNumber(){return this._startPosition.line}get startColumn(){return this._startPosition.column}get endLineNumber(){return this._endPosition.line}get endColumn(){return this._endPosition.column}}},52:function(e,t,i){"use strict";i.d(t,"a",function(){return l});i.d(t,"f",function(){return d});i.d(t,"h",function(){return c});i.d(t,"d",function(){return u});i.d(t,"k",function(){return p});i.d(t,"c",function(){return _});i.d(t,"b",function(){return b});i.d(t,"j",function(){return E});i.d(t,"i",function(){return C});i.d(t,"g",function(){return y});i.d(t,"e",function(){return I});var n=i(25),s=i(123),o=i(12),r=i(0),a=i(89);const l="eventBreakpoint";function d(e,t){const i=[];e.breakpoints.forEach(e=>{const n=t(e.id);i.push({callFrameId:`dmbp_${e.id}_${e.type}#${n.elementUniqueId}`,functionName:n.selector,isAsync:!1,isInTryBlock:!1,isInternal:!1,isWorker:!1,location:{docId:s.a,start:0,length:0,dmbpLocationInfo:e.type}})});return i}function c(e){g(e)&&m(e)&&(e.breakEventType=Object(r.b)("XHRCallstackEventDiscription"));return g(e)?e.callFrames.concat([h(e)]):e.callFrames}function h(e){if(g(e))return{callFrameId:l,functionName:Object(r.b)("CallstackEventBreakpoint",e.breakEventType),isAsync:!1,isInTryBlock:!1,isInternal:!1,isWorker:!1,location:{docId:s.a,start:0,length:0}}}function u(e){const t=[],i=e.asyncCallStackInfo;if(!i)return[];for(let e=i.length-1;e>=0;e--)t.push(i[e].callFrames);return t}function p(e){return e.callFrameId.startsWith("dmbp_")}function g(e){return 6!==e.breakReason&&!!e.breakEventType}function m(e){return"XmlHttpRequest response"===e.breakEventType}function _(e){n.copyPlainText(e.copyText)}function b(e){n.copyPlainText(f(e))}function f(e){let t="";e.forEach(e=>{t+=`${e.title}\n`;e.stackFrames.map(e=>{t+=`${e.copyText}\n`})});return t}function E(e,t){return t?Object(r.b)("CallstackLibraryCode"):e.functionName}function C(e){return e.startPosition&&e.startPosition.doc?o.a.createShortenedUrlText(e.startPosition.doc.url.raw):""}function y(e,t){if(!e||!t)return;const i=t.createDocumentLocation(e.location.start,e.location.length);return new a.a(i.rawLocation,i)}function I(e){let t;switch(e){case"subtree-modified":t=Object(r.b)("DomMutationBreakpointsTypeSubtreeModified");break;case"attribute-modified":t=Object(r.b)("DomMutationBreakpointsTypeAttrModified");break;case"node-removed":t=Object(r.b)("DomMutationBreakpointsTypeNodeRemoved")}return t||""}},53:function(e,t,i){"use strict";var n=i(2),s=i(4),o=i(123),r=i(22),a=i(142),l=i(158),d=i(141),c=i(15),h=i(83),u=i(54),p=i(110),g=i(125),m=i(17),_=i(38),b=i(12),f=i(9),E=i(36),C=i(30),y=i(41),I=i(13),S=i(14),T=i(0),v=i(43),k=i(33),D=i(82),M=i(167),x=i(16),w=i(3),O=i(52);class P{static rewriteSourceMapUrl(e){return P.rewrite(e,P.SOURCEMAP_REWRITE_REGEX,P.SOURCEMAP_REWRITE_VALUE)}static rewriteAuthoredSourceUrl(e){return P.rewrite(e,P.AUTHORED_SOURCE_REWRITE_REGEX,P.AUTHORED_SOURCE_REWRITE_VALUE)}static reset(){P.Regexes={}}static rewrite(e,t,i){if(!e)return e;let n=P.Regexes[t];if(void 0===n){const e=Object(I.r)(t);n=e?{regex:new RegExp(e,"i"),value:Object(I.r)(i)}:{value:""};P.Regexes[t]=n}return n&&n.regex?e.replace(n.regex,n.value):e}}P.SOURCEMAP_REWRITE_REGEX="SourceMapRewriteRegex";P.SOURCEMAP_REWRITE_VALUE="SourceMapRewriteValue";P.AUTHORED_SOURCE_REWRITE_REGEX="AuthoredSourceRewriteRegex";P.AUTHORED_SOURCE_REWRITE_VALUE="AuthoredSourceRewriteValue";P.Regexes={};var B=i(104),R=i(48),L=i(71),A=i(151),F=i(147),N=i(10);class W{constructor(e,t,i){this.propertyChanged=new c.a;this._urlRootOfSourcemapFile=e;this._rawDoc=t;this._debuggerManager=i;this._sourceMapEnabled=x.a.Off;if(!W.ParseWorker){W.SourceMaps=[];W.ParseWorker=new Worker("../common/formatter/SourceMapParserWorker.js");W.ParseWorker.onmessage=(e=>{if(e.data&&e.data.id){const t=W.SourceMaps[e.data.id];t&&t.onWorkerMessage(e)}})}}static sourceScopeComparator(e,t){const i=e.endSegment.line-e.startSegment.line,n=t.endSegment.line-t.startSegment.line;if(i<n)return-1;if(i>n)return 1;const s=e.endSegment.column-e.startSegment.column,o=t.endSegment.column-t.startSegment.column;return s===o?0:s>o?1:-1}static generateMediaTypeMappings(e,t,i=[0]){if(!t||0===t.length||0===e)return[];for(let t=i.length,n=i[t-1];t<e;t++)i.push(n);return i.map(e=>t[e]?h.a.getCanonicalMediaType(t[e]):null)}get sourceMapState(){return this.isValid?this._sourceMapEnabled:x.a.Disabled}set sourceMapState(e){if(e!==this._sourceMapEnabled&&this._sourceMapEnabled!==x.a.Disabled&&(e===x.a.Disabled||!this._debuggerManager.documentController.isInSourceMapSwitch)){this._sourceMapEnabled=e;this.propertyChanged.invoke("sourceMapState");Object(N.g)().broadcast("onSourceMapStateChanged",{url:this._rawDoc.url.toString()})}}get isValid(){return this._sourcemapMappings&&this._sourcemapMappings.isValid&&this._sourcemapMappings.isValid()}get sources(){return this._sources}get sourceMapUrl(){return this._sourceMapUrl}getMediaType(e){const t=this._sources.indexOf(e);return this._sourceMediaTypes&&this._sourceMediaTypes[t]}loadSourceMapContent(e){w.b.logPerformance({id:f.b.Debugger_SourceMap_ParseSourceMapAsync_Start});let t;t=window.LiveUnit?this.loadSourceMapsLocally(e):this.loadSourceMapsOnWorkerThread(e);return Promise.all([t,this._rawDoc.getText()]).then(()=>{if(this.isValid){const e=this._sourceMapEnabled;this.sourceMapState=this._debuggerManager.persistenceManager.isSourceMapEnabled(this._rawDoc)?x.a.On:x.a.Off;e===this.sourceMapState&&this.propertyChanged.invoke("sourceMapState")}})}hasOriginalSourceLocation(e){return this._sourcemapMappings.hasOriginalPosition(e)}getOriginalSourceLocation(e){return this._sourcemapMappings.getOriginalPosition(e)}getGeneratedFileLocation(e){return this._sourcemapMappings.getGeneratedPosition(new L.a(e.line,e.column,e.file))}getGeneratedName(e,t){const i=this.findClosestScope(t);return i&&e in i.localsMap?i.localsMap[e]:e}containsLocalVariablesMapping(){return this._sourceScopes&&this._sourceScopes.length>0}getAuthoredName(e,t){const i=this.findClosestScope(t);if(i)for(const t in i.localsMap)if(i.localsMap[t]===e)return t;return e}loadFromUrl(e){if(this._rawDoc.rawDoc){s.a.failDebugOnly("Can't load a sourcemap for an authored doc");return m.a}if(e){this._sourceMapUrl=e;return this._debuggerManager.downloadUrl(e).then(t=>{if(t.success)return this.loadSourceMapContent(t.content);{const t=Object(T.b)("SourceMapNoMapFile",this._rawDoc.url.toString(),e);y.b.dispatch(Object(C.j)(this._rawDoc.url.toString(),t))}})}return m.a}onWorkerMessage(e){delete W.SourceMaps[this._rawDoc.frontendId];if(e.data){const t=e.data;if("number"!=typeof t.version||3!==t.version){if("number"!=typeof t.version){const e=Object(T.b)("SourceMapInvalidJSON",this._sourceMapUrl);y.b.dispatch(Object(C.j)(this._rawDoc.url.toString(),e))}else{const e=Object(T.b)("SourceMapInvalidVersion",this._sourceMapUrl,t.version);y.b.dispatch(Object(C.j)(this._rawDoc.url.toString(),e))}if(this._sourceMapProcessingCompleted){this._sourceMapProcessingCompleted();this._sourceMapProcessingCompleted=void 0}return}this._sourceScopes=t.sourceScopes;this._sourceScopes&&this._sourceScopes.length>1&&(this._sourceScopes=Array.prototype.sort.call(this._sourceScopes,W.sourceScopeComparator));const i=t.sourcemapMappings,n=t.urls;if(i&&i.length>0&&n&&n.length>0){this._sourcesContent=t.sourcesContent;this.onSourceMapLoadComplete(new A.a(i,n),t.sourceRoot,t.mediaTypes,t.sourceMediaTypes)}else{const e=Object(T.b)("SourceMapInvalidJSON",this._sourceMapUrl);y.b.dispatch(Object(C.j)(this._rawDoc.url.toString(),e))}}if(this._sourceMapProcessingCompleted){this._sourceMapProcessingCompleted();this._sourceMapProcessingCompleted=void 0}}onSourceMapLoadComplete(e,t,i,n){this._sourcemapMappings=e;const s=this.getAbsoluteSourceRootPath(t),o=[],r=new Map;for(let t=0;t<e.urls.length;t++){let i=e.urls[t];const n=this._sourcesContent&&this._sourcesContent[t];s&&(i=b.a.pathCombine(s,i));i=P.rewriteAuthoredSourceUrl(i);let a;r.has(i)&&(a=r.get(i));let l=0;do{let e=null;const s=this._rawDoc.instances[l];s&&(e=s.getParent());if(a){const s=new B.a({url:i,length:0,isDynamicCode:!1},{rawDoc:this._rawDoc,sourceIndex:t,sourceContent:n,parent:e},a,this._debuggerManager);a.instances.push(s)}else{const s=new K({id:void 0,url:i,length:0,isDynamicCode:!1},{rawDoc:this._rawDoc,sourceIndex:t,sourceContent:n,parent:e},this._debuggerManager);o.push(s);r.set(i,s);a=s}++l}while(l<this._rawDoc.instances.length)}this._sources=o;this._sourceMediaTypes=W.generateMediaTypeMappings(this._sources.length,i,n);for(const e of o)this._debuggerManager.documentController.documentAdded(e,!0);w.b.logPerformance({id:f.b.Debugger_SourceMap_ParseSourceMapAsync_Stop})}loadSourceMapsLocally(e){let t;if(t=F.a.parseMapContent(e)){if("number"!=typeof t.version||3!==t.version)return m.a;this._sourcesContent=t.sourcesContent||[];const e=F.a.calculateMappings(t);this.onSourceMapLoadComplete(new A.a(e,t.sources),t.sourceRoot,t.x_ms_mediaTypes,t.x_ms_sourceMediaTypes)}return m.a}loadSourceMapsOnWorkerThread(e){return new Promise(t=>{this._sourceMapProcessingCompleted=t;W.SourceMaps[this._rawDoc.frontendId]=this;W.ParseWorker.postMessage({content:e,id:this._rawDoc.frontendId})})}getAbsoluteSourceRootPath(e){const t=b.a.pathCombine(this._urlRootOfSourcemapFile,e);return b.a.addFileProtocolIfNeeded(t)}findClosestScope(e){if(this.containsLocalVariablesMapping()){const t=e.line,i=e.column;for(let e=0,n=this._sourceScopes.length;e<n;e++){const n=this._sourceScopes[e],s=n.startSegment.line<t||n.startSegment.line===t&&n.startSegment.column<=i,o=n.endSegment.line>t||n.endSegment.line===t&&n.endSegment.column>=i;if(s&&o)return n}}}}var j=i(169);i.d(t,"b",function(){return K});i.d(t,"a",function(){return U});class K{constructor(e,t={},i,n=!1){this.propertyChanged=new c.a;this.locationsInvalidated=new c.a;this.isBrokenFile=!1;this._frontendId=_.a.NextModelId++;this.instances=[];this._children=new Set;this.numOfIframesContained=0;this.mimeType=e.mimeType;const s=new B.a(e,t,this,i);this.instances.push(s);this._firstInstanceId=s.id;this._url=new E.a(e.sourceUrlOverride||e.url||"");this._isDynamicCode=t.rawDoc&&t.rawDoc.isDynamicCode||e.isDynamicCode;this._length=e.length||0;this._rawDoc=t.rawDoc;this._sourceIndex=t.sourceIndex;this._isRuntimeDocument="string"==typeof e.id&&e.id!==o.a;this._debuggerManager=i;this._documentController=i&&i.documentController;this._persistenceManager=i&&i.persistenceManager;this.checkForContentScript();this._formattingPromise=null;this._formattingPromiseVersion=0;this._fetchTextPromise=null;this._fetchTextPromiseVersion=0;this._getTextSubscribers=[];this._timerId=null;this._timerPromise=m.a;this._currentTextIsOutdated=!0;this._prettyPrintEnabled=!1;this._isEmpty=!1;t.sourceContent&&this.setUnformattedText(t.sourceContent,!1);this._isInitialized=Promise.resolve();!n&&e.sourceMapUrl&&(this._isInitialized=this.processSourceMap(e.sourceMapUrl));this._isLibraryFile=this.isLibraryFile;this._isRuntimeDocument||n||(this._isInitialized=this._isInitialized.then(()=>this.findAndProcessSourceMap()))}static createNonRuntimeDoc(e,t,i,n){return new K({isDynamicCode:!1,length:0,parentRuntimeId:n,url:e,mimeType:t},void 0,i)}static createNonRuntimeCssDoc(e,t,i=!1){const n={isDynamicCode:!1,length:0,mimeType:"text/css",url:e.url},s=new K(n,void 0,t,i);s._styleSheetInfo=e;return s}static initialize(){K.SourceMapFileDialogOptions={extensions:["map"],extensionsIndex:0,initialDirectory:"",name:"",title:""};K.SourceMapFileOptions={access:S.a.read,encoding:"UTF-8",mode:S.c.open,share:S.e.readWrite,type:S.f.text}}onToolBarDefined(e){Object(r.isEdpEnabled)()&&!Object(r.isEdpFeatureEnabled)("LibraryCode")&&(e.getNamedElement("jmcDocumentButton").style.display="none")}get rootInstance(){if(this.instances)return this.instances[0]}get firstRunTimeId(){if(this.rootInstance&&void 0!==this.rootInstance.runtimeId)return this.rootInstance.runtimeId}get firstInstanceId(){return this._firstInstanceId}get firstParent(){if(this.rootInstance)return this.rootInstance.getParent()}get hasParents(){for(const e of this.instances)if(e.getParent())return!0;return!1}get childDocInstances(){return this._children}get modelName(){return K.ModelName}get modelType(){return K.ModelType}get toolbarPanelTemplate(){return"Debugger.debuggerDocumentPanel"}get rawDoc(){return this._rawDoc}get sourceMap(){return this._sourceMap}set sourceMap(e){if(this._sourceMap!==e){const t=this.sourceMapState;this._sourceMap&&this._sourceMapChangeRegistration.unregister();this._sourceMap=e;this._sourceMap&&(this._sourceMapChangeRegistration=this._sourceMap.propertyChanged.addHandler(e=>{if("sourceMapState"===e){w.b.logPerformance({id:f.b.Debugger_SourceMap_ToggleSourceMap_Start});this.fireSourceMapStateChanged().then(()=>{w.b.logPerformance({id:f.b.Debugger_SourceMap_ToggleSourceMap_Stop})})}}));this.sourceMapState!==t&&this.fireSourceMapStateChanged()}}get isAuthored(){return!!this._rawDoc}get sourceMapState(){return this.rawDoc&&this.rawDoc.sourceMap?this.rawDoc.sourceMap.sourceMapState:!this.sourceMap||this.hasEdits?x.a.Disabled:this.sourceMap.sourceMapState}set sourceMapState(e){this.rawDoc?this.rawDoc.sourceMap.sourceMapState=e:this.sourceMap&&(this.sourceMap.sourceMapState=e)}get sourceMapEnabled(){return this.sourceMapState!==x.a.Off}updateSourcemapSources(e){this._sourceMap&&this._sourceMap.sources&&this._sourceMap.sources.forEach(t=>{for(const i of t.instances)i.updateParent(e)})}get url(){return this._url}set url(e){if(!E.a.equals(this._url,e)){this._url=e;this._monacoUrl=null;this._lastWorkspaceMapper=null;this.propertyChanged.invoke("url")}}get isDynamicCode(){return this._isDynamicCode}get editorState(){return this._editorState}set editorState(e){this._editorState=e}get isOpen(){return this._isOpen}get frontendId(){return this._frontendId}get libraryState(){return this._debuggerManager.jmcController.isJustMyCodeEnabled&&h.a.isJMCEnabledForMediaType(this.mimeType)?this.isLibraryFile?x.a.On:x.a.Off:x.a.Disabled}set libraryState(e){if(this._debuggerManager.jmcController.isJustMyCodeEnabled&&e!==x.a.Disabled){const t=e===x.a.On;this.setIsLibraryFile(t,n.c.Internal)}}get isLibraryFile(){if(!this.isDynamicCode&&this._debuggerManager){const e=this.rawDoc||this,t=this._debuggerManager.jmcController.getJMCTypeForUrl(e.url&&e.url.toString());return t!==k.a.UserCode&&t!==k.a.Unsure}return!1}get isRuntimeDoc(){return this._isRuntimeDocument}get canFormat(){return Boolean(this._formatter&&this._formatter.canFormat&&!this.isAuthored&&!this.isEditPending)}get prettyPrintState(){return this.canFormat?this._prettyPrintEnabled?x.a.On:x.a.Off:x.a.Disabled}set prettyPrintState(e){if(this.canFormat&&e!==this.prettyPrintState){if(e===x.a.On){this._prettyPrintEnabled=!0;this._formatter&&(this._formatter.options.prettyPrint=!0);this.doFormatting().then(()=>this._debuggerManager.testEventObject.fireEvent("prettyPrintToggleCompleted"))}else{this._prettyPrintEnabled=!1;this._formatter&&(this._formatter.options.prettyPrint=!1);this.updateCurrentTextMapping()}this.firePrettyPrintStateChanged();this.editorWindow.requestedIsWritable=this.isEditable;this.propertyChanged.invoke("isEditable")}}get prettyPrintEnabled(){return this._prettyPrintEnabled}get editorWindow(){return this._debuggerManager.debuggerShell.editorWindow}get hasText(){return!!this._unformattedTextMapping}get hasTextMapping(){return!!this._currentTextMapping}get isNormallyEditable(){return this.isEditSourceSupported&&!this.isAuthored&&h.a.isEditableMediaType(this.mimeType)&&("text/javascript"!==this.mimeType||this.isRuntimeDoc)}get isEditable(){return!(Object(r.isEdpEnabled)()&&!Object(r.isEdpFeatureEnabled)("EditOnIdle"))&&(this.isNormallyEditable&&!this._debuggerManager.executionController.isExecutionPaused&&this.isLastRevision)}get isEditSourceSupported(){return I.w}get hasEdits(){return this._isEditPending||!!this._previousRevision||!!this._nextRevision}get isEditPending(){return this._isEditPending}get isCommitPending(){return this._isCommitPending}get id(){return this.frontendId}get displayName(){return b.a.createShortenedUrlText(this.url)}get tooltip(){if(!this._url)return"";let e=this._url.toString();b.a.stringStartsWith(e,K.CONTENT_SCRIPT_PROTOCOL)&&(e=e.substr(K.CONTENT_SCRIPT_PROTOCOL.length));return e}get preventOpen(){return this.isContentScriptEngine}get previousRevision(){return this._previousRevision}get nextRevision(){return this._nextRevision}set nextRevision(e){this._nextRevision=e;e._previousRevision=this}get latestRevision(){return this._nextRevision?this._nextRevision.latestRevision:this}get originalRevision(){return this._previousRevision?this._previousRevision.originalRevision:this}get isLastRevision(){return!this._nextRevision}get canEditBreakpoints(){return this.isRuntimeDoc&&this.isLastRevision&&!this.isEditPending}get styleSheetInfo(){return this._styleSheetInfo}get persistenceKey(){return this.url.toString().toLowerCase()}get shouldBePersisted(){return!this.isDynamicCode}get persistedPropNames(){return["prettyPrintEnabled","sourceMapEnabled"]}set syntaxErrorInfo(e){this._syntaxErrorInfo=e}get syntaxErrorInfo(){return this._syntaxErrorInfo}get isContentScriptEngine(){return this._isContentScriptEngine}getMonacoUri(e){if(!e)throw new TypeError("Argument not optional: mapper.");if(this._monacoUrl&&this._lastWorkspaceMapper===e)return this._monacoUrl;this._monacoUrl=e.getWorkspaceUri(this._url,!0);this._lastWorkspaceMapper=e;return this._monacoUrl}setIsLibraryFile(e,t){const i=e?w.a.TOGGLE_LIBRARY_FILE_ON:w.a.TOGGLE_LIBRARY_FILE_OFF;return Object(w.c)(i,t,()=>{const t=this.rawDoc||this;if(!t.isDynamicCode&&t.isRuntimeDoc&&this._debuggerManager){const i=e?k.a.Library:k.a.UserCode;return this._debuggerManager.jmcController.setJMCTypeForUrl(t.url&&t.url.toString(),i).then(e=>{this.propertyChanged.invoke("libraryState");return e})}return Promise.resolve(!1)})}open(){if(!this._isOpen){this._isOpen=!0;this.propertyChanged.invoke("isOpen")}}close(){if(this.isOpen){this._isOpen=!1;this.propertyChanged.invoke("isOpen")}null!==this._timerId&&window.clearTimeout(this._timerId);if(this._timerPromise&&Object(g.a)(this._timerPromise)){this._timerPromise.cancel();this._timerPromise=null}if(this._formattingPromise){Object(g.a)(this._formattingPromise)&&this._formattingPromise.cancel();this._formattingPromiseVersion++;this._formattingPromise=null}if(this._fetchTextPromise){this._fetchTextPromiseVersion++;this._fetchTextPromise=null}this.completeGetText("");this.endEdit();if(this.isRuntimeDoc&&!this.isAuthored){this._formatter=void 0;this._currentTextIsOutdated=!0;this._ignoreExistingText=!0;if(!this.sourceMap){this._currentTextMapping=null;this._unformattedTextMapping=null}this.firePrettyPrintStateChanged()}}onMoreTextAvailable(e){if(e>this._length){this._currentTextIsOutdated=!0;this._fetchTextPromise=null;this._fetchTextPromiseVersion++;this._ignoreExistingText=!1;this._length=e;const t=this._currentTextMapping&&this._currentTextMapping.text&&this._currentTextMapping.text.length||0;this.onDocumentContentUpdated(t)}}rawPositionToRawOffset(e,t){return this._unformattedTextMapping?this._unformattedTextMapping.positionToOffset({line:e-1,column:t-1}):0}setUnformattedText(e,t,i){const n=this.prettyPrintState,s=this.createFormatterIfNecessary();this._isEmpty=""===e;return s.setDocument(e,this.url&&this.url.toString(),this.mimeType,t&&this.canFormat).then(()=>{this._length=e.length;this._currentTextIsOutdated=!1;this._ignoreExistingText=!1;this._fetchTextPromise=null;this._fetchTextPromiseVersion++;this._unformattedTextMapping=s&&s.sourceText;this.updateCurrentTextMapping();if(this._formattingPromise){Object(g.a)(this._formattingPromise)&&this._formattingPromise.cancel();this._formattingPromiseVersion++;this._formattingPromise=null}if(void 0!==i)this.prettyPrintState=i;else if(this._persistenceManager){const e=this._persistenceManager.isPrettyPrintEnabled(this);"boolean"==typeof e&&e&&(this.prettyPrintState=x.a.On)}if(this._prettyPrintEnabled){s.options.prettyPrint=!0;this.doFormatting()}this.prettyPrintState!==n&&this.firePrettyPrintStateChanged();return this._unformattedTextMapping?this._unformattedTextMapping.text:""})}appendUnformattedText(e){this.setUnformattedText(this._unformattedTextMapping?this._unformattedTextMapping.text+e:e)}makeRuntimeDocument(e,t,i=!1){this._isRuntimeDocument=!0;this.mimeType=e.mimeType;this._currentTextIsOutdated=!0;this._fetchTextPromise=null;this._fetchTextPromiseVersion++;this._ignoreExistingText=!0;i||this.loadSourceMapFromUrl(e.sourceMapUrl);this.rootInstance&&this.rootInstance.makeRuntimeDoc(e,t);this._prettyPrintEnabled&&this.getText()}makeStyleSheetDoc(e){this._styleSheetInfo=e}onDocumentContentUpdated(e,t){s.a.isTrue(this._isRuntimeDocument,"The requested document is not loaded in the current page");this._currentTextIsOutdated=!0;this._fetchTextPromise=null;this._fetchTextPromiseVersion++;return this.isOpen?this.queueCallback(()=>{this.getText()}):m.a}getText(){const e=new Promise(e=>{this._getTextSubscribers.push(e)}),t=e=>{e instanceof p.a||(this._currentTextMapping&&this._currentTextMapping.text?this.completeGetText(this._currentTextMapping.text):this._isEmpty?this.completeGetText(""):this.completeGetText(Object(T.b)("OpenFileFailed",this.url.toString())))},i=e=>{e instanceof p.a||this.completeGetText(Object(T.b)("OpenFileFailed",this.url.toString()))};this._currentTextIsOutdated||!this._currentTextMapping?this.fetchText(this._isRuntimeDocument&&this.isOpen).then(e=>{if(null===e)return Promise.reject(null);""!==e||this._emptyTimeoutId||(this._emptyTimeoutId=window.setTimeout(()=>{if(!this._currentTextMapping||""===this._currentTextMapping.text){this._isEmpty=!0;this._debuggerManager.documentController.documentTextOrMimeTypeUpdated(this,"",!1)}},K.EMPTY_TIMEOUT));return this.doFormatting()}).then(t).catch(i):this._formatter&&this._prettyPrintEnabled&&this._currentTextMapping!==this._formattedTextMapping?this.doFormatting().then(t,t):t();return e}hasSourceMapping(e){if(!this.sourceMap||this.sourceMapState!==x.a.On||!this._unformattedTextMapping)return!0;const t=this._unformattedTextMapping.offsetToPosition(e);return!t||this.sourceMap.hasOriginalSourceLocation(t)}getDisplayPosition(e,t=!0){let i,n;this._unformattedTextMapping&&(i=this._unformattedTextMapping.offsetToPosition(e));return t&&this.sourceMapState===x.a.On&&this.sourceMap&&i?{column:(n=this.sourceMap.getOriginalSourceLocation(i)).column+1,doc:this.sourceMap.sources[n.file],line:n.line+1}:this._currentTextMapping&&i?{doc:this,line:(n=this._currentTextMapping.getMappedPosition(i)).line+1,column:n.column+1}:void 0}getRawLocation(e,t){const i={column:e.column-1,file:this._sourceIndex||0,line:e.line-1};if(this.isAuthored&&this.rawDoc){const e=this.rawDoc.sourceMap.getGeneratedFileLocation(i);return this.rawDoc.getRawLocation({column:e.column+1,doc:this.rawDoc,line:e.line+1},!0)}if(this._unformattedTextMapping){let e;e=this._currentTextMapping&&!t?this._currentTextMapping.getOriginalPosition(i):i;return{doc:this,offset:this._unformattedTextMapping.positionToOffset(e),length:0}}return{doc:this,offset:0,length:0}}createDocumentLocation(e,t){const i=this.rawDoc||this,n=i.getDisplayPosition(e),s=i.getDisplayPosition(e+t),o={doc:i,offset:e,length:t};return n&&s?new R.a(n.doc,n.line,n.column,s.doc,s.line,s.column,o):new R.a(i,1,1,i,1,1,o)}getPathFromUrl(e){const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));if(t>=0)return e.substr(0,t+1);const i=this.firstParent;return i?i.getPathFromUrl(i.url&&i.url.toString()):""}getMimeTypeCandidates(){let e=[];const t=this.rawDoc&&this.rawDoc.sourceMap;if(t){const i=t.getMediaType(this);i&&e.unshift(i)}this.mimeType&&e.push(h.a.getCanonicalMediaType(this.mimeType));const i=this.url.getComponents(64,2);i&&e.push(h.a.getMediaTypeForFileExtension(i));e.push(this.isAuthored?"text/javascript":"text/plain");return e=h.a.getSortedMediaTypes(e)}loadSourceMapFromFileSystem(e){Object(w.c)(w.a.CHOOSE_SOURCE_MAP_FILE_LOCATION,e,()=>{s.a.isFalse(this.hasEdits);Object(v.a)().openFileDialog(K.SourceMapFileDialogOptions,K.SourceMapFileOptions).then(e=>{if(e){const t=I.l(e.streamId);this.loadSourceMapFromUrl(t);e.close()}},()=>{})})}sourceMapContainsLocalVariablesMapping(){const e=this.isAuthored&&this._rawDoc?this._rawDoc.sourceMap:this._sourceMap;return e&&e.containsLocalVariablesMapping()}getGeneratedIdentifierName(e){const t=this.getZeroBasedActiveFrameRawPosition();let i=e;if(t&&this.isAuthored&&this.rawDoc){const e=(i=i.trim()).indexOf(".");if(e>0){return this.rawDoc.sourceMap.getGeneratedName(i.substring(0,e),t)+i.substring(e)}return this.rawDoc.sourceMap.getGeneratedName(i,t)}return i}getAuthoredIdentifierName(e){const t=this.getZeroBasedActiveFrameRawPosition();let i=e;if(t&&this.isAuthored&&this.rawDoc){const e=(i=i.trim()).indexOf(".");if(e>0){return this.rawDoc.sourceMap.getAuthoredName(i.substring(0,e),t)+i.substring(e)}return this.rawDoc.sourceMap.getAuthoredName(i,t)}return i}isRevision(e){for(let t=this.latestRevision;t;t=t.previousRevision)if(t===e)return!0;return!1}beginEdit(){s.a.isTrue(this.isEditable,"Source is not valid for editing.");if(!this._isEditPending){const e=this.hasEdits;this._isEditPending=!0;this.sourceMapState=x.a.Disabled;this.firePrettyPrintStateChanged();this.propertyChanged.invoke("isEditPending");y.b.dispatch(Object(C.l)(this.url.raw,!0));e!==this.hasEdits&&this.propertyChanged.invoke("hasEdits")}}endEdit(){if(this.isEditPending){this._isEditPending=!1;this.propertyChanged.invoke("isEditPending");y.b.dispatch(Object(C.l)(this.url.raw,!1));this.firePrettyPrintStateChanged()}}beginCommit(){s.a.isTrue(this.isEditable,"Source is not valid for editing.");if(!this._isCommitPending){const e=this.hasEdits;this._isCommitPending=!0;this.sourceMapState=x.a.Disabled;this.propertyChanged.invoke("isCommitPending");e!==this.hasEdits&&this.propertyChanged.invoke("hasEdits")}}endCommit(e){s.a.isTrue(this.isEditable);s.a.areNotEqual(this,e);if(this._isCommitPending){const t=this.hasEdits;this._isCommitPending=!1;if(e){this.nextRevision=e;e.editorState=this.editorState;this.editorState=void 0;this.isOpen&&e.open()}this.propertyChanged.invoke("isCommitPending");if(e){this.propertyChanged.invoke("nextRevision");e.propertyChanged.invoke("previousRevision")}!t&&this.hasEdits&&this.propertyChanged.invoke("hasEdits")}}breakStateChanged(){this.propertyChanged.invoke("isEditable")}addSyntaxErrorLocation(e){this.syntaxErrorInfo={columnNumber:e.columnNumber,fileName:e.fileName,lineNumber:e.lineNumber,messageId:e.messageId,messageText:e.messageText}}onDiffButtonClick(){this._debuggerManager.docDiffHandler.openDiffForDoc(this);D.a.setAlertMessage(Object(T.b)("DocumentComparison"))}onPrettyPrintClickTelemetry(){this.prettyPrintState===x.a.On?w.b.logExecuteCommand(w.a.TOGGLE_PRETTY_PRINT_ON,n.c.Ui):this.prettyPrintState===x.a.Off&&w.b.logExecuteCommand(w.a.TOGGLE_PRETTY_PRINT_OFF,n.c.Ui)}onWordWrapClickTelemetry(){this._documentController.editorWindow.wordWrapEnabled===x.a.On?w.b.logExecuteCommand(w.a.TOGGLE_WORD_WRAP_ON,n.c.Ui):this._documentController.editorWindow.wordWrapEnabled===x.a.Off&&w.b.logExecuteCommand(w.a.TOGGLE_WORD_WRAP_OFF,n.c.Ui)}onJmcDocumentClickTelemetry(){w.b.logExecuteCommand(w.a.TOGGLE_LIBRARY_FILE,n.c.Ui)}onSourceMapClickTelemetry(){this.sourceMapState===x.a.On?w.b.logExecuteCommand(w.a.TOGGLE_SOURCE_MAPS_ON,n.c.Ui):this.prettyPrintState===x.a.Off&&w.b.logExecuteCommand(w.a.TOGGLE_SOURCE_MAPS_OFF,n.c.Ui)}addChildDocInstance(e){this._children.add(e)}removeChildDocInstance(e){this._children.delete(e)}canAddSourceMap(){const e=-1!==this.getMimeTypeCandidates().join(",").toLowerCase().indexOf("text/css");return!(this.isAuthored||this.isDynamicCode||this.hasEdits)&&(this.isRuntimeDoc||e)}completeGetText(e){const t=this._getTextSubscribers;this._getTextSubscribers=[];t.forEach(t=>{t(e)})}getZeroBasedActiveFrameRawPosition(){const e=this._debuggerManager.activeStackFrame?Object(O.g)(this._debuggerManager.activeStackFrame,this._debuggerManager.getDocFromStackFrame(this._debuggerManager.activeStackFrame)):null;if(e&&this.rawDoc&&e.startPosition&&this.id===e.startPosition.doc.id){const t={column:e.startColumn-1,file:this._sourceIndex||0,line:e.startLineNumber-1};return this.isAuthored?this.rawDoc.sourceMap.getGeneratedFileLocation(t):t}return null}createFormatterIfNecessary(){if(this._formatter)return this._formatter;{let e;e=d.a.supportsMimeType(this.mimeType)?new d.a:a.a.supportsMimeType(this.mimeType)?new a.a:new l.a;this._formatter=e;return e}}fireSourceMapStateChanged(){this.locationsInvalidated.invoke(!1);this.propertyChanged.invoke("sourceMapEnabled");return this.propertyChanged.invokeAsync("sourceMapState")}loadSourceMapFromUrl(e){if(e&&this._debuggerManager&&!this.hasEdits&&!this.isAuthored){let t,i=e;if(b.a.isDataURI(i)){t=i;i=this._url&&this._url.toString()}i=b.a.isAbsoluteUrl(i)?b.a.addFileProtocolIfNeeded(i):b.a.pathCombine(this.getPathFromUrl(this.url&&this.url.toString()),b.a.truncateProtocolFromUrl(i));const n=this.getPathFromUrl(i);this.sourceMap=new W(n,this,this._debuggerManager);return this.sourceMap.loadFromUrl(t||i)}return Promise.resolve()}findAndProcessSourceMap(){return this.getText().then(e=>{const t=Object(j.a)("sourceMappingURL",e);return this.processSourceMap(t)})}processSourceMap(e){let t=e;t&&(t=P.rewriteSourceMapUrl(t));return this.loadSourceMapFromUrl(t).then(()=>{if(this.rawDoc){this._isRuntimeDocument=this.rawDoc.isRuntimeDoc;this._sourceMapChangeRegistration||(this._sourceMapChangeRegistration=this.rawDoc.sourceMap&&this.rawDoc.sourceMap.propertyChanged.addHandler(e=>{"sourceMapState"===e&&this.fireSourceMapStateChanged()}))}})}fetchText(e){if(this._fetchTextPromise)return this._fetchTextPromise;{let t;this._fetchTextPromiseVersion++;const i=this._fetchTextPromiseVersion;if(0===this.instances.length)return Promise.resolve("");if(this.isRuntimeDoc&&!this.isAuthored&&this._debuggerManager){const n=this.prettyPrintState,s=this.createFormatterIfNecessary();if(this._persistenceManager){const e=this._persistenceManager.isPrettyPrintEnabled(this);"boolean"==typeof e&&e&&(this.prettyPrintState=x.a.On)}this.prettyPrintState!==n&&this.firePrettyPrintStateChanged();const o=!this._ignoreExistingText&&s.sourceText&&s.sourceText.text;let r;o&&(r=o.length);t=this._debuggerManager.getSourceText(this,r).then(t=>{if(i!==this._fetchTextPromiseVersion)return Promise.reject(new p.a);let n=t.text;o&&(n=o+(n||""));return null===n||t.loadFailed?Promise.resolve(""):this.setUnformattedText(n,e)})}else if(this.url&&this._debuggerManager){const e="res"===this.url.scheme?this.url.raw:this.url.toString();t=this._debuggerManager.downloadUrl(e,this.mimeType).then(e=>{if(i!==this._fetchTextPromiseVersion)return Promise.reject(new p.a);let t;if(e.success){this.url=E.a.tryParse(e.url);this.mimeType=e.mimeType?e.mimeType:this.getMimeTypeCandidates()[0];t=this.setUnformattedText(e.content)}else{if(!this.isAuthored||this.sourceMapState===x.a.Disabled){this.isBrokenFile=!0;return Promise.resolve(void 0)}{this.isBrokenFile=!0;const e=Object(T.b)("SourceMapNoAuthoredFile",this.url.toString(),this.rawDoc.sourceMap&&this.rawDoc.sourceMap.sourceMapUrl);y.b.dispatch(Object(C.j)(this.url.raw,e));this.sourceMapState=x.a.Disabled;t=Promise.resolve("")}}return t})}else t=Promise.resolve(this._unformattedTextMapping?this._unformattedTextMapping.text:null);this._fetchTextPromise=t;return t}}updateCurrentTextMapping(){const e=this._currentTextMapping;let t;if((t=this._formattedTextMapping&&this._formatter&&this._formatter.options.prettyPrint?this._formattedTextMapping:this._unformattedTextMapping)!==e){this._monacoUrl&&(this._lastWorkspaceMapper=null);this._currentTextMapping=t;this.locationsInvalidated.invoke(!e||!t||e.text!==t.text);this._debuggerManager.testEventObject.fireEvent("textMappingUpdated",this.frontendId)}}doFormatting(){if(!this._formattingPromise){if(!(this._formatter&&this.canFormat&&this._prettyPrintEnabled&&this._formatter.sourceText))return Promise.resolve();{w.b.logPerformance({id:f.b.Debugger_PrettyPrint_Start});this._formattingPromiseVersion++;const e=this._formattingPromiseVersion;this._formattingPromise=this._formatter.getFormattedText().then(t=>{if(e!==this._formattingPromiseVersion)return Promise.reject(new p.a);w.b.logPerformance({id:f.b.Debugger_PrettyPrint_Stop});this._formattedTextMapping=t})}}return this._formattingPromise.then(()=>{this.updateCurrentTextMapping()})}queueCallback(e){this._timerPromise&&Object(g.a)(this._timerPromise)&&this._timerPromise.cancel();this._timerPromise=u.a.timeout(50);this._timerPromise.then(()=>{e()});return this._timerPromise}firePrettyPrintStateChanged(){this.propertyChanged.invoke("prettyPrintEnabled");this.propertyChanged.invoke("prettyPrintState")}checkForContentScript(){const e=this._url.toString();if(e.startsWith(K.CONTENT_SCRIPT_URL_PREFIX)){const t=e.indexOf("-"),i=e.slice(t+2);this._url=new E.a(`${K.CONTENT_SCRIPT_PROTOCOL}${i}`);this._isContentScriptEngine=!0}else this.firstParent&&this.firstParent._isContentScriptEngine&&!e.startsWith(K.CONTENT_SCRIPT_PROTOCOL)&&(this._url=new E.a(`${this.firstParent._url.toString()}/${e}`))}}K.CONTENT_SCRIPT_PROTOCOL="ms-browser-extension://";K.CONTENT_SCRIPT_URL_PREFIX="$CSE$";K.ModelName="doc";K.ModelType="Doc";K.EMPTY_TIMEOUT=3e3;class U extends K{constructor(e,t,i){super({isDynamicCode:!1,length:0,mimeType:e.mimeType},{},i,!0);this._nextRevision=e;this._displayName=e.displayName;this.editorState=new M.a;this.editorState.model=monaco.editor.createModel(t,e.mimeType);this.setUnformattedText(t,!0)}get displayName(){return this._displayName}get shouldBePersisted(){return!1}get modelType(){return U.ModelType}}U.ModelType="PreviewDoc";K.initialize()},73:function(e,t,i){"use strict";var n=i(22),s=i(0),o=i(122);class r{constructor(){this.watchIcon="";this.watchName="watch-watchName";this.watchValue=""}get nameEditable(){return this.watchName.indexOf(r.GRID_CELL_EDITABLE)>=0}set nameEditable(e){this.setCSSClass(r.WATCH_NAME_PROPERTY,e,r.GRID_CELL_EDITABLE)}get nameAsMixedCellHTML(){return this.watchName.indexOf(r.GRID_MIXED_CELL_HTML)>=0}set nameAsMixedCellHTML(e){this.setCSSClass(r.WATCH_NAME_PROPERTY,e,r.GRID_MIXED_CELL_HTML)}get valueEditable(){return this.watchValue.indexOf(r.GRID_CELL_EDITABLE)>=0}set valueEditable(e){this.setCSSClass(r.WATCH_VALUE_PROPERTY,e,r.GRID_CELL_EDITABLE)}get valueChanged(){return this.watchValue.indexOf(r.WATCH_VALUE_CHANGED)>=0}set valueChanged(e){e&&!this.invalid?this.setCSSClass(r.WATCH_VALUE_PROPERTY,!0,r.WATCH_VALUE_CHANGED):e||this.setCSSClass(r.WATCH_VALUE_PROPERTY,!1,r.WATCH_VALUE_CHANGED)}get invalid(){return this.watchValue.indexOf(r.WATCH_ERROR)>=0}set invalid(e){this.setCSSClass(r.WATCH_VALUE_PROPERTY,e,r.WATCH_ERROR);e&&(this.watchValue=this.watchValue.replace(r.WATCH_VALUE_CHANGED,""))}setCSSClass(e,t,i){t&&-1===this[e].indexOf(i)?this[e]+=" "+i:t||(this[e]=this[e].replace(i,""))}}r.WATCH_NAME_PROPERTY="watchName";r.WATCH_VALUE_PROPERTY="watchValue";r.GRID_CELL_EDITABLE="grid-cell-editable";r.GRID_MIXED_CELL_HTML="grid-mixed-cell-html";r.WATCH_ERROR="watch-Error";r.WATCH_VALUE_CHANGED="watch-ValueChanged";i.d(t,"a",function(){return a});class a{constructor(e,t,i,n){this._name=t;this._typeClass="";this._store=i;this._isExpandable=!1;this.uid=e;this.fullName=t;this.watchItemCSS=new r;this.containsExpression=!1;this.isPlaceholder=!1;this.parentWatch=n;this.local=!1;this.watchState=a.COLLAPSED;this.evalStatus=0;this.watchItemCSS.valueEditable=!0}set watchName(e){this._name=e}get watchName(){return this._name}set displayName(e){this._displayName=e}get displayName(){return this._displayName||this._name}get displayValue(){return this.getDisplayValue()}get watchIcon(){return this.isUserWatch?'<div role="button" class = "deleteWatch" data-plugin-vs-tooltip=\''+Object(s.b)("DeleteWatchTooltip")+"'></div>":""}get typeClass(){return""===this._type?"":this._typeClass}get isUserWatch(){return this.containsExpression&&!(this.parentWatch&&this.parentWatch.watchName===a.WATCH_LABEL&&"this"===this.watchName)}get watchValue(){return this._value}set watchValue(e){if(void 0!==e){let t=e;this._type&&"string"===this._type.toLowerCase()&&e.length>=2&&!Object(n.isEdpEnabled)()&&(t=e.substring(1,e.length-1));this._value=t.replace(/[\r\n\s]+/g," ").trim()}}get watchType(){return this._type}set watchType(e){this._type=e;e&&-1!==e.toLowerCase().indexOf("function")?this._typeClass="functionItem":this._typeClass="notAFunctionItem"}get isInvalid(){return this._invalid}set isInvalid(e){this._invalid=e;this.watchItemCSS.invalid=e}get isExpandable(){return this._isExpandable}set isExpandable(e){this._isExpandable=e;if(this._isExpandable){this._children=[];const e=new a(this.uid+a.PLACEHOLDER_WATCHITEM_SUFFIX,"",this._store,this);e.isPlaceholder=!0;e.rootIndex=this.rootIndex;this._children.push(e)}else this._children=void 0}get readOnly(){return this._readOnly}set readOnly(e){this._readOnly=e;this.watchItemCSS.valueEditable=!this._readOnly}get fake(){return this._fake}set fake(e){this._fake=e}get customProperty(){return this._customProperty}set customProperty(e){this._customProperty=e;this._customProperty.rootIndex=this.rootIndex}getExpandState(){return this.watchState*(this.getDescendantsCount()-1)}getChildren(e){return 0===e&&this._children&&-1===this._children[0].uid.indexOf(a.PLACEHOLDER_WATCHITEM_SUFFIX)?Promise.resolve(this._children):1===e&&!this.hasAdditionalChildren&&this._children&&this._children.length>o.a.MINIMAL_PROPERTIES_COUNT?Promise.resolve(this._children.splice(o.a.MINIMAL_PROPERTIES_COUNT)):2===e&&this._children&&this._children.length>1?Promise.resolve(this._children):this._store.getChildProperties(this,e).then(t=>{if(this.hasAdditionalChildren){this._children=t;const e=Object(s.b)("WatchesShowAllItems"),i=new a(this.uid+a.SHOWALL_WATCHITEM_SUFFIX,"<div class='showAll' data-plugin-vs-tooltip='"+e+"'>"+e+"</div>",this._store,this);i.watchItemCSS.nameAsMixedCellHTML=!0;this._children.push(i)}else{if(this._children&&1===e){this._children.splice(this._children.length-1,1);this._children=this._children.concat(t);return Promise.resolve(t)}this._children=t}this._customProperty&&this._children.unshift(this._customProperty);return Promise.resolve(this._children)})}getDescendantsCount(){let e=0;if(this._children)for(const t of this._children)e+=t.getDescendantsCount();return 1+e}getDescendants(e=[]){e.push(this);if(this._children)for(const t of this._children)t.getDescendants(e);return e}getNonFakeChildren(){let e=[];const t=[];if(this.hasAdditionalChildren){const i=this.getChildren(1).then(()=>this.getNonFakeChildren()).then(t=>{e=e.concat(t);return Promise.resolve(e)});t.push(i)}else if(this.isExpandable&&this._children&&this._children.length>0&&-1!==this._children[0].uid.indexOf(a.PLACEHOLDER_WATCHITEM_SUFFIX)){const i=this.getChildren(2).then(()=>this.getNonFakeChildren()).then(t=>{e=e.concat(t);return Promise.resolve(e)});t.push(i)}else if(this._children)for(const i of this._children)if(i.fake||i.isReturnValue){if(i.fake&&i.isExpandable&&!i.isReturnValue){const n=i.getNonFakeChildren().then(t=>{e=e.concat(t);return Promise.resolve(e)});t.push(n)}}else e.push(i);return Promise.all(t).then(()=>Promise.resolve(e))}getDisplayValue(){return"{...}"===this._value||"[...]"===this._value?this._type?"Object,"===this._type.substr(0,7)?"[object"+this._type.substr(7)+"]":"[Object,"===this._type.substr(0,8)?"[object"+this._type.substring(8,this._type.length-1)+"]":"Object"===this._type?"[object]":"[object "+this._type+"]":"":"Anonymous function"===this._value?"[Anonymous function]":this._value||""}getCopyString(){return this.watchName+"\t"+(this.displayValue||"")}reset(){this._value=void 0;this._type=void 0;this._children=void 0;this.isExpandable=!1;this.watchState=a.COLLAPSED;this.evalStatus=0;this.hasAdditionalChildren=void 0}clearChildren(){this._children=void 0;this.isExpandable=!1;this.hasAdditionalChildren=void 0}}a.EXPANDED=1;a.COLLAPSED=-1;a.SHOWALL_WATCHITEM_SUFFIX="-showAll";a.PLACEHOLDER_WATCHITEM_SUFFIX="-placeholder";a.RETURN_VALUE_CLASS_NAME="returnValue";a.WATCH_LABEL="[Locals]"},77:function(e,t,i){"use strict";i.d(t,"a",function(){return d});var n=i(4),s=i(64),o=i(12),r=i(0),a=i(89),l=i(121);class d{constructor(e,t,i,s,o,d){this._breakpointId=e;this.isEnabled=!0;this.isTracepoint=!1;this.isBound=d;this.condition="";const c=!(s||o||!i),h=!(!s||!o||i);n.a.isTrue(c||h);this._rawLocation=t;this._url=o;this._eventTypes=i;i?this._location=void 0:s&&(this._location=new a.a(s.rawLocation,s));if(i)if(this.isXHR())this._eventTypesText=Object(r.b)("XHRBreakpointDescription");else if(this._eventTypes){let e="";for(let t=0;t<this._eventTypes.length;t++){e+=l.a.getStringForEventBreakpointType(this._eventTypes[t]);t<this._eventTypes.length-1&&(e+=" ")}this._eventTypesText=Object(r.b)(1===this._eventTypes.length?"EventBreakpointSingleGroup":"EventBreakpointMultiGroup",e)}}static isUnresolvedId(e){return e.indexOf(":unresolved:")>=0}get breakpointId(){return this._breakpointId}get rawLocation(){return this._rawLocation}get eventTypes(){return this._eventTypes}get location(){return this._location}set location(e){this._location&&this._location.cleanup();this._location=e}get url(){return this._url}get tooltipText(){return this._eventTypes?this._eventTypesText:this.url?this.url:""}get isFrozen(){return!!(this.location&&this.location.startPosition&&this.location.startPosition.doc&&this.location.startPosition.doc.isEditPending)}equals(e){return this._breakpointId===e.breakpointId}toString(e=!1){if(this._eventTypes)return this._eventTypesText;{let t=this._url,i="";if(this.location&&this.location.startPosition){t=this.location.startPosition.doc.url.toString();i=" ("+this.location.startPosition.line+", "+this.location.startPosition.column+")"}let n=o.a.createShortenedUrlText(t||"");e&&(n+=" : "+s.a.escapeHtml(t));return n+i}}getGlyphClassName(){let e="breakpointGlyph ";this._eventTypes?this.isTracepoint?e+="eventTracepointImg":this.isXHR()?e+="eventXHRBreakpointImg":this.condition?e+="eventBreakpointConditionalImg":e+="eventBreakpointImg":this.isTracepoint?e+="tracepointimg":this.condition?e+="conditionalimg":e+="breakpointimg";return e}resolveTo(e){this._location&&this._location.cleanup();this._breakpointId=e.breakpointId;this.isBound=e.isBound;this._location=e.location;this._rawLocation=e.rawLocation}isXHR(){return Boolean(this.eventTypes&&-1!==this.eventTypes.indexOf(d.XHR_BREAKPOINT_FLAG))}cleanUp(){this._location&&this._location.cleanup();this._location=void 0;this._rawLocation=void 0}}d.XHR_BREAKPOINT_CONDITION='arguments[0].target.toString() === "[object XMLHttpRequest]" && arguments[0].target.readyState === 4';d.XHR_BREAKPOINT_FLAG="XmlHttpRequest response"},82:function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(114);class s{static setAlertMessage(e){if(!s.announcer){const e=document.getElementById(s.ARIA_ALERT_ZONE_ID);e&&(s.announcer=new n.a(e))}s.announcer&&s.announcer.setAlertMessage(e)}}s.ARIA_ALERT_ZONE_ID="debuggerAriaAlertZone"},87:function(e,t,i){"use strict";var n=i(0),s=i(73);class o{constructor(e,t,i,n){this.fullName=e;this.watchValue=i;this.propertiesRange=n||null===n?0:2;this.watchState=t}}i.d(t,"a",function(){return r});class r{constructor(e){this._store=[];this._watchesStateInfo=[];this._watchController=e;this._watchId=0;if(!this._watchController.isDataTip){this.localsExpando=new s.a(r.LOCALS_EXPANDO_ID,s.a.WATCH_LABEL,this);this.localsExpando.local=!0;this.localsExpando.fake=!0;this.localsExpando.readOnly=!0;this.localsExpando.isExpandable=!0;this.localsExpando.fullName=this.localsExpando.watchName;this.localsExpando.rootIndex=0;this.localsExpando.evalStatus=3;this.thisWatch=new s.a(r.LOCALS_EXPANDO_ID+"-this","this",this,this.localsExpando);this.thisWatch.containsExpression=!0;this.localsExpando.customProperty=this.thisWatch;this._store.push(this.localsExpando);this.addWatchPlaceholder=new s.a(r.ADD_WATCH_PLACEHOLDER,Object(n.b)("AddToWatchesWindowLink"),this);this.addWatchPlaceholder.watchItemCSS.nameEditable=!0;this.addWatchPlaceholder.fake=!0;this.addWatchPlaceholder.readOnly=!0;this._store.push(this.addWatchPlaceholder)}}addWatch(e,t){const i=new s.a(this.getUid(),e,this);i.displayName=t;i.containsExpression=!0;this._watchController.isDataTip||(i.watchItemCSS.nameEditable=!0);if(this._watchController.isDataTip){i.rootIndex=this._store.length;this._store.push(i)}else{i.rootIndex=this._store.length-1;this._store.splice(this._store.length-1,0,i)}return i}editWatch(e,t){let i=this.findWatchWithUid(e);if(!this._watchController.isDataTip&&i){if(i.uid===r.ADD_WATCH_PLACEHOLDER){this.addWatch(t);return!0}{const e=this.getIndexOfTopLevelWatch(i.uid);if(e>0&&(i=this._store[e]).isUserWatch){i.reset();i.watchName=t;i.watchItemCSS.nameEditable=!0}}this.isWatchesEvaluationEnabled||this._watchController.refreshView()}return!1}deleteWatch(e){const t=this.findWatchWithUid(e);if(t&&t.uid!==r.ADD_WATCH_PLACEHOLDER){const e=this.getIndexOfTopLevelWatch(t.uid);if(e>=0){this._store.splice(e,1);this._watchController.refreshView();this.isWatchesEvaluationEnabled&&t.isUserWatch&&this._watchesStateInfo&&this._watchesStateInfo[e]&&this._watchesStateInfo[e].hasOwnProperty(t.fullName)&&this._watchesStateInfo.splice(e,1)}}}deleteAnyExceptionWatch(){const e=this._store[r.EXCEPTION_WATCHITEM_INDEX];this.isExceptionWatchItem(e)&&this.deleteWatch(e.uid)}insertWatchItemAtIndex(e,t){if(this._store&&t>=0&&t<this._store.length){e.rootIndex=t;this._store.splice(t,0,e)}}deleteAll(){this._store=this._store.filter(e=>!e.isUserWatch);this._watchController.refreshView()}getExpandStates(){const e=[],t=this.getWatches();for(const i of t)this.isWatchesEvaluationEnabled||this._watchController.isDataTip?e.push(i.getExpandState()):e.push(0);return e}getWatches(){let e=[];for(const t of this._store)if(this.isWatchesEvaluationEnabled||this._watchController.isDataTip)e=e.concat(t.getDescendants());else{const i=t;if(i.isUserWatch){const t=new s.a(i.uid,i.watchName,this);t.containsExpression=!0;t.watchValue=Object(n.b)("NotAvailableMessage");t.readOnly=!0;t.watchItemCSS.nameEditable=!0;e.push(t)}else i.uid===r.ADD_WATCH_PLACEHOLDER&&e.push(i)}return e}findWatchWithUid(e){const t=this.getWatches();if(t)for(const i of t)if(i.uid===e)return i}getChildProperties(e,t){return this._watchController.getChildProperties(e,t)}updateWatchWithPropInfo(e,t){e.evalStatus=2;if(t.propertyId!==r.ERROR_PROPID){e.uid=t.propertyId;e.watchType=t.type;e.watchValue=t.value;e.fullName=t.fullName;e.isInvalid=t.invalid;e.isExpandable=t.expandable;e.fake=t.fake;e.readOnly=t.readOnly;e.isReturnValue=t.returnValue;return!0}return!1}storeExceptionWatchState(){if(!this._store[r.EXCEPTION_WATCHITEM_INDEX])return;const e=this._store[r.EXCEPTION_WATCHITEM_INDEX].getDescendants();this._exceptionWatchState={};for(const t of e)t.fullName&&(this._exceptionWatchState[t.fullName]=new o(t.fullName,t.watchState,t.watchValue,t.hasAdditionalChildren))}storeWatchStates(){const e=this._watchesStateInfo;this._watchesStateInfo=[];for(let t=0;t<this._store.length;t++)if(3===this._store[t].evalStatus){const e=this._store[t].getDescendants();this._store[t].rootIndex=t;const i={};for(const t of e){const e=this.getExpandStateInformationKey(t);e&&(i[e]=new o(e,t.watchState,t.watchValue,t.hasAdditionalChildren))}this._watchesStateInfo[t]=i}else this._watchesStateInfo[t]=e[t]}restoreWatch(e,t){const i=this.getExpandStateInformationKey(e);if(e&&i&&e.uid!==r.ERROR_PROPID){let n=this._watchesStateInfo[e.rootIndex];0===i.indexOf(r.EXCEPTION_WATCHITEM_PREFIX)&&e.rootIndex===r.EXCEPTION_WATCHITEM_INDEX&&(n=this._exceptionWatchState);if(n){const o=n[i];if(o){e.watchValue!==o.watchValue?e.watchItemCSS.valueChanged=!0:e.watchItemCSS.valueChanged=!1;if(o.watchState===s.a.EXPANDED&&e.isExpandable||t){if(t){e.clearChildren();e.isExpandable=!0}return e.getChildren(o.propertiesRange).then(t=>{e.watchState=o.watchState;e.evalStatus=3;return Promise.resolve(t.length)})}}}}e.evalStatus=3;return Promise.resolve(0)}markAllWatchesStale(){for(const e of this._store)e.evalStatus=0;this.thisWatch&&(this.thisWatch.evalStatus=0)}reset(e=!0){if(this._watchController.isDataTip){this.storeWatchStates();for(const e of this._store)e.reset()}else{0===this._watchesStateInfo.length&&this.localsExpando&&(this.localsExpando.watchState=s.a.EXPANDED);if(this._store.length>=r.EXCEPTION_WATCHITEM_INDEX+1&&this.isExceptionWatchItem(this._store[r.EXCEPTION_WATCHITEM_INDEX])){this._store.splice(r.EXCEPTION_WATCHITEM_INDEX,1);e&&(this._exceptionWatchState=void 0)}this.storeWatchStates();for(const e of this._store)e.reset();this.thisWatch&&this.thisWatch.reset();this.localsExpando&&(this.localsExpando.isExpandable=!0)}}hasUserWatches(){if(this._watchController.isDataTip)return this._store.length>0;for(const e of this._store)if(e.isUserWatch)return!0;return!1}isExceptionWatchItem(e){return e&&e.parentWatch===this.localsExpando&&e.watchName.toLowerCase()===r.EXCEPTION_WATCHITEM_PREFIX}getUid(){return""+this._watchId++}getIndexOfTopLevelWatch(e){for(let t=0;t<this._store.length;t++)if(this._store[t].uid===e)return t;return-1}getExpandStateInformationKey(e){let t=e,i=t.fullName||"";if(!i){for(;t.parentWatch;){i="."+t.watchName+i;t=t.parentWatch}i=t.watchName+i}return i}}r.EXCEPTION_WATCHITEM_INDEX=0;r.LOCALS_EXPANDO_ID="locals";r.ADD_WATCH_PLACEHOLDER="addWatch";r.EXCEPTION_WATCHITEM_PREFIX="{exception}";r.ERROR_PROPID="ERROR"},89:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(4),s=i(15),o=i(48);class r{constructor(e,t,i=!1){this.propertyChanged=new s.a;this.changesCompleted=new s.a;this._rawLocation=e;this._fallbackLocation=t;this._preferFallback=i;if(e.doc){this._displayPositionStart=this._rawLocation.doc.getDisplayPosition(this._rawLocation.offset);this._displayPositionEnd=this._rawLocation.doc.getDisplayPosition(this._rawLocation.offset+this._rawLocation.length);this._rawDocLocationsInvalidatedRegistration=this._rawLocation.doc.locationsInvalidated.addHandler(()=>this.onRawDocumentLocationsInvalidated())}if(t)if(i){this._displayPositionStart=t.startPosition||this._displayPositionStart;this._displayPositionEnd=t.endPosition||this._displayPositionEnd}else{this._displayPositionStart=this._displayPositionStart||t.startPosition;this._displayPositionEnd=this._displayPositionEnd||t.endPosition}}get rawLocation(){return this._rawLocation}get startPosition(){return this._displayPositionStart}get startDisplayText(){return o.a.getPositionDisplayText(this._displayPositionStart)}get endPosition(){return this._displayPositionEnd}get endDisplayText(){return o.a.getPositionDisplayText(this._displayPositionEnd)}get lineNumber(){const e=this.startPosition;return e?e.line:1}get column(){const e=this.startPosition;return e?e.column:1}get startLineNumber(){return this.lineNumber}get startColumn(){return this.column}get endLineNumber(){const e=this.endPosition;return e?e.line:1}get endColumn(){const e=this.endPosition;return e?e.column:1}copy(){return new r(this._rawLocation,this._fallbackLocation,this._preferFallback)}cleanup(){if(this._rawDocLocationsInvalidatedRegistration){this._rawDocLocationsInvalidatedRegistration.unregister();this._rawDocLocationsInvalidatedRegistration=void 0}if(this._displayDocPropertyChangeRegistrationStart){this._displayDocPropertyChangeRegistrationStart.unregister();this._displayDocPropertyChangeRegistrationStart=void 0}if(this._displayDocPropertyChangeRegistrationEnd){this._displayDocPropertyChangeRegistrationEnd.unregister();this._displayDocPropertyChangeRegistrationEnd=void 0}this._displayPositionStart=void 0;this._displayPositionEnd=void 0}onRawDocumentLocationsInvalidated(){this.updateDisplayPosition("start",this.rawLocation.offset,e=>this.onDisplayDocumentPropertyChanged(e,0));this.updateDisplayPosition("end",this.rawLocation.offset+this.rawLocation.length,e=>this.onDisplayDocumentPropertyChanged(e,1));this.changesCompleted.invoke()}updateDisplayPosition(e,t,i){const n="start"===e?this._displayPositionStart:this._displayPositionEnd;let s=this.rawLocation.doc.getDisplayPosition(t);this._preferFallback&&this._fallbackLocation&&this._fallbackLocation.startPosition&&s&&s.doc&&s.doc.frontendId===this._fallbackLocation.startPosition.doc.frontendId&&(s="start"===e?this._fallbackLocation.startPosition:this._fallbackLocation.endPosition);s&&"end"===e&&this._displayPositionStart&&this._displayPositionEnd&&this.arePositionsEqual(this._displayPositionStart,s)&&(s.column+=this.rawLocation.length);if(n&&s&&!this.arePositionsEqual(n,s)){if("start"===e){if(this._displayDocPropertyChangeRegistrationStart){this._displayDocPropertyChangeRegistrationStart.unregister();this._displayDocPropertyChangeRegistrationStart=void 0}s.doc&&(this._displayDocPropertyChangeRegistrationStart=s.doc.propertyChanged.addHandler(i));this._displayPositionStart=s}else{if(this._displayDocPropertyChangeRegistrationEnd){this._displayDocPropertyChangeRegistrationEnd.unregister();this._displayDocPropertyChangeRegistrationEnd=void 0}s.doc&&(this._displayDocPropertyChangeRegistrationEnd=s.doc.propertyChanged.addHandler(i));this._displayPositionEnd=s}if("start"===e){this.propertyChanged.invoke("startDisplayPosition");this.propertyChanged.invoke("startDisplayText")}else{this.propertyChanged.invoke("endDisplayPosition");this.propertyChanged.invoke("endDisplayText")}}}onDisplayDocumentPropertyChanged(e,t){"url"===e&&(0===t?this.propertyChanged.invoke("startDisplayText"):1===t?this.propertyChanged.invoke("endDisplayText"):n.a.fail("onDisplayDocumentPropertyChanged prefix must be 'start' or 'end'."))}arePositionsEqual(e,t){return!e&&!t||!(!e||!t)&&(e.doc===t.doc&&e.line===t.line&&e.column===t.column)}}}});
