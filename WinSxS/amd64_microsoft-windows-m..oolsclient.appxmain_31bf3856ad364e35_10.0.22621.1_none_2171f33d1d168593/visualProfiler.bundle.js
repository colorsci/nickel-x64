!function(e){function t(t){for(var s,r,o=t[0],l=t[1],h=t[2],c=0,u=[];c<o.length;c++){r=o[c];n[r]&&u.push(n[r][0]);n[r]=0}for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);for(;u.length;)u.shift()();a.push.apply(a,h||[]);return i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],s=!0,o=1;o<i.length;o++){var l=i[o];0!==n[l]&&(s=!1)}if(s){a.splice(t--,1);e=r(r.s=i[0])}}return e}var s={},n={5:0},a=[];function r(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};e[t].call(i.exports,i,i.exports,r);i.l=!0;return i.exports}r.m=e;r.c=s;r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})};r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t;o=o.slice();for(var h=0;h<o.length;h++)t(o[h]);var d=l;a.push([204,4]);i()}({204:function(e,t,i){"use strict";i.r(t);var s=i(70),n=i(84),a=i(131),r=i(34),o=i(0);class l{static getFilteredResult(e,t,i,s,n){var a={timeDomain:s,customDomain:{CounterId:i}};if(n)for(var r in n)n.hasOwnProperty(r)&&(a.customDomain[r]=n[r]);return e.getFilteredData(a,t)}}class h{constructor(e){this._graphResources=e}getString(e,...t){if(this._graphResources){var i=this._graphResources[e];if(void 0!==i)return i=h.format(e,i,t)}try{return o.b.apply(this,arguments)}catch(e){}return e}static format(e,t,i){return t.replace(h.FORMAT_REG_EXP,(t,s)=>{var n;switch(t){case"{{":n="{";break;case"}}":n="}";break;case"{":case"}":throw new Error(Object(o.a)("JSPlugin.3002"));default:var a=parseInt(s);if(!(i&&a<i.length))throw new Error(Object(o.a)("JSPlugin.3003")+" (resourceId = "+e+")");n=i[a]}void 0!==n&&null!==n||(n="");return n})}}h.FORMAT_REG_EXP=/\{{2}|\{(\d+)\}|\}{2}|\{|\}/g;var d=i(20);class c{constructor(e){this._data=[];this._dataSeriesInfo={};this._maximumYValue=Number.NEGATIVE_INFINITY;this.viewModel=[];this._options=e;this.validateOptions();this._pixelHorizontalValue=Math.floor(this.xWidth/this._options.width)}get maximumYValue(){return this._maximumYValue}get xWidth(){return this._options.maxX-this._options.minX}addData(e){e.forEach(e=>{if(!this._dataSeriesInfo.hasOwnProperty(e.series))throw new Error(Object(o.a)("JSPerf.1043"));this._data.push(e)});this.generateViewModel()}addSeries(e){for(var t=0;t<e.length;t++){var i=e[t];if(this._dataSeriesInfo.hasOwnProperty(i.name))throw new Error(Object(o.a)("JSPerf.1045"));this._dataSeriesInfo[i.name]=i}}getViewOptions(){return{ariaDescription:this._options.ariaDescription,ariaLabelCallback:this._options.ariaLabelCallback,height:this._options.height,width:this._options.width,tooltipCallback:this._options.tooltipCallback,legendData:this._dataSeriesInfo}}determineYAxisScale(e){for(var t=0;t<e.length;t++){for(var i=0,s=e[t].chartItems,n=0;n<s.length;n++){var a=s[n];a.height>0&&(i+=a.height)}this._maximumYValue=Math.max(this._maximumYValue,i)}this._maximumYValue=Math.floor(Math.max(this._options.minYHeight,this._maximumYValue));var r=this._options.height-c.YAXIS_PIXEL_PADDING;r<=0&&(r=this._options.height);var o=100*Math.floor(this._maximumYValue/100),l=o/r;if((o=this._options.height*l)<this._maximumYValue){l=(o=100*Math.ceil(this._maximumYValue/100))/r;o=this._options.height*l}this._pixelVerticalValue=l;this._maximumYValue=o}generateViewModel(){for(var e=[],t=this._options.barWidth+this._options.barGap,i=this._options.minX+t*this._pixelHorizontalValue,s={x:0,chartItems:[]},n=Math.floor(i),a=0;a<this._data.length&&this._data[a].x<=this._options.maxX;a++){var r=this._data[a];if(a>0&&r.x<this._data[a-1].x)throw new Error(Object(o.a)("JSPerf.1046"));if(!(r.x<this._options.minX)){if(r.x>=n){e.push(s);s={x:s.x,chartItems:[]};for(;r.x>=n;){s.x+=t;n=Math.floor(i+s.x*this._pixelHorizontalValue)}}s.chartItems.push(r)}}e.push(s);this.determineYAxisScale(e);for(a=0;a<e.length;a++)this.generateViewModelForSingleStack(e[a])}generateViewModelForSingleStack(e){var t=e.chartItems;if(t&&0!==t.length){t.sort(this.sortBySeries.bind(this));for(var i=0,s=!1,n=null,a=t.length-1;a>=0;a--){var r=t[a];if(!(r.height<=0)){var o=Math.round(r.height/this._pixelVerticalValue);r.height>0&&0===o&&(o=1);var l=this._options.height-i-o;if(l<0){o=this._options.height-i;l=0;s=!0}i+=o;if(this._options.showStackGap&&a!==t.length-1)if(o>1)o-=1;else if(n&&n.height>1){n.height-=1;n.y+=1}n={x:e.x,y:l,height:o,width:this._options.barWidth,className:this._dataSeriesInfo[r.series].cssClass,chartItem:r};this.viewModel.push(n);if(s)break}}}}sortBySeries(e,t){return this._dataSeriesInfo[t.series].sortOrder-this._dataSeriesInfo[e.series].sortOrder}validateOptions(){if(!this._options)throw new Error(Object(o.a)("JSPerf.1047"));if(void 0===this._options.minX||null===this._options.minX||void 0===this._options.maxX||null===this._options.maxX||void 0===this._options.minY||null===this._options.minY||this._options.minX>this._options.maxX||!(this._options.height>=0&&this._options.width>=0)||!this._options.barWidth||this._options.barWidth<0)throw new Error(Object(o.a)("JSPerf.1048"));this._options.barGap=this._options.barGap||0;this._options.showStackGap=this._options.showStackGap||!1;this._options.minYHeight=this._options.minYHeight||this._options.minY}}c.YAXIS_PIXEL_PADDING=10;class u{constructor(){this._idCount=0;this.rootElement=document.createElement("div");this.rootElement.style.width=this.rootElement.style.height="100%";this._selectedId=null}set presenter(e){this._presenter=e;this._viewData=this._presenter.viewModel;this._options=e.getViewOptions();this._barGraphWidth=this._options.width;this.drawChart()}static svgAddCssClass(e,t){e.setAttribute("class",e.getAttribute("class")+" "+t)}static svgRemoveCssClass(e,t){var i=e.getAttribute("class");i=i.replace(t,"").trim();e.setAttribute("class",i)}createContainer(){if(this._chartAreaContainer)this._chartAreaContainer.innerHTML="";else{this._chartAreaContainer=document.createElement("div");this.rootElement.appendChild(this._chartAreaContainer);this._chartAreaContainer.addEventListener("keydown",e=>this.onBarGraphKeydown(e));this._chartAreaContainer.addEventListener("focus",e=>this.onGraphFocusIn(e));this._chartAreaContainer.addEventListener("focusout",e=>this.onGraphFocusOut(e))}this._barAriaLabel?this._barAriaLabel.innerHTML="":this._barAriaLabel=document.createElement("div");this._chartAreaContainer.style.width=this._options.width+"px";this._chartAreaContainer.style.height=this._options.height+"px";this._chartAreaContainer.classList.add("stackedBarChart");this._chartAreaContainer.style.display="-ms-grid";this._chartAreaContainer.setAttribute("tabIndex","0");this._barAriaLabel.setAttribute("aria-live","assertive");this._barAriaLabel.style.display="none"}createRect(e,t,i,s,n){var a=document.createElementNS(u.SVG_NAMESPACE,"rect");a.id=u.BAR_ID_PREFIX+this._idCount;this._idCount++;a.setAttribute("focusable","false");a.setAttribute("x",e+"px");a.setAttribute("y",t+"px");a.setAttribute("class","bar "+n);a.setAttribute("height",i+"px");a.setAttribute("width",s+"px");return a}drawChart(){if(!this._viewData)throw new Error(Object(o.a)("JSPerf.1049"));this.createContainer();this.initializeBarGraph();this._chartAreaContainer.appendChild(this._barGraph);this.renderViewData(this._barGraph,this._viewData);this._chartAreaContainer.appendChild(this._barGraph);this._chartAreaContainer.appendChild(this._barAriaLabel);this._options.ariaDescription&&this._chartAreaContainer.setAttribute("aria-label",this._options.ariaDescription)}initializeBarGraph(){this._selectedId=-1;this._idCount=0;this._barGraph=document.createElementNS(u.SVG_NAMESPACE,"svg");this._barGraph.setAttribute("class","barGraph");this._barGraph.setAttribute("focusable","false");this._barGraph.setAttribute("height",this._options.height+"px");this._barGraph.setAttribute("width",this._barGraphWidth+"px");this._barGraph.setAttribute("role","img");this._options.ariaDescription&&this._barGraph.setAttribute("aria-label",this._options.ariaDescription)}onGraphFocusIn(e){if(null===this._selectedId||this._selectedId<0)this._selectedId=-1;else{var t=document.getElementById(u.BAR_ID_PREFIX+this._selectedId);t&&u.svgAddCssClass(t,u.FOCUSED_CSS_CLASSNAME)}}onGraphFocusOut(e){var t=document.getElementById(u.BAR_ID_PREFIX+this._selectedId);t&&u.svgRemoveCssClass(t,u.FOCUSED_CSS_CLASSNAME);this._options.ariaDescription&&this._chartAreaContainer.setAttribute("aria-label",this._options.ariaDescription);d.a()}onBarFocusIn(e,t){u.svgAddCssClass(t,u.FOCUSED_CSS_CLASSNAME);if(this._options.ariaLabelCallback){var i=this._options.ariaLabelCallback(e);this._barAriaLabel.textContent=i}}onBarFocusOut(e,t){u.svgRemoveCssClass(t,u.FOCUSED_CSS_CLASSNAME)}onBarGraphKeydown(e){d.a();var t;-1!==this._selectedId&&(t=document.getElementById(u.BAR_ID_PREFIX+this._selectedId));if(e.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.ArrowLeft||e.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.ArrowRight||e.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.Escape){t&&t.onlostfocus&&t.onlostfocus();if(e.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.Escape)this._selectedId=-1;else{if(e.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.ArrowLeft){0!==this._selectedId&&-1!==this._selectedId||(this._selectedId=this._idCount);this._selectedId--}else if(e.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.ArrowRight){this._selectedId++;this._selectedId===this._idCount&&(this._selectedId=0)}(t=document.getElementById(u.BAR_ID_PREFIX+this._selectedId))&&t.ongotfocus&&t.ongotfocus()}t.onkeydown(e);e.preventDefault();e.stopPropagation();return!1}return!t||!t.onkeydown||t.onkeydown(e)}onBarKeydown(e,t){if(t.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.Enter||t.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.ArrowLeft||t.keyCode===Microsoft.VisualStudio.DiagnosticsHub.Common.KeyCodes.ArrowRight){for(var i=t.currentTarget,s=e.x,n=i.offsetHeight;i;){s+=i.offsetLeft;n+=i.offsetTop;i=i.offsetParent}this.showTooltip(e.chartItem,s,n);t.preventDefault();t.stopPropagation();return!1}return!0}renderViewData(e,t){for(var i=0;i<t.length;i++){var s=t[i],n=this.createRect(s.x,s.y,s.height,s.width,s.className);n.onmouseover=this.showTooltip.bind(this,s.chartItem);n.onmouseout=(e=>{d.a()});n.onkeydown=this.onBarKeydown.bind(this,s);n.ongotfocus=this.onBarFocusIn.bind(this,s.chartItem,n);n.onlostfocus=this.onBarFocusOut.bind(this,s.chartItem,n);void 0===n.parentElement&&(n.parentElement=e.parentElement);e.appendChild(n)}}showTooltip(e,t,i){if(this._options.tooltipCallback){var s={content:this._options.tooltipCallback(e),delay:0,x:t,y:i,contentContainsHTML:!0};d.c(s)}}}u.BAR_ID_PREFIX="bar";u.FOCUSED_CSS_CLASSNAME="focused";u.SVG_NAMESPACE="http://www.w3.org/2000/svg";class g{constructor(e){this._scaleChangedEvent=new Microsoft.VisualStudio.DiagnosticsHub.AggregatedEvent;this._config=e;this._graphResources=new h(this._config.resources);this._timeRange=this._config.timeRange||new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(new Microsoft.VisualStudio.DiagnosticsHub.BigNumber(0,0),new Microsoft.VisualStudio.DiagnosticsHub.BigNumber(0,0));this._container=document.createElement("div");g.validateConfiguration(this._config);this._dataSource=this._config.jsonConfig.Series[0].DataSource;if(e.pathToScriptFolder&&e.loadCss){e.loadCss(e.pathToScriptFolder+"/js/hubGraphs/StackedBarChart.css");e.loadCss(e.pathToScriptFolder+"/DataCategoryStyles.css")}this._config.scale=this._config.scale||{};this._config.scale.minimum=0;this._config.scale.maximum=120;this._config.scale.axes=[];for(var t=1;t<64;t++)this._config.scale.axes.push({value:100*t});this._config.legend=this._config.legend||[];var i=this._config.jsonConfig.Series;for(t=0;t<i.length;t++){var s=i[t];this._config.legend.push({color:s.Color,legendText:this._graphResources.getString(s.Legend),legendTooltip:s.LegendTooltip?this._graphResources.getString(s.LegendTooltip):null})}}get container(){return this._container}get scaleChangedEvent(){return this._scaleChangedEvent}get containerOffsetWidth(){void 0===this._containerOffsetWidth&&(this._containerOffsetWidth=this._container.offsetWidth);return this._containerOffsetWidth}onDataUpdate(e){}addSeriesData(e,t,i,s){}getDataPresenter(){for(var e={ariaDescription:this._graphResources.getString("CPUGraphAriaLabel"),height:this._config.height,width:this.containerOffsetWidth,minX:parseInt(this._timeRange.begin.value),maxX:parseInt(this._timeRange.end.value),minY:0,minYHeight:100,barWidth:this._config.jsonConfig.BarWidth,barGap:this._config.jsonConfig.BarGap,showStackGap:this._config.jsonConfig.ShowStackGap,tooltipCallback:this.createTooltip.bind(this),ariaLabelCallback:this.createAriaLabel.bind(this)},t=new c(e),i=[],s=this._config.jsonConfig.Series,n=0;n<s.length;n++){var a=s[n];i.push({cssClass:a.CssClass,name:a.Category,sortOrder:n+1})}t.addSeries(i);return t}getGranularity(){var e=this._config.jsonConfig.BarGap+this._config.jsonConfig.BarWidth,t=parseInt(this._timeRange.elapsed.value);return t<=0||this.containerOffsetWidth<=0?0:Math.floor(e/this.containerOffsetWidth*t)}removeInvalidPoints(e){}render(e,t){e&&(this._containerOffsetWidth=void 0);this._config.jsonConfig.GraphBehaviour===Microsoft.VisualStudio.DiagnosticsHub.GraphBehaviourType.PostMortem&&this.setData(this._timeRange)}resize(e){this.render(!0,!1)}onViewportChanged(e){if(!this._timeRange.equals(e.currentTimespan)){this._timeRange=e.currentTimespan;this.render()}}static validateConfiguration(e){if(!e)throw new Error(Object(o.a)("JSPerf.1070"));var t=e.jsonConfig;if(!t)throw new Error(Object(o.a)("JSPerf.1071"));if(!t.Series||0===t.Series.length)throw new Error(Object(o.a)("JSPerf.1072"));t.BarWidth=t.BarWidth||4;t.BarGap=t.BarGap||0;t.ShowStackGap=t.ShowStackGap||!1;if(!e.height||e.height<0||t.BarWidth<0)throw new Error(Object(o.a)("JSPerf.1048"))}createTooltip(e){var t=this._graphResources.getString("CPUTooltipTimeLabel")+": "+Microsoft.VisualStudio.DiagnosticsHub.RulerUtilities.formatTime(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e.x),Microsoft.VisualStudio.DiagnosticsHub.UnitFormat.fullName)+"<br />";t+=this._graphResources.getString("CPUTooltipCategoryLabel")+": "+this._graphResources.getString(e.series)+"<br />";return t+=this._graphResources.getString("CPUTooltipUtilizationLabel")+": "+(Math.round(100*e.height)/100).toLocaleString(void 0,{minimumFractionDigits:2})+"%"}createAriaLabel(e){var t=(Math.round(100*e.height)/100).toLocaleString(void 0,{minimumFractionDigits:2}),i=Microsoft.VisualStudio.DiagnosticsHub.RulerUtilities.formatTime(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e.x),Microsoft.VisualStudio.DiagnosticsHub.UnitFormat.fullName);return this._graphResources.getString("CPUBarAriaLabel",this._graphResources.getString(e.series),t,i)}setData(e){this._settingDataPromise&&(this._settingDataPromise=null);this._dataSource&&this._dataSource.CounterId&&this._dataSource.AnalyzerId&&(this._settingDataPromise=this.getDataWarehouse().then(t=>{var i=this.getGranularity();return i>0?l.getFilteredResult(t,this._dataSource.AnalyzerId,this._dataSource.CounterId,e,{granularity:i.toString()}):Promise.resolve({p:[]})}).then(e=>{if(this._chart){this._container.removeChild(this._chart.rootElement);this._chart=null}if(e&&e.p){for(var t=[],i=0;i<e.p.length;i++){var s=e.p[i],n=4294967296*s.t.h+s.t.l;t.push({series:s.c,x:n,height:s.u})}var a=this.getDataPresenter();a.addData(t);this._chart=new u;this._chart.presenter=a;this._scaleChangedEvent.invokeEvent({minimum:0,maximum:a.maximumYValue});this._container.appendChild(this._chart.rootElement)}}).then(()=>{this._settingDataPromise=null}))}getDataWarehouse(){return this._dataWarehouse?Promise.resolve(this._dataWarehouse):Microsoft.VisualStudio.DiagnosticsHub.DataWarehouse.loadDataWarehouse().then(e=>{this._dataWarehouse=e;return this._dataWarehouse})}}var m=i(5),p=i(61),_=i(163),v=i(164),b=i(94),C=i(76),S=i(98),f=i(68),E=i(10),w=i(42),I=i(6),T=i(27),D=i(59),y=i(81);class R{getUserSettings(){return new Promise(e=>{Object(y.b)().getSettings("JavaScriptPerfTools").then(t=>{e(t)})})}}const x=new R;class P{}P.Resize="resize";P.Initialized="initialized";var M=i(130),L=i(60);let A=new M.a;class k{}k.START_PROFILE="StartProfile";k.STOP_PROFILE="StopProfile";k.IMPORT_SESSION="ImportSession";k.EXPORT_SESSION="ExportSession";k.ZOOM_IN="ZoomIn";k.ZOOM_RESET="ZoomReset";k.CLEAR_SELECTION="ClearSelection";k.CHANGE_SORT_BY="ChangeSortBy";k.FILTER_BY_NAME="FilterByName";k.FILTER_FRAME="FilterFrame";k.FILTER_IMAGE_DECODING="FilterImageDecoding";k.FILTER_NETWORK_TRAFFIC="FilterNetworkTraffic";k.FILTER_UI_ACTIVITIES="FilterUIActivities";k.FILTER_USER_MEASURES="FilterUserMeasures";k.FILTER_DURATION="FilterDuration";k.SELECT_RANGE="SelectRange";k.CLICK_EVENT_DETAIL="ClickEventDetail";function V(){A=new L.a("VisualProfiler")}var O=i(132),N=i(23),F=i(74),H=i(56),B=i(13),G=i(65),j=i(2),U=i(112),z=i(15),W=i(8),J=i(19),X=i(58),K=i(55),Y=i(86),q=i(54),Z=i(17),$=i(9),Q=i(4),ee=i(11);class te{constructor(e,t){this._container=e;this._elementCreator=t;this._index=null;this._elements=[];this._recycledElements=[]}static forDivWithClass(e,t){return new te(e,()=>{var e=document.createElement("div");e.className=t;return e})}start(){this._index=0}getNext(){Q.a.isTrue(null!==this._index,"Invalid operation. Method 'start' must be called before calling getNext.");var e=this._elements[this._index];if(!e){e=this._recycledElements.length>0?this._recycledElements.pop():this._elementCreator();this._elements.push(e);this._container.appendChild(e)}this._index++;return e}stop(){if(null!==this._index){for(var e=this._elements.length-1;e>=this._index;--e){var t=this._elements.pop();this._recycledElements.push(t);this._container.removeChild(t)}this._index=null}}recycleAll(){for(var e=this._elements.length-1;e>=0;--e){var t=this._elements.pop();this._recycledElements.push(t);this._container.removeChild(t)}}removeAll(){for(var e=this._elements.length-1;e>=0;--e){var t=this._elements.pop();this._container.removeChild(t)}this._elements=[];this._recycledElements=[]}}var ie=i(138);class se extends J.a{constructor(e){super(e);this.hoverStateChangeEvent=new z.a}get id(){return this.item?this.item.id:null}get isSelected(){return this._isSelected}set isSelected(e){if(this._isSelected!==e){this._isSelected=e;this.updateStyle()}}get item(){return this._item}set item(e){this._item=e}get hasFocus(){return null!==this.id&&this.id===se.FocusedContainerId}set hasFocus(e){se.FocusedContainerId=e?this.id:null}clearHoverState(){this.rootElement.classList.remove(se.HOVER_CSS_CLASSNAME)}empty(){this.item=null;this.template&&(this.template.model=null);this._isSelected=null;this.updateStyle();this.rootElement.classList.remove("itemContainerHover")}focus(){this.isSelected=!0;this.hasFocus=!0;this.updateStyle();this.rootElement.focus()}onApplyTemplate(){super.onApplyTemplate();this.rootElement.id="listItemContainer"+se.IdCount++;this.rootElement.className=se.BASE_CSS_CLASSNAME;this.rootElement.tabIndex=-1;this.rootElement.addEventListener("focus",this.onFocus.bind(this));this.rootElement.addEventListener("blur",this.onBlur.bind(this));this.rootElement.addEventListener("click",this.onClick.bind(this));this.rootElement.addEventListener("contextmenu",this.onContextMenu.bind(this));this.rootElement.addEventListener("mouseover",()=>{this.rootElement.classList.add(se.HOVER_CSS_CLASSNAME);this.hoverStateChangeEvent.invoke({hovering:!0,container:this})});this.rootElement.addEventListener("mouseleave",()=>{this.rootElement.classList.remove(se.HOVER_CSS_CLASSNAME);this.hoverStateChangeEvent.invoke({hovering:!1,container:this})})}updateStyle(){if(this._isSelected){this.rootElement.tabIndex=this.selectedTabIndex||0;if(this.hasFocus){this.rootElement.classList.add(se.SELECTED_ACTIVE_CSS_CLASSNAME);this.rootElement.classList.remove(se.SELECTED_CSS_CLASSNAME)}else{this.rootElement.classList.add(se.SELECTED_CSS_CLASSNAME);this.rootElement.classList.remove(se.SELECTED_ACTIVE_CSS_CLASSNAME)}}else{this.rootElement.tabIndex=-1;this.rootElement.classList.remove(se.SELECTED_CSS_CLASSNAME);this.rootElement.classList.remove(se.SELECTED_ACTIVE_CSS_CLASSNAME)}}onBlur(){this.hasFocus=!1;this.updateStyle()}onClick(e){if(!(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement)&&this.clicked){this.clicked(e);e.stopImmediatePropagation()}}onContextMenu(e){this.contextMenu&&this.contextMenu()}onFocus(){this.hasFocus=!0;this.updateStyle()}}se.BASE_CSS_CLASSNAME="BPT-listItemContainer";se.HOVER_CSS_CLASSNAME="BPT-listItemContainerHover";se.SELECTED_CSS_CLASSNAME="BPT-listItemSelected";se.SELECTED_ACTIVE_CSS_CLASSNAME="BPT-listItemSelectedActive";se.IdCount=0;class ne extends J.a{constructor(e){super(e)}}class ae{delay(e){if(this._id){window.clearImmediate(this._id);this._id=0}this._id=window.setImmediate(e)}}class re extends J.a{constructor(e){super(e);this._invalidationDelayer=new ae;this._selectedItemVisibleIndex=-1;this.onDataItemTemplateChanged()}get ariaLabel(){return this.rootElement.getAttribute("aria-label")}set ariaLabel(e){this.rootElement.setAttribute("aria-label",e)}get dataSource(){return this._dataSource}set dataSource(e){if(this._dataSource!==e){this.maintainSelectionAroundOperation(()=>{this._listChangedEventRegistration&&this._listChangedEventRegistration.unregister();this._dataSource=e;this._itemContainerGenerator.setDataSource(this._dataSource);this._dataSource&&this._dataSource.listChanged&&(this._listChangedEventRegistration=this._dataSource.listChanged.addHandler(()=>this.updateSelectedIndex()))});this.panel.invalidate()}}get itemContainerGenerator(){return this._itemContainerGenerator}set itemContainerGenerator(e){Q.a.isTrue(!!e,"Expecting a valid itemContainerGenerator");this._itemContainerGenerator=e;this._itemContainerGenerator.setDataSource(this.dataSource);this.panel&&(this.panel.itemContainerGenerator=this._itemContainerGenerator)}get panel(){return this._panel}set panel(e){if(this._panel!==e){this.maintainSelectionAroundOperation(()=>{if(this._panel){this._panel.templateBinder=null;this._panel.itemContainerGenerator=null;this._panel.onScrolled=null;this.rootElement.contains(this._panel.rootElement)&&this.rootElement.removeChild(this._panel.rootElement)}this._panel=e;if(this._panel){this._panel.templateBinder=this;this._panel.itemContainerGenerator=this._itemContainerGenerator;this._panel.onScrolled=(e=>{this.onScrolled&&this.onScrolled(e)});this.rootElement.appendChild(this._panel.rootElement)}});this.render(!0)}}get selectedIndex(){return this._selectedItemVisibleIndex}set selectedIndex(e){e<0?this.selectedItem=null:this.setSelectedItemVisibleIndex(e,0)}setSelectedItem(e,t){if(this._selectedItem!==e||this._selectedItem&&e&&this._selectedItem.id!==e.id){var i=this.getSelectedItemContainer();i&&(i.isSelected=!1);this._selectedItem=e;this.updateSelectedIndex();this._selectedItemVisibleIndex>=0&&this.panel.ensureVisible(this._selectedItemVisibleIndex);(i=this.getSelectedItemContainer(!0))&&t&&this.focusItemContainer(i);this.onSelectedItemChangedOverride(this._selectedItem);this.selectedItemChanged&&this.selectedItemChanged(this._selectedItem);this.panel.updateIndentLine()}}get selectedItem(){return this._selectedItem}set selectedItem(e){this.setSelectedItem(e,!0)}static initialize(){W.a.defineProperty(re,re.DataItemTemplatePropertyName,ne,e=>e.onDataItemTemplateChanged())}bind(e,t){if(!e.template){if(!this._dataItemTemplateConstruction)throw new Error("Expecting a data item template type.");e.rootElement.tabIndex=-1;e.template=this._dataItemTemplateConstruction.getNewControl();e.rootElement.appendChild(e.template.rootElement);e.template instanceof ne&&(e.template.ownerListControl=this)}e.rootElement.setAttribute("data-id",e.id.toString());this.updateContainerOverride(e,t);e.clicked=this.onItemSelected.bind(this,e);e.contextMenu=this.onItemSelected.bind(this,e);e.isSelected=this._selectedItem&&e.id===this._selectedItem.id}cleanupContainerOverride(e){var t=e.template;t&&(t.model=null)}forceFocusToSelectedItem(){var e=this.getSelectedItemContainer();if(e){var t=e.item;if(t){var i=this.getVisibleIndexOfItem(t);i>=0&&this.panel.isPartiallyVisible(i)&&e.focus()}}}getItemContainerFromItem(e,t){var i=this._itemContainerGenerator.getItemContainerFromItemId(e.id);if(!i&&t){this.scrollToItem(e);i=this._itemContainerGenerator.getItemContainerFromItemId(e.id)}return i}getSelectedItemContainer(e){return this.selectedItem?this.getItemContainerFromItem(this.selectedItem,e):null}invalidate(e=!0){e&&this.panel.invalidate();this.panel.render();var t=this.panel.virtualHeight>this.panel.viewportHeight;if(t!==this._panelScrollBarShown){this._panelScrollBarShown=t;this.invalidateSizeCache()}this.onInvalidated()}invalidateItemRowSpan(e){if(e&&this.dataSource&&this.panel instanceof de){var t=this.panel,i=this.dataSource.indexOfItem(e.id);if(!(i<0)){t.invalidateRowSpan(i);var s=this._selectedItemVisibleIndex>=0&&this.panel.isPartiallyVisible(this._selectedItemVisibleIndex);this._invalidationDelayer.delay(()=>{this.invalidate(!1);s&&this._selectedItemVisibleIndex>=0&&this.panel.ensureVisible(this._selectedItemVisibleIndex)})}}}invalidateSizeCache(){this.panel.invalidateSizeCache()}onApplyTemplate(){super.onApplyTemplate();this.rootElement.style.width="100%";this.rootElement.style.height="100%";this.rootElement.tabIndex=0;this.rootElement.addEventListener("keydown",this.onKeyDown.bind(this));this._itemContainerGenerator=new le;this.panel=new he;this.invalidateSizeCache()}onInvalidated(){}onKeyDownOverride(e){var t=!0;switch(e.keyCode){case 38:this._selectedItemVisibleIndex<0?this.setSelectedItemVisibleIndex(0,1):this.selectPreviousItem();break;case 40:this._selectedItemVisibleIndex<0?this.setSelectedItemVisibleIndex(0,1):this.selectNextItem();break;case 33:this.selectPage(-1,-1);break;case 34:this.selectPage(1,1);break;case 36:this.selectHome();break;case 35:this.selectEnd();break;case 93:this.onShowContextMenu();break;case 121:!e.shiftKey||e.ctrlKey||e.altKey||this.onShowContextMenu();break;default:t=!1}return t}onSelectedItemChangedOverride(e){}onShowContextMenu(){}onWindowResize(){this.invalidateSizeCache();this.invalidate()}render(e=!0){this.invalidate(e)}scrollToItem(e,t){var i=this.getVisibleIndexOfItem(e);i>=0&&this.panel.ensureVisible(i,t)}selectEnd(){this._selectedItemVisibleIndex<0||this.setSelectedItemVisibleIndex(this._itemContainerGenerator.count-1,-1)}selectHome(){this._selectedItemVisibleIndex<0||this.setSelectedItemVisibleIndex(0,1)}selectPreviousItem(){this._selectedItemVisibleIndex<0||this.setSelectedItemVisibleIndex(this._selectedItemVisibleIndex-1,-1)}selectPage(e,t){if(!(this._selectedItemVisibleIndex<0)){this.panel.scrollToOffset(this.panel.scrollTop+e*this.panel.viewportRowsCount*this.panel.rowHeight);var i=this.panel.getItemRowInfoFromIndex(this._selectedItemVisibleIndex);if(i){var s=i.topRow+e*this.panel.viewportRowsCount,n=this.panel.getItemRowInfoFromRow(s);n&&this.setSelectedItemVisibleIndex(n.index,t)}}}selectNextItem(){this._selectedItemVisibleIndex<0||this.setSelectedItemVisibleIndex(this._selectedItemVisibleIndex+1,1)}unbind(e){e.clicked=null;e.rootElement.removeAttribute("aria-label");this.cleanupContainerOverride(e)}updateContainerOverride(e,t){var i=e.item,s=e.template;s&&(s.model=i)}focusItemContainer(e){this.setItemContainerAriaLabel(e);e.focus()}getVisibleIndexOfItem(e){return this.dataSource?this.dataSource.indexOfItem(e.id):-1}maintainSelectionAroundOperation(e){var t=0;if(this._panel&&this._selectedItem&&this._itemContainerGenerator){var i=this._itemContainerGenerator.getItemContainerFromItemId(this._selectedItem.id);i&&(t=this._panel.getScrollViewportOffset(i))}e();if(this._selectedItem){this._selectedItemVisibleIndex=this.getVisibleIndexOfItem(this._selectedItem);if(this._selectedItemVisibleIndex<0){this.selectedItem=null;this.panel.scrollToOffset(0,!0)}else this.panel.scrollToIndex(this._selectedItemVisibleIndex,-t,!0)}else this.panel.scrollToOffset(0,!0)}onDataItemTemplateChanged(){this._dataItemTemplateConstruction=null;this._dataItemTemplate&&(this._dataItemTemplateConstruction=ie.a.createFromStringOrType(this._dataItemTemplate));this.itemContainerGenerator.reset();this.render(!0)}onKeyDown(e){if(this.onKeyDownOverride(e)){e.preventDefault();e.stopPropagation()}}onItemSelected(e,t){if(!(t&&!t.altKey&&t.ctrlKey&&!t.shiftKey)||!e.isSelected){e.item.clickSelectAlternative&&(e=this.getItemContainerFromItem(e.item.clickSelectAlternative,!0));this.selectedItem=e.item;e.focus()}else this.selectedItem=null}setItemContainerAriaLabel(e){if(e){var t;e.item&&this.onGetItemContainerAriaLabel&&(t=this.onGetItemContainerAriaLabel(e));t?e.rootElement.setAttribute("aria-label",t):e.rootElement.removeAttribute("aria-label")}}setSelectedItemVisibleIndex(e,t){for(var i=null,s=this._itemContainerGenerator.count,n=!0,a=!1,r=!1;n;){if(e<0){e=0;if(t){t=1;r=!0}}if(e>=s){e=s-1;if(t){t=-1;a=!0}}n=!1;if(a&&r||this._selectedItemVisibleIndex>=0&&this._selectedItemVisibleIndex===e)i=this.getSelectedItemContainer();else if(e>=0&&e<s){this._itemContainerGenerator.startAt(e);i=this._itemContainerGenerator.getNext();this._itemContainerGenerator.stop();if(i){var o=i.item;i.rootElement.parentElement||this._itemContainerGenerator.recycle(e);if(o.dontKeyboardSelect&&t){e+=t;n=!0;continue}this.selectedItem=o}}}a&&r&&Q.a.fail("All elements in ListControl are not selectable.");return i}updateSelectedIndex(){this._selectedItem?this._selectedItemVisibleIndex=this.getVisibleIndexOfItem(this._selectedItem):this._selectedItemVisibleIndex=-1}}re.DataItemTemplatePropertyName="dataItemTemplate";class oe extends J.a{constructor(e){super(e||"Common.stackPanelTemplate");this.renderStartingEvent=new z.a;this.renderCompletedEvent=new z.a;this.children=[];this._requestScrollToOffset=null;this._scrollTopCached=null}get content(){return this._content}get itemContainerGenerator(){return this._itemContainerGenerator}set itemContainerGenerator(e){if(this._itemContainerGenerator!==e){this._itemContainerGenerator=e;this.onItemContainerGeneratorChanged()}}get rowHeight(){if(!this._rowHeight){var e=new se;this.content.appendChild(e.rootElement);this._rowHeight=e.rootElement.offsetHeight;this.content.removeChild(e.rootElement)}return this._rowHeight}get charWidth(){if(!this._charWidth){var e=document.createElement("div");e.textContent="H";e.style.height="auto";e.style.width="auto";e.style.position="absolute";var t=new se;t.rootElement.appendChild(e);this.content.appendChild(t.rootElement);this._charWidth=e.getBoundingClientRect().width;this.content.removeChild(t.rootElement)}return this._charWidth}get charHeight(){if(!this._charHeight){var e=document.createElement("div");e.textContent="H";e.style.height="auto";e.style.width="auto";e.style.position="absolute";var t=new se;t.rootElement.appendChild(e);this.content.appendChild(t.rootElement);this._charHeight=e.getBoundingClientRect().height;this.content.removeChild(t.rootElement)}return this._charHeight}get viewportHeight(){if(!this._viewportHeight){var e=this.rootElement.parentElement;Q.a.isTrue(!!e,"Trying to access the parent element when the panel is not attached to it.");this._viewportHeight=Math.floor(e.getBoundingClientRect().height)}return this._viewportHeight}get viewportRowsCount(){return 0===this.rowHeight||isNaN(this.rowHeight)?0:Math.floor(this.viewportHeight/this.rowHeight)}get viewportWidth(){this._viewportWidth||(this._viewportWidth=this.content.clientWidth);return this._viewportWidth}get scrollHeight(){return this.rootElement.scrollHeight}get scrollTop(){if(null!==this._requestScrollToOffset){var e=Math.min(this._requestScrollToOffset,this.scrollHeight-this.viewportHeight);return e=Math.max(0,e)}return this.scrollTopCached}get scrollTopCached(){null===this._scrollTopCached&&(this._scrollTopCached=this.rootElement.scrollTop);return this._scrollTopCached}getItemRowInfoFromRow(e){return{index:e,rowsSpan:1,topRow:e}}getItemRowInfoFromIndex(e){return{index:e,rowsSpan:1,topRow:e}}ensureVisible(e,t){var i=this.getItemRowInfoFromIndex(e);if(i){var s=i.topRow*this.rowHeight,n=s+(i.rowsSpan||1)*this.rowHeight,a=this.scrollTop,r=a+this.viewportHeight;if(t||s<a||n>r){var o;if(t){o=(s+n-this.viewportHeight)/2;o=Math.max(o,0);o=Math.min(o,this.scrollHeight-this.viewportHeight)}else o=s<a?s:n-this.viewportHeight;this.scrollToOffset(o)}}}getScrollViewportOffset(e){var t=parseInt(e.rootElement.style.top),i=this.scrollTop,s=this.viewportHeight,n=t-i;return n>0&&n<=s-this.rowHeight?n:0}invalidate(){this.children.forEach(e=>{e&&this.templateBinder.unbind(e)});this.itemContainerGenerator.recycleAll();this.children=[]}invalidateScrollCache(){this._scrollTopCached=null}invalidateSizeCache(){this._viewportHeight=null;this._viewportWidth=null;this._charWidth=0;this._charHeight=0;this._rowHeight=0}isPartiallyVisible(e){var t=this.getItemRowInfoFromIndex(e);if(!t)return!1;var i=t.topRow*this.rowHeight,s=i+(t.rowsSpan||1)*this.rowHeight,n=this.scrollTop,a=n+this.viewportHeight;return s>n&&s<=a||i>=n&&i<a}render(){if(!this._isRendering&&this.templateBinder){this._isRendering=!0;this.renderStartingEvent.invoke(this);try{this.renderCoreOverride();if(null!==this._requestScrollToOffset){if(this.scrollTopCached!==this._requestScrollToOffset){this._scrollTopCached=null;this.rootElement.scrollTop=this._requestScrollToOffset}this._requestScrollToOffset=null}}finally{this._isRendering=!1;this.renderCompletedEvent.invoke(this)}}}renderCoreOverride(){var e=0;this.itemContainerGenerator.startAt(0);for(var t=this.itemContainerGenerator.getNext();t;){this.templateBinder.bind(t,e++);this.rootElement.appendChild(t.rootElement);t=this.itemContainerGenerator.getNext()}this.itemContainerGenerator.stop()}scrollToIndex(e,t=0,i){var s=this.getItemRowInfoFromIndex(e);if(s){var n=s.topRow*this.rowHeight+t;this.scrollToOffset(n,i)}}scrollToOffset(e,t){if(t)this._requestScrollToOffset=e;else{this._requestScrollToOffset=null;this._scrollTopCached=null;this.rootElement.scrollTop=e;this._skipNextOnScroll=!0;this.render()}}onApplyTemplate(){super.onApplyTemplate();this._content=this.getNamedElement("content");Q.a.isTrue(!!this._content,"Expecting a child element called 'content'");this.rootElement.addEventListener("scroll",this.onScroll.bind(this),!1)}onItemContainerGeneratorChanged(){}onScroll(e){this._scrollTopCached=null;if(this._skipNextOnScroll)this._skipNextOnScroll=!1;else if(this._lastScrollTop!==e.srcElement.scrollTop||this._lastScrollHeight!==e.srcElement.scrollHeight||this._lastScrollLeft!==e.srcElement.scrollLeft||this._lastScrollWidth!==e.srcElement.scrollWidth){this.render();this._lastScrollTop=e.srcElement.scrollTop;this._lastScrollHeight=e.srcElement.scrollHeight;this._lastScrollLeft=e.srcElement.scrollLeft;this._lastScrollWidth=e.srcElement.scrollWidth;this.onScrolled&&this.onScrolled(e)}}}class le{constructor(){this._itemContainers={};this._unusedItemContainers=[];this.countChanged=new z.a}get count(){return this._dataSource?this._dataSource.count:0}get indentLevel(){return this._dataSource?this._dataSource.indentLevel:0}get indentIndexStart(){return this._dataSource?this._dataSource.indentIndexStart:0}get indentIndexEnd(){return this._dataSource?this._dataSource.indentIndexEnd:0}setDataSource(e){if(this._dataSource!==e){if(this._dataSourceListChangedEventRegistration){this._dataSourceListChangedEventRegistration.unregister();this._dataSourceListChangedEventRegistration=null}this._dataSource=e;this._currentIndex=null;this.recycleAll();this._dataSource&&this._dataSource.listChanged&&(this._dataSourceListChangedEventRegistration=this._dataSource.listChanged.addHandler(this.onDataSourceListChanged.bind(this)));this.countChanged.invoke({action:2})}}startAt(e){if(this._dataSource){Q.a.isTrue(e>=0&&e<this._dataSource.count,"Index out of range.");this._currentIndex=e;this._dataSource.startAt(this._currentIndex)}}stop(){if(!this._dataSource)return Z.a;this._currentIndex=null;return this._dataSource.stop()}getItemContainerByIndex(e){return this._itemContainers[e]}getNext(){if(!this._dataSource)return null;Q.a.isTrue(null!==this._currentIndex,"Invalid operation. startAt must be called before calling getNext.");var e=null;if(this._currentIndex<this._dataSource.count){var t=this._dataSource.getNext();if(t){if(e=this._itemContainers[this._currentIndex]){if(e.item!==t){e.empty();e.item=t}}else{e=this.getItemContainer(this._currentIndex,t);this._itemContainers[this._currentIndex]=e}this._currentIndex+=1}}return e}getItemContainerFromItemId(e){for(var t in this._itemContainers){var i=this._itemContainers[t];if(i.id===e)return i}return null}recycle(e){var t=this._itemContainers[e];if(t){delete this._itemContainers[e];t.empty();this._unusedItemContainers.push(t)}}recycleAll(){for(var e in this._itemContainers){var t=this._itemContainers[e];if(t){t.empty();this._unusedItemContainers.push(t)}}this._itemContainers={}}reset(){this.recycleAll();this._unusedItemContainers=[]}newItemContainer(){return new se}getItemContainer(e,t){var i;(i=this._unusedItemContainers.length>0?this._unusedItemContainers.pop():this.newItemContainer()).item=t;return i}onDataSourceListChanged(e){this.countChanged.invoke(e)}}class he extends oe{constructor(e){super(e||"Common.virtualizingStackPanelTemplate");this._firstVisibleItemIndex=0}get actualHeight(){return this.viewportHeight}get scrollHeight(){return this.virtualHeight}get virtualHeight(){return this.rowHeight*this.itemContainerGenerator.count}renderCoreOverride(){this.updateVirtualHeight();var e=this.getVisibleRowsScrollFraction(),t=Math.ceil(e),i=Math.ceil(t/4),s=this.getFirstVisibleRowScrollFraction(),n=Math.floor(Math.max(0,s-i)),a=Math.ceil(s+t+i),r=this.getItemRowInfoFromRow(n);if(r&&r.index<this.itemContainerGenerator.count){var o=r.topRow,l=r.index;this._lastFirstTop=o*this.rowHeight;for(var h=this._firstVisibleItemIndex;h<l;++h)this.removeItemContainerByIndex(h);this.itemContainerGenerator.startAt(l);for(var d=l;d<=this.itemContainerGenerator.count&&o<a;++d){var c=this.itemContainerGenerator.getNext();if(!c)break;c.clearHoverState();this.templateBinder.bind(c,d);parseInt(c.rootElement.style.top)+(parseInt(c.rootElement.style.height)||this.rowHeight)>parseInt(this._contentSizer.style.top)&&this.invalidateScrollCache();c.rootElement.style.top=o*this.rowHeight+"px";c.rootElement.style.height="";if(this.children[d]!==c){this.content.contains(c.rootElement)||this.content.appendChild(c.rootElement);this.children[d]=c}o=this.containerRenderedOverride(o,d,c)}a=this.allContainersRenderedOverride(r.topRow,o);this._lastBottomTop=a*this.rowHeight;this.itemContainerGenerator.stop();var u=d;for(h=u;h<=this._lastVisibleItemIndex;++h)this.removeItemContainerByIndex(h);this._firstVisibleItemIndex=l;this._lastVisibleItemIndex=u}if(this.itemContainerGenerator.count<this.children.length){var g=this.itemContainerGenerator.count;this.children.splice(g,this.children.length-g).forEach((e,t)=>{e&&this.templateBinder.unbind(e);this.itemContainerGenerator.recycle(t)})}this.removeOrphanElements();this.updateIndentLine()}scrollToOffset(e,t){t||this.updateVirtualHeight();super.scrollToOffset(e,t)}updateIndentLine(){var e=this.getSelectionIndentElement(),t=this.itemContainerGenerator,i=this.itemContainerGenerator.count,s=t.indentIndexStart,n=t.indentIndexEnd;if(void 0!==s&&s<i&&void 0!==n&&n<i&&this._firstVisibleItemIndex<n&&this._lastVisibleItemIndex>s){if(this._firstVisibleItemIndex>=s)var a=this._lastFirstTop;else{var r=t.getItemContainerByIndex(s);a=r?parseInt(r.rootElement.style.top,10):0}if(this._lastVisibleItemIndex<=n)var o=this._lastBottomTop;else{var l=t.getItemContainerByIndex(n);o=l?parseInt(l.rootElement.style.top,10):a}e.style.top=a+this.rowHeight+"px";e.style.height=o-a+"px";e.style.marginLeft=13*(t.indentLevel+1)+"px";this.content.appendChild(e)}else e.parentNode&&e.parentNode.removeChild(e)}allContainersRenderedOverride(e,t){return t}containerRenderedOverride(e,t,i){return e+1}updateVirtualHeight(){this._contentSizer.style.top=this.virtualHeight+"px"}onApplyTemplate(){super.onApplyTemplate();this._contentSizer=this.getNamedElement("contentSizer");Q.a.isTrue(!!this._contentSizer,"Expecting a child element called 'content'")}getSelectionIndentElement(){if(!this._selectionIndentElement){this._selectionIndentElement=document.createElement("div");this._selectionIndentElement.classList.add("BPT-listItemSelectedIndent")}return this._selectionIndentElement}getFirstVisibleRowScrollFraction(){return this.scrollTop/this.rowHeight}getVisibleRowsScrollFraction(){return this.viewportHeight/this.rowHeight}removeItemContainerByIndex(e){var t=this.children[e];if(!(t&&t.template&&t.template.isVirtualizingDisabled)){delete this.children[e];t&&this.templateBinder.unbind(t);this.itemContainerGenerator.recycle(e)}}removeOrphanElements(){var e=new Set;this.children.forEach(t=>{e.add(t.rootElement)});for(var t=this.content.children.length-1;t>=0;--t){var i=this.content.children[t];e.has(i)||this.content.removeChild(i)}}}class de extends he{constructor(e){super(e);this._previousWidth=null;this._previousCharWidth=null;this._rowsCount=null;this.resetRowSpans()}get virtualHeight(){this.updateViewportInfo(this.viewportWidth,this.charWidth,this.charHeight);return this.rowHeight*this.rowsCount}get rowsCount(){null===this._rowsCount&&this.refreshRowsCount();return this._rowsCount}allContainersRenderedOverride(e,t){var i=e;if(this._containersToReadjust.length>0){for(var s=0;s<this._containersToReadjust.length;s++){var n=(l=this._containersToReadjust[s]).container,a=this._rowSpans[l.index];if(a)l.scrollHeight=a*this.rowHeight;else{var r=n.rootElement.scrollHeight,o=Math.ceil(r/this.rowHeight)*this.rowHeight;l.scrollHeight=o}}for(s=0;s<this._containersToReadjust.length;s++){var l;(n=(l=this._containersToReadjust[s]).container).rootElement.style.top=i*this.rowHeight+"px";n.rootElement.style.height=l.scrollHeight+"px";var h=Math.ceil(l.scrollHeight/this.rowHeight);i+=h;this.updateRowSpan(l.index,h)}this.updateVirtualHeight()}return i}containerRenderedOverride(e,t,i){this._containersToReadjust.push({index:t,container:i,scrollHeight:0});return e+this.getRowSpan(t)}ensureVisible(e,t){for(var i=0;i<2;i++)super.ensureVisible(e,t)}getItemRowInfoFromRow(e){if(this.itemContainerGenerator.count>0){for(var t=0,i=0,s=1;t<this.itemContainerGenerator.count&&!((i+=s=this.getRowSpan(t))>e);t++);t===this.itemContainerGenerator.count&&t--;return{index:t,topRow:i-s,rowsSpan:s}}return null}getItemRowInfoFromIndex(e){if(e>=0&&e<this.itemContainerGenerator.count){for(var t=0,i=0;i<e;i++)t+=this.getRowSpan(i);return{index:e,topRow:t,rowsSpan:this.getRowSpan(e)}}return null}invalidate(){super.invalidate();this.resetRowSpans()}invalidateRowSpan(e){var t=this.getRowSpan(e);delete this._rowSpans[e];if(null!==this._rowsCount){var i=t-1;this._rowsCount-=i}}onItemContainerGeneratorChanged(){if(this._itemContainerGeneratorCountChangedEventRegisteration){this._itemContainerGeneratorCountChangedEventRegisteration.unregister();this._itemContainerGeneratorCountChangedEventRegisteration=null}if(this.itemContainerGenerator){this._itemContainerGeneratorCountChangedEventRegisteration=this.itemContainerGenerator.countChanged.addHandler(this.onItemContainerGeneratorCountChanged.bind(this));this.onItemContainerGeneratorCountChanged({action:2})}}renderCoreOverride(){this._containersToReadjust=[];super.renderCoreOverride()}scrollToIndex(e,t=0,i){for(var s=!1,n=0;n<2;n++){super.scrollToIndex(e,t,s);s=i}}getRowSpan(e){return this._rowSpans[e]||1}onItemContainerGeneratorCountChanged(e){if(null!==e.rowSpanIndexToInvalidate&&void 0!==e.rowSpanIndexToInvalidate)this.invalidateRowSpan(e.rowSpanIndexToInvalidate);else switch(e.action){case 0:var t=[e.newStartingIndex,0];t.push.apply(t,new Array(e.newCount));this._rowSpans.splice.apply(this._rowSpans,t);null!==this._rowsCount&&(this._rowsCount+=e.newCount);break;case 1:for(var i=this._rowSpans.splice(e.oldStartingIndex,e.oldCount),s=0,n=0;n<i.length;n++)s+=i[n]||1;null!==this._rowsCount&&(this._rowsCount-=s);break;default:this.resetRowSpans()}}refreshRowsCount(){this._rowsCount=this.itemContainerGenerator.count;this._rowSpans.length=this.itemContainerGenerator.count;this._rowsCount=this._rowSpans.reduce((e,t)=>e+(t||1)-1,this._rowsCount)}resetRowSpans(){this._rowsCount=null;this._rowSpans=[]}updateRowSpan(e,t){if(this._rowSpans.length!==this.itemContainerGenerator.count){Q.a.failDebugOnly("Detected a count mismatch between datasource ("+this.itemContainerGenerator.count+") and rowspans ("+this._rowSpans.length+").");this.resetRowSpans();this.refreshRowsCount()}if(e>=0&&e<this.itemContainerGenerator.count){var i=this.getRowSpan(e);this._rowSpans[e]=t;if(null===this._rowsCount)this.refreshRowsCount();else{var s=t-i;this._rowsCount+=s}}}updateViewportInfo(e,t,i){if(this._previousWidth!==e||this._previousCharWidth!==t){this._previousWidth=e;this._previousCharWidth=t;this.resetRowSpans()}}}re.initialize();class ce extends ne{constructor(e){super(e||"Common.defaultTreeItemDataTemplate");this.indentationInPixels=ce.INDENTATION_IN_PIXELS_DEFAULT}onApplyTemplate(){super.onApplyTemplate();this._expander=this.getNamedElement("expander");Q.a.isTrue(!!this._expander,"Expecting an expander element");this._expander.addEventListener("click",this.onExpansionClicked.bind(this));this.rootElement.addEventListener("dblclick",this.onRootElementDblClicked.bind(this))}collapse(){if(this.model&&this.model.hasChildren&&!this._expander.classList.contains(ce.COLLAPSED_CSS_CLASS)){this.onExpansionClicked(null);return!0}return!1}updateGutterGlyphContainer(){}expand(){if(this.model&&this.model.hasChildren&&!this.model.areChildrenInline&&!this._expander.classList.contains(ce.EXPANDED_CSS_CLASS)){this.onExpansionClicked(null);return!0}return!1}onModelChanged(){super.onModelChanged();if(this._modelPropertyChangedEventRegistration){this._modelPropertyChangedEventRegistration.unregister();this._modelPropertyChangedEventRegistration=null}if(this.model){var e=this.model;e.propertyChanged&&(this._modelPropertyChangedEventRegistration=e.propertyChanged.addHandler(this.onModelPropertyChanged.bind(this)));this.updateIndentationStyle();this.updateExpanderCss()}}onModelPropertyChangedOverride(e){}updateExpanderCss(){if(this.model&&this.model.hasChildren&&!this.model.areChildrenInline){this._expander.classList.remove(ce.NO_EXPANDER_CSS_CLASS);this._expander.setAttribute("role","none");if(this.model.isExpanded){this._expander.classList.remove(ce.COLLAPSED_CSS_CLASS);this._expander.classList.add(ce.EXPANDED_CSS_CLASS)}else{this._expander.classList.remove(ce.EXPANDED_CSS_CLASS);this._expander.classList.add(ce.COLLAPSED_CSS_CLASS)}}else{this._expander.classList.remove(ce.EXPANDED_CSS_CLASS);this._expander.classList.remove(ce.COLLAPSED_CSS_CLASS);this._expander.classList.add(ce.NO_EXPANDER_CSS_CLASS)}}onModelPropertyChanged(e){switch(e){case"level":this.updateIndentationStyle();break;case"hasChildren":case"isExpanded":case"areChildrenInline":this.model&&this.model.isExpanded&&this.model.areChildrenInline&&this.collapse();this.updateExpanderCss()}this.onModelPropertyChangedOverride(e)}onExpansionClicked(e){e&&e.stopImmediatePropagation();this.expansionToggledCallback&&this.expansionToggledCallback()}onRootElementDblClicked(e){e&&e.srcElement&&e.srcElement===this._expander?e.stopImmediatePropagation():this.onExpansionClicked(e)}updateIndentationStyle(){this.model&&(this._expander.style.marginLeft=this.model.level*this.indentationInPixels+"px")}}ce.COLLAPSED_CSS_CLASS="BPT-itemCollapsed";ce.INDENTATION_IN_PIXELS_DEFAULT=13;ce.EXPANDED_CSS_CLASS="BPT-itemExpanded";ce.NO_EXPANDER_CSS_CLASS="BPT-noExpander";class ue extends re{constructor(e){super(e);this.dataItemTemplate=ce;this._onAriaExpandedModifiedHandler=this.onAriaExpandedModified.bind(this)}onApplyTemplate(){super.onApplyTemplate();this.rootElement.setAttribute("role","tree")}updateContainerOverride(e,t){super.updateContainerOverride(e,t);var i=e.item,s=e.template;if(i&&s){e.rootElement.removeEventListener("DOMAttrModified",this._onAriaExpandedModifiedHandler);s.expansionToggledCallback=this.onExpansionToggled.bind(this,e,t);if(i.hasChildren){e.rootElement.setAttribute("aria-expanded",i.isExpanded?"true":"false");e.rootElement.addEventListener("DOMAttrModified",this._onAriaExpandedModifiedHandler)}else e.rootElement.removeAttribute("aria-expanded");e.rootElement.setAttribute("role","treeitem")}s.updateGutterGlyphContainer()}onKeyDownOverride(e){var t,i,s=!1;switch(e.keyCode){case 39:if(n=this.getSelectedItemContainer()){t=n.template;i=n.item;if(!t.expand()&&i.hasChildren){this.selectNextItem();s=!0}}break;case 37:if(n=this.getSelectedItemContainer()){t=n.template;i=n.item;if(!t.collapse()&&i.level>0){this.dataSource.indexOfParent(i.id).then(e=>{e>=0&&(this.selectedIndex=e)});s=!0}}break;case 107:if(n=this.getSelectedItemContainer()){n.template.expand();s=!0}break;case 109:var n;if(n=this.getSelectedItemContainer()){n.template.collapse();s=!0}}s||(s=super.onKeyDownOverride(e));return s}cleanupContainerOverride(e){super.cleanupContainerOverride(e);var t=e.template;t&&(t.expansionToggledCallback=null);e.rootElement.removeEventListener("DOMAttrModified",this._onAriaExpandedModifiedHandler)}collapseItem(e){return this.dataSource.collapseBranch(e).then(()=>this.afterExpandCollapse())}expandItem(e){return this.dataSource.expandBranch(e).then(()=>this.afterExpandCollapse())}onAriaExpandedModified(e){if("aria-expanded"===e.attrName){var t=e.target,i=parseInt(t.getAttribute("data-id")),s=this.itemContainerGenerator.getItemContainerFromItemId(i);if(s){var n=s.template;"true"===e.newValue?n.expand():n.collapse()}}}onExpansionToggled(e,t){var i=e.item;this.selectedItem=i;i.isExpanded?this.collapseItem(t):this.expandItem(t)}afterExpandCollapse(){this.invalidate(!1);var e=this.getSelectedItemContainer();e&&e.focus()}}var ge=i(129),me=i(80),pe=i(40);class _e extends X.a{constructor(e,t){super("dividerTemplate");this._container=e;this._backdrop=this.findElement("dividerBackdrop");this._divider=this.findElement("divider");this._divider.addEventListener("mousedown",this.onMouseDown.bind(this),!0);this._container.appendChild(this._backdrop);this._container.appendChild(this._divider);this._minX=0;this.offsetX=t;this._onMouseMoveHandler=this.onMouseMove.bind(this);this._onMouseUpHandler=this.onMouseUp.bind(this)}set height(e){this._divider.style.height=e+"px";this._backdrop.style.height=e+"px"}get offsetX(){if(this._divider.style.left){var e=parseInt(this._divider.style.left);if(!isNaN(e))return e}return this._divider.offsetLeft}set offsetX(e){var t=e;t<this._minX?t=this._minX:t>this._maxX&&(t=this._maxX);this._divider.style.left=t+"px"}get minX(){return this._minX}set minX(e){this._minX=e;this.offsetX<this._minX&&(this.offsetX=this._minX)}get maxX(){return this._maxX}set maxX(e){this._maxX=e;this.offsetX>this._maxX&&(this.offsetX=this._maxX)}onMouseDown(e){this._backdrop.style.zIndex="1000";this._backdrop.appendChild(this._divider);document.addEventListener("mousemove",this._onMouseMoveHandler,!0);document.addEventListener("mouseup",this._onMouseUpHandler,!0)}onMouseMove(e){this.updateOffsetX(e.x)&&this.onMoved&&this.onMoved(this._divider.offsetLeft);e.stopImmediatePropagation();e.preventDefault()}onMouseUp(e){this._container.firstChild?this._container.insertBefore(this._divider,this._container.firstChild):this._container.appendChild(this._divider);this._backdrop.style.zIndex="-1";document.removeEventListener("mousemove",this._onMouseMoveHandler,!0);document.removeEventListener("mouseup",this._onMouseUpHandler,!0);this.updateOffsetX(e.x)&&this.onMoved&&this.onMoved(this._divider.offsetLeft)}updateOffsetX(e){if((e-=this._backdrop.clientLeft)<this._divider.offsetLeft||e>this._divider.offsetLeft+this._divider.offsetWidth){this.offsetX=e;return!0}return!1}}var ve,be,Ce=i(26);class Se extends Ce.a{constructor(e=0){super(e)}static fromBigNumber(e){var t=e.jsonValue.l,i=e.jsonValue.h;t<0&&(t>>>=0);i<0&&(i>>>=0);var s=4294967296*i+t;return new Ce.a(s)}static toBigNumber(e){return Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e.nsec)}}class fe{constructor(e=new Ce.a,t=new Se){this._begin=e;this._end=t;if(this._begin.nsec>this._end.nsec)throw new Error(Object(o.a)("JSPerf.1042"))}get begin(){return this._begin}get end(){return this._end}get elapsed(){return new Ce.a(this._end.nsec-this.begin.nsec)}static fromJsonTimespan(e){var t=Se.fromBigNumber(e.begin),i=Se.fromBigNumber(e.end);return new fe(t,i)}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}toJsonTimespan(){return new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(Se.toBigNumber(this._begin),Se.toBigNumber(this._end))}}class Ee{}Ee.DetailsPaneLoaded="ResponsivenessNotifications.DetailsPaneLoaded";Ee.GraphCollapsed="ResponsivenessNotifications.GraphCollapsed";Ee.GraphExpanded="ResponsivenessNotifications.GraphExpanded";Ee.GridRowSelected="ResponsivenessNotifications.GridRowSelected";Ee.GridScrolled="ResponsivenessNotifications.GridScrolled";Ee.GridUpdatedForFilter="ResponsivenessNotifications.GridUpdatedForFilter";Ee.GridUpdatedForTimeSelection="ResponsivenessNotifications.GridUpdatedForTimeSelection";Ee.ResetZoomFinished="ResponsivenessNotifications.ResetZoomFinished";Ee.ResultsLoaded="ResponsivenessNotifications.ResultsLoaded";Ee.SaveSessionFinished="ResponsivenessNotifications.SaveSessionFinished";Ee.SortFinishedOnGrid="ResponsivenessNotifications.SortFinishedOnGrid";Ee.UserSelectedTimeslice="ResponsivenessNotifications.UserSelectedTimeslice";Ee.ZoomInFinished="ResponsivenessNotifications.ZoomInFinished";!function(e){e[e.ImageDecoding=0]="ImageDecoding";e[e.GC=1]="GC";e[e.Loading=2]="Loading";e[e.Rendering=3]="Rendering";e[e.Scripting=4]="Scripting";e[e.Styling=5]="Styling";e[e.Measure=6]="Measure";e[e.Frame=7]="Frame";e[e.Idle=8]="Idle"}(ve||(ve={}));!function(e){e[e.Html=0]="Html";e[e.String=1]="String"}(be||(be={}));class we extends J.a{constructor(e){super(e||"VisualProfiler.eventDataTooltip")}static initialize(){W.a.defineProperty(we,we.EventPropertyName,null,e=>e.onEventChanged())}onEventChanged(){if(this.event){var e=this.getNamedElement("durationExc"),t=this.getNamedElement("durationInc"),i=this.getNamedElement("startTime");e.textContent=Object(o.b)("DurationLabelExclusive",N.a.getPrettyPrintTime(this.event.exclusiveDuration));t.textContent=Object(o.b)("DurationLabelInclusive",N.a.getPrettyPrintTime(this.event.timeSpan.elapsed));i.textContent=Object(o.b)("StartTimeLabel",N.a.getPrettyPrintTime(this.event.timeSpan.begin))}}}we.EventPropertyName="event";we.initialize();class Ie extends ce{constructor(e){super(e||"VisualProfiler.eventDataTemplate")}get canViewSource(){var e=this.model.context?this.model.context.sourceInfo:null;return Ie.hasViewSourceInfo(e)}get canShowInDomExplorer(){return me.a.isAvailable&&this.model.canShowInDomExplorer()}get parentTimeSpan(){return this._parentTimeSpan}set parentTimeSpan(e){if(!this._parentTimeSpan||!e||!this._parentTimeSpan.equals(e)){this._parentTimeSpan=e;this.updateEventUi()}}static addTokens(e,t,i){var s;switch(i){case be.Html:s=Y.a.getHtmlTokens(e);break;case be.String:s=Y.a.getStringTokens(e)}if(s&&s.length>0)for(var n=0;n<s.length;n++){var a=s[n],r=document.createElement("span");r.className=Y.a.getCssClass(a.type);r.textContent=a.value;t.appendChild(r)}else t.textContent=e}static hasViewSourceInfo(e){return e&&"<DOM>"!==e.source}static setViewSourceHandler(e,t,i,s){e.addEventListener("mouseover",e=>Ie.showSourceInfoTooltip(e,t,s));e.addEventListener("mouseout",e=>d.a());e.onclick=Ie.contextMouseHandler.bind(this,t);if(i){e.tabIndex=0;e.onkeydown=Ie.contextKeyHandler.bind(this,t)}}static showSourceInfoTooltip(e,t,i){if(t){var s=t,n={content:new ge.a(s,i,"SourceInfoEventLabel").html,contentContainsHTML:!0};d.c(n);e.stopImmediatePropagation()}}static tryClearDomElementHighlight(){me.a.isAvailable&&me.a.clearHighlight()}onApplyTemplate(){super.onApplyTemplate();this._bar=this.getNamedElement("bar");Q.a.isTrue(this._bar,"Expecting an element named bar");this._durationText=this.getNamedElement("durationText");Q.a.isTrue(this._durationText,"Expecting an element named durationText");this._eventDataTemplateNameCell=this.getNamedElement("eventDataTemplateNameCell");Q.a.isTrue(this._eventDataTemplateNameCell,"Expecting an element named eventDataTemplateNameCell");this._eventData=this.getNamedElement("eventData");Q.a.isTrue(this._eventData,"Expecting an element named eventData");this._eventName=this.getNamedElement("eventName");Q.a.isTrue(this._eventName,"Expecting an element named eventName");this._bar.addEventListener("mouseover",e=>this.showBarTooltip());this._bar.addEventListener("mouseout",e=>d.a());this._eventName.addEventListener("mouseover",e=>this.showEventNameTooltip(e));this._eventName.addEventListener("mouseout",e=>d.a())}tryViewSource(){if(this.canViewSource){var e=this.model.context.sourceInfo;Ie.viewSource(e.source,e.line,e.column)}}tryHighlightDomElement(){var e=this.model.getUidChain();this.canShowInDomExplorer&&e?me.a.highlightElement(e):Ie.tryClearDomElementHighlight()}trySelectInDomExplorer(){if(this.canShowInDomExplorer){var e=this.model.getUidChain();e&&me.a.selectDomElement(e)}}onModelChanged(){super.onModelChanged();if(this._sourceMapChangedEventRegistration){this._sourceMapChangedEventRegistration.unregister();this._sourceMapChangedEventRegistration=null}this.model&&(this._sourceMapChangedEventRegistration=this.model.sourceInfoChanged.addHandler(this.updateEventUi.bind(this)));this.updateEventUi()}static contextKeyHandler(e,t){13!==t.keyCode&&32!==t.keyCode||t.ctrlKey||t.altKey||t.shiftKey||Ie.viewSource(e.source,e.line,e.column)}static contextMouseHandler(e){window.setImmediate(()=>{Ie.viewSource(e.source,e.line,e.column)})}static setBarCss(e,t){e.className="eventBar "+t.getCssClass();var i=t.getBarCssClass();i&&e.classList.add(i)}static viewSource(e,t,i){pe.h(e,t,i).then(()=>{},e=>{ni.hostShell.setStatusBarText(Object(o.b)("UnableToNavigateToSource"),!0)})}getContextSpan(e,t,i,s){var n=document.createElement("span"),a=t;if(-1!==i.source.indexOf(t,i.source.length-t.length)){var r=i.source.substring(0,i.source.length-t.length);a=s.source.replace(r,"")}n.textContent=a;if(Ie.hasViewSourceInfo(i)){n.className="BPT-FileLink";Ie.setViewSourceHandler(n,i,!1,e)}return n}showBarTooltip(){if(this.model){var e=new we;e.event=this.model;var t={content:e.rootElement.innerHTML,contentContainsHTML:!0};d.c(t)}}showEventNameTooltip(e){if(this.model){var t=e.currentTarget,i=this._eventName.textContent;if(t.offsetWidth<t.scrollWidth){var s={content:i};d.c(s)}}}updateEventUi(){if(this.model&&this._parentTimeSpan){var e=this.model;if(e.context){this._eventName.textContent="";var t=(e,t)=>{if(e){var i=document.createElement("span");i.textContent=e;t.appendChild(i)}};t(e.fullName.substring(0,e.context.span.startIndex),this._eventName);var i=e.sourceInfo?e.sourceInfo:e.context.sourceInfo,s=e.context.sourceInfo,n=e.fullName.substring(e.context.span.startIndex,e.context.span.endIndex),a=this.getContextSpan(e.name,n,s,i);this._eventName.appendChild(a);t(e.fullName.substring(e.context.span.endIndex),this._eventName)}else if(e instanceof Oe&&Y.a.isHtmlExpression(e.fullName)){this._eventName.textContent="";Ie.addTokens(e.fullName,this._eventName,be.Html)}else if(e instanceof Oe&&Y.a.isStringExpression(e.fullName)){this._eventName.textContent="";Ie.addTokens(e.fullName,this._eventName,be.String)}else this._eventName.textContent=e.fullName;var r=(e.timeSpan.begin.nsec-this._parentTimeSpan.begin.nsec)/this._parentTimeSpan.elapsed.nsec*100,o=e.timeSpan.elapsed.nsec/this._parentTimeSpan.elapsed.nsec*100;this._bar.style.marginLeft=r+"%";this._bar.style.width=o+"%";Ie.setBarCss(this._bar,e);var l=N.a.getPrettyPrintTime(e.timeSpan.elapsed);e.exclusiveDuration.equals(e.timeSpan.elapsed)||(l+=" ("+N.a.getPrettyPrintTime(e.exclusiveDuration)+")");this._durationText.textContent=l}}}class Te extends ue{constructor(e){super(e);this._columnsCssRule=this.getColumnsCssRule();this.ariaLabel=Object(o.b)("EventsTimelineAriaLabel");this.dataItemTemplate=Ie;this.onGetItemContainerAriaLabel=(e=>this.getItemContainerAriaLabel(e));this.onScrolled=(()=>{K.a.notify(Ee.GridScrolled);A.logPerformance({id:$.b.Timeline_GridScrolled})});ni.addEventListener(P.Resize,()=>{this._columnsCssRule=this.getColumnsCssRule();this.invalidateSizeCache();if(this._viewModel){this.setDividerBounds();this.resizeColumns(this._divider.offsetX)}this.onWindowResize()});this._divider=new _e(this.panel.rootElement,this.eventNameColumnWidth);this._divider.minX=90;this._divider.onMoved=(e=>{this.resizeColumns(e);ni.triggerResize()});this.setDividerBounds();this._verticalRulerLineElementsFactory=te.forDivWithClass(this.rootElement,"verticalRulerLine");this.invalidateSizeCache()}get dataColumnLeft(){var e=this._columnsCssRule.style.msGridColumns.split(" ");return parseInt(e[0])+parseInt(e[1])}get dataColumnWidth(){if(null===this._dataColumnWidth){var e=this.panel.rootElement.offsetWidth-this.panel.rootElement.clientWidth;this._dataColumnWidth=this.rootElement.offsetWidth-this.dataColumnLeft-e}return this._dataColumnWidth}get eventNameColumnWidth(){var e=this._columnsCssRule.style.msGridColumns.split(" ");return parseInt(e[0])}get rulerScale(){return this._rulerScale}set rulerScale(e){this._rulerScale!==e&&(this._rulerScale=e)}set timeSpan(e){this._timeSpan=e}set viewModel(e){this._viewModel=e}filterToEvent(){var e=this.getSelectedEventDataTemplate();if(e){e.expand();var t=this.selectedItem,i=this.getFilterTimeSpan(t),s=this._viewModel.globalRuler.activeRange;if(!s.equals(this._viewModel.globalRuler.totalRange)){var n=i.begin.nsec<s.begin.nsec?i.begin:s.begin,a=i.end.nsec>s.end.nsec?i.end:s.end;this._viewModel.globalRuler.setActiveRange(new fe(n,a))}this._viewModel.timeSpan=i;this._viewModel.globalRuler.setSelection(i);window.setImmediate(()=>{var e=this.getSelectedItemContainer();e&&e.focus()})}}invalidateSizeCache(){this._dataColumnWidth=null;super.invalidateSizeCache()}onInvalidated(){this.updateDividerHeight()}onKeyDownOverride(e){var t=!1;switch(e.keyCode){case 13:this.viewSource();t=!0}t||(t=super.onKeyDownOverride(e));return t}onSelectedItemChangedOverride(e){this.updateHighlightedElement()}onShowContextMenu(){var e=this.getSelectedEventDataTemplate();if(e&&this._contextMenu){var t=e.rootElement.getBoundingClientRect();this._contextMenu.show(t.left+t.width/2,t.top+t.height/2,t.width)}}renderVerticalRulerLines(){var e=this._viewModel.getVerticalRulerLinePositions(this.dataColumnWidth);this._verticalRulerLineElementsFactory.start();for(var t=0;t<e.length;++t){var i=this._verticalRulerLineElementsFactory.getNext(),s=this.dataColumnWidth*e[t]/100+this.dataColumnLeft;this.positionVerticalRulerLine(i,s,this.panel.viewportHeight)}this._verticalRulerLineElementsFactory.stop()}updateHighlightedElement(){var e=this.getSelectedEventDataTemplate();e?e.tryHighlightDomElement():Ie.tryClearDomElementHighlight()}clearHighlightedElement(){Ie.tryClearDomElementHighlight()}updateContainerOverride(e,t){super.updateContainerOverride(e,t);var i=e.template;if(i){i.parentTimeSpan=this._timeSpan;i.rootElement.getAttributeNode("data-plugin-contextmenu")||this.setupEventContextMenu(i.rootElement)}}positionVerticalRulerLine(e,t,i){e.style.left=t+"px";e.style.height=i+"px";e.style.top="0px"}getColumnsCssRule(){return gt.getCssRule("VisualProfiler",".eventDataTemplate")}resizeColumns(e){this._dataColumnWidth=null;this.updateColumnWidth(e);this.dataColumnWidthChanged&&this.dataColumnWidthChanged();this.renderVerticalRulerLines()}setupEventContextMenu(...e){if(!this._contextMenu){var t=this.getSelectionContextMenuIconNames(),i={callback:()=>{this.filterToEvent()},label:Object(o.b)("FilterToEventContextMenu"),type:ee.MenuItemType.command,disabled:()=>!1},s={callback:()=>{this.clearSelection()},label:Object(o.b)("ToolbarButtonClearSelection"),type:ee.MenuItemType.command,iconEnabled:t.clearSelection.enabled,iconDisabled:t.clearSelection.disabled,disabled:()=>this.isClearFilterDisabled()},n={type:ee.MenuItemType.separator},a={callback:()=>window.setImmediate(this.showInDomExplorer.bind(this)),disabled:this.isShowInDomExplorerCommandDisabled.bind(this),hidden:()=>!me.a.isAvailable,label:Object(o.b)("ShowInDomExplorerLabel"),type:ee.MenuItemType.command},r={accessKey:Object(o.b)("EnterKey"),callback:()=>window.setImmediate(this.viewSource.bind(this)),disabled:this.isViewSourceCommandDisabled.bind(this),label:Object(o.b)("ViewSourceLabel"),type:ee.MenuItemType.command};this._contextMenu=ee.create([i,s,n,a,r])}for(var l=0;l<e.length;l++)this._contextMenu.attach(e[l])}getSelectionContextMenuIconNames(){return{zoomin:{enabled:"f12-image-contextmenu-chartzoom-in",disabled:"f12-image-contextmenu-chartzoom-in-disabled"},resetZoom:{enabled:"f12-image-contextmenu-chartzoom-reset",disabled:"f12-image-contextmenu-chartzoom-reset-disabled"},clearSelection:{enabled:"f12-image-contextmenu-chartselection-clear",disabled:"f12-image-contextmenu-chartselection-clear-disabled"}}}isClearFilterDisabled(){return this._viewModel.globalRuler.selection.equals(this._viewModel.globalRuler.activeRange)}isShowInDomExplorerCommandDisabled(){var e=this.getSelectedEventDataTemplate();return!e||!e.canShowInDomExplorer}isViewSourceCommandDisabled(){var e=this.getSelectedEventDataTemplate();return!e||!e.canViewSource}getFilterTimeSpan(e){var t=e.timeSpan,i=this._viewModel.globalRuler.totalRange,s=Math.max(t.begin.nsec,i.begin.nsec),n=Math.min(t.end.nsec,i.end.nsec);return new fe(new Se(s),new Se(n))}clearSelection(){var e=this.getSelectedEventDataTemplate();e&&e.collapse();this._viewModel.globalRuler.setSelection(this._viewModel.globalRuler.activeRange);window.setImmediate(()=>{var e=this.getSelectedItemContainer();e&&e.focus()})}showInDomExplorer(){var e=this.getSelectedEventDataTemplate();e&&e.trySelectInDomExplorer()}viewSource(){var e=this.getSelectedEventDataTemplate();e&&e.tryViewSource()}setDividerBounds(){var e=this.panel.rootElement.offsetWidth;e>0&&(this._divider.maxX=e/2)}getSelectedEventDataTemplate(){var e=this.getSelectedItemContainer();return e?e.template:null}getItemContainerAriaLabel(e){var t,i=e.item;if(i){t=i.name;t+=" , "+Object(o.b)("StartTimeLabel",N.a.getPrettyPrintTime(i.timeSpan.begin));t+=" , "+Object(o.b)("DurationLabelInclusive",N.a.getPrettyPrintTime(i.timeSpan.elapsed));i.timeSpan.elapsed.equals(i.exclusiveDuration)||(t+=" , "+Object(o.b)("DurationLabelExclusive",N.a.getPrettyPrintTime(i.exclusiveDuration)));t+=" , "+Object(o.b)("ThreadContextLabel",i.contextThreadId||Object(o.b)("UIThreadContext"));for(var s=this._viewModel.getEventDetails(i),n=0;n<s.length;n++)t+=" , "+s[n].localizedName+": "+s[n].localizedValue;t+=" , "+i.getDescription();var a=ut.GetAsyncFrames(i);if(a.length>0){t+=", "+Object(o.b)("AsyncStackLabel");for(var r=0;r<a.length;r++){for(var l=0;l<a[r].length;l++)t+=", "+a[r][l].name;r+1<a.length&&(t+=", "+Object(o.b)("AsyncStackTransition"))}}e.rootElement.setAttribute("aria-label",t)}else e.rootElement.removeAttribute("aria-label");return t}updateColumnWidth(e){null!==e&&void 0!==e||(e=this._divider.offsetX);var t=this._columnsCssRule.style.msGridColumns.split(" ");t[0]=e+"px";this._columnsCssRule.style.msGridColumns=t.join(" ")}updateDividerHeight(){if(this._divider){var e=Math.max(this.panel.virtualHeight,this.panel.actualHeight);this._divider.height=e}}}class De{static get mappedSourcesCount(){return Object.keys(this._mappedSources).length}static addMappings(e){this.ensureRegisteredForSourceMapStateChangedEvent();for(var t=new Array,i=0;i<e.length;++i){let r=e[i];if(r.context){var s=r.context.sourceInfo,n=this.getSourceInfoKey(s);if(!this._mappedSources[n]){var a={originalSource:s,translatedSource:s};this._mappedSources[n]=a;let e=pe.g(s.source,s.line,s.column).then(e=>{this._mappedSources[n].translatedSource={source:e.documentPath,line:e.oneBasedLine,column:e.oneBasedColumn}});t.push(e);continue}}t.push(Promise.resolve(null))}}static clearMappings(){this._mappedSources={}}static getMappedSourceInfo(e){var t=this.getSourceInfoKey(e),i=this._mappedSources[t];return i?Promise.resolve(i.translatedSource):pe.g(e.source,e.line,e.column).then(i=>{var s={column:i.oneBasedColumn,line:i.oneBasedLine,name:e.name,source:i.documentPath};this._mappedSources[t]={originalSource:e,translatedSource:s};return this._mappedSources[t].translatedSource})}static ensureRegisteredForSourceMapStateChangedEvent(){if(!this._registeredForEvent){Object(E.g)().listen("onSourceMapStateChanged",e=>this.onSourceMapStateChanged(e));this._registeredForEvent=!0}}static onSourceMapStateChanged(e){let t=encodeURI(e.customData),i=[];for(let e in this._mappedSources)this._mappedSources[e].originalSource.source===t&&i.push(e);if(i.length>0){let e=i.map(e=>{let t=this._mappedSources[e].originalSource;return pe.g(t.source,t.line,t.column).then(t=>{this._mappedSources[e].translatedSource={source:t.documentPath,line:t.oneBasedLine,column:t.oneBasedColumn}})});Promise.all(e).then(()=>{this.sourceMappingChanged.invoke({url:t})})}}static getSourceInfoKey(e){return e.source+"_"+e.line+"_"+e.column}}De._mappedSources={};De._registeredForEvent=!1;De.sourceMappingChanged=new z.a;class ye extends J.a{constructor(e){super("VisualProfiler.asyncStackFrameItem");this._sourceInfo=e;this.model=this._sourceInfo;this.updateTranslatedSourceInfo(this._sourceInfo.source)}updateTranslatedSourceInfo(e){e&&e!==this._sourceInfo.source||De.getMappedSourceInfo(this._sourceInfo).then(e=>{this.model=e})}onModelChanged(){this.setUpViewSourceHandler()}setUpViewSourceHandler(){Ie.setViewSourceHandler(this.rootElement,this._sourceInfo,!0)}}var Re=i(47),xe=i(31);class Pe{constructor(e,t,i,s){this._totalValue=0;this._container=e;this._sectBaseData=[];this._labelOffset=8;this._renderTooltipCallback=t;this._addSectorAriaLabelCallback=i;var n=Object(xe.b)().getValue("plugin-font-size");-1!==n.indexOf("px")?this._textFontPx=parseInt(n.substring(0,n.indexOf("px"))):-1!==n.indexOf("pt")?this._textFontPx=Math.round(parseInt(n.substring(0,n.indexOf("pt")))/.75):this._textFontPx=0;this._config=s||{explosionFactor:2,radius:55,strokeWidth:25,minDonutArcAngle:10,containerWidth:200,containerHeight:200,clockwiseRotation:!0};this._centerX=this._config.containerWidth/2;this._centerY=this._config.containerHeight/2;this._div=this.createDivContainer();this._container.appendChild(this._div)}get centerX(){return this._centerX}get centerY(){return this._centerY}get containerHeight(){return this._config.containerHeight}get containerWidth(){return this._config.containerWidth}get clockwiseRotation(){return this._config.clockwiseRotation}get explosionFactor(){return this._config.explosionFactor}get radius(){return this._config.radius}get strokeWidth(){return this._config.strokeWidth}get sectors(){return this._sectBaseData}addSector(e){this.addSectorToBaseSeries(e)}addSectors(e){for(var t=0;t<e.length;t++)this.addSector(e[t])}removeSector(e){var t=this.getSectorIndex(e);if(-1===t)throw new Error(Object(o.a)("JSPerf.1061"));this._totalValue-=e.value;this._sectBaseData.splice(t,1)}removeSectors(e){for(var t=0;t<e.length;t++)this.removeSector(e[t])}render(){var e=this.buildChartData(this._sectBaseData),t=this.calculatePoints(e);this.draw(t)}resetDonutChart(){this._totalValue=0;this._sectBaseData=[];this._container.removeChild(this._svg);this._svg=this.createSVG();this._container.appendChild(this._svg)}addSectorToBaseSeries(e){this._totalValue+=e.value;this._sectBaseData.push(e)}buildChartData(e){var t=[];if(1===e.length)t.push({startAngle:0,endAngle:360,percentValue:100,info:{name:e[0].name,cssClass:e[0].cssClass,value:e[0].value}});else{var i=0,s=0,n=0,a=this.getReductionFactor(e);for(n=0;n<e.length-1;n++){s=e[n].value;var r=Math.round(360*s/this._totalValue),o=parseFloat((100*s/this._totalValue).toFixed(2));r=r<this._config.minDonutArcAngle?this._config.minDonutArcAngle:Math.round(a*r);t.push({startAngle:i,endAngle:i+r-this._config.explosionFactor,percentValue:o,info:{name:e[n].name,cssClass:e[n].cssClass,value:e[n].value}});if((i+=r)>=360)break}if(n===e.length-1&&i<360){s=e[n].value;r=360-i,o=parseFloat((100*s/this._totalValue).toFixed(2));t.push({startAngle:i,endAngle:i+r-this._config.explosionFactor,percentValue:o,info:{name:e[n].name,cssClass:e[n].cssClass,value:e[n].value}});i+=r}}return t}calculatePoints(e){for(var t,i=this._config.radius,s=this._config.radius+this._config.strokeWidth/2+this._labelOffset,n=[],a=0;a<e.length;a++){var r=e[a].startAngle,o=e[a].endAngle,l=1===e.length?0:(r+o)/2,h=i*Math.sin(r*Math.PI/180),d=i*Math.cos(r*Math.PI/180)*-1,c=i*Math.sin(o*Math.PI/180),u=i*Math.cos(o*Math.PI/180)*-1;if(l<180&&l>0){s=e[a].percentValue>9?s+this._textFontPx/2:s;t="start"}else t=l>180?"end":"middle";var g=s*Math.sin(l*Math.PI/180),m=s*Math.cos(l*Math.PI/180)*-1,p=o-r>180?1:0,_=this._config.clockwiseRotation?1:0;n.push({startPoint:{x:h,y:d},endPoint:{x:c,y:u},label:{point:{x:g,y:m},anchor:t},percentValue:e[a].percentValue,largeArc:p,sweepFlag:_,info:e[a].info})}return n}createDivContainer(){var e=document.createElement("div");e.style.width="100%";e.style.height="100%";return e}createSVG(){var e=document.createElementNS(Pe.SvgNS,"svg");e.setAttribute("version","1.1");e.setAttribute("width",this._config.containerWidth+"px");e.setAttribute("height",this._config.containerHeight+"px");e.setAttribute("focusable","false");return e}createSVGPath(e,t,i,s){var n=document.createElementNS(Pe.SvgNS,"path");n.setAttribute("class",e);n.setAttribute("d",t);n.setAttribute("stroke-width",i.toString());if(this._renderTooltipCallback){n.onmouseover=(()=>this.showToolTip(s.info,s.percentValue));n.onmouseout=(e=>d.a())}this._addSectorAriaLabelCallback&&this._addSectorAriaLabelCallback(s.info,s.percentValue);return n}createSVGText(e,t,i,s){var n=document.createElementNS(Pe.SvgNS,"text");n.setAttribute("x",e.toString());n.setAttribute("y",t.toString());n.setAttribute("text-anchor",i);n.setAttribute("class","BPT-donutChartText");n.textContent=Object(o.b)("InclusiveTimeSVGLabelString",Math.floor(s));return n}draw(e){void 0!==this._svg&&this._div.removeChild(this._svg);this._svg=this.createSVG();if(1===e.length){var t=0,i="M "+this._centerX+","+this._centerY+" M "+(this._centerX+e[t].startPoint.x)+", "+(this._centerY+e[t].startPoint.y)+" A "+this._config.radius+","+this._config.radius+" 1 "+e[t].largeArc+", "+e[t].sweepFlag+" "+(this._centerX+e[t].startPoint.x)+","+(this._centerY+e[t].startPoint.y+2*this._config.radius)+" A "+this._config.radius+","+this._config.radius+" 1 "+e[t].largeArc+", "+e[t].sweepFlag+" "+(this._centerX+e[t].endPoint.x)+","+(this._centerY+e[t].endPoint.y),s=this.createSVGPath(e[t].info.cssClass,i,this._config.strokeWidth,e[t]);this._svg.appendChild(s);var n=this.createSVGText(this._centerX+e[t].label.point.x,this._centerY+e[t].label.point.y,e[t].label.anchor,e[t].percentValue);this._svg.appendChild(n)}else if(e.length>1)for(t=0;t<e.length;t++){i="M "+this._centerX+","+this._centerY+" M "+(this._centerX+e[t].startPoint.x)+", "+(this._centerY+e[t].startPoint.y)+" A "+this._config.radius+","+this._config.radius+" 1 "+e[t].largeArc+", "+e[t].sweepFlag+" "+(this._centerX+e[t].endPoint.x)+","+(this._centerY+e[t].endPoint.y),s=this.createSVGPath(e[t].info.cssClass,i,this._config.strokeWidth,e[t]);this._svg.appendChild(s);if(e[t].percentValue>Math.round(100*this._config.minDonutArcAngle/360)){n=this.createSVGText(this._centerX+e[t].label.point.x,this._centerY+e[t].label.point.y,e[t].label.anchor,e[t].percentValue);this._svg.appendChild(n)}}this._div.appendChild(this._svg)}getReductionFactor(e){var t=0,i=0,s=0;for(i=0;i<e.length;i++)s+=(t=Math.round(360*e[i].value/this._totalValue))<this._config.minDonutArcAngle?this._config.minDonutArcAngle-t:0;return 1-s/360}getSectorIndex(e){for(var t=0;t<this._sectBaseData.length;t++)if(this._sectBaseData[t]===e||this._sectBaseData[t].name===e.name&&this._sectBaseData[t].cssClass===e.cssClass&&this._sectBaseData[t].value===e.value)return t;return-1}showToolTip(e,t){var i=this._renderTooltipCallback(e,t);if(""!==i&&null!==i&&void 0!==i){var s={content:i};d.c(s)}}}Pe.SvgNS="http://www.w3.org/2000/svg";class Me{constructor(){this._sectors=[]}get headerText(){return this._headerText}set headerText(e){this._headerText=e}get sectors(){return this._sectors}addSector(e){this._sectors.push(e)}}class Le{constructor(e){this._model=new Me;this._view=new Ae(e,this)}get model(){return this._model}get view(){return this._view}}class Ae extends Re.a{constructor(e,t){super(e);this._controller=t;this.rootElement.tabIndex=0;var i={explosionFactor:2,radius:45,strokeWidth:20,minDonutArcAngle:10,containerWidth:210,containerHeight:180,clockwiseRotation:!0};this._donutChart=new Pe(this.rootElement,this.onRenderSectorTooltip.bind(this),this.onAddSectorAriaLabel.bind(this),i);this._ariaLabel=Object(o.b)("InclusiveTimeAriaLabel");this.rootElement.setAttribute("aria-label",this._ariaLabel)}render(){this.addHeaderElement();Ae.sortEventsByValue(this._controller.model.sectors);this._donutChart.addSectors(this._controller.model.sectors);this._donutChart.render()}static sortEventsByValue(e){e.sort((e,t)=>t.value-e.value)}addHeaderElement(){var e=document.createElement("div");e.style.marginLeft="10px";var t=document.createElement("span");t.innerText=this._controller.model.headerText;e.appendChild(t);this.rootElement.insertBefore(e,this.rootElement.firstChild);this.addHeaderAriaLabel()}addHeaderAriaLabel(){if(this._controller.model&&this._controller.model.headerText&&this._ariaLabel){this._ariaLabel=`${this._controller.model.headerText}, ${this._ariaLabel}`;this.rootElement.setAttribute("aria-label",this._ariaLabel)}}onAddSectorAriaLabel(e,t){if(this.addSectorAriaLabel){const i=this.addSectorAriaLabel(e,t);if(i){this._ariaLabel=`${this._ariaLabel}, ${i}`;this.rootElement.setAttribute("aria-label",this._ariaLabel)}}}onRenderSectorTooltip(e,t){var i=N.a.getPrettyPrintTime(new Se(e.value));return Object(o.b)("SectorTooltipFormat",e.name,N.a.getDecimalLocaleString(t,!1),i)}}class ke{constructor(e){this._totalRange=e;this._activeRange=this._selection=this._totalRange;this._selectionWasFinal=!1;this._onViewSelectionChangedHandler=this.onViewSelectionChanged.bind(this);this._publisher=new f.a;this._viewEventManager=Microsoft.VisualStudio.DiagnosticsHub.getViewEventManager();this._viewEventManager.selectionChanged.addEventListener(this._onViewSelectionChangedHandler)}get totalRange(){return this._totalRange}get selection(){return this._selection}get activeRange(){return this._activeRange}deinitialize(){this._viewEventManager.selectionChanged.removeEventListener(this._onViewSelectionChangedHandler)}setSelection(e,t=!1){this.setSelectionInternal(e,t,!1)}setActiveRange(e){if(!this._activeRange.equals(e)){this._activeRange=e;this._publisher.dispatchEvent(ke.ActiveRangeChangedEventType)}}addEventListener(e,t){this._publisher.addEventListener(e,t)}removeEventListener(e,t){this._publisher.removeEventListener(e,t)}setSelectionInternal(e,t=!1,i=!1){var s=!this._selection.equals(e),n=this._selectionWasFinal!==!t;this._selectionWasFinal=!t;if(s||n&&!t){A.logPerformance({id:$.b.Timeline_UserSelectedTimeSlice_Start});var a=Se.fromNanoseconds(Math.max(e.begin.nsec,this._activeRange.begin.nsec)),r=Se.fromNanoseconds(Math.min(e.end.nsec,this._activeRange.end.nsec));this._selection=new fe(a,r);i||this._viewEventManager.selectionChanged.raiseEvent({position:this._selection.toJsonTimespan(),isIntermittent:t});this._publisher.dispatchEvent(ke.SelectionChangedEventType,{data:{isIntermittent:t,newSelection:e}});K.a.notify(Ee.UserSelectedTimeslice);A.logPerformance({id:$.b.Timeline_UserSelectedTimeSlice_Stop})}}onViewSelectionChanged(e){var t=fe.fromJsonTimespan(e.position),i=t.begin.nsec===this._totalRange.begin.nsec&&t.end.nsec===this._totalRange.end.nsec,s=t.begin.nsec===this._selection.begin.nsec&&t.end.nsec===this._selection.end.nsec;i||s||A.logExecuteCommand(k.SELECT_RANGE,j.c.Ui);this.setSelectionInternal(t,e.isIntermittent,!0)}}ke.SelectionChangedEventType="selectionChanged";ke.ActiveRangeChangedEventType="activeRangeChanged";class Ve{constructor(e){this._interval=e}get tag(){if(void 0===this._tag){this._tag="";this._interval.element&&this._interval.element.tag&&(this._tag=this._interval.element.tag.toLowerCase())}return this._tag}get cssId(){if(void 0===this._cssId){this._cssId="";this._interval.element&&this._interval.element.id&&(this._cssId=this._interval.element.id)}return this._cssId}get cssClass(){if(void 0===this._cssClass){this._cssClass="";this._interval.element&&this._interval.element.class&&(this._cssClass=this._interval.element.class)}return this._cssClass}get uidChain(){if(void 0===this._uidChain){this._uidChain="";this._interval.element&&this._interval.element.uidChain&&(this._uidChain=this._interval.element.uidChain)}return this._uidChain}}class Oe{constructor(e,t,i){this.details=[];this.sourceInfoChanged=new z.a;this._interval=e;this._asyncStackJson=e.asyncStackJson;this._category=t;this._contextThreadId=Oe.getContextThreadId(e,i);this._exclusiveTimeSpan=Se.fromNanoseconds(e.exclusiveDuration);this._timeSpan=new fe(Se.fromNanoseconds(e.begin),Se.fromNanoseconds(e.end))}get asyncStackJson(){return this._asyncStackJson}get category(){return this._category}get childrenCount(){return this._interval.childrenCount}get context(){return this._interval.context}get contextThreadId(){return this._contextThreadId}get exclusiveDuration(){return this._exclusiveTimeSpan}get fullName(){return this._interval.fullName}get hasChildren(){return this.childrenCount>0}get id(){return this._interval.id}get interval(){return this._interval}get isExpanded(){return this._interval.isExpanded}get level(){return this._interval.level}get name(){void 0===this._name&&(this._name=this.createName());return this._name}get sourceInfo(){return null}get timeSpan(){return this._timeSpan}get title(){return this.name}static convertBooleanToYesNoLabel(e){return e?"YesLabel":"NoLabel"}static convertPropagationStatus(e){return{preventDefaultCalled:0!=(1&e),stopImmediatePropagationCalled:0!=(2&e),stopPropagationCalled:0!=(4&e)}}static createElementString(e,t,i){var s="",n=!1;if(""!==e){n=!0;s+="<"+e}else s+="<"+Object(o.b)("UnknownElement");if(""!==t){n=!0;s+=' id="'+t+'"'}if(""!==i){n=!0;s+=' class="'+i+'"'}s+=">";!1===n&&(s="");return s}static createShortenedUrlTextWithQueryString(e){if(!e||0===e.indexOf("data:image"))return e;var t=e.split("/");return Oe.isFile(e)?t[t.length-1]:Oe.isUrl(e)&&t.length>3?"/"+t.slice(3,t.length).join("/"):e}createDetailInfo(e,t,i,s,n){var a;a=s?Object(o.b)(s):t;var r={propertyName:e,propertyValue:t,localizedName:i?Object(o.b)(i):e,localizedValue:a};n&&(r.sourceInfo=n);return r}createName(){return Object(o.b)(this._interval.name)}canShowInDomExplorer(){return!!this.getUidChain()}getBarCssClass(){return this._category===ve.Measure?"bracket":null}getCssClass(){switch(this._category){case ve.GC:return"dataScriptingGc";case ve.ImageDecoding:return"dataImageDecoding";case ve.Loading:return"dataLoading";case ve.Rendering:return"dataRendering";case ve.Scripting:return"dataScripting";case ve.Styling:return"dataStyling";case ve.Measure:return"dataMeasure";case ve.Frame:return"dataFrame";default:throw new Error(Object(o.a)("JSPerf.1033"))}}getDescription(){return""}getDetails(e){return[]}getEventDetailsRequestInformation(){return[]}getThreadContext(){return null===this._contextThreadId?"":" ["+this._contextThreadId+"]"}getUidChain(){return null}setSourceDetails(e,t){var i={propertyName:"CallbackFunction",propertyValue:e.name,localizedName:Object(o.b)("CallbackFunction"),localizedValue:e.name,sourceInfo:e};t.push(i)}updateSourceInfo(){}static getContextThreadId(e,t){return e.beginThreadId!==t?e.beginThreadId:e.endThreadId!==t?e.endThreadId:null}static isFile(e){return!!e.match(/^(file|res|ms-appx):/i)}static isUrl(e){return!!e.match(/^(https?|file|res|ms-appx):/i)}}class Ne extends Oe{getDescription(){return Object(o.b)("CssCalculationEventDescription")}}class Fe extends Oe{constructor(e,t,i){super(e,t,i);this.updateSourceInfo()}get sourceInfo(){return this._mappedSourceInfo}getDescription(){return Object(o.b)("CssParsingEventDescription")}getDetails(e){var t=[],i=this.sourceInfo;i&&t.push(this.createDetailInfo("StylesheetUrl",i.source,"StylesheetUrlLabel",null,i));return t}updateSourceInfo(){if(!this._originalSourceInfo){var e=this.interval;if(!e.url)return;this._originalSourceInfo={name:Oe.createShortenedUrlTextWithQueryString(e.url),line:1,column:1,source:e.url}}this._mappedSourceInfo=this._originalSourceInfo;De.getMappedSourceInfo(this._originalSourceInfo).then(e=>{this._mappedSourceInfo=e;this.sourceInfoChanged.invoke()})}}class He extends Oe{constructor(e,t,i){super(e,t,i);this._ddTrackerHelper=new Ve(e)}getDescription(){return Object(o.b)("DomEventDescription")}getDetails(e){var t=[];t.push(this.createDetailInfo("EventName",this.getEventName(),"EventNameLabel",null));var i=this.interval,s={stopPropagationCalled:!1,stopImmediatePropagationCalled:!1,preventDefaultCalled:!1};i.endingPropagationStatus&&(s=Oe.convertPropagationStatus(i.endingPropagationStatus));s.preventDefaultCalled&&t.push(this.createDetailInfo("DefaultPrevented",i.endingPropagationStatus,"DefaultPreventedLabel",Oe.convertBooleanToYesNoLabel(s.preventDefaultCalled)));s.stopImmediatePropagationCalled&&t.push(this.createDetailInfo("stopImmediatePropagation()",i.endingPropagationStatus,"ImmediatePropagationStoppedLabel",Oe.convertBooleanToYesNoLabel(s.stopImmediatePropagationCalled)));s.stopPropagationCalled&&t.push(this.createDetailInfo("stopPropagation()",i.endingPropagationStatus,"PropagationStoppedLabel",Oe.convertBooleanToYesNoLabel(s.stopPropagationCalled)));var n=Oe.createElementString(this._ddTrackerHelper.tag,this._ddTrackerHelper.cssId,this._ddTrackerHelper.cssClass);""!==n&&t.push(this.createDetailInfo("TargetElement",n,"EventTargetLabel",null));return t}getUidChain(){return this._ddTrackerHelper.uidChain}getEventName(){var e=this.interval;return void 0!==e.eventName?e.eventName:null}}class Be extends Oe{constructor(e,t,i){super(e,t,i);this.updateSourceInfo()}get sourceInfo(){return this._mappedSourceInfo}getDescription(){return Object(o.b)("EvaluatingScriptEventDescription")}getDetails(e){var t=[],i=this.sourceInfo,s=this.getScriptPreview();void 0!==i&&t.push(this.createDetailInfo("ScriptUrl",i.source,"ScriptUrlLabel",null,i));void 0!==s&&t.push(this.createDetailInfo("ContentPreview",s,"ScriptContentPreviewLabel",null));return t}updateSourceInfo(){if(!this._originalSourceInfo){var e=this.interval;if(!e.url)return;this._originalSourceInfo={name:Oe.createShortenedUrlTextWithQueryString(e.url),line:1,column:1,source:e.url}}this._mappedSourceInfo=this._originalSourceInfo;De.getMappedSourceInfo(this._originalSourceInfo).then(e=>{this._mappedSourceInfo=e;this.sourceInfoChanged.invoke()})}getScriptPreview(){var e=this.interval.inlineScript;if(e){var t=/(\r\n|\r|\n)\s*/gm;e=(e=e.replace(t," ")).trim()}return e}}class Ge extends Oe{constructor(e,t,i){super(e,t,i);this._ddTrackerHelper=new Ve(e)}getDescription(){return Object(o.b)("EventHandlerEventDescription")}getDetails(e){var t,i=this.interval,s=[];e&&this.setSourceDetails(e,s);if(i.eventPhase){switch(i.eventPhase){case 1:t="CapturingEventPhaseLabel";break;case 2:t="AtTargetEventPhaseLabel";break;case 3:t="BubblingEventPhaseLabel"}s.push(this.createDetailInfo("EventPhase",i.eventPhase.toString(),"EventPhaseLabel",t))}var n={stopPropagationCalled:!1,stopImmediatePropagationCalled:!1,preventDefaultCalled:!1};i.endingPropagationStatus&&(n=Oe.convertPropagationStatus(i.endingPropagationStatus));n.preventDefaultCalled&&s.push(this.createDetailInfo("DefaultPrevented",i.endingPropagationStatus,"DefaultPreventedLabel",Oe.convertBooleanToYesNoLabel(n.preventDefaultCalled)));n.stopImmediatePropagationCalled&&s.push(this.createDetailInfo("stopImmediatePropagation()",i.endingPropagationStatus,"ImmediatePropagationStoppedLabel",Oe.convertBooleanToYesNoLabel(n.stopImmediatePropagationCalled)));n.stopPropagationCalled&&s.push(this.createDetailInfo("stopPropagation()",i.endingPropagationStatus,"PropagationStoppedLabel",Oe.convertBooleanToYesNoLabel(n.stopPropagationCalled)));i.usesCapture&&s.push(this.createDetailInfo("ListenerUsesCapture",i.usesCapture,"ListenerUsesCaptureLabel",Oe.convertBooleanToYesNoLabel(i.usesCapture)));var a=Oe.createElementString(this._ddTrackerHelper.tag,this._ddTrackerHelper.cssId,this._ddTrackerHelper.cssClass);""!==a&&s.push(this.createDetailInfo("TargetElement",a,"EventTargetLabel",null));return s}getEventDetailsRequestInformation(){var e=[];this.context&&this.context.sourceInfo&&e.push({sourceInfo:this.context.sourceInfo,isSourceRequest:!0});return e}getUidChain(){return this._ddTrackerHelper.uidChain}}class je extends Oe{getDescription(){return Object(o.b)("GarbageCollectionEventDescription")}}class Ue extends Oe{getDescription(){return Object(o.b)("HtmlParsingEventDescription")}}class ze extends Oe{getDescription(){return Object(o.b)("HtmlSpeculativeDownloadingEventDescription")}}class We extends Oe{constructor(e,t,i){super(e,t,i);this.updateSourceInfo()}get sourceInfo(){return this._mappedSourceInfo}getDescription(){return Object(o.b)("HttpRequestEventDescription")}getDetails(e){var t=[],i=this.interval,s=this.sourceInfo;s&&t.push(this.createDetailInfo("AddressName",s.source,"AddressNameLabel",null,s));i.statusLine&&t.push(this.createDetailInfo("StatusCode",i.statusLine,"StatusCodeLabel",null));return t}getEventDetailsRequestInformation(){var e=[];e.push({isSourceRequest:!1});return e}updateSourceInfo(){if(!this._originalSourceInfo){var e=this.interval;if(!e.url)return;this._originalSourceInfo={name:Oe.createShortenedUrlTextWithQueryString(e.url),line:1,column:1,source:e.url}}this._mappedSourceInfo=this._originalSourceInfo;De.getMappedSourceInfo(this._originalSourceInfo).then(e=>{this._mappedSourceInfo=e;this.sourceInfoChanged.invoke()})}}class Je extends Oe{}class Xe extends Oe{constructor(e,t,i){super(e,t,i);this.updateSourceInfo()}get sourceInfo(){return this._sourceInfo}getDescription(){return Object(o.b)("ImageDecodedEventDescription")}getDetails(e){var t=[];this._sourceInfo&&t.push(this.createDetailInfo("ImageUrl",this._sourceInfo.source,"ImageUrlLabel",null,this._sourceInfo));return t}updateSourceInfo(){var e=this.interval;void 0!==e.url&&(this._sourceInfo={name:Oe.createShortenedUrlTextWithQueryString(e.url),line:1,column:1,source:e.url})}}class Ke extends Oe{getDescription(){return Object(o.b)("LayoutEventDescription")}}class Ye extends Oe{getDescription(){return Object(o.b)("MeasureDescription")}getDetails(e){var t=this.interval,i=[];t.measureName&&i.push(this.createDetailInfo("Name",t.measureName,"MeasureName",null));t.startMarkName&&i.push(this.createDetailInfo("Start mark",t.startMarkName,"StartMarkName",null));t.endMarkName&&i.push(this.createDetailInfo("End mark",t.endMarkName,"EndMarkName",null));return i}}class qe extends Oe{getDescription(){return Object(o.b)("MediaQueryListenerEventDescription")}getDetails(e){var t=[],i=this.interval;e&&this.setSourceDetails(e,t);i.mediaQuery&&t.push(this.createDetailInfo("MediaQuery",i.mediaQuery,"MediaQueryLabel",null));return t}getEventDetailsRequestInformation(){var e=[];this.context&&this.context.sourceInfo&&e.push({sourceInfo:this.context.sourceInfo,isSourceRequest:!0});return e}}class Ze extends Oe{getDescription(){return Object(o.b)("MutationObserverEventDescription")}getDetails(e){var t=[];e&&this.setSourceDetails(e,t);return t}getEventDetailsRequestInformation(){var e=[];this.context&&this.context.sourceInfo&&e.push({sourceInfo:this.context.sourceInfo,isSourceRequest:!0});return e}}class $e{constructor(e){this._paintRect=e}get bottom(){return this._paintRect.bottom}get height(){return this._paintRect.bottom-this._paintRect.top}get left(){return this._paintRect.left}get right(){return this._paintRect.right}get top(){return this._paintRect.top}get width(){return this._paintRect.right-this._paintRect.left}}class Qe extends Oe{constructor(e,t,i){super(e,t,i);this._paintRect=Qe.getPaintRect(e)}get paintRect(){return this._paintRect}get widthByHeight(){return this._paintRect?this._paintRect.width+"x"+this._paintRect.height:null}static getPaintRect(e){var t=e;return void 0!==t.paintRect&&void 0!==t.paintRect.top&&void 0!==t.paintRect.left&&void 0!==t.paintRect.right&&void 0!==t.paintRect.bottom?new $e(t.paintRect):null}getDetails(e){var t=[];if(this._paintRect&&this.widthByHeight&&"0x0"!==this.widthByHeight){t.push(this.createDetailInfo("Origin",this._paintRect.left+", "+this._paintRect.top,"OriginLabel",null));t.push(this.createDetailInfo("Dimensions",this.widthByHeight,"DimensionsLabel",null))}return t}}class et extends Qe{constructor(e,t,i){super(e,t,i);this._ddTrackerHelper=new Ve(e)}canShowInDomExplorer(){return super.canShowInDomExplorer()&&"root"!==this._ddTrackerHelper.tag}getDescription(){return Object(o.b)("PaintEventDescription")}getUidChain(){return this._ddTrackerHelper.uidChain}}class tt extends Qe{constructor(e,t,i){super(e,t,i);this._ddTrackerHelper=new Ve(e)}get title(){return Object(o.b)("RenderLayer")}createName(){var e=Oe.createElementString(this._ddTrackerHelper.tag,this._ddTrackerHelper.cssId,this._ddTrackerHelper.cssClass);return e||Object(o.b)("RenderLayer")}canShowInDomExplorer(){return super.canShowInDomExplorer()&&"root"!==this._ddTrackerHelper.tag}getDescription(){return Object(o.b)("RenderLayoutEventDescription")}getDetails(){var e=super.getDetails(),t=Oe.createElementString(this._ddTrackerHelper.tag,this._ddTrackerHelper.cssId,this._ddTrackerHelper.cssClass);t&&e.push(this.createDetailInfo("Element",t,"DDTrackerElementLabel",null));return e}getUidChain(){return this._ddTrackerHelper.uidChain}}class it extends Oe{getDescription(){return Object(o.b)("TimerFiredEventDescription")}getDetails(e){var t,i=[],s=this.interval;e&&this.setSourceDetails(e,i);switch(s.timerType){case 0:t="TimeoutTimerTypeLabel";break;case 1:t="IntervalTimerTypeLabel";break;case 2:t="ImmediateTimerTypeLabel";break;case 3:t="AnimationFrameTimerTypeLabel"}3!==s.timerType&&i.push(this.createDetailInfo("TimerType",s.timerType,"TimerTypeLabel",t));0!==s.timerType&&1!==s.timerType||"number"!=typeof s.timeoutValue||i.push(this.createDetailInfo("TimeoutValue",N.a.getPrettyPrintTime(Se.fromMilliseconds(s.timeoutValue)),"TimeoutLabel",null));return i}getEventDetailsRequestInformation(){var e=[];this.context&&this.context.sourceInfo&&e.push({sourceInfo:this.context.sourceInfo,isSourceRequest:!0});return e}}class st extends it{createName(){return Object(o.b)("AnimationFrame")}getDescription(){return Object(o.b)("AnimationFrameEventDescription")}}class nt extends Oe{getDescription(){return Object(o.b)("WindowsRuntimeEventDescription")}getDetails(e){var t=[];t.push(this.createDetailInfo("EventName",this.getEventName(),"EventNameLabel",null));return t}getEventName(){var e=this.interval;return void 0!==e.eventName?e.eventName:null}}class at extends Oe{getDescription(){return Object(o.b)("WindowsRuntimeAsyncCallbackDescription")}}class rt extends Oe{constructor(e,t,i){super(e,t,i);this._ddTrackerHelper=new Ve(e)}createName(){var e=this.interval;if(e.ddtrackerBaseClass)switch(e.ddtrackerBaseClass){case"DOM":return Object(o.b)("DOMAccessEvent");case"Layout":return Object(o.b)("DDTrackerLayoutDetailHeader");case"CSS":return"TASK_Fi"===e.ddtrackerTaskResource?Object(o.b)("CssCalculation"):Object(o.b)("DDTrackerStyleComputationDetailHeader")}return""}canShowInDomExplorer(){var e=this.interval;if(e.ddtrackerBaseClass)switch(e.ddtrackerBaseClass){case"DOM":case"Layout":case"CSS":return super.canShowInDomExplorer()}return!1}getDetails(e){var t=[],i=this.interval;if(i.ddtrackerBaseClass)switch(i.ddtrackerBaseClass){case"DOM":t.push(this.createDetailInfo("Access type",this.getDDTrackerTaskName(),"AccessTypeLabel",null));break;case"Layout":var s=this.getDDTrackerTaskName();s&&t.push(this.createDetailInfo("Category",s,"LayoutModeLabel",null))}var n=Oe.createElementString(this._ddTrackerHelper.tag,this._ddTrackerHelper.cssId,this._ddTrackerHelper.cssClass);""!==n&&"<root>"!==n&&t.push(this.createDetailInfo("Element",n,"DDTrackerElementLabel",null));return t}getDescription(){if(void 0===this._description){this._description="";var e=this.interval;if(e.ddtrackerBaseClass)switch(e.ddtrackerBaseClass){case"DOM":this._description=Object(o.b)("DDTrackerDOMDescription");break;case"Layout":this._description=Object(o.b)("DDTrackerLayoutDescription");break;case"CSS":"TASK_Fi"===e.ddtrackerTaskResource?this._description=Object(o.b)("CssCalculationEventDescription"):this._description=Object(o.b)("DDTrackerStyleChangeDescription")}}return this._description}getUidChain(){return this._ddTrackerHelper.uidChain}getDDTrackerTaskName(){if(void 0===this._ddTrackerTaskName){var e=this.interval;if(e.isSetStyle){var t=N.a.stripNewLine(e.styleProperty),i=N.a.stripNewLine(e.newValue);this._ddTrackerTaskName=Object(o.b)("DDTrackerSetStyleContextName",t,i)}else{this._ddTrackerTaskName="";if("CSS"!==e.ddtrackerBaseClass)if(e.ddtrackerTaskString)this._ddTrackerTaskName=e.ddtrackerTaskString;else if(e.ddtrackerTaskResource){var s=[e.ddtrackerTaskResource];e.ddtrackerTaskResourceArgs&&(s=s.concat(e.ddtrackerTaskResourceArgs));this._ddTrackerTaskName=o.b.apply(this,s)}}}return this._ddTrackerTaskName}}class ot extends Oe{getDescription(){return Object(o.b)("PaintEventDescription")}}class lt{constructor(){this._nameToEventMap={};this._nameToEventMap.CssCalculation=Ne;this._nameToEventMap.CssParsing=Fe;this._nameToEventMap.DDTracker=rt;this._nameToEventMap.DomEvent=He;this._nameToEventMap.EvaluatingScript=Be;this._nameToEventMap.EventHandler=Ge;this._nameToEventMap.Frame=ot;this._nameToEventMap.GarbageCollection=je;this._nameToEventMap.HtmlParsing=Ue;this._nameToEventMap.HtmlSpeculativeDownloading=ze;this._nameToEventMap.HttpRequest=We;this._nameToEventMap.Idle=Je;this._nameToEventMap.ImageDecoded=Xe;this._nameToEventMap.Layout=Ke;this._nameToEventMap.Measure=Ye;this._nameToEventMap.MediaQueryListener=qe;this._nameToEventMap.MutationObserver=Ze;this._nameToEventMap.Paint=et;this._nameToEventMap.RenderLayer=tt;this._nameToEventMap.TimerFired=it;this._nameToEventMap.WindowsRuntimeEvent=nt;this._nameToEventMap.WindowsRuntimeAsyncCallback=at}createEvent(e,t){var i=ve[e.category];if("TimerFired"===e.name){var s=e;if(3===s.timerType)return new st(s,i,t)}var n=this._nameToEventMap[e.name];if(n)return new n(e,i,t);throw new Error(Object(o.a)("JSPerf.1040"))}}class ht{constructor(e,t,i,s){this._queryResult=e;this._count=this._queryResult.getIntervalsCount();this._uiThreadId=t;this._data=[];this._dataPrevious=[];this._eventsFactory=s;this._currentIndex=null;this._timeSpan=i}get count(){return this._count}get rowsCount(){return this.count}get timeSpan(){return this._timeSpan}collapseBranch(e,t){this._queryResult.collapseIntervalBranch(e);this.resetData();t&&t();return Z.a}expandBranch(e,t){A.logExecuteCommand(k.CLICK_EVENT_DETAIL,j.c.Ui);this._queryResult.expandIntervalBranch(e);this.resetData();t&&t();return Z.a}expandFrameForEvent(e){this._queryResult.expandFrameForEvent(e);this.resetData()}getItemRowInfoFromRow(e){return{index:e,rowsSpan:1,topRow:e}}getItemRowInfoFromIndex(e){return{index:e,rowsSpan:1,topRow:e}}getNext(e){if(null===this._currentIndex)throw new Error(Object(o.a)("JSPerf.1057"));if(this._currentIndex>=this.count)return null;var t=this._data[this._currentIndex];if(!t){this.fetchFromPrevious(this._currentIndex,ht._prefetchSize)||this.fetchData(this._currentIndex,ht._prefetchSize);t=this._data[this._currentIndex]}this._currentIndex++;isNaN(e)||(this._currentIndex+=e);return t}indexOfItem(e){return this._queryResult.indexOfInterval(e)}indexOfItemAsync(e){return Promise.resolve(this.indexOfItem(e))}indexOfParent(e){var t=this._queryResult.indexOfParentInterval(e);return Promise.resolve(t)}getAggregatedDescendantsForEvent(e){return this._queryResult.getAggregatedDescendantsForEvent(e)}getSelectionSummary(){return this._queryResult.getSelectionSummary()}startAt(e){if(null!==this._currentIndex)throw new Error(Object(o.a)("JSPerf.1058"));if(isNaN(e)||e<0||e>=this.count)throw new Error(Object(o.a)("JSPerf.1036"));this._currentIndex=e;this._data=[]}stop(){this._currentIndex=null;this._dataPrevious=this._data;this._data=null;return Z.a}updateAllSourceInfo(){for(var e=0;e<this._dataPrevious.length;e++)this._dataPrevious[e].updateSourceInfo()}updateViewportInfo(e,t,i){}fetchData(e,t){var i=Math.max(0,e-t),s=Math.min(this._count,e+t)-1,n=this._queryResult.getIntervals(i,s);De.addMappings(n);for(var a=i,r=0;r<n.length;r++,a++)if(!this._data[a]){var o=n[r];this._data[a]=this._eventsFactory.createEvent(o,this._uiThreadId)}}fetchFromPrevious(e,t){if(this._dataPrevious[e]){for(var i=Math.max(0,e-t),s=Math.min(this._dataPrevious.length,e+t)-1,n=i;n<=s;n++){var a=this._dataPrevious[n];a&&(this._data[n]=a)}return!0}return!1}resetData(){this._dataPrevious=[];this._data=[];this._count=this._queryResult.getIntervalsCount()}}ht._prefetchSize=30;class dt{constructor(e){this._eventFactory=new lt;this._session=e;De.clearMappings()}getEvents(e,t,i){return this._session.queryEventIntervals(e.begin.nsec,e.end.nsec,t,i).then(t=>{var i=this._session.getUIThreadId();return new ht(t,i,e,this._eventFactory)})}}class ct extends W.b{constructor(e,t,i){super();this._model=e;this._globalRuler=t;this._markEventModel=i;this._globalRuler.addEventListener(ke.SelectionChangedEventType,e=>this.onRulerSelectionChanged(e));this.timeSpan=this._globalRuler.totalRange;var s=Object(o.b)("MillisecondsAbbreviation");this.durationFilterOptions=[{value:"0",text:Object(o.b)("DurationFilterAll"),tooltip:Object(o.b)("DurationFilterTooltip")},{value:ct.ONE_MS_IN_NS.toString(),text:Object(o.b)("DurationFilterTimed",ct.ONE_MS_IN_NS/1e3/1e3+s),tooltip:Object(o.b)("DurationFilterTooltip")},{value:ct.FIFTY_MS_IN_NS.toString(),text:Object(o.b)("DurationFilterTimed",ct.FIFTY_MS_IN_NS/1e3/1e3+s),tooltip:Object(o.b)("DurationFilterTooltip")}];this.sortOptions=[{value:"0",text:Object(o.b)("TimelineSortStartTime"),tooltip:Object(o.b)("TimelineSortTooltip")},{value:"1",text:Object(o.b)("TimelineSortDuration"),tooltip:Object(o.b)("TimelineSortTooltip")}];De.sourceMappingChanged.addHandler(this.onSourceMappingChanged.bind(this))}get globalRuler(){return this._globalRuler}get selectedEvent(){return this._selectedEvent}set selectedEvent(e){if(this._selectedEvent!==e){this._selectedEvent=e;this.selectedEventChanged&&this.selectedEventChanged(this._selectedEvent);K.a.notify(Ee.GridRowSelected)}}get timeSpan(){return this._timeSpan}set timeSpan(e){if(void 0===e&&void 0!==this._timeSpan||void 0!==e&&void 0===this._timeSpan||void 0!==e&&void 0!==this._timeSpan&&!e.equals(this._timeSpan)){this._timeSpan=e;this._isDataSourceInvalid=!0;this.timeSpanChanged&&this.timeSpanChanged()}}static initialize(){W.a.defineProperty(ct,ct.DisplayImageDecodingPropertyName,!1,e=>e.onFilterChange(),e=>e.onFilterChanging());W.a.defineProperty(ct,ct.DisplayFramesPropertyName,!1,e=>e.onFilterChange(),e=>e.onFilterChanging());W.a.defineProperty(ct,ct.DisplayMeasuresPropertyName,!0,e=>e.onFilterChange(),e=>e.onFilterChanging());W.a.defineProperty(ct,ct.DisplayNetworkActivitiesPropertyName,!0,e=>e.onFilterChange(),e=>e.onFilterChanging());W.a.defineProperty(ct,ct.DisplayUIActivitiesPropertyName,!0,e=>e.onFilterChange(),e=>e.onFilterChanging());W.a.defineProperty(ct,ct.DurationFilterPropertyName,0,e=>e.onFilterChange(),e=>e.onFilterChanging());W.a.defineProperty(ct,ct.EventNameFilterPropertyName,"",e=>e.onFilterChange(),e=>e.onFilterChanging());W.a.defineProperty(ct,ct.HasFilterPropertyName,!0,null,null);W.a.defineProperty(ct,ct.SortPropertyName,0,null,e=>e.onFilterChanging())}getEventDetails(e){var t=e.getEventDetailsRequestInformation();if(!t||0===t.length)return e.getDetails();for(var i=[],s=0;s<t.length;s++){var n=t[s];if(n.isSourceRequest)try{i=i.concat(e.getDetails(n.sourceInfo))}catch(e){}else i=i.concat(e.getDetails())}return i}getEvents(){if(this._gettingEventsPromise){this._gettingEventsPromise.cancel();this._gettingEventsPromise=null}if(this._isDataSourceInvalid){var e={eventNameFilter:this.eventNameFilter,filterImageDecoding:!this.displayImageDecoding,filterFrames:!this.displayFrames,filterMeasures:!this.displayMeasures,filterNegligibleUIActivities:this.durationFilter,filterNetworkActivities:!this.displayNetworkActivities,filterUIActivities:!this.displayUIActivities};this._gettingEventsPromise=q.a.wrap(this._model.getEvents(this._timeSpan,this.sort,e).then(e=>{this._dataSource=e;this._isDataSourceInvalid=!1;this._gettingEventsPromise=null;this.displayFrames&&this._selectedEvent&&this._dataSource.expandFrameForEvent(this._selectedEvent.id);return this._dataSource}));return this._gettingEventsPromise}return Promise.resolve(this._dataSource)}getMarks(e){return this._markEventModel.getMarkEvents(this._globalRuler.totalRange,e)}getMarkTooltip(e){return this._markEventModel.getMarkTooltip(e)}getVerticalRulerLinePositions(e){return Microsoft.VisualStudio.DiagnosticsHub.RulerUtilities.getVerticalLinePositions(this._timeSpan.toJsonTimespan(),e)}resetFilter(){this.displayImageDecoding=void 0;this.displayFrames=void 0;this.displayMeasures=void 0;this.displayNetworkActivities=void 0;this.displayUIActivities=void 0;this.durationFilter=void 0;this.eventNameFilter=void 0;this.hasFilter=void 0;this.sort=void 0}onFilterChange(){this.hasFilter=!this.displayImageDecoding||!this.displayMeasures||!this.displayNetworkActivities||!this.displayUIActivities||this.durationFilter>0||!!this.eventNameFilter}onFilterChanging(){this._isDataSourceInvalid=!0}onRulerSelectionChanged(e){e.data.isIntermittent||(this.timeSpan=new fe(this._globalRuler.selection.begin,this._globalRuler.selection.end))}onSourceMappingChanged(e){this._dataSource&&this._dataSource.updateAllSourceInfo()}}ct.ONE_MS_IN_NS=1e6;ct.FIFTY_MS_IN_NS=5e7;ct.DisplayImageDecodingPropertyName="displayImageDecoding";ct.DisplayFramesPropertyName="displayFrames";ct.DisplayMeasuresPropertyName="displayMeasures";ct.DisplayNetworkActivitiesPropertyName="displayNetworkActivities";ct.DisplayUIActivitiesPropertyName="displayUIActivities";ct.DurationFilterPropertyName="durationFilter";ct.EventNameFilterPropertyName="eventNameFilter";ct.HasFilterPropertyName="hasFilter";ct.SortPropertyName="sort";ct.initialize();class ut extends X.a{constructor(e,t,i,s){super("eventDetailsTemplate");this.initializeEventGroup();this._imagePreviewSeparator=this.findElement("imagePreviewSeparator");this._imagePreviewContainer=this.findElement("imagePreviewContainer");this._aggregatedDescendants=i;if(e){this._details=t;this._event=e;this.displayCommonFields();this.displayEventSpecificFields();this.displayAsyncCausalityDetails(!0);this.displayInclusiveTimeSummary(!0);(this._event instanceof We||this._event instanceof Xe)&&this.displayImagePreview();for(var n=this.findElementsByClassName("eventCell"),a=0;a<n.length;a++){var r=n[a];(e=>{r.classList.contains("BPT-FileLink")?r.addEventListener("mouseover",e=>Ie.showSourceInfoTooltip(e,this._event.context.sourceInfo)):r.addEventListener("mouseover",t=>ut.showCellTooltip(t,e));r.addEventListener("mouseout",e=>d.a())})(r.textContent)}this._sourceInfoChangedEventRegistration=this._event.sourceInfoChanged.addHandler(this.updateSourceInfoUi.bind(this))}else if(this._aggregatedDescendants){this.displaySelectionSummaryFields(s.elapsed,s.begin);this.displayAsyncCausalityDetails(!1);this.displayInclusiveTimeSummary(!1)}}static GetAsyncFrames(e){if(!e||!e.asyncStackJson)return[];try{return JSON.parse(e.asyncStackJson)}catch(e){return[]}}dispose(){if(this._sourceInfoChangedEventRegistration){this._sourceInfoChangedEventRegistration.unregister();this._sourceInfoChangedEventRegistration=null}}onSourceMappingChanged(e){for(var t=0;t<this._asyncStackFrames.length;t++)this._asyncStackFrames[t].updateTranslatedSourceInfo(e)}static getCssClass(e){switch(e){case"Loading":return"dataLoading";case"Scripting":return"dataScripting";case"GC":return"dataScriptingGc";case"Styling":return"dataStyling";case"Rendering":return"dataRendering";case"ImageDecoding":return"dataImageDecoding";case"Frame":return"dataFrame";case"Idle":return"dataIdle";case"Unknown":return"dataOther";default:throw new Error(Object(o.a)("JSPerf.1033"))}}static isValidImageUrl(e){return ut.IMG_URL_REGEX.test(e)&&navigator.onLine||ut.IMG_DATA_URI_REGEX.test(e)||ut.MS_APP_IMG_REGEX.test(e)}static showCellTooltip(e,t){var i=e.currentTarget;if(i.offsetWidth<i.scrollWidth){var s={content:t};d.c(s)}}createDiv(e,...t){var i=document.createElement("div");Y.a.isHtmlExpression(e)?Ie.addTokens(e,i,be.Html):Y.a.isStringExpression(e)?Ie.addTokens(e,i,be.String):i.textContent=e;if(t)for(var s=0;s<t.length;s++)i.classList.add(t[s]);return i}displayCommonFields(){var e=this.findElement("durationLabelExc"),t=this.findElement("durationValueExc"),i=this.findElement("durationIncRow"),s=this.findElement("durationLabelInc"),n=this.findElement("durationValueInc"),a=this.findElement("startTimeLabel"),r=this.findElement("startTimeValue"),l=this.findElement("threadContextRow"),h=this.findElement("threadContextLabel"),d=this.findElement("threadContextValue"),c=this.findElement("eventDetailsDescription");i.classList.remove("BPT-hidden");e.textContent=Object(o.b)("DurationLabelExclusive","");t.textContent=N.a.getPrettyPrintTime(this._event.exclusiveDuration);s.textContent=Object(o.b)("DurationLabelInclusive","");n.textContent=N.a.getPrettyPrintTime(this._event.timeSpan.elapsed);a.textContent=Object(o.b)("StartTimeLabel","");r.textContent=N.a.getPrettyPrintTime(this._event.timeSpan.begin);var u=this.getThreadContext();if("0"!==u){l.classList.remove("BPT-hidden");h.textContent=Object(o.b)("ThreadContextLabel","");d.textContent=u}c.classList.remove("BPT-hidden");c.textContent=this._event.getDescription()}displayImagePreview(){for(var e,t=0;t<this._details.length;t++)if(this._details[t].localizedName===Object(o.b)("AddressNameLabel")||this._details[t].localizedName===Object(o.b)("ImageUrlLabel")){e=this._details[t].localizedValue;break}if(this._event instanceof Xe||ut.isValidImageUrl(e)){var i=this.findElement("imagePreview");i.onload=(e=>{if(i.width>1&&i.height>1){this.findElement("imagePreviewHeader").textContent=Object(o.b)("ImagePreviewHeader",i.width,i.height);this._imagePreviewSeparator.classList.remove("BPT-hidden");this._imagePreviewContainer.classList.remove("BPT-hidden")}});i.src=e}}displayInclusiveTimeSummary(e){var t=this.findElement("inclusiveTimeBreakDownDetails");if(!(e&&this._aggregatedDescendants.length<=1||!e&&0===this._aggregatedDescendants.length)){if(void 0===this._donutChartViewModel){this._donutChartViewModel=new Le(t);this._donutChartViewModel.view.addSectorAriaLabel=((e,t)=>{var i=N.a.getPrettyPrintTime(new Se(e.value));return Object(o.b)("DonutSectorAriaLabel",e.name,t,i)})}this._event?this._donutChartViewModel.model.headerText=Object(o.b)("InclusiveTimeDetailsHeader"):this._donutChartViewModel.model.headerText=Object(o.b)("UIThreadSummaryHeader");this.createSectors(this._aggregatedDescendants).forEach(e=>{this._donutChartViewModel.model.addSector(e)});var i=this._donutChartViewModel.model.sectors.length;if(e&&i>1||!e&&i>0){t.classList.remove("BPT-hidden");if(e){this.findElement("inclusiveTimeDetailSeparator").classList.remove("BPT-hidden")}this._donutChartViewModel.view.render()}}}displayAsyncCausalityDetails(e){var t=this.findElement("eventAsyncCausalityDetails");t.innerText="";t.classList.add("BPT-hidden");this._asyncStackFrames=[];this.findElement("eventAsyncCausalitySeparator").classList.add("BPT-hidden");if(e){var i=ut.GetAsyncFrames(this._event);if(0!==i.length){var s=document.createElement("div");s.classList.add("asyncStackLabel");s.innerText=Object(o.b)("AsyncStackLabel");t.appendChild(s);for(var n=0;n<i.length;n++){for(var a=i[n],r=0;r<a.length;r++){var l=new ye(a[r]);this._asyncStackFrames.push(l);t.appendChild(l.rootElement)}if(n+1<i.length){(s=document.createElement("div")).classList.add("asyncStackLabel");s.innerText=Object(o.b)("AsyncStackTransition");t.appendChild(s)}}t.classList.remove("BPT-hidden");this.findElement("eventAsyncCausalitySeparator").classList.remove("BPT-hidden")}}}createSectors(e){for(var t=new lt,i=[],s=0;s<e.length;s++){var n=e[s],a={asyncStackJson:null,begin:0,beginThreadId:0,category:n.category,childrenCount:0,end:0,endThreadId:0,exclusiveDuration:0,fullName:void 0,id:-1,isExpanded:!1,level:-1,name:n.name};if("DDTracker"===n.name&&void 0!==n.ddTrackerProp){var r=a;r.ddtrackerTaskString=n.ddTrackerProp.ddtrackerTaskString;r.ddtrackerTaskResource=n.ddTrackerProp.ddtrackerTaskResource;r.ddtrackerTaskResourceArgs=n.ddTrackerProp.ddtrackerTaskResourceArgs;r.ddtrackerBaseClass=n.ddTrackerProp.ddtrackerBaseClass}var o=t.createEvent(a,0);i.push({name:o.name,cssClass:ut.getCssClass(n.category),value:n.value})}return this.groupEventTypes(i)}initializeEventGroup(){this._eventGroupsMap={};this._eventGroupsMap[Object(o.b)("DomEvent")]=Object(o.b)("DomEvent");this._eventGroupsMap[Object(o.b)("EventHandler")]=Object(o.b)("DomEvent");this._eventGroupsMap[Object(o.b)("Layout")]=Object(o.b)("Layout");this._eventGroupsMap[Object(o.b)("DDTrackerLayoutDetailHeader")]=Object(o.b)("Layout");this._eventGroupsMap[Object(o.b)("CssCalculation")]=Object(o.b)("CssCalculation");this._eventGroupsMap[Object(o.b)("DDTrackerStyleComputationDetailHeader")]=Object(o.b)("CssCalculation");this._eventGroupsMap[Object(o.b)("Paint")]=Object(o.b)("Paint");this._eventGroupsMap[Object(o.b)("RenderLayer")]=Object(o.b)("Paint")}groupEventTypes(e){for(var t,i={},s=0;s<e.length;s++){var n=e[s],a=this._eventGroupsMap[n.name];if(void 0!==a)if(void 0===(t=i[a])){i[a]=n;i[a].name=a}else if(n.name===a){i[a]=n;n.value+=t.value}else t.value+=n.value;else i[n.name]=n}var r=[];for(var o in i)r.push(i[o]);return r}displayEventSpecificFields(){if(this._details)for(var e=this.findElement("additionalDetails"),t=0;t<this._details.length;t++){var i=this._details[t];if(!i.sourceInfo||"<DOM>"!==i.sourceInfo.source){var s=this.createDiv(i.localizedName+":","eventCell","name"),n=this.createDiv(i.localizedValue,"eventCell","value");if(i.sourceInfo){n.className+=" BPT-FileLink";n.setAttribute("role","link");Ie.setViewSourceHandler(n,i.sourceInfo,!0);if(i.localizedValue===i.sourceInfo.source){this._detailUrlDiv=n;this.updateSourceInfoUi()}}var a=this.createDiv("","eventRow");a.appendChild(s);a.appendChild(n);e.appendChild(a)}}}displaySelectionSummaryFields(e,t){const i=this.findElement("eventDetailsSummaryTable"),s=this.findElement("durationLabelExc"),n=this.findElement("durationValueExc"),a=this.findElement("startTimeLabel"),r=this.findElement("startTimeValue");if(i&&s&&n&&a&&r){s.textContent=Object(o.b)("SelectionDurationLabel","");const l=N.a.getPrettyPrintTime(e);s.setAttribute("data-plugin-vs-tooltip",Object(o.b)("SelectionDurationLabel",l));n.textContent=l;a.textContent=Object(o.b)("StartTimeLabel","");const h=N.a.getPrettyPrintTime(t);a.setAttribute("data-plugin-vs-tooltip",Object(o.b)("StartTimeLabel",h));r.textContent=h;i.tabIndex=0;const d=`${s.textContent}, ${n.textContent}, ${a.textContent}, ${r.textContent}`;i.setAttribute("aria-label",d)}}getThreadContext(){var e=this._event.contextThreadId;return null!==e?this._event.category===ve.Rendering?Object(o.b)("RenderThread"):this._event instanceof We?Object(o.b)("DownloadThread"):this._event.category===ve.ImageDecoding?Object(o.b)("ImageDecodingThread"):e.toString():Object(o.b)("UIThreadContext")}updateSourceInfoUi(){this._detailUrlDiv.innerText=this._event.sourceInfo.source}}ut.IMG_URL_REGEX=/^(http|https).*([.jpg]|[.jpeg]|[.gif]|[.png])$/i;ut.IMG_DATA_URI_REGEX=/^(data:image\/).*$/i;ut.MS_APP_IMG_REGEX=/^(ms-appx(-web)?:\/\/).*$/i;class gt extends X.a{constructor(e){super("timelineViewTemplate");this._isVisible=!0;this._parentContainer=document.getElementById(e);if(!this._parentContainer)throw new Error(Object(o.a)("JSPerf.1034"));this._eventDetailsHeaderClass="emptyHeader";this._eventDetailsTitle=this.findElement("eventDetailsTitle");this._timelineDetailsHeader=this.findElement("timelineDetailsHeader");this._timelineDetailsPaneContainer=this.findElement("timelineDetailsPaneContainer");this._timelineViewAndDetailsContainer=this.findElement("timelineViewAndDetails");this._timelineLabel=this.findElement("timelineLabel");this._timelineView=this.findElement("timelineView");this._timelineLabel.textContent=Object(o.b)("TimelineLabel");this._sortFilterSection=this.findElement("sortFilterSection");this._filteringBar=new J.a("VisualProfiler.filteringBarTemplate");this._sortFilterSection.appendChild(this._filteringBar.rootElement);this._listControl=new Te;this._timelineView.appendChild(this._listControl.rootElement);this._listControl.dataColumnWidthChanged=this.onListControlDataColumnWidthChanged.bind(this);this._parentContainer.appendChild(this.rootElement);this._onResizeHandler=(()=>{this._columnsCssRule=this.getColumnsCssRule();this._listControl.invalidateSizeCache();this.updateDetailsDivider();this.render()});this.registerResizeEvent();De.sourceMappingChanged.addHandler(e=>this.onSourceMappingChanged(e));this._eventHeaderDivider=this.findElement("timelineEventHeaderDivider");this._eventHeaderDivider.style.left=this._listControl.eventNameColumnWidth+"px";this._eventHeaderLabel=this.findElement("timelineEventHeaderLabel");this._eventHeaderLabel.textContent=Object(o.b)("EventHeaderLabel");this._eventHeaderLabel.style.width=this._listControl.eventNameColumnWidth+"px";this._rulerContainer=this.findElement("timelineRuler");this._columnsCssRule=this.getColumnsCssRule();this._eventDetailsDivider=new _e(this._timelineViewAndDetailsContainer,0);this._eventDetailsDivider.onMoved=this.onResizeDetails.bind(this);this.createFilteringMenu();this._viewEventManager=Microsoft.VisualStudio.DiagnosticsHub.getViewEventManager();this._viewEventManager.detailsViewSelectionChanged.addEventListener(this.onDetailsViewChanged.bind(this));this._viewEventManager.detailsViewReady.raiseEvent({Id:gt.DETAILS_VIEW_ID})}get detailsView(){return this._detailsView}get listControl(){return this._listControl}get viewModel(){return this.model}get sortFilterSection(){return this._sortFilterSection}set viewModel(e){this.unregisterViewModelEvents();this._listControl.dataSource=null;this.model=e;this._filteringBar.model=this.model;this._filteringMenu.model=this.model;this.createRuler();this.updateDetailsPane(null);this.updateDetailsDivider();this.registerViewModelEvents()}static getCssRule(e,t){var i=document.styleSheets[e];if(i)for(var s=0;s<i.rules.length;++s){var n=i.rules[s];if(n&&n.selectorText===t)return n}return null}onTabActivated(){}onTabResize(){}render(){if(this.model&&this._isVisible){this.unregisterResizeEvent();return this.model.getEvents().then(e=>{var t=this.model.timeSpan;this._listControl.dataSource=e;this._listControl.timeSpan=t;this._listControl.viewModel=this.model;this._listControl.rulerScale=this._rulerScale;this._listControl.selectedItemChanged=this.onSelectedEventChanged.bind(this);this._listControl.render();this.setRulerRect();this._rulerScale.onViewportChanged({currentTimespan:t.toJsonTimespan(),selectionTimespan:null,isIntermittent:!1});this._listControl.renderVerticalRulerLines();this._listControl.selectedItem||this.updateDetailsPane(null);this.registerResizeEvent()},e=>{this.registerResizeEvent()})}return Promise.resolve()}static showTooltip(e){var t={content:Object(o.b)(e)};d.c(t)}createFilteringMenu(){var e=this._filteringBar.getNamedControl("filteringMenuButton");this._filteringMenu=new U.a;this._filteringMenu.menuItemsTemplateId="VisualProfiler.filteringMenuDropDown";this._filteringMenu.targetButtonElement=e.rootElement;this._filteringMenu.dismissOnMenuItemClick=!0;this._filteringMenu.dismissOnTargetButtonClick=!0;this._filteringMenu.focusFirstItemOnShow=!0;this._filteringBar.rootElement.appendChild(this._filteringMenu.rootElement)}createRuler(){if(this._gettingMarksPromise){this._gettingMarksPromise.cancel();this._gettingMarksPromise=null}var e=[],t=[];this._rulerContainer.innerHTML="";this._rulerScale&&this._rulerScale.dispose();this._rulerScale=new Microsoft.VisualStudio.DiagnosticsHub.RulerScale(this.model?this.model.timeSpan.toJsonTimespan():new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(new Microsoft.VisualStudio.DiagnosticsHub.BigNumber(0,0),new Microsoft.VisualStudio.DiagnosticsHub.BigNumber(0,0)));if(this.model){var i=this.model.getMarks(0).then(t=>{e=t}),s=this.model.getMarks(1).then(e=>{t=e});this._gettingMarksPromise=q.a.wrap(Promise.all([i,s]).then(()=>{this._rulerScale.dispose();this._rulerScale=new Microsoft.VisualStudio.DiagnosticsHub.RulerScale(this.model.timeSpan.toJsonTimespan(),[{index:0,id:Microsoft.VisualStudio.DiagnosticsHub.MarkType.UserMark,label:Object(o.b)("RulerUserMarkLabel"),data:t},{index:1,id:Microsoft.VisualStudio.DiagnosticsHub.MarkType.LifeCycleEvent,label:Object(o.b)("RulerLifecycleMarkLabel"),data:e}],["vs-image-graph-app-event","vs-image-graph-user-mark"],"vs-image-graph-aggregated-event");this._rulerContainer.appendChild(this._rulerScale.container);this._rulerScale.resize(null)}));this._gettingMarksPromise.then(()=>{this._gettingMarksPromise=null})}else{this._rulerContainer.appendChild(this._rulerScale.container);this._rulerScale.resize(null)}}getColumnsCssRule(){return gt.getCssRule("VisualProfiler",".mainView .dataViewContainer .detailedViewsContainer .timelineViewContainer .timelineViewGroup .timelineViewAndDetails")}onDetailsViewChanged(e){if(!e)throw new Error(Object(o.a)("JSPerf.1078"));this._isVisible=e.Id.toLowerCase()===gt.DETAILS_VIEW_ID.toLowerCase();this._isVisible&&this.render()}onResizeDetails(e){this.updateColumnWidth(e);ni.triggerResize()}onSelectedEventChanged(e){this.model.selectedEvent=e}onListControlDataColumnWidthChanged(){this._eventHeaderDivider.style.left=this._listControl.eventNameColumnWidth+"px";this._eventHeaderLabel.style.width=this._listControl.eventNameColumnWidth+"px";this.setRulerRect()}onSortChanged(){A.logPerformance({id:$.b.Timeline_GridSort_Start});this.render().then(()=>{K.a.notify(Ee.SortFinishedOnGrid);A.logPerformance({id:$.b.Timeline_GridSort_Stop})})}onTimeSpanChanged(){this.render().then(()=>{K.a.notify(Ee.GridUpdatedForTimeSelection)})}onToggleFilter(e,t){void 0!==e&&A.logPerformance({id:e});this.render().then(()=>{void 0!==t&&A.logPerformance({id:t})})}onEventNameFilterChange(){clearTimeout(this._eventNameFilterResponseTimeoutHandle);this._eventNameFilterResponseTimeoutHandle=setTimeout(()=>{A.logPerformance({id:$.b.Timeline_GridUpdatedForFilterName_Start});this.render().then(()=>{A.logPerformance({id:$.b.Timeline_GridUpdatedForFilterName_Stop});K.a.notify(Ee.GridUpdatedForFilter)})},200)}logExecuteCommand(e,t){this._filteringMenu.isVisible&&A.logExecuteCommand(e,t)}onViewModelPropertyChanged(e){switch(e){case ct.DisplayImageDecodingPropertyName:this.logExecuteCommand(k.FILTER_IMAGE_DECODING,j.c.Ui);this.onToggleFilter($.b.Timeline_GridUpdatedForFilterBackground_Start,$.b.Timeline_GridUpdatedForFilterBackground_Stop);break;case ct.DisplayFramesPropertyName:this.logExecuteCommand(k.FILTER_FRAME,j.c.Ui);this.onToggleFilter($.b.Timeline_GridUpdatedForFilterFrames_Start,$.b.Timeline_GridUpdatedForFilterFrames_Stop);break;case ct.DisplayMeasuresPropertyName:this.logExecuteCommand(k.FILTER_USER_MEASURES,j.c.Ui);this.onToggleFilter($.b.Timeline_GridUpdatedForFilterMeasures_Start,$.b.Timeline_GridUpdatedForFilterMeasures_Stop);break;case ct.DisplayNetworkActivitiesPropertyName:this.logExecuteCommand(k.FILTER_NETWORK_TRAFFIC,j.c.Ui);this.onToggleFilter($.b.Timeline_GridUpdatedForFilterNetwork_Start,$.b.Timeline_GridUpdatedForFilterNetwork_Stop);break;case ct.DisplayUIActivitiesPropertyName:this.logExecuteCommand(k.FILTER_UI_ACTIVITIES,j.c.Ui);this.onToggleFilter();break;case ct.DurationFilterPropertyName:this.logExecuteCommand(k.FILTER_DURATION,j.c.Ui);this.onToggleFilter();break;case ct.EventNameFilterPropertyName:this.logExecuteCommand(k.FILTER_BY_NAME,j.c.Ui);this.onEventNameFilterChange();break;case ct.SortPropertyName:this.logExecuteCommand(k.CHANGE_SORT_BY,j.c.Ui);this.onSortChanged()}}onViewModelSelectionChanged(e){this._listControl.selectedItem=e;this.updateDetailsPane(e)}onSourceMappingChanged(e){if(this._detailsView){var t;e&&(t=e.url);this._detailsView.onSourceMappingChanged(t)}}registerResizeEvent(){ni.addEventListener(P.Resize,this._onResizeHandler)}registerViewModelEvents(){if(this.model){this._viewModelPropertyChangeEvtReg=this.model.propertyChanged.addHandler(this.onViewModelPropertyChanged.bind(this));this.model.timeSpanChanged=this.onTimeSpanChanged.bind(this);this.model.selectedEventChanged=this.onViewModelSelectionChanged.bind(this)}}setDetailsDividerBounds(){var e=this._timelineViewAndDetailsContainer.offsetWidth;this._eventDetailsDivider.minX=e/2;this._eventDetailsDivider.maxX=e}setRulerRect(){var e=this._listControl.dataColumnLeft+"px",t=this._listControl.dataColumnWidth+"px";if(this._rulerContainer.style.marginLeft!==e||this._rulerContainer.style.width!==t){this._rulerContainer.style.marginLeft=e;this._rulerContainer.style.width=t;this._rulerScale&&this._rulerScale.resize(null)}}updateDetailsPane(e){var t=this._listControl.dataSource;if(t){this._timelineDetailsHeader.classList.remove(this._eventDetailsHeaderClass);var i,s;this._detailsView&&this._detailsView.dispose();if(e){this._eventDetailsTitle.textContent=e.title;this._eventDetailsHeaderClass=e.getCssClass();var n=this.model.getEventDetails(e);i=t.getAggregatedDescendantsForEvent(e.id);this._detailsView=new ut(e,n,i,s)}else{if(t){this._eventDetailsTitle.textContent="";this._eventDetailsHeaderClass="emptyHeader";i=t.getSelectionSummary();s=t.timeSpan}this._detailsView=new ut(null,null,i,s)}this._timelineDetailsHeader.classList.add(this._eventDetailsHeaderClass);this._timelineDetailsPaneContainer.innerHTML="";this._timelineDetailsPaneContainer.appendChild(this._detailsView.rootElement);K.a.notify(Ee.DetailsPaneLoaded)}}updateColumnWidth(e){null!==e&&void 0!==e||(e=this._eventDetailsDivider.offsetX);var t=this._columnsCssRule.style.msGridColumns.split(" ");t[2]=this._timelineViewAndDetailsContainer.clientWidth-e+"px";this._columnsCssRule.style.msGridColumns=t.join(" ")}updateDetailsDivider(){this.setDetailsDividerBounds();this._eventDetailsDivider.offsetX=this._timelineView.offsetWidth;this.updateColumnWidth(this._eventDetailsDivider.offsetX+3)}unregisterResizeEvent(){ni.removeEventListener(P.Resize,this._onResizeHandler)}unregisterViewModelEvents(){if(this.model){this.model.selectedEvent=null;this.model.timeSpanChanged=null;this.model.selectedEventChanged=null}if(this._viewModelPropertyChangeEvtReg){this._viewModelPropertyChangeEvtReg.unregister();this._viewModelPropertyChangeEvtReg=null}}}gt.DETAILS_VIEW_ID="0615d892-30b0-4ada-afab-93bfe13d9538";class mt{constructor(e){this._session=e}getMarkEvents(e,t){return this._session.queryMarkEvents(e.begin.nsec,e.end.nsec,t)}getMarkTooltip(e){var t=e.toolTip,i=parseInt(e.timestamp.value);return t+=Object(o.b)("RulerMarkTooltipLabel",N.a.getPrettyPrintTime(Se.fromNanoseconds(i)))}}class pt{constructor(e){this._dataWarehouse=e;this._threadId=0;this._sessionUrl=null;this._lowestObservedDocumentMode=0}initialize(){return this._dataWarehouse.getContextService().getGlobalContext().then(e=>e.getTimeDomain()).then(e=>{this._totalDuration={begin:parseInt(e.begin.value),end:parseInt(e.end.value)};return this.getFilteredResult("getUIThreadId")}).then(e=>{this._threadId=e.getResult();return this.getFilteredResult("getSessionUrl")}).then(e=>{this._sessionUrl=e.getResult();return this.getFilteredResult("getLowestObservedDocumentMode")}).then(e=>{this._lowestObservedDocumentMode=e.getResult()})}close(){this._dataWarehouse.closeSynchronous()}closeAsync(){return this._dataWarehouse.close()}getTotalDuration(){return this._totalDuration}initializeResources(e){var t=new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(0),Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(this._totalDuration.end));return this.getFilteredResult(pt.INITIALIZE_RESOURCES_OPERATION,t,e)}queryEventIntervals(e,t,i,s){var n=new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e),Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(t)),a={eventNameFilter:s&&s.eventNameFilter,minDuration:s&&s.filterNegligibleUIActivities?s.filterNegligibleUIActivities.toString():"0",sort:i.toString(),filterImageDecoding:s&&s.filterImageDecoding?"true":"false",filterFrames:s&&s.filterFrames?"true":"false",filterMeasures:s&&s.filterMeasures?"true":"false",filterNetworkActivities:s&&s.filterNetworkActivities?"true":"false",filterUIActivities:s&&s.filterUIActivities?"true":"false"};return this.getFilteredResult(pt.QUERY_EVENT_INTERVALS,n,a)}queryCPUUsage(e,t,i){var s=new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e),Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(t)),n={granularity:i.toString()};return l.getFilteredResult(this._dataWarehouse,pt.TIMELINE_ANALYZER_CLASSID,pt.CPU_USAGE_COUNTERID,s,n).then(e=>{var t;e&&e.p&&(t=e.p.map(e=>{var t=new Microsoft.VisualStudio.DiagnosticsHub.BigNumber(e.t.h,e.t.l);return{category:e.c,time:parseInt(t.value),utilization:e.u}}));return t})}queryFrameRate(e,t){var i=new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e),Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(t));return l.getFilteredResult(this._dataWarehouse,pt.TIMELINE_ANALYZER_CLASSID,pt.FRAME_RATE_COUNTERID,i).then(e=>{var t;e&&e.p&&(t=e.p.map(e=>{var t=new Microsoft.VisualStudio.DiagnosticsHub.BigNumber(e.t.h,e.t.l);return{fps:e.v,time:parseInt(t.value)}}));return t})}queryMarkEvents(e,t,i){var s,n=new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e),Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(t));s=0===i?pt.LIFE_CYCLE_MARKS_COUNTERID:pt.USER_MARKS_COUNTERID;return l.getFilteredResult(this._dataWarehouse,pt.TIMELINE_ANALYZER_CLASSID,s,n).then(e=>{var t;if(e&&e.p){t=[];for(var i=0;i<e.p.length;i++){var s=e.p[i];t.push({time:new Microsoft.VisualStudio.DiagnosticsHub.BigNumber(s.t.h,s.t.l),tooltip:s.tt})}}return t})}getUIThreadId(){return this._threadId}getSessionUrl(){return this._sessionUrl}getLowestObservedDocumentMode(){return this._lowestObservedDocumentMode}getFilteredResult(e,t,i){var s={timeDomain:t,customDomain:{operation:e}};if(i)for(var n in i)i.hasOwnProperty(n)&&(s.customDomain[n]=i[n]);return this._dataWarehouse.getFilteredData(s,pt.TIMELINE_ANALYZER_CLASSID)}}pt.INITIALIZE_RESOURCES_OPERATION="initializeResources";pt.QUERY_EVENT_INTERVALS="queryEventIntervals";pt.CPUUSAGE_ANALYZER_CLASSID="DCA8B3EF-28C5-4B08-BAFC-B072F8AA9277";pt.TIMELINE_ANALYZER_CLASSID="8C0C631D-37F1-11E3-8259-6C3BE516EAD0";pt.CPU_USAGE_COUNTERID="CPUUsage";pt.FRAME_RATE_COUNTERID="frameRate";pt.LIFE_CYCLE_MARKS_COUNTERID="lifeCycleMarks";pt.USER_MARKS_COUNTERID="userMarks";class _t{constructor(e){this._dataWarehouse=e}clean(){}getDataSession(){var e=new pt(this._dataWarehouse);return e.initialize().then(()=>e)}}class vt{constructor(e,t,i){this._etlFilePath=e;this._isUserSpecifiedFile=t;if(i){this._analyzerDir=i;"\\"!==this._analyzerDir.charAt(this._analyzerDir.length-1)&&(this._analyzerDir+="\\")}}get etlPath(){return this._etlFilePath}clean(){if(this._dataWarehouseSource){this._dataWarehouseSource.clean();this._dataWarehouseSource=null}if(this._etlFilePath&&!this._isUserSpecifiedFile){for(var e=this._etlFilePath.split("|"),t=0;t<e.length;t++){var i=e[t];i&&Object(B.h)(i)}this._etlFilePath=null}}getDataSession(){var e={id:this._etlFilePath,identity:Microsoft.VisualStudio.DiagnosticsHub.DataWarehouse.ResourceIdentity.EtlFile,type:1,path:this._etlFilePath,tags:[]},t={type:2,localDllPath:this.getAnalyzerPath("timeline.dll"),clsid:pt.TIMELINE_ANALYZER_CLASSID},i={type:2,localDllPath:this.getAnalyzerPath("timeline.dll"),clsid:pt.CPUUSAGE_ANALYZER_CLASSID};let s="";m.b.isWinRTHost&&(s=m.b.utilities.getTempAppDataPath());vt._sessionId++;var n,a={sessionId:vt.getSimpleGuid(vt._sessionId),analyzers:[t,i],dataSources:[e],symbolCachePath:s,symbolStorePath:""};return new Promise((t,i)=>{Microsoft.VisualStudio.DiagnosticsHub.DataWarehouse.loadDataWarehouse(a).then(e=>{n=e;this._dataWarehouseSource=new _t(n);return n.beginInitialization()}).then(()=>n.pushDataSources([e])).then(()=>n.endInitialization()).then(()=>this._dataWarehouseSource.getDataSession()).then(e=>{t&&t(e)},i)})}static getSimpleGuid(e){var t="00000000-0000-0000-0000-000000000000",i=(e%0xffffffffffff).toString(16);return t.substr(0,t.length-i.length)+i}getAnalyzerPath(e){return this._analyzerDir?this._analyzerDir+e:e}}vt._sessionId=0;class bt{constructor(){this.configurations=[bt.getCpuUsageConfiguration(),bt.getVisualThroughputConfiguration()]}static getCpuUsageConfiguration(){var e='            {                "View": "Graph",                "GraphBehaviour": 2,                "Series": [{                    "Legend": "Loading_Category",                    "LegendTooltip": "LoadingLegendTooltip",                    "Category": "Loading_Category",                    "Color": "#117ad1",                    "CssClass": "dataLoading",                    "DataSource": {                        "CounterId": "CPUUsage",                        "AnalyzerId": "8C0C631D-37F1-11E3-8259-6C3BE516EAD0"                    }                }, {                    "Legend": "Scripting_Category",                    "LegendTooltip": "ScriptingLegendTooltip",                    "Category": "Scripting_Category",                    "Color": "#bf3f00",                    "CssClass": "dataScripting"                }, {                    "Legend": "GC_Category",                    "LegendTooltip": "GCLegendTooltip",                    "Category": "GC_Category",                    "Color": "#fcb714",                    "CssClass": "dataScriptingGc"                }, {                    "Legend": "Styling_Category",                    "LegendTooltip": "StylingLegendTooltip",                    "Category": "Styling_Category",                    "Color": "#71b252",                    "CssClass": "dataStyling"                }, {                    "Legend": "Rendering_Category",                    "LegendTooltip": "RenderingLegendTooltip",                    "Category": "Rendering_Category",                    "Color": "#903f8b",                    "CssClass": "dataRendering"                }, {                    "Legend": "ImageDecoding_Category",                    "LegendTooltip": "ImageDecodingLegendTooltip",                    "Category": "ImageDecoding_Category",                    "Color": "#79d7f2",                    "CssClass": "dataImageDecoding"                }],                "BarWidth": 4,                "BarGap": 1,                "ShowStackGap": true,                "Height": 60            }',t=JSON.parse(e),i={Id:"918f5d75-c371-4e52-88bb-c27b4669cb4c",Title:Object(o.b)("CPUChartTitle"),Description:Object(o.b)("CPUGraphAriaLabel"),JsonObject:t,JsonConfiguration:e,JavaScriptClassName:"VisualProfiler2.Graphs.StackedBarGraph",Resources:{CPUBarAriaLabel:Object(o.b)("CPUBarAriaLabel"),CPUGraphAriaLabel:Object(o.b)("CPUGraphAriaLabel"),CPUTooltipCategoryLabel:Object(o.b)("CPUTooltipCategoryLabel"),CPUTooltipTimeLabel:Object(o.b)("CPUTooltipTimeLabel"),CPUTooltipUtilizationLabel:Object(o.b)("CPUTooltipUtilizationLabel"),GC_Category:Object(o.b)("GC_Category"),GCLegendTooltip:Object(o.b)("GCLegendTooltip"),ImageDecoding_Category:Object(o.b)("ImageDecoding_Category"),ImageDecodingLegendTooltip:Object(o.b)("ImageDecodingLegendTooltip"),Loading_Category:Object(o.b)("Loading_Category"),LoadingLegendTooltip:Object(o.b)("LoadingLegendTooltip"),Rendering_Category:Object(o.b)("Rendering_Category"),RenderingLegendTooltip:Object(o.b)("RenderingLegendTooltip"),Scripting_Category:Object(o.b)("Scripting_Category"),ScriptingLegendTooltip:Object(o.b)("ScriptingLegendTooltip"),Styling_Category:Object(o.b)("Styling_Category"),StylingLegendTooltip:Object(o.b)("StylingLegendTooltip"),Unknown_Category:Object(o.b)("Unknown_Category"),UnknownLegendTooltip:Object(o.b)("UnknownLegendTooltip")}};Microsoft.VisualStudio.DiagnosticsHub.RegisterNamespace.registerClass("VisualProfiler2.Graphs.StackedBarGraph");return i}static getVisualThroughputConfiguration(){var e='            {            "View": "Graph",            "GraphBehaviour": 2,            "Series": [{                    "Legend": "AFG_Legend",                    "LegendTooltip": "AFG_Legend",                    "Category": "AFG_Legend",                    "Color": {                        "Line":"#76AEC8",                        "Fill":"#A6CADB"                        },                    "CssClass": "dataLoading",                    "DataSource": {                        "CounterId": "frameRate",                        "AnalyzerId": "8C0C631D-37F1-11E3-8259-6C3BE516EAD0"                    }                }],            "Axes": [{ "value": 30 }, { "value": 60 }],            "ScaleType": 2,            "MinValue": 0,            "MaxValue": 70,            "Unit": "AFG_Unit",            "Height": 50            }',t=JSON.parse(e);return{Id:"fa1d7085-b7da-4ffa-9ba7-0f85bee330bb",Title:Object(o.b)("AFG_Title"),Description:Object(o.b)("VisualThroughputGraphAriaLabel"),JsonObject:t,JsonConfiguration:e,Resources:{AFG_Legend:Object(o.b)("AFG_Legend"),AFG_Unit:Object(o.b)("AFG_Unit")}}}}class Ct{static getSwimlaneViewStateService(){Ct._swimlaneVisibilityService||(Ct._swimlaneVisibilityService=new St);return Ct._swimlaneVisibilityService}}class St{constructor(){this._swimlaneVisibilityMap=new Map}getSwimlaneVisibility(e){return Promise.resolve(this.getSwimlaneVisibilitySynchronous(e))}getSwimlaneVisibilitySynchronous(e){var t=this._swimlaneVisibilityMap.get(e);if(void 0===t){this._swimlaneVisibilityMap.set(e,!0);t=!0}return t}setSwimlaneVisibility(e,t){this._swimlaneVisibilityMap.set(e,t)}}class ft{constructor(e,t){this.padding=40;this._globalRuler=e;this._markEventModel=t}get globalRuler(){return this._globalRuler}getMarks(e){return this._markEventModel.getMarkEvents(this._globalRuler.totalRange,e)}getMarkTooltip(e){return this._markEventModel.getMarkTooltip(e)}setSelectionRange(e,t=!1){this._globalRuler.setSelection(e,t)}setActiveRange(e){this._globalRuler.setActiveRange(e)}}class Et{constructor(e){this._parentContainer=document.getElementById(e);if(!this._parentContainer)throw new Error(Object(o.a)("JSPerf.1034"));ni.addEventListener(P.Resize,e=>{this._rulerControl&&this._rulerControl.resize(e)})}set viewModel(e){this.unregisterViewModelEvents();this._viewModel=e;this.registerViewModelEvents()}focus(){this._focusRequested=!1;this._rulerControl?this._rulerControl.container.focus():this._focusRequested=!0}render(){this._gettingMarksPromise&&(this._gettingMarksPromise=null);this._parentContainer.innerHTML="";this._rulerControl&&this._rulerControl.dispose();var e=new Microsoft.VisualStudio.DiagnosticsHub.RulerConfig;e.timeRange=this._viewModel.globalRuler.totalRange.toJsonTimespan();var t=[],i=[],s=this._viewModel.getMarks(0).then(e=>{t=e}),n=this._viewModel.getMarks(1).then(e=>{i=e});this._gettingMarksPromise=Promise.all([s,n]).then(()=>{e.markSeries=[{id:Microsoft.VisualStudio.DiagnosticsHub.MarkType.UserMark,label:Object(o.b)("RulerUserMarkLabel"),tooltip:Object(o.b)("UserMarkTooltip"),data:i},{id:Microsoft.VisualStudio.DiagnosticsHub.MarkType.LifeCycleEvent,label:Object(o.b)("RulerLifecycleMarkLabel"),tooltip:Object(o.b)("LifecycleMarkTooltip"),data:t}];this._rulerControl=new Microsoft.VisualStudio.DiagnosticsHub.Ruler(e);this._parentContainer.appendChild(this._rulerControl.container);this._rulerControl.resize(null);this._focusRequested&&this.focus()});this._gettingMarksPromise.then(()=>{this._gettingMarksPromise=null})}unregisterViewModelEvents(){if(this._viewModel){this._viewModel.globalRuler.removeEventListener(ke.SelectionChangedEventType,this.onGlobalRulerSelectionChanged.bind(this));this._viewModel.globalRuler.removeEventListener(ke.ActiveRangeChangedEventType,this.onGlobalRulerActiveRangeChange.bind(this))}}registerViewModelEvents(){if(this._viewModel){this._viewModel.globalRuler.addEventListener(ke.SelectionChangedEventType,this.onGlobalRulerSelectionChanged.bind(this));this._viewModel.globalRuler.addEventListener(ke.ActiveRangeChangedEventType,this.onGlobalRulerActiveRangeChange.bind(this))}}onGlobalRulerActiveRangeChange(e){if(this._viewModel&&this._rulerControl){var t={currentTimespan:this._viewModel.globalRuler.activeRange.toJsonTimespan(),selectionTimespan:this._viewModel.globalRuler.selection.toJsonTimespan(),isIntermittent:!1};this._rulerControl.onViewportChanged(t)}}onGlobalRulerSelectionChanged(e){if(this._viewModel&&this._rulerControl){var t={currentTimespan:this._viewModel.globalRuler.activeRange.toJsonTimespan(),selectionTimespan:this._viewModel.globalRuler.selection.toJsonTimespan(),isIntermittent:!1};this._rulerControl.onViewportChanged(t)}}}class wt{constructor(e,t,i,s,n){this._globalRuler=e;this._graphConfigs=[];this.padding=s;this.toolbarViewModel=n;this._graphRulerViewModel=new ft(e,t);this._graphRulerViewModel.padding=s}get globalRuler(){return this._globalRuler}get graphConfigs(){return this._graphConfigs}set graphConfigs(e){this._graphConfigs=e}get graphRulerViewModel(){return this._graphRulerViewModel}getSwimlaneConfigurationFromManagedConfig(e){var t=new Microsoft.VisualStudio.DiagnosticsHub.SwimlaneConfiguration(e,this.globalRuler.activeRange.toJsonTimespan(),Microsoft.VisualStudio.DiagnosticsHub.GraphBehaviourType.PostMortem);e.JavaScriptClassName?t.graph.registeredClass=Microsoft.VisualStudio.DiagnosticsHub.RegisterNamespace.getRegisteredClass(e.JavaScriptClassName):t.graph.registeredClass=Microsoft.VisualStudio.DiagnosticsHub.RegisterNamespace.getRegisteredClass("Microsoft.VisualStudio.DiagnosticsHub.MultiSeriesGraph");t.graph.legend=[];t.graph.scale.minimum=e.JsonObject.MinValue;t.graph.scale.maximum=e.JsonObject.MaxValue;return t}}class It extends X.a{constructor(e){super("swimLanesView");var t=document.getElementById(e);if(!e)throw new Error(Object(o.a)("JSPerf.1034"));t.appendChild(this.rootElement);this._swimlanes=[];this._swimlanesContainer=this.findElement("swimlanesContainer");this._graphRulerView=new Et(this.findElement("graphRulerView").id);this._onGlobalRulerActiveRangeChange=this.onGlobalRulerActiveRangeChange.bind(this);this._onGlobalRulerSelectionChanged=this.onGlobalRulerSelectionChanged.bind(this);this._triggerResize=(()=>ni.triggerResize());ni.addEventListener(P.Resize,e=>this.onResize(e))}get viewModel(){return this._viewModel}set viewModel(e){this.unregisterViewModelEvents();this.removeSwimlanes();this._viewModel=e;if(this._viewModel){this._graphRulerView.viewModel=this._viewModel.graphRulerViewModel;this.setupSwimlanes()}this.registerViewModelEvents()}focusOnRuler(){this._graphRulerView.focus()}render(){this._graphRulerView.render()}getNewSwimlaneContainer(){var e=document.createElement("div");e.id=It.SWIMLANE_CONTAINER_ID_PREFIX+this._swimlanesContainer.childElementCount.toString();this._swimlanesContainer.appendChild(e);return e}getToolbarViewModel(){return this._viewModel&&this._viewModel.toolbarViewModel}onResize(e){this._swimlanes.forEach(t=>{t.resize(e)})}registerViewModelEvents(){if(this._viewModel){this._viewModel.globalRuler.addEventListener(ke.SelectionChangedEventType,this._onGlobalRulerSelectionChanged);this._viewModel.globalRuler.addEventListener(ke.ActiveRangeChangedEventType,this._onGlobalRulerActiveRangeChange)}}unregisterViewModelEvents(){if(this._viewModel){this._viewModel.globalRuler.removeEventListener(ke.SelectionChangedEventType,this._onGlobalRulerSelectionChanged);this._viewModel.globalRuler.removeEventListener(ke.ActiveRangeChangedEventType,this._onGlobalRulerActiveRangeChange)}}removeSwimlanes(){for(;this._swimlanes.length>0;){this._swimlanes.pop().dispose()}this._swimlanesContainer.innerHTML=""}setupSwimlanes(){if(this._viewModel.graphConfigs){!this._swimlaneVisibilityService&&Ct.getSwimlaneViewStateService&&(this._swimlaneVisibilityService=Ct.getSwimlaneViewStateService());for(var e=0;e<this._viewModel.graphConfigs.length;e++){var t=this._viewModel.graphConfigs[e],i=this.getNewSwimlaneContainer();this.setupSelectionContextMenu(i);var s=this._viewModel.getSwimlaneConfigurationFromManagedConfig(t),n=new s.graph.registeredClass(s.graph);s.header.unit=s.graph.unit;s.header.isBodyExpanded=!this._swimlaneVisibilityService||this._swimlaneVisibilityService.getSwimlaneVisibilitySynchronous(s.id);var a=new Microsoft.VisualStudio.DiagnosticsHub.SwimlaneBase(s.header,s.graph.height,s.timeRange);n.scaleChangedEvent.addEventListener(a.onScaleChanged.bind(a));a.swimlaneVisibilityChangedEvent.addEventListener(this.toggleSwimlaneVisibility.bind(this,s.id));var r=new Microsoft.VisualStudio.DiagnosticsHub.LocalizedUnitConverter(s.graph.jsonConfig.Units,s.graph.resources),o=new Microsoft.VisualStudio.DiagnosticsHub.Scale(s.graph.scale,Microsoft.VisualStudio.DiagnosticsHub.ScaleType.Left,r),l=new Microsoft.VisualStudio.DiagnosticsHub.Scale(s.graph.scale,Microsoft.VisualStudio.DiagnosticsHub.ScaleType.Right,r);n.scaleChangedEvent.addEventListener(o.onScaleChanged.bind(o));n.scaleChangedEvent.addEventListener(l.onScaleChanged.bind(l));a.addTitleControl(new Microsoft.VisualStudio.DiagnosticsHub.Legend(s.graph.legend));a.addMainRegionControl(new Microsoft.VisualStudio.DiagnosticsHub.SelectionOverlay(n,this._viewModel.globalRuler.activeRange.toJsonTimespan(),this._viewModel.globalRuler.selection.toJsonTimespan()));a.addMainRegionControl(new Microsoft.VisualStudio.DiagnosticsHub.GridLineRenderer(s.timeRange));a.addLeftRegionControl(o);a.addRightRegionControl(l);this._swimlanes.push(a);i.appendChild(a.container);a.resize(null)}}}setupSelectionContextMenu(...e){var t=this.getSelectionContextMenuIconNames(),i={callback:()=>{this.getToolbarViewModel()&&this.getToolbarViewModel().zoomIn()},disabled:()=>!this.getToolbarViewModel()||!this.getToolbarViewModel().zoomInEnabled,iconEnabled:t.zoomin.enabled,iconDisabled:t.zoomin.disabled,label:Object(o.b)("ToolbarButtonZoomIn"),type:ee.MenuItemType.command},s={callback:()=>{this.getToolbarViewModel()&&this.getToolbarViewModel().resetZoom()},disabled:()=>!this.getToolbarViewModel()||!this.getToolbarViewModel().resetZoomEnabled,iconEnabled:t.resetZoom.enabled,iconDisabled:t.resetZoom.disabled,label:Object(o.b)("ToolbarButtonResetZoom"),type:ee.MenuItemType.command},n={callback:()=>{this.getToolbarViewModel()&&this.getToolbarViewModel().clearSelection()},disabled:()=>!this.getToolbarViewModel()||!this.getToolbarViewModel().clearSelectionEnabled,iconEnabled:t.clearSelection.enabled,iconDisabled:t.clearSelection.disabled,label:Object(o.b)("ToolbarButtonClearSelection"),type:ee.MenuItemType.command};this._selectionActionContextMenu=ee.create([i,s,n]);for(var a=0;a<e.length;a++)this._selectionActionContextMenu.attach(e[a])}getSelectionContextMenuIconNames(){return{zoomin:{enabled:"f12-image-contextmenu-chartzoom-in",disabled:"f12-image-contextmenu-chartzoom-in-disabled"},resetZoom:{enabled:"f12-image-contextmenu-chartzoom-reset",disabled:"f12-image-contextmenu-chartzoom-reset-disabled"},clearSelection:{enabled:"f12-image-contextmenu-chartselection-clear",disabled:"f12-image-contextmenu-chartselection-clear-disabled"}}}onGlobalRulerActiveRangeChange(e){if(this._viewModel){var t={currentTimespan:this._viewModel.globalRuler.activeRange.toJsonTimespan(),selectionTimespan:this._viewModel.globalRuler.selection.toJsonTimespan(),isIntermittent:!1};this._swimlanes.forEach(e=>{e.onViewportChanged(t)})}}onGlobalRulerSelectionChanged(e){if(this._viewModel){var t={currentTimespan:this._viewModel.globalRuler.activeRange.toJsonTimespan(),selectionTimespan:this._viewModel.globalRuler.selection.toJsonTimespan(),isIntermittent:!1};this._swimlanes.forEach(e=>{e.onViewportChanged(t)})}}toggleSwimlaneVisibility(e,t){this._swimlaneVisibilityService.setSwimlaneVisibility(e,t);this._triggerResize()}}It.SWIMLANE_CONTAINER_ID_PREFIX="swimlaneContainer_";var Tt=i(85),Dt=i(51),yt=i(14),Rt=i(43);const xt=Object(Dt.a)();class Pt extends W.b{constructor(e){super();this._controller=e;this._startProfilingEnabled=!0}get startProfilingEnabled(){return this._startProfilingEnabled&&!this.isAtBreakpoint}set startProfilingEnabled(e){if(e!==this._startProfilingEnabled){this._startProfilingEnabled=e;this.propertyChanged.invoke(Pt.StartProfilingEnabledPropertyName)}}static initialize(){W.a.defineProperty(Pt,Pt.ClearSelectionEnabledPropertyName,!1);W.a.defineProperty(Pt,Pt.CollectionStatePropertyName,0);W.a.defineProperty(Pt,Pt.IsAtBreakpointPropertyName,!1,(e,t,i)=>e.onIsAtBreakpointChanged());W.a.defineProperty(Pt,Pt.OpenSessionPropertyName,!0);W.a.defineProperty(Pt,Pt.ResetZoomEnabledPropertyName,!1);W.a.defineProperty(Pt,Pt.SaveSessionPropertyName,!1);W.a.defineProperty(Pt,Pt.StopProfilingEnabledPropertyName,!1);W.a.defineProperty(Pt,Pt.ZoomInEnabledPropertyName,!1)}clearSelection(){this._globalRuler&&this._globalRuler.setSelection(this._globalRuler.activeRange)}resetZoom(){if(this._globalRuler){this._globalRuler.setActiveRange(this._globalRuler.totalRange);this.zoomInEnabled=!0;this.clearSelectionEnabled=!0}K.a.notify(Ee.ResetZoomFinished)}setGlobalRuler(e){if(this._globalRuler){this._globalRuler.removeEventListener(ke.ActiveRangeChangedEventType,this.onActiveRangeChanged.bind(this));this._globalRuler.removeEventListener(ke.SelectionChangedEventType,this.onSelectionChanged.bind(this))}this._globalRuler=e;if(this._globalRuler){this._globalRuler.addEventListener(ke.ActiveRangeChangedEventType,this.onActiveRangeChanged.bind(this));this._globalRuler.addEventListener(ke.SelectionChangedEventType,this.onSelectionChanged.bind(this))}}openSession(){Object(Rt.a)().openFileDialog({name:"",extensions:["diagsession"]},{access:yt.a.read,encoding:"BINARY",persistence:yt.d.temporary,type:yt.f.binary}).then(e=>this._controller.openSession(e)).then(()=>{},e=>{void 0!==e.number&&e.number===F.a.E_ABORT||xt.show(Object(o.b)("ProcessSessionFailedMessage"))})}saveSession(){Object(Rt.a)().saveFileDialog({name:"",extensions:["diagsession"]},{access:yt.a.readWrite,encoding:"BINARY",persistence:yt.d.temporary,type:yt.f.binary}).then(e=>{this._controller.saveSession(e)}).then(()=>{K.a.notify(Ee.SaveSessionFinished)},e=>{void 0!==e.number&&e.number===F.a.E_ABORT||xt.show(Object(o.b)("SaveSessionFailedMessage"))})}startProfiling(){this.clearSelectionEnabled=!1;this.openSessionEnabled=!1;this.resetZoomEnabled=!1;this.saveSessionEnabled=!1;this.startProfilingEnabled=!1;this.stopProfilingEnabled=!1;this.zoomInEnabled=!1;this.collectionState=0;this._controller.startProfiling().then(()=>{this.stopProfilingEnabled=!0;this.collectionState=1},e=>{this.startProfilingEnabled=!0;this.openSessionEnabled=null!==ni.packager;ni.reportError(e,Object(o.a)("JSPerf.1067"))})}stopProfiling(){this.clearSelectionEnabled=!1;this.openSessionEnabled=!1;this.resetZoomEnabled=!1;this.saveSessionEnabled=!1;this.startProfilingEnabled=!1;this.stopProfilingEnabled=!1;this.zoomInEnabled=!1;this.collectionState=2;this._controller.stopProfiling().then(()=>{this.openSessionEnabled=null!==ni.packager;this.saveSessionEnabled=null!==ni.packager;this.startProfilingEnabled=!0;this.collectionState=3},e=>{this.startProfilingEnabled=!0;this.collectionState=0;ni.reportError(e,Object(o.a)("JSPerf.1068"))})}abortProfiling(){this.clearSelectionEnabled=!1;this.openSessionEnabled=!0;this.resetZoomEnabled=!1;this.saveSessionEnabled=!1;this.startProfilingEnabled=!0;this.stopProfilingEnabled=!1;this.zoomInEnabled=!1;this.collectionState=3}zoomIn(){A.logPerformance({id:$.b.Timeline_Zoom_Start});if(this._globalRuler){this._globalRuler.setActiveRange(this._globalRuler.selection);this.zoomInEnabled=!1;this.clearSelectionEnabled=!1}K.a.notify(Ee.ZoomInFinished);A.logPerformance({id:$.b.Timeline_Zoom_Stop})}onActiveRangeChanged(e){this.resetZoomEnabled=!this._globalRuler.activeRange.equals(this._globalRuler.totalRange)}onSelectionChanged(e){var t=!e.data.newSelection.equals(this._globalRuler.activeRange);this.clearSelectionEnabled=t;this.zoomInEnabled=t&&e.data.newSelection.elapsed.nsec>Pt.MinimumZoomLevelInNs}onIsAtBreakpointChanged(){this.propertyChanged.invoke(Pt.StartProfilingEnabledPropertyName)}}Pt.MinimumZoomLevelInNs=1e5;Pt.ClearSelectionEnabledPropertyName="clearSelectionEnabled";Pt.CollectionStatePropertyName="collectionState";Pt.IsAtBreakpointPropertyName="isAtBreakpoint";Pt.OpenSessionPropertyName="openSessionEnabled";Pt.ResetZoomEnabledPropertyName="resetZoomEnabled";Pt.SaveSessionPropertyName="saveSessionEnabled";Pt.StartProfilingEnabledPropertyName="startProfilingEnabled";Pt.StopProfilingEnabledPropertyName="stopProfilingEnabled";Pt.ZoomInEnabledPropertyName="zoomInEnabled";Pt.initialize();class Mt extends Tt.a{constructor(){super("Common.defaultToolbarTemplate");this.title=Object(o.b)("F12ToolTitle");this.panelTemplateId="VisualProfiler.toolbarButtonsPanel";this.addClickHandlerToButton("startToolbarButton",this.onStartToolbarButtonClick.bind(this));this.addClickHandlerToButton("stopToolbarButton",this.onStopToolbarButtonClick.bind(this));this.addClickHandlerToButton("openSessionButton",this.onOpenSessionButtonClick.bind(this));this.addClickHandlerToButton("saveSessionButton",this.onSaveSessionButtonClick.bind(this));this.addClickHandlerToButton("zoomInButton",this.onZoomInButtonClick.bind(this));this.addClickHandlerToButton("resetZoomButton",this.onResetZoomButtonClick.bind(this));this.addClickHandlerToButton("clearSelectionButton",this.onClearSelectionButtonClick.bind(this))}onStartToolbarButtonClick(){if(this.model){A.logExecuteCommand(k.START_PROFILE,j.c.Ui);this.model.startProfiling()}}onStopToolbarButtonClick(){if(this.model){A.logExecuteCommand(k.STOP_PROFILE,j.c.Ui);this.model.stopProfiling()}}onOpenSessionButtonClick(){if(this.model){A.logExecuteCommand(k.IMPORT_SESSION,j.c.Ui);this.model.openSession()}}onSaveSessionButtonClick(){if(this.model){A.logExecuteCommand(k.EXPORT_SESSION,j.c.Ui);this.model.saveSession()}}onZoomInButtonClick(){if(this.model){A.logExecuteCommand(k.ZOOM_IN,j.c.Ui);this.model.zoomIn()}}onResetZoomButtonClick(){if(this.model){A.logExecuteCommand(k.ZOOM_RESET,j.c.Ui);this.model.resetZoom()}}onClearSelectionButtonClick(){if(this.model){A.logExecuteCommand(k.CLEAR_SELECTION,j.c.Ui);this.model.clearSelection()}}}var Lt=i(45),At=i(128),kt=i(93),Vt=i(137);class Ot{constructor(e){this._grid=e}findNextMatch(e,t,i){return this._grid.search(e,!1,!1,t)}findAndHighlightMatches(e){return null}getSearchTextFromSelection(e){return null}}var Nt=i(62),Ft=i(46),Ht=i(75),Bt=i(69);class Gt{constructor(e,t){this.controller=t;var i=document.getElementById("mainContainer"),s=new Re.a(i);this.mainView=new X.a(e);s.appendChild(this.mainView);this.dataViewContainer=this.mainView.findElement("dataViewContainer");this.detailedViewsContainer=this.mainView.findElement("detailedViewsContainer");this.eventsTimelineView=new gt(this.mainView.findElement("timelineViewContainer").id);this._warningView=this.mainView.findElement("warningView");this._warningView.style.display="none"}onToolActivated(){this.eventsTimelineView&&this.eventsTimelineView.listControl&&this.eventsTimelineView.listControl.updateHighlightedElement()}onToolDeactivated(){this.eventsTimelineView&&this.eventsTimelineView.listControl&&this.eventsTimelineView.listControl.clearHighlightedElement()}setSource(e){A.logPerformance({id:$.b.Timeline_LoadGraphs_Start});this.hide(this._warningView);this.onProcessingStarting();return this.controller.initializeSession(e).then(e=>{this.onProcessingCompleted();this.show(this.detailedViewsContainer);this.setupAnalysisView(e)},e=>{this.onProcessingFailed(e);const t=Object(o.b)("GenericDataProcessingError");this.showError(new Error(t),e.message);ni.reportError(e,t)})}setupAnalysisView(e){this.setupAnalysisViewOverride(e);this.eventsTimelineView.viewModel=e.eventsTimelineViewModel;this.eventsTimelineView.viewModel.resetFilter();this.eventsTimelineView.render().then(()=>{K.a.notify(Ee.ResultsLoaded);A.logPerformance({id:$.b.Timeline_LoadGraphs_Stop})})}resetSource(){this.eventsTimelineView.viewModel=null}show(e){e.style.display=""}hide(e){e.style.display="none"}}Gt.TestEventObject=new Bt.a;var jt=i(25);class Ut extends Ht.d{constructor(e,t){super(e,t);this._columnHeaderText=null;this.initializeContextMenuCommands();this._hideTooltipHandler=this.hideTooltip.bind(this)}_onDismissContextMenu(){this._contextMenuActive=!1;this._onBlur(null)}_onContextMenu(e){if(this.contextMenu){var t,i=0,s=0;if("contextmenu"===e.type){t=this.getRowInfoFromEvent(e,".grid-row");i=e.clientX;s=e.clientY}else if("keydown"===e.type&&this.isActive()){var n=this.getSelectedRowIndex(),a=this.getVisibleRowIndices();if(n<a.first||n>a.last){this.getSelectedRowIntoView();return}var r=this.getSelectedDataIndex();if(!(t=this.getRowInfo(r)))return;i=t.row.clientLeft;s=this.getElement().offsetTop+this.getHeaderHeight()+this.getRowTop(t.rowIndex)-this.getCanvas().scrollTop+this.getMeasurements().rowHeight}if(t){this._cachedSourceFilename=null;var o=this.getRowData(this.getSelectedDataIndex());o.aggType||this.cacheF12SourceInfo(o);if(this.cacheSelectedRows()){this._contextMenuActive=!0;this.contextMenu.show(i,s)}}}}_onKeyDown(e){switch(e.keyCode){case 121:if(e.shiftKey){this._onContextMenu(e);return!1}break;case 93:this._onContextMenu(e);return!1;case 9:e.shiftKey&&this.rootElement.focus();return!0;case 13:this.onEnter();return!1;case 123:return!0}return super._onKeyDown(e)}_onBlur(e){this._contextMenuActive||super._onBlur(e)}onEnter(){this._cachedSourceFilename=null;var e=this.getRowData(this.getSelectedDataIndex());if(e.aggType){if(1===this.getSelectionCount()&&e&&e.fileName){(new Microsoft.VisualStudio.DiagnosticsHub.Controllers.SourceService).getAccessiblePathToFile(e.fileName).then(t=>{if(t){this._cachedSourceFilename=t;this._cachedSourceLineNumber=e.lineNumber}}).then(()=>{this.navigateToCachedSource()})}}else{this.cacheF12SourceInfo(e);this.showDocument()}}getClipboardFormattedRowString(e,t){var i="",s=this.getRowData(e);if(!s)return i;for(var n=this.getColumns(),a=0;a<n.length;++a){var r=n[a];a>0&&(i+="\t");r.format?i+=s[r.index].toLocaleString(Ft.a.Language,r.format):i+=s[r.index]}var o=this._getExpandState(e);i=o<0?" + "+i:o>0?" - "+i:"   "+i;for(var l=s.parent,h=0;l;){h++>=t&&(i="  "+i);l=l.parent}return i}getShallowestDepthOfSelection(){var e=0,t=this.getSelectedRows();if(t){e=Number.MAX_VALUE;for(var i in t)if(null!==t[i]&&void 0!==t[i]){for(var s=this.getRowData(t[i]).parent,n=0;s&&!(++n>e);)s=s.parent;n<e&&(e=n)}}return e}expandNodesWhile(e){var t=this.getSelectedDataIndex();-1===t&&(t=0);for(var i=this.getRowData(t);i&&!i.isPlaceholder&&0!==this._getExpandState(t);){this.expandNode(t);if(!e(i))break;t++;i=this.getRowData(t)}}getColumnPixelIndent(e){return 12*e}_drawCell(e,t,i,s,n,a,r){var o=n.width||20,l=this.createElementWithClass("div",this.options().cellClass);l.style.width=isNaN(o)?String(o):o+"px";var h=this.getColumnText(t,n,r);n.hasHTMLContent||Ht.d._setTooltip(l,h,65);var d=n;if(d.getDynamicTooltip){var c=d.getDynamicTooltip(this.getRowData(t));l.addEventListener("mouseenter",this.showTooltip.bind(this,c));l.addEventListener("mouseleave",this._hideTooltipHandler);this.populateCell(l,t,n,h)}else if(r===a&&s>0){var u=this.getColumnPixelIndent(s);if(u<o){this.populateCell(l,t,n,h);this.addTreeIconWithIndent(l,i,s,n);if(d.getDynamicSourceInfoTooltip){var g=d.getDynamicSourceInfoTooltip(this.getRowData(t));l.addEventListener("mouseenter",this.showSourceInfoTooltip.bind(this,g));l.addEventListener("mouseleave",this._hideTooltipHandler)}}else{var m=document.createElement("div");m.innerHTML="[...]";m.style.left=o-18+"px";m.style.position="absolute";m.addEventListener("click",this.expandColumn.bind(this,m,n,u,h));l.appendChild(m);l.addEventListener("mouseenter",this.showTooltip.bind(this,h));l.addEventListener("mouseleave",this._hideTooltipHandler)}}else this.populateCell(l,t,n,h);if(d.cssClass)for(var p=d.cssClass.trim().split(" "),_=0;_<p.length;_++)l.classList.add(p[_]);n.rowCss&&l.classList.add(n.rowCss);return l}getCopyText(){var e=void 0;if(this._dataForClipboard||this.cacheSelectedRows()){e=this._dataForClipboard;this._dataForClipboard=null}return e||""}expandColumn(e,t,i,s){var n=document.createElement("div");n.innerHTML=s;n.style.position="absolute";n.style.left="10000px";e.appendChild(n);var a=i+n.scrollWidth;e.removeChild(n);t.width=a+10;this._applyColumnSizing(0,-1,!0)}showTooltip(e){d.c({content:e,delay:0})}showSourceInfoTooltip(e){var t={content:new ge.a(e).html,contentContainsHTML:!0};d.c(t)}hideTooltip(){d.a()}populateCell(e,t,i,s){var n;void 0!==i.hrefIndex&&(n=this.getColumnValue(t,i.hrefIndex,-1));if(n){var a=document.createElement("a");a.setAttribute("href",n);a.innerText=s;e.appendChild(a)}else s?i.hasHTMLContent?e.innerHTML=s:e.innerText=s:e.innerHTML="&nbsp;"}initializeContextMenuCommands(){var e=new Array;e[0]={id:"copy",callback:()=>{const e=this.getCopyText()||"";jt.copyPlainText(e)},label:Object(o.b)("CpuUsageTreeGrid_ContextMenu_Copy"),type:ee.MenuItemType.command,iconEnabled:null,iconDisabled:null,accessKey:"Ctrl+C",hidden:()=>!1,disabled:()=>!1,checked:()=>!1,cssClass:null,submenu:null};e[1]={id:"gotosource",callback:()=>{this.showDocument()},label:Object(o.b)("CpuUsageTreeGrid_ContextMenu_ViewSource"),type:ee.MenuItemType.command,iconEnabled:null,iconDisabled:null,accessKey:"Enter",hidden:()=>1!==this.getSelectionCount(),disabled:()=>!this._cachedSourceFilename,checked:()=>!1,cssClass:null,submenu:null};this._contextMenuCommands=e;this._contextMenuCommands.forEach(e=>{if(e.callback){var t=e.callback;e.callback=((e,i)=>{t(e,i);this.focus(10)})}});this.contextMenu=ee.create(this._contextMenuCommands,null,null,null,()=>{});this._contextMenuActive=!1;this._onDismissContextMenu=this._onDismissContextMenu.bind(this);this.addEventListenerToCanvas("contextmenu",this,this._onContextMenu);this.contextMenu.addEventListener("dismiss",this._onDismissContextMenu)}getColumnHeaderText(){if(!this._columnHeaderText){this._columnHeaderText="";for(var e=this.getColumns(),t=0;t<e.length;t++){t>0&&(this._columnHeaderText+="\t");var i=e[t];this._columnHeaderText+=i.text}}return this._columnHeaderText}navigateToCachedSource(){if(this._cachedSourceFilename){(new Microsoft.VisualStudio.DiagnosticsHub.Controllers.SourceService).showDocument(this._cachedSourceFilename,this._cachedSourceLineNumber)}}showDocument(){pe.h(this._cachedSourceFilename,this._cachedSourceLineNumber,this._cachedSourceColumnNumber).then(()=>{},e=>{ni.hostShell.setStatusBarText(Object(o.b)("UnableToNavigateToSource"),!0)})}cacheF12SourceInfo(e){if(e&&e.sourceInfo){this._cachedSourceFilename=e.sourceInfo.source;this._cachedSourceLineNumber=e.sourceInfo.line;this._cachedSourceColumnNumber=e.sourceInfo.column;0===this._cachedSourceLineNumber&&0===this._cachedSourceColumnNumber&&this.cacheF12SourceInfo(e.parent)}}cacheSelectedRows(){this._dataForClipboard=null;var e=this.getSelectedRows();if(null===e)return!1;var t=this.getShallowestDepthOfSelection(),i=this.getColumnHeaderText(),s=-1;for(var n in e){var a=parseInt(n.toString());if(null!==e[n]&&void 0!==e[n]){var r=this.getClipboardFormattedRowString(e[n],t);-1!==s&&s!==a-1&&(r="[...]\r\n"+r);i=i+"\r\n"+r}s=a}this._dataForClipboard=i;return!0}}class zt{constructor(e,t,i="",s="",n=-1){this._buttonDiv=null;this._tabIndex=-1;this._buttonClickedListeners=[];var a=document.getElementById(e);a.innerHTML=Object(o.b)(t);a.setAttribute("role","button");s&&a.setAttribute("aria-label",Object(o.b)(s));i&&a.setAttribute("data-plugin-vs-tooltip",Object(o.b)(i));this._buttonDiv=a;this._tabIndex=n;this._clickHandler=this.onButtonClick.bind(this);this._keyPressHandler=this.onButtonKeyPress.bind(this)}getContainer(){return this._buttonDiv}enable(){this._buttonDiv.removeEventListener("click",this._clickHandler);this._buttonDiv.removeEventListener("keypress",this._keyPressHandler);this._buttonDiv.addEventListener("click",this._clickHandler);this._buttonDiv.addEventListener("keypress",this._keyPressHandler);this._buttonDiv.classList.add("tree-grid-button-enabled");this._buttonDiv.classList.remove("tree-grid-button-disabled");this._buttonDiv.tabIndex=this._tabIndex}disable(){this._buttonDiv.removeEventListener("click",this._clickHandler);this._buttonDiv.removeEventListener("keypress",this._keyPressHandler);this._buttonDiv.classList.remove("tree-grid-button-enabled");this._buttonDiv.classList.add("tree-grid-button-disabled");this._buttonDiv.tabIndex=-1}addButtonClickedListener(e){for(var t=0;t<this._buttonClickedListeners.length;t++)if(e===this._buttonClickedListeners[t])return;this._buttonClickedListeners.push(e)}removeButtonClickedListener(e){for(var t=0;t<this._buttonClickedListeners.length;t++)if(e===this._buttonClickedListeners[t]){this._buttonClickedListeners.splice(t,1);return}}onButtonClick(e){this.invokeButtonClickedListeners()}onButtonKeyPress(e){13===e.keyCode&&this.invokeButtonClickedListeners()}invokeButtonClickedListeners(){for(var e=0;e<this._buttonClickedListeners.length;e++)this._buttonClickedListeners[e](this._buttonDiv.id)}}var Wt,Jt=!1,Xt=function(e){for(var t=[],i=e;i&&null!==i.id&&void 0!==i.id;){t.push(i.id);i=i.parent}return t},Kt=function(e,t=null){t||(t="desc"===e.sortOrder.order?2:1);var i=null;switch(e.column.index){case"name":i=2;break;case"iSamples":i=3;break;case"eSamples":i=4;break;case"iPercent":i=5;break;case"ePercent":i=6;break;case"module":i=7;break;case"id":i=1;break;default:throw new Error(Object(o.a)("JSCpuUsage.1001"))}return{column:i,direction:t}},Yt=function(e,t,i,s){var n=0,a=i[e.index],r=s[e.index];if(void 0===a||null===a)return void 0===r||null===r?0:-1;0===(n="name"===e.index?(a=a.toUpperCase())===(r=r.toUpperCase())?0:a>r?1:-1:a-r)&&(n=i.id-s.id);return n};class qt extends Ht.a{constructor(e,t,i,s,n,a,r,l,h,d,c,u){super(e,Object(o.b)(t),Object(o.b)(i),s,a);this.defaultSortOrder=r?"asc":"desc";this.indent=n;this.comparer=Yt;this.format=l;this.cssClass=h;this.getDynamicTooltip=c;this.getDynamicSourceInfoTooltip=u;d&&(this.getHeaderCellContents=d)}}class Zt{constructor(){this._dictionary={}}setThreadChecked(e,t){this._dictionary[e]=t}isThreadChecked(e){var t=this._dictionary[e];return void 0===t||t}getThreadIds(){var e=[];for(var t in this._dictionary)this._dictionary.hasOwnProperty(t)&&e.push(parseInt(t,10));return e}}class $t{constructor(e){this._analyzerId="DCA8B3EF-28C5-4B08-BAFC-B072F8AA9277";this._detailViewId="DCA8B3EF-17B4-4B08-BAFC-B072F8AA9277";this._buttonAnalyzeNowId="buttonAnalyzeNow";this._buttonCreateDetailedReportId="buttonCreateDetailedReport";this._logger=Microsoft.VisualStudio.DiagnosticsHub.getLogger();this._currentContextData={customDomain:{}};this._callTreeResult=null;this._grid=null;this._config=null;this._dataWarehouse=null;this._columns=null;this._progressBar=null;this._progressMessage=null;this._disableTreeGrid=null;this._lastSearchPromise=null;this._buttonCreateDetailedReport=null;this._buttons={};this._timeRangeChanged=!1;this._isReportButtonFocused=!1;this._jmcOn=!0;this._isSearching=!1;this._cachedJmcOn=!0;this._isVisible=!1;this._isActive=!1;if(!e||!e.containerId)throw new Error(Object(o.a)("JSCpuUsage.1000"));this._config=e;this._timeRangeChangedHandler=this.timeRangeChanged.bind(this);this._cacheTimeRangeChangedHandler=this.timeRangeChanged.bind(this);this._jmcEnabledStateChangedHandler=this.jmcEnabledStateChangedHandler.bind(this);this._cacheJmcEnabledStateChangedHandler=this.cacheJmcEnabledStateChangedHandler.bind(this);this._viewEventManager=Microsoft.VisualStudio.DiagnosticsHub.getViewEventManager();this.addExternalEvents(this._cacheTimeRangeChangedHandler,this._cacheJmcEnabledStateChangedHandler);this._container=document.getElementById(this._config.containerId);this._reportButtonFocusHandler=this.onReportButtonFocus.bind(this);this._reportButtonBlurHandler=this.onReportButtonBlur.bind(this);this._reportButtonKeyPressHandler=this.onReportButtonKeyPress.bind(this);this._reportButtonClickHandler=this.onReportButtonClick.bind(this);this._automation=Microsoft.VisualStudio.DiagnosticsHub.getAutomationManager(this._logger);for(;this._container.firstChild;)this._container.removeChild(this._container.firstChild);this._viewEventManager.detailsViewSelectionChanged.addEventListener(this.detailsViewChanged.bind(this));this._viewEventManager.detailsViewReady.raiseEvent({Id:this._detailViewId})}setActiveState(e){this._isActive=e;this.updateData()}hasData(){return null!==this._callTreeResult}render(){this._disableTreeGrid=document.getElementsByClassName("cpu-usage-container-overlay")[0];this.createToolbar();this._timeRangeChanged=!0;this._progressBar=document.getElementById("progressBar");this._progressMessage=document.getElementById("progressMessage");const e="1"===m.b.utilities.getEnvironmentVariable("F12_PERF_SHOW_NATIVE_CODE"),t="1"===m.b.utilities.getEnvironmentVariable("F12_PERF_SHOW_INJECTED_SCRIPTS");this._initialLoad=Microsoft.VisualStudio.DiagnosticsHub.DataWarehouse.loadDataWarehouse().then(e=>{this._dataWarehouse=e;return this._dataWarehouse.getContextService().getGlobalContext()}).then(e=>e.getTimeDomain()).then(e=>{this._currentContextData.timeDomain=e}).then(()=>this._dataWarehouse.getJmcService().setJmcEnabledState(!e)).then(()=>this._dataWarehouse.getPrivateData(1)).then(e=>{for(var i={"*.html":0,"*edgehtml.dll":0,$JScriptDynamic$:0},s=0;s<e.length;s++)(t||"dsh://"!==e[s].substring(0,6))&&(i[e[s]]=0);return this._dataWarehouse.setPrivateData(1,i)}).then(()=>{this.updateData()})}drawHeaderCellValue(e,t,i){var s=document.createElement("div");s.classList.add("title");e.hasHTMLContent?s.innerHTML=e.text||"&nbsp;":s.innerText=e.text||"";i&&s.classList.add(i);return s}search(e,t,i,s=!0){if(this._lastSearchPromise){this._lastSearchPromise.cancel();this._lastSearchPromise=null}this._searchString=e;if(e.length>0){this.setProgressMessage(Object(o.b)("SearchProgressMessage"));this.enableInProgressState();var n=this._grid.getRowData(this._grid.getSelectedDataIndex());this._request={type:2,selectedPath:Xt(n),sort:Kt(this.getCurrentSortInfo()),str:e,caseSensitive:t,isRegex:i,forward:s};this._isSearching=!0;this._lastSearchPromise=q.a.wrap(this._callTreeResult.getResult(this._request).then(this.searchChildNode.bind(this),this.errorHandler.bind(this)))}return this._lastSearchPromise}getCurrentThreadFilterConfig(){var e=new Zt;if(!this._threadDropDown)return e;var t=this._threadDropDown.getConfiguration();if(!t){this._logger.debug("Drop down exists but does not have configuration");return e}if(2!==t.body.items.length){this._logger.debug("Current body configuration count should be '2'");return e}t.body.items[1].checkboxItems.forEach(t=>{e.setThreadChecked(t.data.tid,t.checked)});return e}setCurrentThreadFilterConfig(e){if(!e)throw new Error(Object(o.a)("JSProfiler.1000"));var t=this._threadDropDown.getConfiguration();if(!t){this._logger.debug("Drop down exists but does not have configuration");return!1}if(2!==t.body.items.length){this._logger.debug("Current body configuration count should be '2'");return!1}t.body.items[1].checkboxItems.forEach(t=>{var i=document.getElementById(t.id);i&&(i.checked=e.isThreadChecked(t.data.tid))});this._threadDropDown.triggerApplyChanges();return!0}setLoadDataCompleteCallback(e){e?this._logger.debug("Setting additional callback for load data complete"):this._logger.debug("Clearing additional callback for load data complete");this._loadDataCompleteCallback=e}detailsViewChanged(e){if(e){this._cachedDetailsViewSelectionChangedEventArgs=e;if(this._initialLoad){this._initialLoad.then(()=>{this.switchDetailsView(this._cachedDetailsViewSelectionChangedEventArgs)});this._initialLoad=null}else this.switchDetailsView(e)}else this._logger.debug("detailsViewChanged - args is null or undefined.")}switchDetailsView(e){if(e.Id.toLowerCase()!==this._detailViewId.toLowerCase()||this._isVisible){if(e.Id.toLowerCase()!==this._detailViewId.toLowerCase()&&this._isVisible){this._isVisible=!1;this._cachedJmcOn=this._jmcOn;this._inactiveTimeRange=this._currentContextData.timeDomain;this.removeExternalEvents(this._timeRangeChangedHandler,this._jmcEnabledStateChangedHandler);this.addExternalEvents(this._cacheTimeRangeChangedHandler,this._cacheJmcEnabledStateChangedHandler)}}else{this._isVisible=!0;this.addExternalEvents(this._timeRangeChangedHandler,this._jmcEnabledStateChangedHandler);this.removeExternalEvents(this._cacheTimeRangeChangedHandler,this._cacheJmcEnabledStateChangedHandler);this.timeRangeChanged({isIntermittent:!1,position:this._inactiveTimeRange});this.jmcEnabledStateChangedHandler({currEnabledState:this._cachedJmcOn,prevEnabledState:this._jmcOn})}}cacheJmcEnabledStateChangedHandler(e){e.currEnabledState!==e.prevEnabledState&&(this._cachedJmcOn=e.currEnabledState)}addExternalEvents(e,t){if(this._viewEventManager){this._viewEventManager.selectionChanged.addEventListener(e);this._viewEventManager.jmcEnabledStateChanged.addEventListener(t)}}removeExternalEvents(e,t){if(this._viewEventManager){this._viewEventManager.selectionChanged.removeEventListener(e);this._viewEventManager.jmcEnabledStateChanged.removeEventListener(t)}}enableInProgressState(){this._disableTreeGrid.classList.add("cpu-usage-container-disable");this._progressBar.classList.remove("progress-hidden");this._progressMessage.classList.remove("progress-hidden")}disableInProgressState(){this._progressBar.classList.add("progress-hidden");this._progressMessage.classList.add("progress-hidden");this._disableTreeGrid.classList.remove("cpu-usage-container-disable")}setProgressMessage(e){this._progressMessage.innerText=e}createToolbar(){var e=0;if(2===this._config.viewDestination){this._buttonCreateDetailedReport=document.getElementById("buttonCreateDetailedReport");this._buttonCreateDetailedReport.innerHTML=Object(o.b)("Button_CreateDetailedReport");this._buttonCreateDetailedReport.setAttribute("role","button");this._buttonCreateDetailedReport.setAttribute("aria-label",Object(o.b)("Button_CreateDetailedReport"));this.enableReportButton();e++}if(4===this._config.viewDestination){var t=new zt(this._buttonAnalyzeNowId,"Button_AnalyzeNow","","Button_AnalyzeNow",e);t.enable();t.addButtonClickedListener(this.onButtonClicked.bind(this));this._buttons[this._buttonAnalyzeNowId]=t;e++}}enableReportButton(){this._buttonCreateDetailedReport.addEventListener("click",this._reportButtonClickHandler);this._buttonCreateDetailedReport.addEventListener("focus",this._reportButtonFocusHandler);this._buttonCreateDetailedReport.addEventListener("blur",this._reportButtonBlurHandler);this._buttonCreateDetailedReport.addEventListener("keypress",this._reportButtonKeyPressHandler);this._buttonCreateDetailedReport.classList.add("create-report-button-enabled");this._buttonCreateDetailedReport.classList.remove("create-report-button-disabled");this._buttonCreateDetailedReport.tabIndex=0}disableReportButton(){this._buttonCreateDetailedReport.removeEventListener("click",this._reportButtonClickHandler);this._buttonCreateDetailedReport.removeEventListener("focus",this._reportButtonFocusHandler);this._buttonCreateDetailedReport.removeEventListener("blur",this._reportButtonBlurHandler);this._buttonCreateDetailedReport.removeEventListener("keypress",this._reportButtonKeyPressHandler);this._buttonCreateDetailedReport.classList.remove("create-report-button-enabled");this._buttonCreateDetailedReport.classList.add("create-report-button-disabled");this._buttonCreateDetailedReport.tabIndex=-1}onReportButtonClick(e){this.createDetailedReport()}onReportButtonFocus(e){this._isReportButtonFocused=!0}onReportButtonBlur(e){this._isReportButtonFocused=!1}onReportButtonKeyPress(e){this._isReportButtonFocused&&13===e.keyCode&&this.createDetailedReport()}createDetailedReport(){this.disableReportButton();Microsoft.VisualStudio.DiagnosticsHub.getCurrentDocument().openInAlternateFormat(1).then(e=>{this.enableReportButton()},e=>{this._logger.debug("Create detailed report failure: "+JSON.stringify(e));this.enableReportButton()})}onButtonClicked(e){if(this._buttons[e]){this._buttons[e].disable();try{e===this._buttonAnalyzeNowId?this.render():e===this._buttonCreateDetailedReportId&&this.createDetailedReport()}catch(e){this._logger.error(e.Message)}this._buttons[e].enable()}else this._logger.error("Button ID '"+e+"' is unknown.")}getThreadInfo(e){var t={customDomain:{task:"get-threads"}};this._currentContextData.timeDomain&&(t.timeDomain=this._currentContextData.timeDomain);e&&(t.customDomain.control=e);return this.queryDataWarehouse(t,this._analyzerId)}populateThreadFilter(e){this._currentContextData.threadDomain=[];e.forEach(e=>{1===e.roles&&this._currentContextData.threadDomain.push(e.tid)})}timeRangeChanged(e){if(!e.isIntermittent){var t=e.position;if(t&&(!this._currentContextData.timeDomain||!this._currentContextData.timeDomain.equals(t))){this._currentContextData.timeDomain=t;this._timeRangeChanged=!0;this._currentContextData.threadDomain&&this.updateData()}}}updateData(){this._loadDataPromise&&this._loadDataPromise.cancel();this._isActive&&this._timeRangeChanged&&this.loadData()}loadData(e=3){this.setProgressMessage(Object(o.b)("LoadDataProgressMessage"));this.enableInProgressState();switch(e){case 1:return this.loadCallTree().then(this.getShowExternalCodeState.bind(this)).then(this.populateShowExternalCodeState.bind(this)).then(this.loadDataComplete.bind(this),this.errorHandler.bind(this));case 2:return this.getShowExternalCodeState().then(this.populateShowExternalCodeState.bind(this)).then(this.getThreadInfo.bind(this,"filter")).then(this.populateThreadFilter.bind(this)).then(this.loadDataComplete.bind(this),this.errorHandler.bind(this));case 3:default:return this.getThreadInfo("filter").then(this.populateThreadFilter.bind(this)).then(this.loadCallTree.bind(this)).then(this.getShowExternalCodeState.bind(this)).then(this.populateShowExternalCodeState.bind(this)).then(this.loadDataComplete.bind(this),this.errorHandler.bind(this))}}getShowExternalCodeState(){if(this._dataWarehouse)return this._dataWarehouse.getJmcService().getJmcEnabledState()}populateShowExternalCodeState(e){"boolean"==typeof e&&(this._jmcOn=e)}jmcEnabledStateChangedHandler(e){if(e.currEnabledState!==e.prevEnabledState){this._jmcOn=e.currEnabledState;this._loadDataPromise&&this._loadDataPromise.cancel();this._loadDataPromise=q.a.wrap(this.loadData())}}loadDataComplete(){this._initialLoad=null;this._timeRangeChanged=!1;this.disableInProgressState();this._loadDataCompleteCallback&&this._loadDataCompleteCallback()}loadCallTree(){if(this._lastSearchPromise){this._lastSearchPromise.cancel();this._lastSearchPromise=null}var e;if(this._callTreeResult){var t=this._callTreeResult;this._callTreeResult=null;t.dispose()}e=Promise.resolve(null);this._currentContextData.customDomain.task="get-call-tree-view";return e.then(this.queryDataWarehouse.bind(this,this._currentContextData,this._analyzerId)).then(this.getResultData.bind(this)).then(this.setCreateDetailedReportButtonState.bind(this)).then(this.populateTreeGrid.bind(this),this.errorHandler.bind(this))}queryDataWarehouse(e,t){return this._dataWarehouse.getFilteredData(e,t)}getResultData(e){this._callTreeResult=e;var t={type:1,sort:Kt(this.getCurrentSortInfo(),1),path:[]};if(this._callTreeResult){Gt.TestEventObject.fireEvent("ResultPopulated");return this._callTreeResult.getResult(t)}return Promise.reject(new Error(Object(o.b)("InvalidResultsError")))}setCreateDetailedReportButtonState(e){e.enableIceCap&&2===this._config.viewDestination&&(this._buttonCreateDetailedReport.style.display="block");return e.callTreeData}populateTreeGrid(e){if(!this._grid){var t=new Ht.b(this.getChildrenDataCallback.bind(this),this.getColumns(),[this.getDefaultSortInfo()],null);t.asyncInit=!1;t.allowMultiSelect=!0;this._grid=new Ut(this._container,t)}var i=this.constructRows(null,e);this._grid.setSelectedRowIndex(-1);this._timeRangeChanged=!1;return this._grid.setDataSource(i.itemsWithPlaceholders,i.expandStates,this.getColumns(),[this.getDefaultSortInfo()]).then(()=>{this._grid.getCanvas().scrollTop=0;this.autoExpand()})}errorHandler(e){this._loadDataPromise&&this._loadDataPromise.cancel();this._isSearching=!1;this.disableInProgressState();this._logger.error(JSON.stringify(e))}getChildrenDataCallback(e,t){var i=e;if(!this._timeRangeChanged&&this._callTreeResult){this._loadDataPromise=q.a.wrap(this._callTreeResult.getResult({type:1,sort:Kt(this.getCurrentSortInfo(),1),path:Xt(i)}));var s=this._loadDataPromise.then(this.updateGridWithResult.bind(this,i,t));this._isSearching||s.then(this.autoExpand.bind(this),this.errorHandler.bind(this))}}updateGridWithResult(e,t,i){t(this.constructRows(e,i.callTreeData));this._result&&this._result.length>0&&this.searchChildNode(this._result);return Promise.resolve(null)}autoExpand(){this._grid&&this._grid.expandNodesWhile(e=>!(!e||this._timeRangeChanged)&&1===e.childCount)}constructRows(e,t){var i=[],s=[];if(t)for(;t.length>0;){var n=t.pop();if(n.aggType)switch(n.aggType){case 1:n.name=Object(o.b)("SystemCodeLabel");break;case 2:n.name="[External code]"}switch(n.moduleCount){case 0:n.module="";break;case 1:break;default:n.module=Object(o.b)("MultipleModuleLabel",n.moduleCount)}if(!n.aggType){var a=n.name.split(/-|:/),r=0,l=0;if(a.length>2){r=parseInt(a.pop());l=parseInt(a.pop());n.name=a.toString()}"$JScriptDynamic$"===n.module&&(n.module=Object(o.b)("FilePickerDynamicNode"));n.sourceInfo={source:n.module,column:r,line:l}}"Global code"===n.name&&(n.name="(Global code)");"$JScriptDynamic$"===n.fileName&&(n.module=Object(o.b)("FilePickerDynamicNode"));this._logger.debug(JSON.stringify(n));n.parent=e;i.push(n);if(n.childCount>0){s.push(-1);i.push({isPlaceholder:!0,name:"",iSamples:0,eSamples:0,iPercent:0,ePercent:0,childCount:0,lineNumber:0,id:0,module:"",moduleCount:0,parent:null,fileName:""});s.push(0)}else s.push(0)}return{itemsWithPlaceholders:i,expandStates:s}}getColumns(){if(null===this._columns){var e={style:"percent",maximumFractionDigits:2,minimumFractionDigits:2},t=125;this._columns=[new qt("name","CpuUsageTreeGrid_FunctionNameHeader","CpuUsageTreeGrid_FunctionNameTooltip",300,!0,!0,!0,null,null,null,null,e=>e.sourceInfo),new qt("iPercent","CpuUsageTreeGrid_TotalSamplesPercentHeader","CpuUsageTreeGrid_TotalSamplesPercentHeaderTooltip",t,!1,!0,!1,e,"grid-cell-numeric",(e,t)=>this.drawHeaderCellValue(e,t,"grid-header-cell-numeric"),t=>t.isPlaceholder?"":Object(o.b)("CpuUsageTreeGrid_PercentageTooltip",t.iPercent.toLocaleString(Ft.a.Language,e),t.iSamples,this._grid.getRowData(0).iSamples)),new qt("ePercent","CpuUsageTreeGrid_SelfSamplesPercentHeader","CpuUsageTreeGrid_SelfSamplesPercentHeaderTooltip",t,!1,!0,!1,e,"grid-cell-numeric",(e,t)=>this.drawHeaderCellValue(e,t,"grid-header-cell-numeric"),t=>t.isPlaceholder?"":Object(o.b)("CpuUsageTreeGrid_PercentageTooltip",t.ePercent.toLocaleString(Ft.a.Language,e),t.eSamples,this._grid.getRowData(0).iSamples)),new qt("iSamples","CpuUsageTreeGrid_TotalSamplesHeader","CpuUsageTreeGrid_TotalSamplesHeaderTooltip",t,!1,!0,!1,null,"grid-cell-numeric",(e,t)=>this.drawHeaderCellValue(e,t,"grid-header-cell-numeric"),e=>e.isPlaceholder?"":Object(o.b)("CpuUsageTreeGrid_SamplesTooltip",e.iSamples,e.iSamples)),new qt("eSamples","CpuUsageTreeGrid_SelfSamplesHeader","CpuUsageTreeGrid_SelfSamplesHeaderTooltip",t,!1,!0,!1,null,"grid-cell-numeric",(e,t)=>this.drawHeaderCellValue(e,t,"grid-header-cell-numeric"),e=>e.isPlaceholder?"":Object(o.b)("CpuUsageTreeGrid_SamplesTooltip",e.eSamples,e.eSamples)),new qt("module","CpuUsageTreeGrid_ModuleHeader","CpuUsageTreeGrid_ModuleTooltip",400,!1,!0,!1)];Jt&&this._columns.push(new qt("id","CpuUsageTreeGrid_FunctionNameHeader","CpuUsageTreeGrid_FunctionNameTooltip",t,!1,!0,!1,null,"grid-cell-numeric",(e,t)=>this.drawHeaderCellValue(e,t,"grid-header-cell-numeric")))}return this._columns}getDefaultSortInfo(){var e=this.getColumns()[1];return new Nt.g(e.index,e.defaultSortOrder)}getCurrentSortInfo(){var e=null,t=null;if(this._grid){var i=this._grid.getSortOrder();i&&i.length>0&&(t=i[0])}t||(t=this.getDefaultSortInfo());for(var s=this.getColumns(),n=0;n<s.length;n++)if(s[n].index===t.index){e=s[n];break}return{column:e,sortOrder:t}}searchChildNode(e){this._result=e;if(null!==this._searchString){this.disableInProgressState();if(0!==this._result.length){for(var t=0,i=!1;;){var s=this._grid.getRowData(t);if(!s)break;if(!s.isPlaceholder&&s.id===this._result[0].nodeId){if(!(this._result.length>1)){this._result.shift();this._grid.setSelectedDataIndex(t);this._grid.getSelectedRowIntoViewCenter()||this._grid.redraw();this._result=null;this._searchString=null;this._request=null;this._isSearching=!1;break}this._result.shift();var n=this._grid.getRowData(t+1);if(n&&n.isPlaceholder){i=!0;break}this._grid.expandNode(t)}t++}i&&this._grid.expandNode(t);return!0}this._isSearching=!1;return!1}}}class Qt extends J.a{constructor(e,t){super(t||"VisualProfiler.cpuUsageTemplate");document.getElementById(e).appendChild(this.rootElement);this.model=new $t({containerId:"gridContainer",viewDestination:0});this.SearchControl.searchProvider=new Ot(this.model);ni.addEventListener(P.Resize,()=>this.onTabResize())}get SearchControl(){this._searchControl||(this._searchControl=new Vt.a);return this._searchControl}onTabActivated(){}onTabResize(){}}!function(e){e[e.Stopped=0]="Stopped";e[e.InProgress=1]="InProgress";e[e.Failed=2]="Failed";e[e.Analyzing=3]="Analyzing"}(Wt||(Wt={}));const ei=Object(Dt.a)();class ti extends Gt{constructor(e,t){super("mainViewTemplateF12",e);this.timelineViewContainer=this.mainView.findElement("timelineViewContainer");this.eventsTimelineTab=new kt.a;this.eventsTimelineTab.tabPane=this.eventsTimelineView;this.eventsTimelineTab.title=Object(o.b)("TimelineTabLabel");this.eventsTimelineTab.tooltip=Object(o.b)("TimelineTabTooltip");var i=new Qt(this.timelineViewContainer.id);this.cpuUsageTab=new kt.a;this.cpuUsageTab.tabPane=i;this.cpuUsageTab.title=Object(o.b)("JavaScriptCallStacksTabLabel");this.cpuUsageTab.tooltip=Object(o.b)("JavaScriptCallStacksTabTooltip");this.tabControl=new At.a;this.tabControl.tabsLeftAligned=!0;this.timelineViewContainer.appendChild(this.tabControl.rootElement);this.tabControl.selectedItemChanged=(()=>this.onSelectedTabChanged());this.tabControl.addTab(this.eventsTimelineTab);this.tabControl.addTab(this.cpuUsageTab);this.toolbarViewModel=t;this._profilingState=Wt.Stopped;this.hide(this.dataViewContainer);this.hide(this.detailedViewsContainer);this._toolbarControl=new Mt;this._toolbarControl.model=t;this.mainView.findElement("toolbarViewContainer").appendChild(this._toolbarControl.rootElement);this._progressContainer=this.mainView.findElement("progressContainer");this._profilingLink=this.mainView.findElement("profilingLink");this._progressText=this.mainView.findElement("progressText");this._progressText.textContent=Object(o.b)("AnalyzeDataStatus");this._progressIndicator=this.mainView.findElement("progressIndicator");this.showStartProfilingPrompt();var s=this.onProfilingLinkClick.bind(this);this._profilingLink.addEventListener("click",s);this._profilingLink.addEventListener("keydown",s);this._swimLanesView=new It(this.mainView.findElement("swimLanesViewContainer").id);document.addEventListener("keydown",this.shortcutHandler.bind(this));this._toolbarViewModel.openSessionEnabled=null!==ni.packager;this.updateNavigationFrames(!0);Lt.a.registerFocusHandlers(I.c.visualProfiler)}hasData(){return this.cpuUsageTab.tabPane.model.hasData()}get toolbarViewModel(){return this._toolbarViewModel}set toolbarViewModel(e){this.unregisterToolbarViewModelEvents();this._toolbarViewModel=e;this.registerToolbarViewModelEvents()}showProcessingProgressPrompt(){this.hide(this.dataViewContainer);this.show(this._progressContainer);this.show(this._progressText);this.show(this._progressIndicator);this.hide(this._profilingLink)}showStartProfilingPrompt(){this.setProfilingLinkText(Object(o.b)("F12StartProfilingMessage"));this.hide(this.dataViewContainer);this.show(this._progressContainer);this.hide(this._progressText);this.hide(this._progressIndicator);this.show(this._profilingLink)}showProfilingProgressPrompt(){this.setProfilingLinkText(Object(o.b)("F12StopProfilingMessage"));this.hide(this.dataViewContainer);this.show(this._progressContainer);this.hide(this._progressText);this.show(this._progressIndicator);this.show(this._profilingLink)}hidePrompt(){this.hide(this._progressContainer);this.hide(this._progressText);this.hide(this._profilingLink);this.hide(this._progressIndicator)}onProcessingStarting(){this._profilingState=Wt.Analyzing;this.showProcessingProgressPrompt()}onProcessingCompleted(){this._profilingState=Wt.Stopped;this.hidePrompt();this.show(this.dataViewContainer);this.show(this.detailedViewsContainer)}onProcessingFailed(e){this._profilingState=Wt.Stopped;this.showStartProfilingPrompt();this.showError(new Error(Object(o.b)("GenericDataProcessingError",e.message)))}onProfilingStarted(){this._profilingState=Wt.InProgress;this.showProfilingProgressPrompt()}onProfilingStartFailed(e){this._profilingState=Wt.Failed;this.showStartProfilingPrompt();var t="-2147221164"===e.message?"https://go.microsoft.com/fwlink/?LinkID=306020":null;this.showError(new Error(Object(o.b)("GenericDataProcessingError",e.message)),t)}onProfilingStopping(){this._profilingState=Wt.Stopped;this.hidePrompt();this.showProcessingProgressPrompt()}onProfilingStopFailed(e){this._profilingState=Wt.Failed;this.showStartProfilingPrompt();this.showError(new Error(Object(o.b)("GenericDataProcessingError",e.message)));this.updateNavigationFrames(!0)}onProfilingAborted(){this.showStartProfilingPrompt();this.updateNavigationFrames(!0)}registerToolbarViewModelEvents(){this.toolbarViewModel&&(this._toolbarViewModelPropertyChangedEvtReg=this.toolbarViewModel.propertyChanged.addHandler(this.onToolbarViewModelPropertyChanged.bind(this)))}setupAnalysisViewOverride(e){this._swimLanesView.viewModel=e.swimlanesViewModel;this._swimLanesView.render();this.cpuUsageTab&&this.cpuUsageTab.tabPane.model.render();window.setImmediate(()=>{ni.triggerResize();this._swimLanesView.focusOnRuler();this.updateNavigationFrames(!1)})}showError(e,t){ei.show(e.message,null,t)}unregisterToolbarViewModelEvents(){if(this._toolbarViewModelPropertyChangedEvtReg){this._toolbarViewModelPropertyChangedEvtReg.unregister();this._toolbarViewModelPropertyChangedEvtReg=null}}onProfilingLinkClick(e){if(this.controller&&("click"===e.type||13===e.keyCode||32===e.keyCode)){this._profilingState===Wt.InProgress&&this.toolbarViewModel.stopProfilingEnabled?A.logExecuteCommand(k.STOP_PROFILE,j.c.Ui):this.toolbarViewModel.startProfilingEnabled&&A.logExecuteCommand(k.START_PROFILE,j.c.Ui);this.toggleProfiling()}}onSelectedTabChanged(){for(;this.tabControl.afterBarContainer.firstChild;)this.tabControl.afterBarContainer.removeChild(this.tabControl.afterBarContainer.firstChild);const e=this.cpuUsageTab.tabPane;e.model.setActiveState(this.tabControl.selectedItem===this.cpuUsageTab);if(this.tabControl.selectedItem===this.eventsTimelineTab){const e=this.eventsTimelineView.sortFilterSection;this.tabControl.afterBarContainer.appendChild(e)}else if(this.tabControl.selectedItem===this.cpuUsageTab){const t=e.SearchControl.rootElement;this.tabControl.afterBarContainer.appendChild(t)}}onToolbarViewModelPropertyChanged(e){const t=!this.toolbarViewModel.isAtBreakpoint;switch(e){case Pt.StartProfilingEnabledPropertyName:this._profilingState!==Wt.Stopped&&this._profilingState!==Wt.Failed||this.updateProfilingLinkState(t);break;case Pt.StopProfilingEnabledPropertyName:this._profilingState===Wt.InProgress&&this.updateProfilingLinkState(t)}}shortcutHandler(e){if(e.ctrlKey&&!e.shiftKey&&!e.altKey)if(69===e.keyCode){this._profilingState!==Wt.InProgress&&this._profilingState!==Wt.Analyzing||!this.toolbarViewModel.stopProfilingEnabled?this.toolbarViewModel.startProfilingEnabled&&A.logExecuteCommand(k.START_PROFILE,j.c.KeyboardShortcut):A.logExecuteCommand(k.STOP_PROFILE,j.c.KeyboardShortcut);e.preventDefault();this.toggleProfiling()}else if(this.toolbarViewModel.saveSessionEnabled&&83===e.keyCode){A.logExecuteCommand(k.EXPORT_SESSION,j.c.KeyboardShortcut);this.toolbarViewModel.saveSession();e.preventDefault()}else if(this.toolbarViewModel.openSessionEnabled&&79===e.keyCode){A.logExecuteCommand(k.IMPORT_SESSION,j.c.KeyboardShortcut);this.toolbarViewModel.openSession();e.preventDefault()}}toggleProfiling(){if(this._profilingState!==Wt.InProgress&&this._profilingState!==Wt.Analyzing||!this.toolbarViewModel.stopProfilingEnabled){if(this.toolbarViewModel.startProfilingEnabled){this.toolbarViewModel.startProfiling();this.updateNavigationFrames(!0)}}else this.toolbarViewModel.stopProfiling()}setProfilingLinkText(e){this._profilingLink.innerText=e;this._profilingLink.setAttribute("aria-label",e)}updateProfilingLinkState(e){this.hide(this._progressText);if(e){this.show(this._profilingLink);this._profilingState!==Wt.Failed&&ei.close()}else{this.hide(this._profilingLink);this.showBreakpointDisabledMessage()}}showBreakpointDisabledMessage(){ei.show(Object(o.b)("VisualProfilerDisabledAtBreakpoint"))}updateNavigationFrames(e){var t=[Lt.a.makeNavigationFrameFromCallback(document.body,()=>this._toolbarControl.getActiveElement())];e||t.push(Lt.a.makeNavigationFrameFromCallback(this.mainView.findElement("timelineViewContainer"),()=>document.getElementById("timelineSortSelector")));Lt.a.registerNavigationFrames(t)}}class ii{constructor(){this._toolbarViewModel=new Pt(this);this._view=new ti(this,this._toolbarViewModel);m.b.addEventListener("activated",()=>this.onToolActivated());m.b.addEventListener("deactivated",()=>this.onToolDeactivated());m.b.addEventListener("break",()=>this.onBreak());m.b.addEventListener("run",()=>this.onRun());this.onToolActivated();m.b.addEventListener("attach",()=>{this._isAttached=!0});m.b.addEventListener("detach",()=>{this._isAttached=!1;this.clearEtw()});m.b.addEventListener("closing",()=>{this.clearEtw()});this._isAttached=m.b.isAttached}get globalRuler(){return this._globalRuler}get toolbarViewModel(){return this._toolbarViewModel}get view(){return this._view}initializeSession(e){this._profilingSource=e;return new Promise((e,t,i)=>{this._profilingSource.getDataSession().then(e=>{if(!e)return t(new Error("Session can't be null on initialization"));this._session=e;return this.initializeResources()},t).then(()=>{this._globalRuler&&this._globalRuler.deinitialize();var t=this._session.getTotalDuration();this._globalRuler=new ke(new fe(Se.fromNanoseconds(t.begin),Se.fromNanoseconds(t.end)));this._toolbarViewModel.setGlobalRuler(this._globalRuler);var i=new mt(this._session),s=new dt(this._session),n=new ct(s,this._globalRuler,i),a=this._session.getLowestObservedDocumentMode(),r=new wt(this._globalRuler,i,this._session,ii.PADDING,this._toolbarViewModel),o=new bt;r.graphConfigs=o.configurations;e&&e({eventsTimelineViewModel:n,globalRuler:this._globalRuler,swimlanesViewModel:r,lowestObservedDocumentMode:a})},t)})}startProfiling(){return this._collectionSession?Promise.resolve():this.closeSession().then(()=>{G.b(I.c.visualProfiler);this._etwDataCollector||(this._etwDataCollector=new O.a);return this._etwDataCollector.startSession("JavaScriptCollectionAgent.dll","{8C0C6321-37F1-11E3-8259-6C3BE516EAD0}",!0,I.c.visualProfiler).then(e=>{this._collectionSession=e;this._view.onProfilingStarted()},e=>{G.c(I.c.visualProfiler);this._view.onProfilingStartFailed(e);throw e})})}stopProfiling(){if(this._collectionSession){this._view.onProfilingStopping();var e=this._collectionSession;this._collectionSession=null;return(this._isAttached?e.stop():Promise.resolve(null)).then(e=>{if(e){G.c(I.c.visualProfiler);return this._view.setSource(new vt(e,!1,Object(B.k)()))}return Promise.resolve()},e=>{this._view.onProfilingStopFailed(e);throw e})}return Promise.resolve()}async openSession(e){try{await ni.packager.openPackage(e.streamId);if(!ni.packager.hasToolData(F.a.UI_RESPONSIVENESS_TOOL_GUID))throw new Error(Object(o.a)("JSPerf.1076"));await this.closeSession();const t=ni.packager.getResourcePathsByType(ii.ETL_RESOURCE_TYPE);ni.packager.closePackage();this._view.onProfilingStopping();this.toolbarViewModel.openSessionEnabled=!0;this.toolbarViewModel.saveSessionEnabled=!0;this.toolbarViewModel.startProfilingEnabled=!0;this.toolbarViewModel.collectionState=3;let i="";if(t.length>0){i=t[0];for(let e=1;e<t.length;e++)i=i+"|"+t[e]}this._view.setSource(new vt(i,!0,Object(B.k)()));await e.close()}catch(t){ni.packager.closePackage();await e.close();return Promise.resolve(t)}}async saveSession(e){let t;if(!(this._profilingSource instanceof vt))throw new Error(Object(o.b)("WrongDataSource"));t=this._profilingSource.etlPath.split("|");const i=ni.packager.createPackage(F.a.UI_RESPONSIVENESS_TOOL_GUID);for(let e=0;e<t.length;++e)ni.packager.addResource(ii.ETL_RESOURCE_TYPE,t[e],ii.ETL_SAVE_NAME+e+".etl");ni.packager.commit();await Object(B.g)(i,e.streamId);await e.close();Object(B.h)(i)}closeSession(){if(this._session){this._view.resetSource();return this._session.closeAsync().then(()=>{this._session=null;this.deleteEtlFile()},e=>{this._session=null;throw e})}return Promise.resolve()}deleteEtlFile(){this._profilingSource&&this._profilingSource.clean()}clearEtw(){if(this._session){this._session.close();this._session=null;this.deleteEtlFile()}if(this._collectionSession){this._view.onProfilingStopping();G.c(I.c.visualProfiler)}this._toolbarViewModel.abortProfiling();this._view.onProfilingAborted();this._collectionSession=null;if(this._etwDataCollector){this._etwDataCollector.stopCollection();this._etwDataCollector=null}}initializeResources(){var e={};["AnimationFrame","CssCalculation","CssParsing","DDTrackDomSet","DDTrackerSetStyleContextName","DomEvent","EvaluatingScript","EventHandler","Frame","GarbageCollection","HtmlParsing","HtmlSpeculativeDownloading","HttpRequest","Idle","ImageDecoded","InlineScriptLabel","InlineStylesheetLabel","Layout","Measure","MediaQueryListener","MutationObserver","Paint","RenderLayer","TASK_DocumentResize","TASK_DoEnReNo","TASK_DoInsElm","TASK_Fi","TASK_FiCmpFmt","TASK_LineBox","TASK_PageFrame","TASK_TableBox","TASK_TextBlock","TimerFired","UnknownElement","WindowsRuntimeAsyncCallback","WindowsRuntimeEvent"].forEach(t=>{var i=Object(o.b)(t);i=N.a.convertFormatString(i);e[t]=i});return this._session.initializeResources(e)}onToolActivated(){var e=H.b();this._toolbarViewModel.isAtBreakpoint=e;this._view.onToolActivated()}onToolDeactivated(){this._view.onToolDeactivated()}onBreak(){this._toolbarViewModel.isAtBreakpoint=!0}onRun(){this._toolbarViewModel.isAtBreakpoint=!1}}ii.PADDING=34;ii.ETL_RESOURCE_TYPE="DiagnosticsHub.Resource.EtlFile";ii.ETL_SAVE_NAME="Trace";class si{constructor(){this._eventManager=new f.a;this._traceWriter=new C.a}get controller(){return this._visualProfilerController}get hostShell(){return this._hostShell}get packager(){return this._packager}get traceWriter(){return this._traceWriter}get userSettings(){return this._userSettings}addEventListener(e,t){if(e===P.Initialized&&this._visualProfilerController){var i=document.createEvent("Event");i.initEvent(P.Initialized,!1,!1);i.controller=this._visualProfilerController;t(i)}else this._eventManager.addEventListener(e,t)}getHostSpecificString(e,...t){return Object(o.b)(e,t)}main(){window.addEventListener("load",()=>{Object(E.g)().call("ms:host","postPendingMessageToPlugin",[I.c.visualProfiler]);this._visualProfilerController=new ii;var e;this._hostShell=new _.a;try{this._packager=new v.a(m.b.packager)}catch(e){this._packager=null}e=C.b;V();e&&(this._traceWriter=new C.b(e));x.getUserSettings().then(e=>{this._userSettings=e;this.initializeErrorReporting();window.addEventListener("resize",this.triggerResize.bind(this));this._eventManager.dispatchEvent(P.Initialized);window.requestAnimationFrame(()=>{D.markToolReady(I.c.visualProfiler);T.startPreload(I.c.visualProfiler);w.b()&&Object(b.g)(()=>{},{Reliability:{isAlive:()=>Promise.resolve()}})})});Object(p.a)()})}initializeErrorReporting(){window.onerror=((e,t,i)=>{var s,n;arguments&&arguments[3]&&"number"==typeof arguments[3]&&(s=arguments[3]);if(arguments&&arguments[4]&&arguments[4]instanceof Error){n="Error number: "+arguments[4].number;n+="\r\nStack: "+arguments[4].stack}else n="Unhandled Error";this.reportError(new Error(e),n,t,i,s);return!0})}removeEventListener(e,t){this._eventManager.removeEventListener(e,t)}reportError(e,t,i,s,n){if(!this.userSettings||!this.userSettings.disableWER){var a=e.message||e.description,r=i||"Visual Profiler",o=s||0,l=n||0,h="Error description:  "+a;e.number&&(h+="\r\nError number:  "+e.number);i&&(h+="\r\nSource:  "+i);if(e.stack){var d=e.stack;h+="\r\nError stack:  "+d;if(!a){var c=d.indexOf("\n");if(c>0){c=Math.min(c,50);a=d.substring(0,c)}}if(void 0===i){var u=d.match(/(file|res):?([^)]+)\)/);u&&u.length>2&&(r=u[2])}if(void 0===s){(!(u=d.match(/line ?(\d+)/))||u.length<=1)&&(u=d.match(/js:?(\d+):/));u&&u.length>1&&(o=parseInt(u[1]))}}t&&(h+="\r\nAdditional Info:  "+t);S.a(a,r,o,h,l)}}triggerResize(){this._eventManager.dispatchEvent(P.Resize)}}const ni=new si;Object(n.a)();Object(r.a)("VisualProfiler2.Graphs",{StackedBarGraph:g});Object(a.a)().then(async()=>{await Object(s.a)();ni.main()})}});
