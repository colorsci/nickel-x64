!function(e){function t(t){for(var s,n,o=t[0],l=t[1],h=t[2],c=0,p=[];c<o.length;c++){n=o[c];a[n]&&p.push(a[n][0]);a[n]=0}for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);for(;p.length;)p.shift()();r.push.apply(r,h||[]);return i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],s=!0,o=1;o<i.length;o++){var l=i[o];0!==a[l]&&(s=!1)}if(s){r.splice(t--,1);e=n(n.s=i[0])}}return e}var s={},a={11:0},r=[];function n(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};e[t].call(i.exports,i,i.exports,n);i.l=!0;return i.exports}n.m=e;n.c=s;n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})};n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})};n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t;o=o.slice();for(var h=0;h<o.length;h++)t(o[h]);var d=l;r.push([203,4]);i()}({203:function(e,t,i){"use strict";i.r(t);var s=i(70),a=i(131),r=i(84),n=i(34),o=i(13),l=i(0);class h{constructor(e,t){this._collectionStartTime=e;this._frequency=t;this._hundredPicosecondsPerQpcRatio=h.NanosecondsInASecond/this._frequency*10}getCollectionStartTime(){return this._collectionStartTime}getFrequency(){return this._frequency}convertQpcTimestampToNanoseconds(e){var t=Microsoft.VisualStudio.DiagnosticsHub.BigNumber.subtract(e,this._collectionStartTime),i=Microsoft.VisualStudio.DiagnosticsHub.BigNumber.multiplyNumber(t,this._hundredPicosecondsPerQpcRatio);return Microsoft.VisualStudio.DiagnosticsHub.BigNumber.divideNumber(i,10)}}h.NanosecondsInASecond=1e9;class d{constructor(e,t,i,s,a,r,n){this._graphUpdateDelayMilliseconds=100;this._requestHandle=0;this._hasDroppedRequest=!1;this._minValue=Number.MAX_VALUE;this._maxValue=Number.MIN_VALUE;this._sampledPoints=[];this._data=[];this._rawData=[];this._width=250;this._newDataEvent=new Microsoft.VisualStudio.DiagnosticsHub.AggregatedEvent;this._viewport=e;this._title=i;this._formattableTooltipText=s||Object(l.b)("/DiagnosticsHubControlsResources/ChartSeriesFormattableTooltipLabel");this._unitConverter=r;this._color=a;this._drawFill="string"==typeof a.lineFillColor&&""!==a.lineFillColor;this._marker=document.createElement("div");this._marker.classList.add("countersDataSeries-marker");this._marker.style.backgroundColor=this._color.lineColor;this._marker.style.width="5px";this._marker.style.height="5px";this._bufferAllData=t;var d=Object(o.q)(),c=Object(o.p)();this._qpcTime=new h(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(d),c);this._view=n;window.setImmediate(()=>this.requestUpdate)}get minValue(){return this._minValue}get maxValue(){return this._maxValue}get marker(){return this._marker}get title(){return this._title}get newDataEvent(){return this._newDataEvent}dispose(){this._newDataEvent.dispose()}onDataUpdate(e){this.requestUpdate()}onViewportChanged(e){this._viewport=e;this._bufferAllData?this.updatePointSampling(this._viewport):this.requestUpdate()}draw(e,t){if(0!==this._sampledPoints.length){if(t.chartRect.width!==this._width){this._width=t.chartRect.width||1;this._bufferAllData?this.updatePointSampling(this._viewport):this.requestUpdate()}var i=e=>Microsoft.VisualStudio.DiagnosticsHub.Utilities.convertToPixel(e.Timestamp,t.gridX,t.chartRect.width,!1),s=e=>t.chartRect.height-Microsoft.VisualStudio.DiagnosticsHub.Utilities.scaleToRange(e.Value,t.gridY.min,t.gridY.max,0,t.chartRect.height);e.save();e.lineWidth=t.chartRect.height<100?1:2;e.fillStyle=this._color.lineFillColor;e.strokeStyle=this._color.lineColor;var a=0;e.beginPath();e.moveTo(a,s(this._sampledPoints[0]));this._sampledPoints.forEach(t=>e.lineTo(i(t),s(t)));e.stroke();var r=t.chartRect.height-Microsoft.VisualStudio.DiagnosticsHub.Utilities.scaleToRange(0,t.gridY.min,t.gridY.max,0,t.chartRect.height);e.lineTo(i(this._sampledPoints[this._sampledPoints.length-1]),r);e.lineTo(a,r);e.closePath();e.fill();e.restore()}}getPointAtTimestamp(e,t=Microsoft.VisualStudio.DiagnosticsHub.PointToFind.Nearest){if(0===this._sampledPoints.length)return null;var i={Timestamp:e,Value:0},s=(e,t)=>t.Timestamp.greater(e.Timestamp);switch(t){case Microsoft.VisualStudio.DiagnosticsHub.PointToFind.LessThanOrEqual:var a=Microsoft.VisualStudio.DiagnosticsHub.Utilities.findLessThan(this._sampledPoints,i,s);i=this._sampledPoints[a];break;case Microsoft.VisualStudio.DiagnosticsHub.PointToFind.GreaterThanOrEqual:a=Microsoft.VisualStudio.DiagnosticsHub.Utilities.findGreaterThan(this._sampledPoints,i,s);i=this._sampledPoints[a];break;case Microsoft.VisualStudio.DiagnosticsHub.PointToFind.Nearest:var r=Microsoft.VisualStudio.DiagnosticsHub.Utilities.findLessThan(this._sampledPoints,i,s),n=this._sampledPoints[r];if(r===this._sampledPoints.length-1||this._sampledPoints[0].Timestamp.greater(e)){i.Value=n.Value;i.Timestamp=n.Timestamp}else{var o=this._sampledPoints[Math.min(r+1,this._sampledPoints.length-1)];i.Value=Microsoft.VisualStudio.DiagnosticsHub.Utilities.linearInterpolate(e,n.Timestamp,n.Value,o.Timestamp,o.Value)}}return{timestamp:i.Timestamp,tooltip:Microsoft.VisualStudio.DiagnosticsHub.Utilities.formatString(this._formattableTooltipText,this._unitConverter.formatNumber(i.Value)),color:this._color,value:i.Value}}requestUpdate(){this._requestHandle?this._hasDroppedRequest=!0:this._requestHandle=window.setTimeout(()=>{this._view.model.graphCollectorSession&&this._view.model.graphCollectorSession.getGraphDataUpdate("Heap").then(e=>{if(e&&0!==e.length){e.forEach(e=>{this._rawData.push({Timestamp:this._qpcTime.convertQpcTimestampToNanoseconds(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e.timestamp)),Value:e.value,ToolTip:e.toolTip,CustomData:e.customData})});this.cachePoints(this._rawData)}}).then(()=>this._view.model.graphCollectorSession.getGraphDataUpdate("performancemark")).then(e=>{e.forEach(e=>{this._view.addRulerMark(this._qpcTime.convertQpcTimestampToNanoseconds(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e.timestamp)),e.toolTip)})}).then(()=>{this._newDataEvent.invokeEvent(this);this._requestHandle=0;if(this._hasDroppedRequest){window.setImmediate(()=>this.requestUpdate);this._hasDroppedRequest=!1}})},this._graphUpdateDelayMilliseconds)}cachePoints(e){this._data=[];this._maxValue=Number.MIN_VALUE;this._minValue=Number.MAX_VALUE;if(e&&0!==e.length){var t=e[0];this._data=e.filter(e=>{if(!e.Timestamp||!e.Timestamp.greaterOrEqual(t.Timestamp))return!1;this._maxValue=Math.max(this._maxValue,e.Value);this._minValue=Math.min(this._minValue,e.Value);t=e;return!0});this._bufferAllData?this.updatePointSampling(this._viewport):this._sampledPoints=this._data}}updatePointSampling(e){if(0!==this._data.length){this._sampledPoints=[];var t=new Microsoft.VisualStudio.DiagnosticsHub.JsonTimespan(this._data[0].Timestamp,this._data[this._data.length-1].Timestamp),i=Microsoft.VisualStudio.DiagnosticsHub.BigNumber.divideNumber(e.elapsed,this._width),s=(e,t)=>t.Timestamp.greater(e.Timestamp),a={Timestamp:Microsoft.VisualStudio.DiagnosticsHub.BigNumber.zero,Value:0},r=Math.floor(parseInt(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.subtract(e.begin,t.begin).value)/parseInt(i.value)),n=Microsoft.VisualStudio.DiagnosticsHub.BigNumber.add(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.multiplyNumber(i,r),t.begin),o=Microsoft.VisualStudio.DiagnosticsHub.BigNumber.add(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.add(n,e.elapsed),i);a.Timestamp=n;var l=Microsoft.VisualStudio.DiagnosticsHub.Utilities.findLessThan(this._data,a,s);a.Timestamp=o;var h=Microsoft.VisualStudio.DiagnosticsHub.Utilities.findGreaterThan(this._data,a,s),d=(e,t)=>{for(var i=this._data[e],s=0,a=e;a<=t;++a)s=Math.max(s,this._data[a].Value);return{Timestamp:i.Timestamp,ToolTip:i.ToolTip,Value:s}},c=(e,t,r,n)=>{if(n>=r-t)for(var o=t;o<=r;++o)this._sampledPoints.push(d(o,o));else if(1===n)this._sampledPoints.push(d(t,r));else{var l=Math.floor(n/2),h=n-l,p=Microsoft.VisualStudio.DiagnosticsHub.BigNumber.add(e,Microsoft.VisualStudio.DiagnosticsHub.BigNumber.multiplyNumber(i,l));a.Timestamp=p;var u=Microsoft.VisualStudio.DiagnosticsHub.Utilities.findLessThan(this._data,a,s,t,r);c(e,t,u,l);c(p,u,r,h)}};c(n,l,h,this._width)}}}function c(e,t,i,s,a,r){var n=new Microsoft.VisualStudio.DiagnosticsHub.SwimlaneConfiguration(e,a,s);n.header.isBodyExpanded=t;var o=new Microsoft.VisualStudio.DiagnosticsHub.LocalizedUnitConverter(n.graph.jsonConfig.Units,n.graph.resources),h=[],c=new d(a,!0,e.Title,null,new Microsoft.VisualStudio.DiagnosticsHub.ChartColorScheme("#76AEC8","#A6CADB"),o,e.View);h.push(c);n.graph.legend.push({legendText:Object(l.b)("HubGraphHeapLegend"),legendTooltip:Object(l.b)("GraphTitle")+", "+Object(l.b)("HubGraphHeapLegend"),marker:c.marker});var p=new Microsoft.VisualStudio.DiagnosticsHub.MultiSeriesGraph(n.graph,h),u=new Microsoft.VisualStudio.DiagnosticsHub.Scale(n.graph.scale,Microsoft.VisualStudio.DiagnosticsHub.ScaleType.Left,o),m=new Microsoft.VisualStudio.DiagnosticsHub.Scale(n.graph.scale,Microsoft.VisualStudio.DiagnosticsHub.ScaleType.Right,o);p.scaleChangedEvent.addEventListener(u.onScaleChanged.bind(u));p.scaleChangedEvent.addEventListener(m.onScaleChanged.bind(m));var g=new Microsoft.VisualStudio.DiagnosticsHub.SwimlaneBase(n.header,n.graph.height,a,r);p.scaleChangedEvent.addEventListener(g.onScaleChanged.bind(g));g.addTitleControl(new Microsoft.VisualStudio.DiagnosticsHub.Legend(n.graph.legend));g.addMainRegionControl(p);g.addMainRegionControl(new Microsoft.VisualStudio.DiagnosticsHub.GridLineRenderer(a));g.addLeftRegionControl(u);g.addRightRegionControl(m);p.container.style.zIndex="130";return g}class p{static initialize(){p.MemoryUsageSwimlaneFactory=c}}p.initialize();function u(){Object(r.a)();Object(n.a)("MemoryAnalyzer",{MemoryUsageSwimlaneFactory:p.MemoryUsageSwimlaneFactory})}var m=i(5),g=i(61),_=i(55),f=i(164),S=i(76),b=i(98),C=i(68),v=i(10),w=i(140),y=i(6),D=i(54);class I{constructor(e){this._heapObjectCache={};this._proxy=e;if(!this._proxy)throw new Error(Object(l.a)("JSPerf.1066"))}getChildrenForObject(e,t=0,i=-1,s=2,a,r){r=this.getFilter(r);var n=this._proxy.getChildrenForObject(e,t,i,s,a,r);this.performObjectCaching(n);return n}getDominators(e=0,t=-1,i="",s=2,a){var r;return new D.a((n,o)=>{r=this._proxy.getDominators(e,t,i,s,a,e=>{this.performObjectCaching(e);n(e)},e=>{o&&o(T.GetErrorFromHr(e))})},()=>{if(void 0!==r){this._proxy.cancelRequest(r);return!0}return!1})}getObjectsByType(e,t=0,i=-1,s=2,a){a=this.getFilter(a);var r=this._proxy.getObjectsByType(e,t,i,s,a);this.performObjectCaching(r);return r}getPathToDominator(e,t=2,i){i=this.getFilter(i);return this._proxy.getPathToDominator(e,t,i)}getPathToRoot(e,t=0,i){i=this.getFilter(i);return this._proxy.getPathToRoot(e,t,i)}getRootObjects(e,t){t=this.getFilter(t);var i=this._proxy.getRootObjects(e,t);this.performObjectCaching(i);return i}getTypes(e="",t=2,i){i=this.getFilter(i);var s;return new D.a((a,r)=>{s=this._proxy.getTypes(e,t,i,e=>{a(e)},e=>{r&&r(T.GetErrorFromHr(e))})},()=>{if(void 0!==s){this._proxy.cancelRequest(s);return!0}return!1})}getRetainedDescendants(e,t=0,i=-1,s=2,a){a=this.getFilter(a);var r=this._proxy.getRetainedDescendants(e,t,i,s,a);this.performObjectCaching(r);return r}getReferenceTreeItems(e,t,i,s){var a=this._proxy.getReferenceTreeItems(e,t,i||0,s);this.performObjectCaching(a);return a}hasDetachedDomNodes(){return this._proxy.hasDetachedDomNodes()}getSnapshotDiffStats(){return this._proxy.getSnapshotDiffStats()}getUidChain(e){return this._proxy.getUidChain(e)}getObject(e){return this._heapObjectCache[e]}getFilter(e){var t={};e=e||{};t.foldObjectsByDominator=e.foldObjectsByDominator||!1;t.showNonMatchingReferences=e.showNonMatchingReferences||!1;t.showBuiltIns=e.showBuiltIns||!1;t.showUnknownSizes=e.showUnknownSizes||!1;t.showUnknownTypes=e.showUnknownTypes||!1;return t}performObjectCaching(e){var t=e.result;if(t&&t.length>0)for(var i=0;i<t.length;i++){var s=t[i];if(void 0!==s.object){var a=s.object;this._heapObjectCache[a.objectId]=a}}}}class T{constructor(e){this._proxy=e;if(!this._proxy)throw new Error(Object(l.a)("JSPerf.1065"))}static GetErrorFromHr(e){e<0&&(e=4294967295+e+1);switch(e){case 2147942414:case 2306408456:return new Error(Object(l.b)("ERRoutOfMemory"));case 2306408449:return new Error(Object(l.b)("ERRbadHexDigit"));case 2306408450:return new Error(Object(l.b)("ERRbadNumber"));case 2306408451:return new Error(Object(l.b)("ERRillegalChar"));case 2306408453:return new Error(Object(l.b)("ERRnoColon"));case 2306408454:return new Error(Object(l.b)("ERRnoRbrack"));case 2306408455:return new Error(Object(l.b)("ERRnoRcurly"));case 2306408457:return new Error(Object(l.b)("ERRnoStrEnd"));case 2306408458:return new Error(Object(l.b)("ERRsyntax"));case 2306408460:return new Error(Object(l.b)("ERRmissingObjectId"));case 2306408461:return new Error(Object(l.b)("ERRinvalidObjectID"))}return new Error(Object(l.b)("ERRunknownError","0x"+e.toString(16).toUpperCase()))}processSnapshotSummary(e,t="",i=!0){return new Promise((s,a)=>{this._proxy.processSnapshotSummary(e,t,e=>{s(e)},e=>{a&&a(T.GetErrorFromHr(e))},()=>i)})}processSnapshot(e){return new Promise((t,i,s)=>{this._proxy.processSnapshot(e,e=>{t(new I(e))},e=>{i&&i(T.GetErrorFromHr(e))},e=>{s&&s(e)})})}processSnapshotDiff(e){return new Promise((t,i,s)=>{this._proxy.processSnapshotDiff(e,e=>{t(new I(e))},e=>{i&&i(T.GetErrorFromHr(e))},e=>{s&&s(e)})})}addSnapshotStreamPart(e){this._proxy.addSnapshotStreamPart(e)}}class x{isEnabled(){return Promise.resolve(!1)}sendData(e,t,i,s,a,r){return Promise.resolve(null)}}var P=i(74);i(90);class O{constructor(){this._snapshotId=1}getNewSnapshotRelativePath(){return"snapshot"+this._snapshotId+++".snapjs"}}class E extends O{constructor(e,t=!1){super();this._sessionInfo={filePaths:[],isOffline:t,sessionType:0,sortProperty:"",storageId:e||E.getUniqueStorageId(),targetView:""}}addViewTypeEventListener(e){}getSessionInfo(){return Promise.resolve(this._sessionInfo)}openSnapshotDetails(e,t,i,s){return new Promise((i,a)=>{i({filePaths:[e],isOffline:!0,sessionType:1,sortProperty:s,storageId:this._sessionInfo.storageId,targetView:t})})}openSnapshotDiff(e,t,i,s,a,r){return new Promise((i,n)=>{i({filePaths:e,isOffline:!0,sessionType:2,sortProperty:r,storageId:this._sessionInfo.storageId,targetView:t,firstSnapshotId:s,lastSnapshotId:a})})}save(e){return new Promise((e,t)=>{var i=(m.b.isWinRTHost?P.b.F12_TEMP_DATA_ROOT_PATH_UWP:P.b.F12_TEMP_DATA_ROOT_PATH)+this._sessionInfo.storageId;try{var s,a=Et.packager.createPackage(P.a.MEMORY_ANALYZER_TOOL_GUID),r=this._sessionInfo.storageId.split("\\");s=r.length>1?r[r.length-1]:this._sessionInfo.storageId;Et.packager.addResource(P.a.MEMORY_ANALYZER_SNAPSHOT_RESOURCE_TYPE,i,s);Et.packager.commit();e(a)}catch(e){t&&t(e)}})}static getUniqueStorageId(){return Math.floor(2821109907455*Math.random()).toString(36)+"."+Math.floor(46655*Math.random()).toString(36)}}var M=i(81);class k{getUserSettings(){return new Promise(e=>{Object(M.b)().getSettings("JavaScriptPerfTools").then(t=>{e(t)})})}}var N=i(2),R=i(4),j=i(37),V=i(85),A=i(132),L=i(58),F=i(45),H=i(163),z=i(9),G=i(56),B=i(51),U=i(14),W=i(65),K=i(42),q=i(43),Y=i(152);class J{static getNextId(){return J.idCounter++}static reset(){J.frameMap=[];J.currentNavigationId=-1}static setToolbar(e){J.toolbarFrame=F.a.makeNavigationFrameFromCallback(document.body,()=>e.getActiveElement());J.registerNavigation()}static switchNavigationView(e){J.currentNavigationId=e;J.registerNavigation()}static updateAdditionalNavigationFrames(e,t=[]){J.frameMap[e]=t;e===J.currentNavigationId&&J.registerNavigation()}static registerNavigation(){var e,t=[];J.toolbarFrame&&(t=[J.toolbarFrame]);J.currentNavigationId>=0&&(e=J.frameMap[J.currentNavigationId])&&(t=t.concat(e));F.a.registerNavigationFrames(t)}}J.currentNavigationId=-1;J.frameMap=[];J.idCounter=0;var Q=i(47);class X extends L.a{constructor(){super();this._items=[];this.setTemplateFromHTML('<div class="tabControl">   <div class="tabHeader">       <div id="beforeBarContainer" class="beforeBarContainer"></div>       <nav id="tabBarContainer" class="tabBarContainer">        <ul class="tabBar"></ul>       </nav>       <div id="afterBarContainer" class="afterBarContainer"></div>   </div>   <div class="tabContentPane"></div></div>');this._barPanel=new Q.a(this.rootElement.getElementsByClassName("tabBar")[0]);this._barPanel.rootElement.setAttribute("role","tabList");this._barPanel.rootElement.onkeydown=this.onKeyDown.bind(this);this._contentPane=new Q.a(this.rootElement.getElementsByClassName("tabContentPane")[0]);this.beforeBarContainer=new Q.a(this.rootElement.getElementsByClassName("beforeBarContainer")[0]);this.afterBarContainer=this.rootElement.getElementsByClassName("afterBarContainer")[0];this._tabBarContainer=this.findElement("tabBarContainer")}get tabsLeftAligned(){return this._tabBarContainer.classList.contains("tabBarContainerLeftAlign")}set tabsLeftAligned(e){e?this._tabBarContainer.classList.add("tabBarContainerLeftAlign"):this._tabBarContainer.classList.remove("tabBarContainerLeftAlign")}get selectedItem(){return this._selectedItem}set selectedItem(e){if(this._selectedItem!==e){if(!this.containsTab(e))return;var t=this._selectedItem;this._selectedItem&&(this._selectedItem.active=!1);this._selectedItem=e;this._selectedItem&&(this._selectedItem.active=!0);this.selectedItemChanged&&this.selectedItemChanged(t,this._selectedItem)}}addTab(e){this._items.push(e);e.ownerTabControl=this;this._barPanel.appendChild(e.header);this._contentPane.appendChild(e);this._selectedItem||(this.selectedItem=e)}removeTab(e){var t=this._items.indexOf(e);if(!(t<0)){this.selectedItem===e&&(this.selectedItem=null);this._items.splice(t,1);var i=Math.min(this._items.length-1,t);i>=0&&(this.selectedItem=this._items[i]);this._barPanel.removeChild(e.header);this._contentPane.removeChild(e);e.ownerTabControl=null}}containsTab(e){return this._items.indexOf(e)>=0}getTabIndex(e){return this._items.indexOf(e)}getTab(e){return this._items[e]}length(){return this._items.length}onTabItemSelected(e){this.selectedItem=e}onKeyDown(e){var t=this.getTabIndex(this._selectedItem);t>=0?39===e.keyCode||40===e.keyCode?this.selectedItem=this.getTab((t+1)%this.length()):37!==e.keyCode&&38!==e.keyCode||(this.selectedItem=this.getTab(t-1<0?this.length()-1:t-1)):this.selectedItem=this.getTab(0);this._selectedItem.header.rootElement.focus()}}var Z=i(94),$=i(27),ee=i(59),te=i(170),ie=i(130),se=i(60),ae=new ie.a;class re{}re.SNAPSHOT_END="SnapshotEnd";class ne{}ne.START_PROFILE="StartProfile";ne.STOP_PROFILE="StopProfile";ne.IMPORT_SESSION="ImportSession";ne.EXPORT_SESSION="ExportSession";ne.TAKE_SNAPSHOT="TakeSnapShot";ne.TAKE_SNAPSHOT_TILE="TakeSnapShotTile";ne.CLICK_SUMMARY="ClickSummary";ne.CLICK_SHOT="ClickSnapShot";ne.CLICK_SHOT_DIFF="ClickSnapShotDiff";ne.TYPE_VIEW="TypeView";ne.ROOT_VIEW="RootView";ne.DOMINATOR_VIEW="DominatorView";ne.IDENTIFIER_FILTER="IdentifierFilter";ne.SHOW_BUILT_INS="ShowBuiltIns";ne.DISPLAY_OBJECT_IDS="DisplayObjectIds";ne.FOLD_BY_DOMINATOR="FoldByDominator";ne.SCOPE_FILTER="ScopeFilter";class oe{}oe.SUMMARY="SUMMARY";oe.SNAPSHOT="SNAPSHOT";oe.TYPES="Types";oe.ROOTS="Roots";oe.DOMINATORS="Dominators";function le(){ae=new se.a("Memory")}class he extends te.a{constructor(){super();this.header=new Q.a(document.createElement("li"));this.header.rootElement.onclick=this.onHeaderClicked.bind(this);this.header.rootElement.setAttribute("role","tab");this.header.rootElement.addEventListener("keydown",this.onKeyDown.bind(this));this.rootElement.className="tabItemContent"}get ownerTabControl(){return this._ownerTabControl}set ownerTabControl(e){if(this._ownerTabControl!==e){if(this._ownerTabControl&&e)throw new Error(Object(l.a)("JSPerf.1022"));this._ownerTabControl=e}}get active(){return this._active}set active(e){if(this._active!==e){this._active=e;this.header.rootElement.classList.toggle("active");e?this.header.rootElement.setAttribute("tabIndex","2"):this.header.rootElement.removeAttribute("tabIndex");this.header.rootElement.setAttribute("aria-selected",String(this._active));this.rootElement.classList.toggle("active");this.onActiveChanged()}}get title(){return this.header.rootElement.innerText}set title(e){this.header.rootElement.innerText=e}get tooltipString(){return this.header.rootElement.getAttribute("data-plugin-vs-tooltip")}set tooltipString(e){var t={content:e};this.header.rootElement.setAttribute("data-plugin-vs-tooltip",JSON.stringify(t))}onActiveChanged(){}onHeaderClicked(){if(this.ownerTabControl){switch(this.title){case oe.SUMMARY:ae.logExecuteCommand(ne.CLICK_SUMMARY,N.c.Ui);break;case oe.TYPES:ae.logExecuteCommand(ne.TYPE_VIEW,N.c.Ui);break;case oe.ROOTS:ae.logExecuteCommand(ne.ROOT_VIEW,N.c.Ui);break;case oe.DOMINATORS:ae.logExecuteCommand(ne.DOMINATOR_VIEW,N.c.Ui);break;default:0===this.title.indexOf(oe.SNAPSHOT)&&(0===this.title.lastIndexOf(oe.SNAPSHOT)?ae.logExecuteCommand(ne.CLICK_SHOT,N.c.Ui):ae.logExecuteCommand(ne.CLICK_SHOT_DIFF,N.c.Ui))}this.ownerTabControl.selectedItem=this}Et.onIdle()}onKeyDown(e){13!==e.keyCode&&32!==e.keyCode||this.onHeaderClicked()}}class de{}de.DetailsViewRowSelected="MemoryNotifications.DetailsViewRowSelected";de.Idle="MemoryNotifications.Idle";de.OnSnapshotProcessingCompleted="MemoryNotifications.OnSnapshotProcessingCompleted";de.SessionEnd="MemoryNotifications.SessionEnd";de.SessionLoadCompleted="MemoryNotifications.SessionLoadCompleted";de.SessionSaveCompleted="MemoryNotifications.SessionSaveCompleted";de.SnapshotDataViewReady="MemoryNotifications.SnapshotDataViewReady";de.WindowClose="MemoryNotifications.WindowClose";class ce extends he{constructor(e){super();this._summaryViewController=e;this.title=Object(l.b)("Summary").toLocaleUpperCase();this.tooltipString=Object(l.b)("SummaryTabTooltip");this.content=e.view}onActiveChanged(){this.active&&J.switchNavigationView(this._summaryViewController.navigationId)}}var pe,ue,me,ge,_e,fe,Se=i(8),be=i(92);class Ce{static format(e){if(Et.userSettings.showDetailedErrors){var t="Error description:  "+(e.message||e.description);e.number&&(t+="\r\nError number:  "+e.number);e.stack&&(t+="\r\nError stack:  "+e.stack);return t}return e.message||e.description}}!function(e){e[e.types=0]="types";e[e.roots=1]="roots";e[e.dominators=2]="dominators"}(pe||(pe={}));!function(e){e[e.ascending=0]="ascending";e[e.descending=1]="descending"}(ue||(ue={}));!function(e){e[e.Background=0]="Background";e[e.Foreground=1]="Foreground";e[e.Grid=2]="Grid";e[e.LegendBackground=3]="LegendBackground";e[e.ViewSelection=4]="ViewSelection";e[e.ViewSelectionOutside=5]="ViewSelectionOutside"}(me||(me={}));!function(e){e[e.Foreground=0]="Foreground"}(ge||(ge={}));!function(e){e[e.Error=-1]="Error";e[e.StreamLength=-2]="StreamLength"}(_e||(_e={}));!function(e){e[e.Empty=0]="Empty";e[e.Loading=1]="Loading";e[e.Done=2]="Done"}(fe||(fe={}));class ve{constructor(e,t){this.storageId=e;this.relativePath=t}}class we{constructor(e,t,i,s){this.detachedDomNodeCount=e.detachedDomNodeCount;this.id=s;this.objectsCount=e.objectsCount;this.processPrivateBytes=e.privateBytes.toString();this.pointerSize=e.pointerSize;this.screenshotData=e.base64Image;this.snapshotFile=t;this.statsAddedObjects=e.statsAddedObjects;this.statsDeletedObjects=e.statsDeletedObjects;this.taken=i;this.totalObjectSize=e.totalObjectSize}static get fileExtension(){return".snapshotsummary"}static async load(e,t){const i=await Object(q.a)().openFileAsHostFile(e+"\\"+t,{access:U.a.read,encoding:"UTF-8",persistence:U.d.temporary,type:U.f.text}),s=await i.read(),a=JSON.parse(s);a.snapshotFile.storageId=e;await i.close();return a}async save(){const e=this.snapshotFile.relativePath+we.fileExtension,t=await Object(q.a)().createFile(this.snapshotFile.storageId+"\\"+e,{access:U.a.write,encoding:"UTF-8",persistence:U.d.temporary,type:U.f.text});await t.writeAllText(JSON.stringify(this));await t.close()}}var ye=i(23),De=i(11);class Ie{constructor(e,t){this._summary=e;this._snapshotSummaryCollection=t}get summaryData(){return this._summary}get snapshotSummaryCollection(){return this._snapshotSummaryCollection}get timeTaken(){return"("+new Date(this._summary.taken).toLocaleTimeString()+")"}get detachedDomNodeCount(){return this._summary.detachedDomNodeCount}get processPrivateBytes(){return ye.a.getPrettyPrintSize(parseInt(this.summaryData.processPrivateBytes))}get totalObjectSize(){return ye.a.getPrettyPrintSize(this.summaryData.totalObjectSize)}get objectsCount(){return this.summaryData.objectsCount}getComparableSnapshots(){for(var e=[],t=(this._summary.taken,0);t<this._snapshotSummaryCollection.length;t++){var i=this._snapshotSummaryCollection.getItem(t);i.id!==this._summary.id&&e.push(i)}return e=e.sort(function(e,t){return e.id-t.id})}}class Te extends L.a{constructor(e,t){super("SnapshotTileTemplate");this._controller=e;this._model=t;this._tileContextMenuItems=[];this._snapshotTile=this.findElement("snapshotTile");this._comparableSnapshots=this._model.getComparableSnapshots();this._tileHeader=this.findElement("snapshotTileHeader");let i=Object(l.b)("SnapshotNumber",this._model.summaryData.id);this.findElement("snapshotTileTitle").innerText=i;this._tileHeader.setAttribute("aria-label",i.concat(this._model.timeTaken));var s=this.findElement("snapshotTileImage");if(this._model.summaryData.screenshotData){s.src="data:image/jpeg;base64,"+this._model.summaryData.screenshotData.replace(/\r\n/g,"");s.alt=Object(l.b)("Screenshot")}else s.style.display="none";var a=ye.a.getDecimalLocaleString(this._model.objectsCount,!0);this.findElement("snapshotTakenDate").innerText=this._model.timeTaken;this.findElement("heapSizeLink").innerText=this._model.totalObjectSize;this.findElement("objectsCountLink").innerText=Object(l.b)("ObjectsCount",a);this.findElement("heapSizeLink").setAttribute("data-plugin-vs-tooltip",Object(l.b)("HeapSizeLinkTooltip"));this.findElement("objectsCountLink").setAttribute("data-plugin-vs-tooltip",Object(l.b)("ObjectsCountLinkTooltip"));this.setupSizeDiff(this.findElement("heapDiffLink"),this.findElement("heapDiffIndicatorIcon"));this.setupCountDiff(this.findElement("objectsDiffLink"),this.findElement("objectDiffIndicatorIcon"));this.findElement("heapSizeLink").onclick=this.onSizeClick.bind(this);this.findElement("objectsCountLink").onclick=this.onObjectCountClick.bind(this);this.findElement("heapDiffLink").onclick=this.onDiffClick.bind(this);this.findElement("objectsDiffLink").onclick=this.onObjectDiffClick.bind(this);if(t.detachedDomNodeCount>0){var r=this.findElement("snapshotTileDetachedDomNodeCount");r.innerText=t.detachedDomNodeCount.toString();r.setAttribute("data-plugin-vs-tooltip",Object(l.b)("PotentialIssuesTooltip",t.detachedDomNodeCount));r.setAttribute("aria-label",Object(l.b)("PotentialIssuesTooltip",t.detachedDomNodeCount));r.onclick=this.onDetachedDomNodesClick.bind(this);this.findElement("snapshotTileDetachedDomNodeInfo").style.visibility="visible"}for(var n=this.findElementsByClassName("BPT-FileLink"),o=0;o<n.length;o++){(e=>{e.onkeydown=(t=>{13!==t.keyCode&&32!==t.keyCode||t.ctrlKey||t.altKey||t.shiftKey||e.click()})})(n[o])}this.populateContextMenu();this._model.snapshotSummaryCollection.collectionChanged.addHandler(this.onCollectionChanged.bind(this))}get navigationElement(){return this._tileHeader}setFocus(){this._tileHeader.focus()}onCollectionChanged(e){if(0===e.action){var t=e.newItems[0];if(this._model.summaryData.id!==t.id){var i={callback:this.diffTo.bind(this,t.id),label:Object(l.b)("SnapshotNumber",t.id),type:De.MenuItemType.command};this._tileContextMenuItems.push(i)}this.createContextMenu()}}createContextMenu(){this._tileContextMenu&&this._tileContextMenu.detach(this._snapshotTile);var e={callback:this.onSizeClick.bind(this),label:Object(l.b)("ViewSnapshotDetails"),type:De.MenuItemType.command},t={callback:()=>{},disabled:()=>this.isFirstSnapshot(),label:Object(l.b)("CompareToEllipsis"),type:De.MenuItemType.command};this.isFirstSnapshot()||(t.submenu=this._tileContextMenuItems);this._tileContextMenu=De.create([e,t]);this._tileContextMenu.attach(this._snapshotTile)}isFirstSnapshot(){return 0===this._tileContextMenuItems.length}populateContextMenu(){this._comparableSnapshots=this._model.getComparableSnapshots();for(var e=0;e<this._comparableSnapshots.length;e++){var t=this._comparableSnapshots[e],i={callback:this.diffTo.bind(this,t.id),label:Object(l.b)("SnapshotNumber",t.id),type:De.MenuItemType.command};this._tileContextMenuItems.push(i)}this.createContextMenu()}setupSizeDiff(e,t){var i=this._comparableSnapshots[this._model.summaryData.id-2];if(i){var s=this._model.summaryData.totalObjectSize-i.totalObjectSize;s>0?t.classList.add("heapIncreaseIcon"):s<0&&t.classList.add("heapDecreaseIcon");e.innerText=0===s?Object(l.b)("NoDiff"):(s>0?"+":"-")+ye.a.getPrettyPrintSize(Math.abs(s));e.setAttribute("data-plugin-vs-tooltip",Object(l.b)("HeapSizeDiffLinkTooltip"))}else{e.classList.remove("BPT-FileLink");e.classList.add("baselineText");e.innerText=Object(l.b)("Baseline");e.tabIndex=-1}}setupCountDiff(e,t){if(this._comparableSnapshots.length>=1){var i=this._model.summaryData.statsAddedObjects,s=this._model.summaryData.statsDeletedObjects,a=i-s;a>0?t.classList.add("heapIncreaseIcon"):a<0&&t.classList.add("heapDecreaseIcon");if(0===i&&0===s)e.innerText=Object(l.b)("NoDiff");else{var r;r="+"+ye.a.getDecimalLocaleString(i,!0)+" / -"+ye.a.getDecimalLocaleString(s,!0);e.innerText=r}e.setAttribute("data-plugin-vs-tooltip",Object(l.b)("ObjectsCountDiffLinkTooltip"))}else{e.classList.remove("BPT-FileLink");e.classList.add("baselineText");e.innerText=Object(l.b)("Baseline");e.tabIndex=-1}}onDetachedDomNodesClick(e){this._controller.viewSnapshot(this._model.summaryData.id,"Types","containsDetachedDomNode")}onSizeClick(e){this._controller.viewSnapshot(this._model.summaryData.id,"Types","retainedSize")}onObjectCountClick(e){this._controller.viewSnapshot(this._model.summaryData.id,"Types","childrenCount")}diffTo(e){this._controller.compareSnapshots(this._model.summaryData.id,e,"Types","retainedSize")}onDiffClick(e){var t=this._comparableSnapshots[this._model.summaryData.id-2];t&&this._controller.compareSnapshots(this._model.summaryData.id,t.id,"Types","retainedSizeDiff")}onObjectDiffClick(e,t){var i=this._comparableSnapshots[this._model.summaryData.id-2];i&&this._controller.compareSnapshots(this._model.summaryData.id,i.id,"Types","childrenCount")}}class xe{constructor(e,t,i){this._screenshotHeight=150;this._screenshotKeepAspectRatio=!0;this._screenshotWidth=200;this._snapshotStart=0;this._parts={};this._currentPartId=0;this._streamingStarted=!1;this._processedPartCount=0;this._memoryAnalyzer=e;this._storageId=t;this._navigationId=J.getNextId();this.model=new Pe(i);this.view=new Oe(this,this.model);Microsoft.VisualStudio.DiagnosticsHub.RegisterNamespace.registerFunction("MemoryAnalyzer.MemoryUsageSwimlaneFactory")}get navigationId(){return this._navigationId}giveFeedback(){Et.internalFeedback.isEnabled().then(e=>{e&&Et.shell.save(!1).then(e=>{Et.internalFeedback.sendData(!0,"","","","",e)})})}async loadExistingSnapshots(){const e=".snapjs"+we.fileExtension,t=[];let i=0;try{let s=await Object(q.a)().getFileList(this._storageId,U.d.temporary);s=s.filter(function(t){return t.slice(-e.length)===e});for(let e=0;e<s.length;e++){let a=await we.load(this._storageId,s[e]);t.push(a);if(++i===s.length){t.sort(function(e,t){return e.id-t.id});for(let e=0;e<t.length;e++)this.model.snapshotSummaryCollection.push(t[e])}}Et.onIdle()}catch(e){this.onSnapshotFailed(e)}}save(){return this.model.snapshotSummaryCollection.length>0?Et.shell.save(!0):Promise.resolve(null)}startGraphCollectorSession(){if(Et.shell.isGraphCollectionSupported&&!this._graphCollectorSession){this.model.isStarting=!0;Et.shell.startGraphCollection().then(e=>{this._graphCollectorSession=e;this.model.graphCollectorSession=e;this.view.startGraph();this.model.isStarting=!1;this.model.isOffline=!1},e=>{this.model.isStarting=!1;const t=["StartSessionFailedMessage",""],i=l.b.apply(this,t);xe.errorDisplay.show(i,0,xe._startSessionFailedFwdLink);Et.reportError(e,Object(l.a)("JSPerf.1064"))})}}stopGraphCollectorSession(){if(this._graphCollectorSession){this.model.isStopping=!0;this.view.stopGraph();(this.model.isAttached?this._graphCollectorSession.stop():Promise.resolve(null)).then(()=>{this._graphCollectorSession=null;0===this.model.snapshotSummaryCollection.length&&this.view.removeExistingGraph();this.model.isStopping=!1;this.model.isOffline=!0},e=>{this.model.isStopping=!1})}}async onSnapshotDataReceived(e,t){switch(t){case _e.Error:var i;i=e?new Error(e):new Error(Object(l.b)("ERRoutOfMemory"));await this._filePath.file.close();this.onSnapshotFailed(i);break;case _e.StreamLength:this._expectedPartCount=e;break;default:this._parts[t]=e;for(;void 0!==this._parts[this._currentPartId];){var s=this._parts[this._currentPartId];if(!this._streamingStarted){var a;if(this.model.snapshotSummaryCollection.length>0){var r=this.model.snapshotSummaryCollection.getItem(this.model.snapshotSummaryCollection.length-1);r&&(a=r.snapshotFile.relativePath)}this.onSnapshotResult(this._filePath.relativePath,a);this._streamingStarted=!0}Et.memoryAnalyzerData.addSnapshotStreamPart(e);delete this._parts[this._currentPartId];++this._currentPartId;await Object(q.a)().write(this._filePath.file.streamId,s,s.length,U.f.text);this._processedPartCount++;await this.checkCompleted()}}await this.checkCompleted()}async takeSnapshot(){if(this.model.isTakeSnapshotEnabled){this._snapshotStart=Date.now();this.model.isTakingSnapshot=!0;ae.logPerformance({id:z.a.Memory_TakeSnapshot_Start});try{const e=await Et.shell.createSnapshot();this._filePath=e;let t=[xe._snapshotChunkSize,this._screenshotWidth,this._screenshotHeight,this._screenshotKeepAspectRatio];this._memoryAnalyzer.methodCall("takeSnapshot",t)}catch(e){this.onSnapshotFailed(e)}}}cancelPendingSnapshots(){if(this._snapshotSummaryPromise){this._snapshotSummaryPromise.cancel();this._snapshotSummaryPromise=null}}viewSnapshot(e,t,i){return new Promise(s=>{var a=this.getSnapshotSummary(e);if(a){ae.logPerformance({id:z.a.Memory_ViewSnapshot_Start,key:e});return this._memoryAnalyzer.showSnapshotTab(a.snapshotFile.relativePath,t,Object(l.b)("SnapshotNumber",a.id),i).then(()=>{ae.logPerformance({id:z.a.Memory_ViewSnapshot_Stop,key:e});s(Object(l.b)("SnapshotNumber",a.id).toLocaleUpperCase())})}s("")})}compareSnapshots(e,t,i,s){var a=1e6*e+t;ae.logPerformance({id:z.a.Memory_CompareSnapshot_Start,key:a});if(e<t){var r=e;e=t;t=r}var n=[],o=this.getSnapshotSummary(e),h=this.getSnapshotSummary(t);if(o&&h){for(var d=0;d<this.model.snapshotSummaryCollection.length;d++){var c=this.model.snapshotSummaryCollection.getItem(d);c.taken>=h.taken&&c.taken<=o.taken&&n.push(c)}n=n.sort(function(e,t){return e.taken-t.taken})}var p=[];for(d=0;d<n.length;d++)p.push(n[d].snapshotFile.relativePath);return this._memoryAnalyzer.showDiffSnapshotTab(p,i,Object(l.b)("SnapshotNumberDiff",e,t),t,e,s).then(()=>{ae.logPerformance({id:z.a.Memory_CompareSnapshot_Stop,key:a})})}setScreenshotSize(e,t,i){this._screenshotWidth=e;this._screenshotHeight=t;this._screenshotKeepAspectRatio=i}createTileView(e){var t=new Ie(e,this.model.snapshotSummaryCollection);return new Te(this,t)}reset(){xe._nextIdentifier=0;this.model.snapshotSummaryCollection.clear();Et.onIdle()}removeExistingGraph(){this.view.removeExistingGraph()}async checkCompleted(){if(this._processedPartCount===this._expectedPartCount){this._expectedPartCount=-1;this._processedPartCount=0;this._parts={};this._currentPartId=0;this._streamingStarted=!1;await this._filePath.file.close();Et.memoryAnalyzerData.addSnapshotStreamPart("~~END~~")}}getSnapshotSummary(e){for(var t=null,i=0;i<this.model.snapshotSummaryCollection.length;i++){var s=this.model.snapshotSummaryCollection.getItem(i);if(s.id===e){t=s;break}}return t}onSnapshotResult(e,t){var i,s=(new Date).getTime(),a=Et.shell.getSnapshotFullPath(this._storageId,e),r=xe._nextIdentifier;t&&(i=Et.shell.getSnapshotFullPath(this._storageId,t));this._snapshotSummaryPromise=D.a.wrap(Et.memoryAnalyzerData.processSnapshotSummary(a,i).then(t=>{this._snapshotSummaryPromise=null;return this.onSnapshotCompleted(e,t,s)},e=>{this._snapshotSummaryPromise=null;r===xe._nextIdentifier&&this.onSnapshotFailed(e)}));return this._snapshotSummaryPromise}async onSnapshotCompleted(e,t,i){if(!t)throw new Error(Object(l.a)("JSPerf.1014"));var s=++xe._nextIdentifier,a=new we(t,new ve(this._storageId,e),i,s);this.model.snapshotSummaryCollection.push(a);this.model.isTakingSnapshot=!1;window.console&&window.console.log&&window.console.log("Snapshot taken: "+a.objectsCount+" objects.");try{await a.save();_.a.notify(de.OnSnapshotProcessingCompleted,a);ae.logPerformance({id:z.a.Memory_TakeSnapshot_Stop})}catch(e){this.onSnapshotFailed(e)}if(0!==this._snapshotStart){ae.log(re.SNAPSHOT_END,{Duration:Date.now()-this._snapshotStart});this._snapshotStart=0}}onSnapshotFailed(e){if(!e)throw new Error(Object(l.a)("JSPerf.1015"));e.message=Object(l.b)("SnapshotCreationFailed",e.message);this.model.latestSnapshotError=e;this.model.isTakingSnapshot=!1;Et.onIdle()}}xe._nextIdentifier=0;xe._snapshotChunkSize=32768;xe._startSessionFailedFwdLink="https://aka.ms/devtools-memory-known-issues";xe.errorDisplay=Object(B.a)();class Pe extends Se.b{constructor(e){super();this.isOffline=e;this._snapshotSummaryCollection=new be.a;this._snapshotSummaryCollection.propertyChanged.addHandler(this.onPropertyChanged.bind(this));this.propertyChanged.addHandler(this.onPropertyChanged.bind(this))}get isOpenSessionEnabled(){return null!==Et.packager&&!this.isStarting&&this.isOffline&&this.isTargetCompatible&&this.isAttached&&this.isRunning}get isSaveSessionEnabled(){return this._snapshotSummaryCollection.length>0&&null!==Et.packager}get isStartEnabled(){return!this.isStarting&&this.isOffline&&this.isTargetCompatible&&this.isAttached&&this.isRunning}get isStopEnabled(){return!this.isStopping&&!this.isOffline&&this.isAttached&&this.isRunning}get isTakeSnapshotEnabled(){return!this.isOffline&&this.isAttached&&this.isRunning&&!this.isTakingSnapshot&&this.isTargetCompatible}get snapshotSummaryCollection(){return this._snapshotSummaryCollection}static initialize(){Se.a.defineProperty(Pe,Pe.IsActivatedPropertyName,!1);Se.a.defineProperty(Pe,Pe.IsAttachedPropertyName,!1);Se.a.defineProperty(Pe,Pe.IsOfflinePropertyName,!0,e=>{e.onIsOfflineChanged()});Se.a.defineProperty(Pe,Pe.IsRunningPropertyName,!0);Se.a.defineProperty(Pe,Pe.IsStartingPropertyName,!1);Se.a.defineProperty(Pe,Pe.IsStartProfilingPromptVisiblePropertyName,!0);Se.a.defineProperty(Pe,Pe.IsStoppingPropertyName,!1);Se.a.defineProperty(Pe,Pe.IsTakingSnapshotPropertyName,!1);Se.a.defineProperty(Pe,Pe.IsTargetCompatiblePropertyName,!0);Se.a.defineProperty(Pe,Pe.WarningMessagePropertyName,"");Se.a.defineProperty(Pe,Pe.LatestSnapshotErrorPropertyName,null)}onIsOfflineChanged(){this.isOffline&&(this.isTakingSnapshot=!1)}onPropertyChanged(e){switch(e){case Pe.IsAttachedPropertyName:case Pe.IsOfflinePropertyName:case Pe.IsRunningPropertyName:case Pe.IsStartingPropertyName:case Pe.IsTargetCompatiblePropertyName:this.propertyChanged.invoke(Pe.StartProfilingEnabledPropertyName)}switch(e){case Pe.IsAttachedPropertyName:case Pe.IsOfflinePropertyName:case Pe.IsRunningPropertyName:case Pe.IsStoppingPropertyName:this.propertyChanged.invoke(Pe.StopProfilingEnabledPropertyName)}switch(e){case Pe.IsAttachedPropertyName:case Pe.IsOfflinePropertyName:case Pe.IsRunningPropertyName:case Pe.IsStartingPropertyName:case Pe.IsTargetCompatiblePropertyName:this.propertyChanged.invoke(Pe.OpenSessionEnabledPropertyName)}switch(e){case be.a.LengthProperty:this.propertyChanged.invoke(Pe.SaveSessionEnabledPropertyName)}switch(e){case Pe.IsAttachedPropertyName:case Pe.IsOfflinePropertyName:case Pe.IsRunningPropertyName:case Pe.IsTakingSnapshotPropertyName:case Pe.IsTargetCompatiblePropertyName:this.propertyChanged.invoke(Pe.TakeSnapshotEnabledPropertyName)}}}Pe.IsActivatedPropertyName="isActivated";Pe.IsAttachedPropertyName="isAttached";Pe.IsOfflinePropertyName="isOffline";Pe.IsRunningPropertyName="isRunning";Pe.IsStartingPropertyName="isStarting";Pe.IsStartProfilingPromptVisiblePropertyName="isStartProfilingPromptVisible";Pe.IsStoppingPropertyName="isStopping";Pe.IsTakingSnapshotPropertyName="isTakingSnapshot";Pe.IsTargetCompatiblePropertyName="isTargetCompatible";Pe.LatestSnapshotErrorPropertyName="latestSnapshotError";Pe.OpenSessionEnabledPropertyName="isOpenSessionEnabled";Pe.SaveSessionEnabledPropertyName="isSaveSessionEnabled";Pe.StartProfilingEnabledPropertyName="isStartEnabled";Pe.StopProfilingEnabledPropertyName="isStopEnabled";Pe.TakeSnapshotEnabledPropertyName="isTakeSnapshotEnabled";Pe.WarningMessagePropertyName="warningMessage";Pe.initialize();class Oe extends L.a{constructor(e,t){super("SummaryTabTemplate");this._graphUpdateDelayMilliseconds=100;this._screenshotWidth=280;this._screenshotHeight=160;this._screenshotKeepAspectRatio=!0;this._controller=e;this._model=t;this._model.propertyChanged.addHandler(this.onPropertyChanged.bind(this));this._model.snapshotSummaryCollection.collectionChanged.addHandler(this.onCollectionChanged.bind(this));this._heapGraphContainer=this.findElement("heapOverviewGraph");this._tilesContainer=this.findElement("tilesContainer");this._warningSection=this.findElement("warningSection");this._onSnapshotClickHandler=this.onSnapshotClick.bind(this);var i=this.findElement("giveFeedbackButton_Summary");i.classList.add("hidden");Et.internalFeedback.isEnabled().then(e=>{if(e){i.classList.remove("hidden");i.addEventListener("click",this.onGiveFeedbackClick.bind(this))}});this._takeSnapshotTile=this.findElement("takeSnapshotTile");this._snapshotError=this.findElement("snapshotError");this._snapshotErrorMsg=this.findElement("snapshotErrorMsg");this._snapshotProgress=this.findElement("takeSnapshotProgress");this._snapshotTile=this.findElement("takeSnapshotButton");this._snapshotLabel=this.findElement("takeSnapshotLabel");this._snapshotIcon=this.findElement("takeSnapshotIcon");var s=Object(l.b)("TakeSnapshot");s+="<br>"+Object(l.b)("TakeSnapshotShortcut");this._snapshotLabel.innerHTML=s;this._snapshotProgress.innerText=Object(l.b)("Loading");this.toggleProgress(this._model.isTakingSnapshot);this.toggleAttached(this._model.isAttached);this.updateTakeSnapshotTile();this._snapshotTile.addEventListener("click",this._onSnapshotClickHandler);this._model.isOffline?this._takeSnapshotTile.style.display="none":this.updateNavigationTarget(this._snapshotTile);this._controller.setScreenshotSize(this._screenshotWidth,this._screenshotHeight,this._screenshotKeepAspectRatio)}get model(){return this._model}addRulerMark(e,t){this._graphRenderer&&this._graphRenderer.ruler.addMark(Microsoft.VisualStudio.DiagnosticsHub.MarkType.UserMark,e,t)}refreshGraph(){this._graphRenderer&&this._graphRenderer.onResize()}removeExistingGraph(){if(this._graphRenderer){this._graphRenderer.dispose();this._graphRenderer=null;this._graphResizeCompleted=!1}this._heapGraphContainer.innerHTML="";this._heapGraphContainer.style.display="none"}startGraph(){var e=Object(o.q)(),t=Object(o.p)();this.removeExistingGraph();var i={GraphBehaviour:Microsoft.VisualStudio.DiagnosticsHub.GraphBehaviourType.Live,Series:[],MinValue:0,MaxValue:100,Units:[{Unit:Object(l.b)("/Common/ByteUnits"),LowerBound:Number.MIN_VALUE,Divider:1,Decimals:1},{Unit:Object(l.b)("/Common/KilobyteUnits"),LowerBound:1024,Divider:1024,Decimals:1},{Unit:Object(l.b)("/Common/MegabyteUnits"),LowerBound:1048576,Divider:1048576,Decimals:1},{Unit:Object(l.b)("/Common/GigabyteUnits"),LowerBound:1073741824,Divider:1073741824,Decimals:1}]},s={View:"Ruler",Series:[{MarkType:Microsoft.VisualStudio.DiagnosticsHub.MarkType.UserMark,Legend:"",DataSource:{CounterId:Oe.ProfilerMarkCounterId}}],MinValue:void 0,MaxValue:void 0,Unit:void 0,Units:void 0,Axes:void 0},a={Id:"",Title:Object(l.b)("GraphTitle"),Description:Object(l.b)("GraphTitle")+", "+Object(l.b)("HubGraphHeapLegend"),JsonConfiguration:JSON.stringify(i),Resources:{CPU_Legend:Object(l.b)("GraphTitle"),CPU_LegendTooltip:Object(l.b)("GraphTitle")+", "+Object(l.b)("HubGraphHeapLegend")},JavaScriptFactoryFunction:"MemoryAnalyzer.MemoryUsageSwimlaneFactory",View:this,Type:3},r={Id:"",Title:"None",Description:"None",JsonConfiguration:JSON.stringify(s),Resources:{None:""}};let n="";m.b.isWinRTHost&&(n=m.b.utilities.getTempAppDataPath());var d={sessionId:"00000000-0000-0000-0000-000000000001",analyzers:[],dataSources:[],symbolCachePath:n,symbolStorePath:""},c=new h(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(e),t),p={isToolbarRequired:!1,isSelectionEnabled:!1,dataManager:{getConfigurations:e=>{e([a,r],d)},dataUpdate:e=>{this._graphUpdateIntervalId=window.setInterval(()=>{var t=c.convertQpcTimestampToNanoseconds(Microsoft.VisualStudio.DiagnosticsHub.BigNumber.convertFromNumber(Object(o.q)()));e(t.jsonValue)},this._graphUpdateDelayMilliseconds)}},containerId:this._heapGraphContainer.id,collectorTimeService:null,isLive:!0,timeInNsPerPixel:2e8};this._graphRenderer=new Microsoft.VisualStudio.DiagnosticsHub.Renderer(p);this._heapGraphContainer.style.display="-ms-grid"}stopGraph(){window.clearInterval(this._graphUpdateIntervalId)}onPropertyChanged(e){switch(e){case Pe.WarningMessagePropertyName:this.showWarningMessage(this._model.warningMessage);break;case Pe.LatestSnapshotErrorPropertyName:this.showSnapshotError(this._model.latestSnapshotError);break;case Pe.IsTakingSnapshotPropertyName:this.toggleProgress(this._model.isTakingSnapshot);this.updateTakeSnapshotTile();break;case Pe.IsAttachedPropertyName:case Pe.IsTargetCompatiblePropertyName:this.toggleAttached(this._model.isAttached);this.updateTakeSnapshotTile();break;case Pe.IsRunningPropertyName:this.toggleRunning(this._model.isOffline,this._model.isAttached,this._model.isRunning);this.updateTakeSnapshotTile();break;case Pe.IsOfflinePropertyName:this.toggleOffline(this._model.isOffline,this._model.isAttached,this._model.isRunning);this.updateTakeSnapshotTile()}}onCollectionChanged(e){switch(e.action){case 0:this.createTile(e.newItems[0]);break;case 3:this.removeSnapshotTiles()}}onGiveFeedbackClick(e){this._controller.giveFeedback()}createTile(e){var t=this._controller.createTileView(e);this._tilesContainer.insertBefore(t.rootElement,this._takeSnapshotTile);t.rootElement.scrollIntoView(!0);t.setFocus();this.updateNavigationTarget(t.navigationElement)}removeSnapshotTiles(){for(;this._tilesContainer.hasChildNodes();)this._tilesContainer.removeChild(this._tilesContainer.firstChild);this._tilesContainer.appendChild(this._takeSnapshotTile);this.updateNavigationTarget(this._snapshotTile)}toggleAttached(e){e||this._controller.cancelPendingSnapshots()}toggleOffline(e,t,i){this._takeSnapshotTile.style.display=e?"none":"block"}toggleProgress(e){if(this._snapshotProgress&&this._snapshotError)if(e){this._snapshotLabel.style.display="none";this._snapshotIcon.style.display="none";this._snapshotProgress.style.display="block";this._snapshotError.style.display="none";this._snapshotTile.setAttribute("aria-label",Object(l.b)("Loading"))}else{this._snapshotLabel.style.display="";this._snapshotIcon.style.display="";this._snapshotProgress.style.display="none";this._snapshotTile.setAttribute("aria-label",Object(l.b)("TakeSnapshot"))}}toggleRunning(e,t,i){!e&&t&&i?this._controller.startGraphCollectorSession():this._controller.stopGraphCollectorSession()}showSnapshotError(e){if(this._snapshotErrorMsg&&this._snapshotError)if(e){this._snapshotErrorMsg.innerText=Ce.format(e);this._snapshotError.style.display="block"}else{this._snapshotErrorMsg.innerText="";this._snapshotError.style.display="none"}}showWarningMessage(e){if(this._warningSection)if(e){this._warningSection.innerHTML=e;this._warningSection.style.display="inline"}else{this._warningSection.innerHTML="";this._warningSection.style.display="none"}}onSnapshotClick(e){ae.logExecuteCommand(ne.TAKE_SNAPSHOT_TILE,N.c.Ui);this._controller.takeSnapshot()}updateTakeSnapshotTile(){if(this._snapshotTile)if(this._model.isTakeSnapshotEnabled){this._snapshotTile.classList.remove("disabled");this._snapshotTile.disabled=!1}else if(!this._model.isTakingSnapshot){this._snapshotTile.classList.add("disabled");this._snapshotTile.disabled=!0}}updateNavigationTarget(e){J.updateAdditionalNavigationFrames(this._controller.navigationId,[F.a.makeNavigationFrameFromCallback(this._tilesContainer,()=>e===this._snapshotTile&&"none"!==this._snapshotProgress.style.display?null:e)])}}Oe.PrivateBytesCounterId="PrivateBytes";Oe.ProfilerMarkCounterId="performancemark";const Ee=["../memoryanalyzer/memoryAnalyzerRemote.bundle.js"],Me="memoryAnalyzerPort";class ke{constructor(e){this.eventQueue=[];Object(v.g)().listen("notificationFromRemote|ms:memory",e=>{const t=e.event,i=e.params;this.jsonRpcNotificationReceive(t,i)});if(!e.isOffline){m.b.addEventListener("activated",this.onActivate.bind(this));m.b.addEventListener("deactivated",this.onDeactivate.bind(this));m.b.addEventListener("break",this.onBreak.bind(this));m.b.addEventListener("run",this.onRun.bind(this));m.b.addEventListener("detach",this.onDetach.bind(this));m.b.addEventListener("attach",this.onAttach.bind(this));m.b.isAttached&&this.onAttach()}this.setSession(e)}methodCall(e,t){return $.callRemote(Me,e,t)}jsonRpcNotificationReceive(e,t){this.eventQueue.push({event:e,params:t});this.processQueue()}async processQueue(){if(!this.eventQueueCurrentItem&&this.eventQueue.length){this.eventQueueCurrentItem=this.eventQueue.shift();if(this.eventQueueCurrentItem)try{await this.jsonRpcNotificationReceiveImpl(this.eventQueueCurrentItem.event,this.eventQueueCurrentItem.params)}finally{this.eventQueueCurrentItem=void 0;this.processQueue()}}}async jsonRpcNotificationReceiveImpl(e,t){switch(e){case"SnapshotChunk":case"SnapshotComplete":await this.onSnapshotDataReceived(t[0].data,t[0].partId);break;case"MemoryHandshake":await this.onHandshake();break;case"DocumentNotYetReady":break;case"TakeSnapshot":await this.takeSnapshot()}}get summaryViewController(){return this._summaryViewController}get view(){return this._view}clearSummaryTab(){this._summaryViewController.reset()}goOffline(){this._summaryViewController.model.isOffline||this._summaryViewController.stopGraphCollectorSession()}goOnline(){this._summaryViewController.model.isOffline&&this._summaryViewController.startGraphCollectorSession()}removeExistingGraph(){this._summaryViewController.removeExistingGraph()}setSession(e){var t,i,s,a,r=e.isOffline,n=!!this._summaryViewController;if(n){t=this._summaryViewController.model.isAttached;i=this._summaryViewController.model.isRunning;s=this._summaryViewController.model.isTakingSnapshot;a=this._summaryViewController.model.isTargetCompatible}let o;this._summaryViewController=new xe(this,e.storageId,r);if(r){this._view=new ce(this.summaryViewController);o=this.summaryViewController.loadExistingSnapshots()}else{this._view=new Ne(this);var l=Microsoft.VisualStudio.DiagnosticsHub.getCurrentSession();l&&l.addStateChangedEventListener(this.onDiagnosticsHubStateChanged.bind(this,l));o=Promise.resolve()}return o.then(()=>{if(n){this._summaryViewController.model.isAttached=t;this._summaryViewController.model.isRunning=i;this._summaryViewController.model.isTakingSnapshot=s;this._summaryViewController.model.isTargetCompatible=a}})}onSnapshotDataReceived(e,t){return this._summaryViewController.onSnapshotDataReceived(e,t)}takeSnapshot(){this._summaryViewController.takeSnapshot()}showWarning(e){this._summaryViewController.model.warningMessage=e}onActivate(){this._summaryViewController.model.isActivated=!0}onAttach(){if(!this._isAttached){this._isAttached=!0;m.b.notifyOnToolActivated(y.c.memoryAnalyzer);$.loadScripts(Ee,Me)}}onDeactivate(){this._summaryViewController.model.isActivated=!1}onDetach(){this._isAttached=!1;this.showWarning(Object(l.b)("WarningNotAttached"));this._summaryViewController.model.isAttached=!1;Et.shell.clearEtw()}onBreak(){this._summaryViewController.model.isRunning=!1}onRun(){this._summaryViewController.model.isRunning=!0}async onHandshake(){this._summaryViewController.model.isAttached=!0;ae.logPerformance({id:z.b.Memory_ToolReady_Start});this._summaryViewController.model.isOffline||this.showWarning(null);this._summaryViewController.model.isTargetCompatible=!0;this._summaryViewController.model.isTakingSnapshot=!1;if(this._summaryViewController.model.isOffline){if(0===this._summaryViewController.model.snapshotSummaryCollection.length){this._summaryViewController.reset();await Et.shell.closeAllSnapshots();Et.shell.resetView()}}else{await Et.shell.closeAllSnapshots();this._summaryViewController.reset()}ae.logPerformance({id:z.b.Memory_ToolReady_Stop});window.requestAnimationFrame(()=>{ee.markToolReady(y.c.memoryAnalyzer);$.startPreload(y.c.memoryAnalyzer);K.b()&&Object(Z.g)(()=>{},{Reliability:{isAlive:()=>Promise.resolve()}})})}showSnapshotTab(e,t,i,s){return e?Et.shell.openSnapshot(e,t,i,s):Promise.resolve()}showDiffSnapshotTab(e,t,i,s,a,r){return!e||e.length<2?Promise.resolve():Et.shell.openSnapshotDiff(e,t,i,s,a,r)}canTakeSnapshot(){var e=this._summaryViewController.model;return e.isAttached&&e.isRunning&&!e.isTakingSnapshot&&!e.isOffline}canShowTakeSnapshot(){var e=this._summaryViewController.model;return e.isAttached&&e.isRunning&&!e.isOffline}onDiagnosticsHubStateChanged(e,t){if(300===t.previousState&&400===t.currentState){e.removeStateChangedEventListener(this.onDiagnosticsHubStateChanged.bind(this,e));var i=t.getDeferral(),s=()=>{_.a.notify(de.SessionEnd);i.complete()};this._summaryViewController.save().then(s,s)}}onTakeSnapshotCommand(){this.takeSnapshot()}}class Ne extends he{constructor(e){super();this._controller=e;this.title=Object(l.b)("Summary").toLocaleUpperCase();this.tooltipString=Object(l.b)("SummaryTabTooltip");this.content=new ce(this._controller.summaryViewController)}onActiveChanged(){if(this.active){var e=this._controller.summaryViewController.view;e&&e.refreshGraph();J.switchNavigationView(this._controller.summaryViewController.navigationId)}}}class Re{constructor(e){this.session=e}async createSnapshot(){const e=await this.session.getSessionInfo(),t=this.session.getNewSnapshotRelativePath(),i=e.storageId+"\\"+t;return{file:await Object(q.a)().openFileAsHostFile(i,{access:U.a.write,encoding:"UTF-8",mode:U.c.append,persistence:U.d.temporary,type:U.f.text}),relativePath:t}}save(e){return this.session.save(e)}}class je{static getValue(e,t,i){return e>>t&i}static setValue(e,t,i,s){return~(s<<i)&e|(t&s)<<i}static isFlagSet(e,t){return 0!=(e&t)}static setFlag(e,t,i){return t?e|i:e&~i}}class Ve{constructor(e,t,i,s){this._innerObj=e.object||t;this._isCircularReference=s;this.name=this.initName(e.name,i);s||(this._hasChildren=e.hasChildren);if(this.isFabricatedObject)this._diffOperation=null;else if(this.isAdded)this._diffOperation=Object(l.b)("DiffColumnOperationAdded");else if(this.isChanged){this._diffOperation=Object(l.b)("DiffColumnOperationModified");this.isBaseline&&(this._diffOperation+=" ("+Object(l.b)("Baseline")+")")}else{this._diffOperation=Object(l.b)("DiffColumnOperationUnchanged");this.isBaseline&&(this._diffOperation+=" ("+Object(l.b)("Baseline")+")")}}get id(){return this.objectId}get flags(){return this._innerObj.flags}get kind(){return this._innerObj.kind}get objectId(){return this._innerObj.objectId}get retainedSize(){return this._innerObj.retainedSize}get size(){return this._innerObj.objectSize}get sourceInfo(){return this._innerObj.sourceInfo}get type(){return this._innerObj.type}get value(){return this._innerObj.value}get diffOperation(){return this._diffOperation}get sizeDiff(){return this._innerObj.sizeDiff}get retainedSizeDiff(){return this._innerObj.retainedSizeDiff}get hasChildren(){return this._hasChildren}get isCircularReference(){return this._isCircularReference}get containsDetachedDomNode(){return this.isDetachedDomNode||this.hasDetachedDomNodeChildren}get hasDetachedDomNodeChildren(){return je.isFlagSet(this._innerObj.flags,1048576)}get isDetachedDomNode(){return je.isFlagSet(this._innerObj.flags,8192)}get isSizeApproximate(){return je.isFlagSet(this._innerObj.flags,2048)}get isNew(){return je.isFlagSet(this._innerObj.flags,64)}get isRoot(){return je.isFlagSet(this._innerObj.flags,128)}get isSiteClosed(){return je.isFlagSet(this._innerObj.flags,256)}get isBuiltIn(){return je.isFlagSet(this._innerObj.flags,512)}get external(){return je.getValue(this._innerObj.flags,0,7)}get winrt(){return je.getValue(this._innerObj.flags,3,7)}get isMarkup(){return je.isFlagSet(this._innerObj.flags,1024)}get isAdded(){return je.isFlagSet(this._innerObj.flags,32768)}get isBaseline(){return je.isFlagSet(this._innerObj.flags,65536)}get isChanged(){return je.isFlagSet(this._innerObj.flags,4096)}get isFabricatedObject(){return je.isFlagSet(this._innerObj.flags,524288)}get isRelatedToAddedScopedObject(){return je.isFlagSet(this._innerObj.flags,131072)}get isRelatedToLeftoverScopedObject(){return je.isFlagSet(this._innerObj.flags,262144)}get isWinJsDisposable(){return je.isFlagSet(this._innerObj.flags,16384)}initName(e,t){var i="";void 0!==e&&(i+=e);if(this.winrt)switch(this.winrt){case 2:i+="{Runtime Class} ";break;case 3:i+="{Delegate} ";break;case 4:i+="{Namespace} "}if(this.external){i?i+=": ":i="";var s="External";switch(this.external){case 2:s+=" IUnknown";break;case 3:s+=" IDispatch"}i+=s}if(void 0!==this.value){i?i+=" = ":i="";var a="string"==typeof this.value;a&&(i+='"');i+=this.value;a&&(i+='"')}""===i&&this.type&&("("===this.type[0]?i+=this.type:i+="("+this.type+") ");return i}}class Ae extends Ve{constructor(e,t,i,s,a=0){super(e,t,i);this.nodeId=a;this.parentObjectId=s}}class Le{constructor(e){this.objectHeapType=e;this._name=this.objectHeapType.type}get isAdded(){return!1}get isBaseline(){return!1}get isRelatedToAddedScopedObject(){return!1}get isRelatedToLeftoverScopedObject(){return!1}get isFabricatedObject(){return!1}get isChanged(){return this.objectHeapType.hasModifiedChildren}get id(){return this.objectHeapType.type}get isDetachedDomNode(){return this.objectHeapType.hasDetachedDomNodeChildrenOfSameType}get name(){return this._name}get retainedSize(){return this.objectHeapType.retainedSize}get sizeDiff(){return this.objectHeapType.sizeDiff}get retainedSizeDiff(){return this.objectHeapType.retainedSizeDiff}get size(){return this.objectHeapType.objectSize}get isSizeApproximate(){return!1}get isNew(){return!0}get type(){return""}get isBuiltIn(){return!1}get childrenCount(){return this.objectHeapType.childrenCount}get hasChildren(){return this.objectHeapType.childrenCount>0}get hasDetachedDomNodeChildren(){return this.objectHeapType.hasDetachedDomNodeChildren}get containsDetachedDomNode(){return this.isDetachedDomNode||this.hasDetachedDomNodeChildren}get diffOperation(){return null}}class Fe{constructor(e,t,i,s){this._snapshotData=e;this._isDiff=t;this._firstSnapshotId=i;this._lastSnapshotId=s}get isDiff(){return this._isDiff}get firstSnapshotId(){return this._firstSnapshotId}get lastSnapshotId(){return this._lastSnapshotId}get hasDetachedDomNodes(){return this._snapshotData.hasDetachedDomNodes()}getUidChain(e){return this._snapshotData.getUidChain(e)}getAllObjects(e,t,i=0,s=-1,a=2){return this._snapshotData.getDominators(i,s,e.filterString,a,e).then(i=>{for(var s=i.result,a=[],r=0;r<s.length;r++){var n=s[r],o=new Ve(n,this._snapshotData.getObject(n.objectId),e.displayObjectIDs);a.push(o)}a.sort(t.sortComparer);return{items:a,totalCount:i.totalCount}})}getAllRootObjects(e,t,i){for(var s=this._snapshotData.getRootObjects(i,e),a=s.result,r=[],n=0;n<a.length;n++){var o=a[n],l=new Ve(o,this._snapshotData.getObject(o.objectId),e.displayObjectIDs);r.push(l)}r.sort(t.sortComparer);return{items:r,totalCount:s.totalCount}}getAllTypes(e,t,i){return this._snapshotData.getTypes(e.filterString,i,e).then(e=>{for(var i=[],s=0;s<e.length;s++){var a=e[s],r=new Le(a);i.push(r)}i.sort(t.sortComparer);return{items:i,totalCount:i.length}})}getAllChildrenForObjectOrType(e,t,i,s,a=0,r=-1,n=2,o=!1){var l=parseInt(e);return isNaN(l)?this.getAllObjectsByType(e,i,s,a,r,n):this.getAllChildrenForObject(l,t,i,s,a,r,n,o)}getAllObjectsByType(e,t,i,s=0,a=-1,r){for(var n=this._snapshotData.getObjectsByType(e,s,a,r,t),o=n.result,l=[],h=0;h<o.length;h++){var d=o[h],c=new Ve(d,this._snapshotData.getObject(d.objectId),t.displayObjectIDs);l.push(c)}l.sort(i.sortComparer);return{items:l,totalCount:n.totalCount}}getAllChildrenForObject(e,t,i,s,a=0,r=-1,n=2,o=!1){if("1"!==m.b.utilities.getEnvironmentVariable("F12_GENERATE_BUILTINS")){for(var l=this._snapshotData.getChildrenForObject(e,a,r,n,o,i),h=l.result,d=[],c=new Set,p=0;p<t.length;p++)c.add(t[p].id);for(p=0;p<h.length;p++){var u=h[p],g=new Ve(u,this._snapshotData.getObject(u.objectId),i.displayObjectIDs,c.has(u.objectId));d.push(g)}d.sort(s.sortComparer);return{items:d,totalCount:l.totalCount}}this.getAndSaveAllChildrenForObject.apply(arguments)}getAndSaveAllChildrenForObject(e,t,i,s,a=0,r=-1,n=2,o=!1){this.generateBuiltInDef(e).then(e=>{this.saveDef(e)});return{items:[],totalCount:0}}getRetainedDescendants(e,t,i,s,a=0,r=-1){for(var n=this._snapshotData.getRetainedDescendants(e,a,r,t,i),o=n.result,l=[],h=0;h<o.length;h++){var d=o[h],c=new Ve(d,this._snapshotData.getObject(d.objectId),i.displayObjectIDs);l.push(c)}l.sort(s.sortComparer);return{items:l,totalCount:n.totalCount}}getReferenceTreeItems(e,t,i,s,a,r){for(var n=this._snapshotData.getReferenceTreeItems(e,t,i,r),o=n.result,l=[],h=0;h<o.length;h++){var d=o[h],c=new Ae(d,this._snapshotData.getObject(d.objectId),a,d.parentId,d.nodeId);l.push(c)}l.sort(s.sortComparer);return{items:l,totalCount:n.totalCount}}getPathToDominator(e,t,i){return this._snapshotData.getPathToDominator(e,t,i)}getPathToRoot(e,t,i){return this._snapshotData.getPathToRoot(e,i,t)}getSnapshotDiffStats(){return this._snapshotData.getSnapshotDiffStats()}saveDef(e){var t,i="txt";Object(q.a)().saveFileDialog({name:"",extensions:[i]},{access:U.a.write,encoding:"UTF-8",persistence:U.d.temporary,type:U.f.text}).then(i=>(t=i).write(e)).then(()=>{},e=>{}).then(()=>{t&&t.close()})}getOwnChildren(e){var t=[],i=this._snapshotData.getChildrenForObject(e.objectId,0,-1,2,!1,{showBuiltIns:!0}).result;if(i.length>0)for(var s=0;s<i.length;s++){var a=i[s],r=a.object||this._snapshotData.getObject(a.objectId);a.name&&"link->"===a.name.substr(0,6)||a.name&&"<"===a.name.substr(0,1)||r&&"Scope"===r.kind||a.name&&"["===a.name.substr(0,1)&&r&&"Window"===r.kind||t.push(a)}return t.sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()))}generateBuiltInObjectDef(e,t,i,s,a,r){var n=(e,t)=>'NameKindKey(L"'+e+'", L"'+t+'")',o=(e,t,i,s)=>e+"->insert("+n(t,i)+", "+s+");\n",l=e=>e.length>0&&"[prototype]"===e[0].name?e.splice(0,1)[0]:null,h="",d=this.getOwnChildren(t);l(d);if(d.length>0){var c=r+"_"+a,p=s+"    ";h+=s+"{\n";h+=p+"auto "+c+" = "+o(r,e,t.kind,"heap.GetNewBuiltInObject()");for(var u={},m=0;m<d.length;m++){var g,_=d[m],f=_.object||this._snapshotData.getObject(_.objectId);if(_.objectId||f&&"Property"===f.kind&&"GlobalObject"===t.kind){var S=f;if(!S)continue;var b=null;if("hasOwnProperty"!==_.name){if(u.hasOwnProperty(_.name))continue;u[_.name]=!0}else{if(u.hasOwnProperty("$hasOwnProperty"))continue;u.$hasOwnProperty=!0}var C=this.getOwnChildren(S),v=l(C),w=v.object||this._snapshotData.getObject(v.objectId);if("prototype"===_.name&&w)switch(S.kind){case"Null":b="nullptr";break;case"ObjectObject":"Null"===w.kind&&(b="common.objectObject");break;case"BooleanObject":"ObjectObject"===w.kind&&(b="common.booleanObject");break;case"DateObject":"ObjectObject"===w.kind&&(b="common.dateObject");break;case"FunctionObject":"ObjectObject"===w.kind&&(b="common.functionObject");break;case"NumberObject":"ObjectObject"===w.kind&&(b="common.numberObject");break;case"RegexObject":"ObjectObject"===w.kind&&(b="common.regexObject");break;case"StringObject":"ObjectObject"===w.kind&&(b="common.stringObject");break;case"TypedArrayObject":"ObjectObject"===w.kind&&(b="common.typedArrayObject");break;case"ArrayObject":"ObjectObject"===w.kind&&(b="common.arrayObject")}else"FunctionObject"===S.kind?1===C.length&&"length"===C[0].name?b="common.functionWrapper":0===C.length&&(b="common.emptyFunctionPrototype"):"Windows"===S.kind?b="common.recursive":"Property"===S.kind&&(2!==C.length||"get"!==C[0].name&&"get:"!==C[0].name.substring(0,4)||"set"!==C[1].name&&"set:"!==C[1].name.substring(0,4)||(b="common.getterSetterObject"));if(b)g=p+o(c,_.name,S.kind,b);else if(i[S.objectId])g=p+o(c,_.name,S.kind,"nullptr");else{i[S.objectId]=!0;g=this.generateBuiltInObjectDef(_.name,S,i,p,m,c);delete i[S.objectId]}}else f&&"number"==typeof f.value?g=p+o(c,_.name,"NUMBER","nullptr"):"FunctionObject"===t.kind&&"arguments"===_.name?g=p+o(c,"arguments","Null","nullptr"):"FunctionObject"===t.kind&&"caller"===_.name&&(g=p+o(c,"caller","Null","nullptr"));g&&(h+=g)}h+=s+"}\n"}else h+=s+o(r,e,t.kind,"nullptr");return h}generateBuiltInDef(e){return this._snapshotData.getDominators(0,-1,"",2,{showBuiltIns:!0}).then(t=>{var i='//\n                //! Copyright (C) Microsoft. All rights reserved.\n                //\n\n                //------------------------------------------------------------------------------\n                // <auto-generated>\n                //     This code was generated by memAnalyzerBuiltInDefinitionsGenerator\n                //\n                //     Changes to this file may cause incorrect behavior and will be lost if\n                //     the code is regenerated.\n                // </auto-generated>\n                //------------------------------------------------------------------------------\n\n                #pragma optimize("", off)\n                void AddGlobalObjectBuiltInDefinitions(BuiltInObject* a, BuiltInDefinitionsCommon& common, BuiltInObjectsHeap& heap)\n                {\n                '.replace(/^\s+/gm,""),s={};t.result.forEach(e=>s[e.objectId]=e.object);i+=this.generateBuiltInObjectDef("",s[e],{},"    ",0,"a");return i+='}\n                #pragma optimize("", on)\n                '.replace(/^\s+/gm,"")})}}var He=i(46);class ze{static stableReverse(e,t){var i=[],s=e.length-1;s>=0&&e[s].data.hasMoreText&&s--;for(;s>=0;s--){for(var a=s-1;a>=0&&0===t(e[a],e[s]);a--);for(var r=a+1;r<=s;r++)i.push(e[r]);s=a+1}for(var n=0;n<i.length;n++)e[n]=i[n]}static defaultComparer(e,t,i,s){var a=i[e.index],r=s[e.index];return void 0===a||null===a?void 0===r||null===r?0:-1:a.toString().toLocaleUpperCase().localeCompare(r.toString().toLocaleUpperCase())}static sortComparer(e,t,i,s){if(i.hasMoreText)return 1;if(s.hasMoreText)return-1;for(var a=0;a<e.length;a++){var r=e[a],n=t[a],o=(n.comparer||ze.defaultComparer)(n,r.order,i,s);if(0!==o)return"desc"===r.order?-o:o}return 0}}class Ge{constructor(e,t,i,s,a,r,n,o,l){this.index=e;this.text=t;this.tooltip=i;this.width=s;this.canSortBy=a;this.getColumnValue=r;this.getCellCSSClass=n;this.comparer=o;this.hasHTMLContent=!1;this.variableWidth=l}}class Be{constructor(e,t){this.index=e;this.order=t}}class Ue{constructor(e,t){this.data=e;this.expandState=t;this.children=[]}}class We{constructor(e,t,i,s,a){this.backgroundColor=e;this.icon=t;this.checkbox=i;this.headerClickSortColumn=s;this.getTooltip=a}}class Ke{constructor(e,t,i,s,a,r){this.childDataCallback=e;this.loadMoreChildDataCallback=t;this.columns=i;this.sortOrders=s;this.allowMultiSelect=!1;this.allowSortOnMultiColumns=!1;this.ariaTitle="";this.asyncInit=!0;this.autoSort=!0;this.coreCssClass="grid";this.cssClass="";this.expandStates=[];this.extendViewportBy=3;this.gutter=new We;this.header=!0;this.height="100%";this.initialSelection=!1;this.keepSelection=!1;this.payloadSize=200;this.source=null;this.editCellCallback=a;this.rowSelectedCallback=r;this.disableRightClickSelection=!0;this.isGridDisabled=!1;this.sizeColumns()}sizeColumns(){if(this.columns){for(var e=document.documentElement.offsetWidth-66,t=0,i=-1,s=0;s<this.columns.length;s++)this.columns[s].variableWidth&&-1===i?i=s:t+=this.columns[s].width;if(i>=0){var a=e-t;a>this.columns[i].width&&(this.columns[i].width=a)}}}}class qe{constructor(e,t){this.rowIndex=e;this.dataIndex=t}}class Ye{constructor(e,t){this.width=e;this.height=t}}class Je{constructor(e,t){this.start=e;this.end=t}}class Qe{constructor(e,t,i,s){this.active=e;this.index=t;this.originalWidth=i;this.origin=s}}class Xe extends Q.a{constructor(e,t){super(e);this._gridInstanceNumber=Xe.GlobalGridInstanceNumber++;this._options=t;this._canvas=null;this._contentSpacer=null;this._element=null;this._gutter=null;this._gutterHeader=null;this._header=null;this._headerCanvas=null;this._dataSource=[];this._rows={};this._columns=[];this._expandStates=null;this._expandedCount=0;this._sortOrder=[];this._rowInfoMap=new Map;this._editCellCallback=null;this._selectedRows=null;this._selectionStart=-1;this._selectionCount=0;this._selectedIndex=-1;this._active=!1;this._activeAriaId=null;this._getChildDataCallback=null;this._getLoadMoreChildDataCallback=null;this._rowSelectedCallback=null;this._canvasHeight=300;this._canvasWidth=300;this._contentSize=null;this._measurements={};this._count=0;this._indentIndex=0;this._indentLevels=null;this._visibleRange=[];this._columnSizing=null;this._sizingElement=null;this._copyInProgress=!1;this._resetScroll=!1;this._ignoreScroll=!1;this._scrollTop=0;this._scrollLeft=0;this._cancelable=null;this._onAriaExpandedModifiedHandler=this.onAriaExpandedModified.bind(this);this.initialize()}getSelectionCount(){return this._selectionCount}getElement(){return this._element}setAriaDescription(e){this._ariaDescription=e;this._updateGridAriaLabel()}setGutterHeaderClickSortColumn(e){this._options.gutter.headerClickSortColumn=e}initializeDataSource(){var e;if(this._resetScroll){this._ignoreScroll=!0;try{(e=this._canvas).scrollTop=0;e.scrollLeft=0;this._scrollLeft=0;this._scrollTop=0;this._resetScroll=!1}finally{this._ignoreScroll=!1}}this.setDataSource(this._options.source,this._options.expandStates,this._options.columns,this._options.sortOrders);this._expandedCount>0?this._options.keepSelection&&this._selectedIndex>=0?this._selectRow(Math.min(this._selectedIndex,this._expandedCount-1)):this._selectRow(!1!==this._options.initialSelection?0:-1):this.setSelectedRowIndex(-1)}setDataSource(e,t,i,s,a){var r,n,o;this._rowInfoMap=new Map;this._dataSource=e||[];this._count=o=this._dataSource.length;if(t){this._expandStates=t;this._indentLevels=Xe.expand(t)}else{this._indentLevels=null;this._expandStates=null}this._expandedCount=o;this._updateRanges();this._columns=[];if(i){var l=(e,t,i,s,a,r,n)=>this._drawCell(e,t,i,s,a,r,n),h=(e,t)=>this._drawHeaderCellValue(e,t),d=(e,t,i)=>this.getColumnValue(e,t,i);for(r=0,n=i.length;r<n;r++){var c=i[r];c.index=void 0!==c.index?c.index:String(r);c.canSortBy=!1!==c.canSortBy;c.canMove=!1!==c.canMove;c.width=void 0!==c.width?c.width:100;c.getCellContents=c.getCellContents||l;c.getHeaderCellContents=c.getHeaderCellContents||h;c.getColumnValue=c.getColumnValue||d;this._columns.push(c)}}this._sortOrder=[];if(s){for(r=0,n=s.length;r<n;r++){var p=s[r];"desc"!==p.order&&(p.order="asc");this._sortOrder.push(p)}this.setGutterHeaderSortOrder()}this._clearSelection();this._determineIndentIndex();this._options.asyncInit?window.setTimeout(()=>this._layoutAfterSetDataSource(a),0):this._layoutAfterSetDataSource(a)}updateGetChildDataCallback(e){this._getChildDataCallback=e}getRowInfo(e){return this._rows[e]}getRowData(e){return this._dataSource[e]}getColumns(){return this._columns||[]}getSortOrder(){return this._sortOrder||[]}expandNode(e){if(this._dataSource[e+1].isPlaceholder){var t=this.getExpansionPath(e);this._getChildDataCallback(this._dataSource[e],t,(t,i)=>{if(null!==t){var s=e+1;this._adjustForDynamicData(t.itemsWithPlaceholders,t.expandStates,e,s,i)}})}if(this._expandStates){var i=this._expandStates[e];if(i<0){this._expandStates[e]=-i;this._updateRanges();var s=this._rows[e];s&&(s.isDirty=!0)}}}collapseNode(e){if(this._expandStates){var t=this._expandStates[e];if(t>0){this._expandStates[e]=-t;this._updateRanges();var i=this._rows[e];i&&(i.isDirty=!0)}}}expandAllNodes(){var e=0,t=this._count,i=this._expandStates,s=!1,a=this._rows;if(i){for(;e<t;){var r=i[e];if(r<0){i[e]=-r;s=!0;var n=a[e];n&&(n.isDirty=!0)}e++}s&&this._updateRanges()}return s}collapseAllNodes(){var e=0,t=this._count,i=this._expandStates,s=!1,a=this._rows;if(i){for(;e<t;){var r=i[e];if(r>0){i[e]=-r;s=!0;var n=a[e];n&&(n.isDirty=!0)}e++}s&&this._updateRanges()}return s}expandAll(){this._updateExpansionStateAndRedraw(()=>this.expandAllNodes)}collapseAll(){this._updateExpansionStateAndRedraw(()=>this.collapseAllNodes)}tryToggle(e,t,i){var s;if(!this._expandStates||this._selectedIndex<0||this._expandedCount<=0)return!1;var a=void 0!==i?i:this._getDataIndex(this._selectedIndex);if(!this._rows[a])return!1;if(0!==(s=this._expandStates[a])){if(e){if(!(s<0))return!1;this.expandNode(a)}else{if(!(s>0))return!1;this.collapseNode(a)}this._clearSelection();this._addSelection(this._getRowIndex(a));this._layoutContentSpacer();this._redraw();return!0}return!1}getSelectedRowIntoView(e){this._selectedIndex>=0&&this._getRowIntoView(this._selectedIndex,e)}cacheRows(e,t,i){}updateRow(e,t){var i=0,s=0;void 0===t||t<0?t=this._getDataIndex(e):(void 0===e||e<0)&&(e=this._getRowIndex(t));var a=this._rows[t];if(a){if(this._expandStates){i=this._expandStates[t];s=this._indentLevels[t]}this._updateRow(a,e,t,i,s)}}layout(){this._measureCanvasSize();this._cleanUpRows();this._fixScrollPos();this._layoutContentSpacer();this._updateViewport();this._layoutHeader();this._drawHeader()}redraw(){this._fixScrollPos();this._redraw(!0)}getColumnValue(e,t,i){return this._dataSource[e][t]}getColumnText(e,t,i,s){var a,r=t.getColumnValue(e,t.index,i,this._dataSource,s);a="string"!=typeof r?Xe.convertValueToDisplayString(r,t.format):r;t.maxLength=Math.max(t.maxLength||0,a.length);return a}getSelectedRowIndex(){return 0===this._selectionCount?-1:this._selectedIndex}setSelectedRowIndex(e){this._clearSelection();this._addSelection(e)}getSelectedDataIndex(){return this._getDataIndex(this._selectedIndex)}getSelectedDataIndices(){var e,t=this._selectedRows,i=[];if(t)for(e in t)i[i.length]=t[e];return i}ensureDataIndexExpanded(e){for(var t=this._getRowIndex(e);t<0||e>0&&0===t;){this.expandNode(this._getDataIndex(-t));t=this._getRowIndex(e)}return t}setSelectedDataIndex(e,t){var i=t?this.ensureDataIndexExpanded(e):this._getRowIndex(e);this.setSelectedRowIndex(i)}setFocusToSelectedRow(){this._updateAriaAttribute();this.getSelectedRowIntoView(!0)}selectionChanged(e,t,i){}selectedIndexChanged(e,t){}onSort(e,t){this.fireCustomEvent(this._element,"sortStarted");if(this._options.autoSort){this._trySorting(e,t);this._sortOrder=e;this.layout()}return!0}getRowInfoFromEvent(e,t){var i=this.findClosestElement(e.target,t);return this._rowInfoMap.get(i)}getExpandStates(){return this._expandStates}getExpansionPath(e){if(e<0||e>=this._expandStates.length)throw new Error("Item does not exist");for(var t=[],i=0;i<e;){var s=i+Math.abs(this._expandStates[i]);if(e<=s){t.push(this._dataSource[i]);i++}else i=s+1}if(i!==e)throw new Error("Invalid expandStates format or incorrect assumption");t.push(this._dataSource[e]);return t}ensureSelectedIndex(e){this._ensureSelectedIndex(e,!0)}static expand(e){var t=[];if(e.length>0){var i=[],s={level:1,origCount:e.length,remainingCount:e.length};i.push(s);for(var a=0;a<e.length;){t.push(s.level);s.remainingCount--;for(;0===s.remainingCount;){i.pop();if(0===i.length){if(a===e.length-1)break;throw new Error("invalid descendant counts, nesting not possible")}var r=i[i.length-1];r.remainingCount-=s.origCount;if((s=r).remainingCount<0)throw new Error("invalid descendant counts, cannot convert to indentation levels")}var n=Math.abs(e[a]);if(n>0){var o={level:t[t.length-1]+1,origCount:n,remainingCount:n};i.push(o);s=o}a++}if(i.length>0)throw new Error("invalid descendant counts, more input expected")}return t}static addItemsToTree(e,t,i,s,a){for(var r=Math.min(i+s,e.length),n=i;n<r;n++){var o=new Ue(e[n],t[n]),l=Math.abs(o.expandState);if(l>0){Xe.addItemsToTree(e,t,n+1,l,o);n+=l}a.children.push(o)}}static walkTree(e,t){if(t){t(e);var i=0,s=e.children;if(s&&(i=s.length))for(var a=0;a<i;a++){var r=s[a];Xe.walkTree(r,t)}}}static makeElementUnselectable(e){e.setAttribute("unselectable","on");for(var t=e.querySelectorAll("*"),i=0;i<t.length;i++){var s=t[i];switch(s.tagName){case"IFRAME":case"TEXTAREA":case"INPUT":case"SELECT":break;default:s.setAttribute("unselectable","on")}}}static toDecimalLocaleString(e,t,i){var s,a,r,n=function(e,t,i){for(var s=e.length;s<t;s++)e=i?"0"+e:e+"0";return e},o=e.toString(),l="";a=i?i.numberFormat:He.a.NumberFormat;o=(r=o.split(/e/i))[0];s=r.length>1?parseInt(r[1],10):0;o=(r=o.split("."))[0];l=r.length>1?r[1]:"";if(s>0){o+=(l=n(l,s,!1)).slice(0,s);l=l.substr(s)}else if(s<0){l=(o=n(o,(s=-s)+1,!0)).slice(-s,o.length)+l;o=o.slice(0,-s)}l.length>0&&(l=a.numberDecimalSeparator+l);if(!0===t){for(var h=a.numberGroupSizes,d=a.numberGroupSeparator,c=h[0],p=1,u=o.length-1,m="";u>=0;){if(0===c||c>u)return m.length>0?o.slice(0,u+1)+d+m+l:o.slice(0,u+1)+l;m=m.length>0?o.slice(u-c+1,u+1)+d+m:o.slice(u-c+1,u+1);u-=c;if(p<h.length){c=h[p];p++}}return o.slice(0,u+1)+d+m+l}return o+l}static convertValueToDisplayString(e,t){return null!=e?"string"==typeof e?e:"number"==typeof e?t?e.toLocaleString(t):Xe.toDecimalLocaleString(e):"boolean"==typeof e?e?"True":"False":e?e.localeFormat(t||"G"):e.toString():""}static _setTooltip(e,t,i){var s=t.trim();if(s){var a={content:s,height:i};e.setAttribute("data-plugin-vs-tooltip",JSON.stringify(a))}}initialize(){this._element=document.createElement("div");this._element.className=this._options.coreCssClass;this._element.style.height=this._options.height;this.rootElement.appendChild(this._element);this._buildDom();this._contentSize=new Ye(300,400);this._takeMeasurements();this._getChildDataCallback=this._options.childDataCallback||null;this._getLoadMoreChildDataCallback=this._options.loadMoreChildDataCallback||null;this._editCellCallback=this._options.editCellCallback||null;this._rowSelectedCallback=this._options.rowSelectedCallback||null;this._options.asyncInit?window.setTimeout(()=>{this._attachEvents()},10):this._attachEvents();this.initializeDataSource()}findClosestElement(e,t){for(var i=this._element.parentNode,s=e;s&&s!==i;){if(s.msMatchesSelector(t))return s;s=s.parentNode}return s}fireCustomEvent(e,t,i){var s=document.createEvent("Event");s.initEvent(t,!0,!0);s.customData=i;e.dispatchEvent(s)}onAriaExpandedModified(e){if("aria-expanded"===e.attrName){var t=this.getRowInfoFromEvent(e,".grid-row");t&&this.tryToggle("true"===e.newValue,!1,t.dataIndex)}}createElementWithClass(e,t){var i=document.createElement(e);t&&(i.className=t);return i}_getId(){return Xe.TYPE_NAME+this._gridInstanceNumber}_enhance(e){this._buildDom()}_buildDom(){var e=document.createDocumentFragment(),t=this._options.gutter,i=t&&(t.icon||t.checkbox);this._canvas=document.createElement("div");this._canvas.className="grid-canvas";this._contentSpacer=document.createElement("div");this._contentSpacer.className="grid-content-spacer";this._canvas.appendChild(this._contentSpacer);if(this._options.header){this._element.classList.add("has-header");this._header=document.createElement("div");this._header.className="grid-header";this._headerCanvas=document.createElement("div");this._headerCanvas.className="grid-header-canvas";this._header.appendChild(this._headerCanvas);e.appendChild(this._header)}if(i){this._element.classList.add("has-gutter");this._gutter=document.createElement("div");this._gutter.className="grid-gutter";t&&t.backgroundColor&&(this._gutter.style.backgroundColor=t.backgroundColor);this._canvas.appendChild(this._gutter);if(this._header){this._gutterHeader=document.createElement("div");this._gutterHeader.className="grid-gutter-header";this._gutterHeader.classList.add("grid-header-column");this._header.appendChild(this._gutterHeader);var s=this.createElementWithClass("div","sort-handle");this._gutterHeader.appendChild(s);this.setGutterHeaderSortOrder()}}e.appendChild(this._canvas);this._element.appendChild(e);this._ariaColumns="";for(var a=0;a<this._options.columns.length;a++){var r=this._options.columns[a];this._ariaColumns&&(this._ariaColumns+=", ");this._ariaColumns+=r.text}this._updateGridAriaLabel()}_updateGridAriaLabel(){var e="";(e+=this._options.ariaTitle||"")&&(e+=", ");(e+=this._ariaColumns||"")&&(e+=", ");e+=this._ariaDescription||"";this._element.setAttribute("aria-label",e)}setGutterHeaderSortOrder(){if(this._sortOrder&&0!==this._sortOrder.length&&this._options.gutter.headerClickSortColumn)if(this._options.allowSortOnMultiColumns){for(var e=!1,t=0;t<this._sortOrder.length;t++){if((i=this._sortOrder[t]).index===this._options.gutter.headerClickSortColumn.index){e=!0;this._setSortOrderClass(this._gutterHeader,i.order)}}e||this._setSortOrderClass(this._gutterHeader,"none")}else{var i;(i=this._sortOrder[0]).index===this._options.gutter.headerClickSortColumn.index?this._setSortOrderClass(this._gutterHeader,i.order):this._setSortOrderClass(this._gutterHeader,"none")}}_attachEvents(){window.addEventListener("resize",e=>this._onContainerResize(e));this._element.addEventListener("keydown",e=>this._onKeyDown(e));this._canvas.addEventListener("mousedown",e=>this._onRowMouseDown(e));this._canvas.addEventListener("dblclick",e=>this._onEditCell(e));this._canvas.addEventListener("scroll",e=>this._onCanvasScroll(e));this._canvas.addEventListener("selectstart",function(){return!1});this._canvas.addEventListener("focusin",e=>{this._canvasContainsFocus=!0});this._canvas.addEventListener("focusout",e=>{this._canvasContainsFocus=!1});if(this._header){this._header.addEventListener("mousedown",e=>this._onHeaderMouseDown(e));this._header.addEventListener("mouseup",e=>this._onHeaderMouseUp(e));this._header.addEventListener("click",e=>this._onHeaderClick(e));this._header.addEventListener("dblclick",e=>this._onHeaderDblClick(e))}if(this._gutter){this._gutterHeader&&this._gutterHeader.addEventListener("click",e=>{this._sortBy(this._options.gutter.headerClickSortColumn,!1);this.setGutterHeaderSortOrder()});this._gutter.addEventListener("click",e=>this._onGutterClick(e));this._gutter.addEventListener("mouseover",e=>{var t=this.findClosestElement(e.target,".grid-gutter-row");t&&t.classList.add("grid-gutter-row-hover")});this._gutter.addEventListener("mouseout",e=>{var t=this.findClosestElement(e.target,".grid-gutter-row");t&&t.classList.remove("grid-gutter-row-hover")})}}_mergeExpandStates(e,t,i,s){var a=s.length-1;i.splice(t,1);for(var r=0;r<=a;r++)i.splice(t+r,0,s[r]);var n=0;for(r=e;r>=0;r--){var o=i[r];if(Math.abs(o)>n){i[r]=o<0?o-a:o+a;n=0}else n++}}_takeMeasurements(){var e=this._options.coreCssClass;this._options.cssClass&&(e+=" "+this._options.cssClass);var t=this.createElementWithClass("div",e);t.style.position="absolute";t.style.left="-5000px";t.style.top="-5000px";t.style.width="1000px";t.style.height="500px";document.body.appendChild(t);var i=this.createElementWithClass("div","grid-row grid-row-normal");t.appendChild(i);var s=this.createElementWithClass("div","grid-cell");s.style.width="100px";s.innerText="1";i.appendChild(s);this._measurements.rowHeight=i.offsetHeight;this._measurements.cellOffset=s.offsetWidth-100;var a=this.createElementWithClass("div");a.style.overflow="hidden";a.style.width="1em";a.style.height="1ex";s.appendChild(a);this._measurements.unitEx=a.offsetHeight;var r=this.createElementWithClass("div","grid-gutter");r.appendChild(this.createElementWithClass("div","grid-gutter-row"));t.appendChild(r);this._gutter?this._measurements.gutterWidth=r.clientWidth:this._measurements.gutterWidth=0;document.body.removeChild(t)}_layoutAfterSetDataSource(e){this.layout();-1!==e&&this._ensureSelectedIndex(e)}_adjustForDynamicData(e,t,i,s,a){if(a){var r={hasMoreText:a};e.push(r);t.push(0)}this._dataSource.splice(s,1);for(var n=0;n<e.length;n++)this._dataSource.splice(s+n,0,e[n]);this._mergeExpandStates(i,s,this._expandStates,t);var o=this._dataSource.length;this._count=o;this._expandStates?this._indentLevels=Xe.expand(this._expandStates):this._indentLevels=null;this._expandedCount=o;this._updateRanges();this._clearSelection();this._determineIndentIndex();this.layout()}_ensureSelectedIndex(e,t){var i=this._selectedIndex;"number"==typeof e&&(this._selectedIndex=e);if(this._selectedIndex>=0){this._count<=this._selectedIndex&&(this._selectedIndex=this._count-1);(this._selectedIndex!==i||t)&&this._addSelection(this._selectedIndex)}}_determineIndentIndex(){var e,t,i=this._columns;for(e=0,t=i.length;e<t;e++)if(i[e].indent){this._indentIndex=e;return}this._indentIndex=0}_getDataIndex(e){var t,i,s,a=-1,r=this._visibleRange;if(e<0)return-1;for(t=0,i=r.length;t<i;t++)if(e<=(a+=(s=r[t]).end-s.start+1))return s.end-a+e;return e}_getRowIndex(e){var t,i,s,a=0,r=this._visibleRange;for(t=0,i=r.length;t<i&&e>=(s=r[t]).start;t++){if(e<=s.end)return a+e-s.start;a+=s.end-s.start+1}return-Math.max(0,a-1)}_updateRanges(){var e=0,t=0,i=this._count,s=[],a=0;if(this._expandStates){for(;e<i;){var r=this._expandStates[e];if(r<0){s[s.length]=new Je(t,e);a+=e-t+1;t=e+=1-r}else e++}if(t<i){s[s.length]=new Je(t,i-1);a+=i-t}}else{a=i;s[s.length]=new Je(0,a)}this._expandedCount=a;this._visibleRange=s}_updateExpansionStateAndRedraw(e){var t,i=this._selectedIndex;i>=0&&(t=this._getDataIndex(i));e();if(i>=0){this._clearSelection();this._addSelection(Math.abs(this._getRowIndex(t)))}this._layoutContentSpacer();this._redraw()}_getVisibleRowIndices(){var e=this._scrollTop,t=e+this._canvasHeight,i=this._expandedCount-1,s=this._measurements.rowHeight||1;return{first:Math.min(i,Math.max(0,Math.ceil(e/s))),last:Math.min(i,Math.floor(t/s)-1)}}_getRowIntoView(e,t){if(t){this._canvas.scrollTop=Math.max(0,Math.min(e||0,this._expandedCount-1))*this._measurements.rowHeight;return!0}var i=this._getVisibleRowIndices(),s=i.first,a=i.last,r=a-s;if(e<s||e>a){s=this._selectedIndex>s?Math.max(e-r,0):Math.max(0,Math.min(e+r,this._expandedCount-1)-r);this._canvas.scrollTop=s*this._measurements.rowHeight;return!0}return!1}_updateViewport(e){var t=this._count,i=[],s=[],a=[],r=this._expandStates||[],n=this._expandedCount-1,o=this._getVisibleRowIndices(),l=o.first,h=o.last;l=Math.max(0,l-this._options.extendViewportBy);h=Math.min(n,h+this._options.extendViewportBy);for(var d=Math.max(0,l-this._options.payloadSize),c=Math.min(n,h+this._options.payloadSize),p=this._getDataIndex(d),u=d;u<=c&&p<t;u++){if(u<l)i[i.length]=new qe(u,p);else if(u>h)s[s.length]=new qe(u,p);else{a[a.length]=new qe(u,p);u}var m=r[p];m<0?p+=1-m:p++}this.cacheRows(i,a,s);this._drawRows(a,e);if(this._updateAriaOnViewportUpdate){this._updateAriaOnViewportUpdate=!1;this._updateAriaAttribute()}}_cleanUpRows(){var e=this._rows,t=this._gutter;for(var i in e){var s=e[i];s.row.parentElement&&s.row.parentElement.removeChild(s.row);t&&s.gutterRow.parentElement&&s.gutterRow.parentElement.removeChild(s.gutterRow)}this._rows={}}_drawRows(e,t){var i,s,a=this._expandStates,r=0,n=this._indentLevels,o=0,l=this._gutter,h=this._canvas,d=document.createDocumentFragment(),c=null;if(l){i=this._gutter;c=document.createDocumentFragment()}var p=this._rows,u={};this._rows=u;for(var m=e.length,g=0;g<m;g++){var _=e[g],f=_.rowIndex,S=_.dataIndex,b=p[S];if(b){if(s=b.rowIndex!==f)b.rowIndex=f;else{s=b.isDirty;delete b.isDirty}t&&(s=!0);delete p[S]}else{s=!0;var C=this.createElementWithClass("div","grid-row grid-row-normal");C.id="row_"+this._getId()+"_"+f;d.appendChild(C);var v={rowIndex:f,dataIndex:S,row:C};if(l){var w=this.createElementWithClass("div","grid-gutter-row");c.appendChild(w);this._rowInfoMap.set(w,v);v.gutterRow=w}this._rowInfoMap.set(C,v);b=v;C.onfocus=this._onFocus.bind(this);C.onblur=this._onBlur.bind(this);C.ondblclick=this._onToggle.bind(this,v)}u[S]=b;if(s){if(a){r=a[S];o=n[S]}this._updateRow(b,f,S,r,o)}}for(var y in p){b=p[y];if(l){this._rowInfoMap.delete(b.gutterRow);b.gutterRow.parentElement.removeChild(b.gutterRow)}this._rowInfoMap.delete(b.row);b.row.parentElement.removeChild(b.row)}h.appendChild(d);l&&i.appendChild(c)}_setSortOrderClass(e,t){if("asc"===t){e.classList.remove("descending");e.classList.add("ascending")}else if("desc"===t){e.classList.remove("ascending");e.classList.add("descending")}else if("none"===t){e.classList.remove("ascending");e.classList.remove("descending")}}_updateRow(e,t,i,s,a){var r=this._indentIndex;if(this._gutter){var n=this._options.gutter,o=e.gutterRow;o.style.top=t*this._measurements.rowHeight+"px";o.style.left="0px";o.style.width=this._measurements.gutterWidth+"px";o.style.height=this._measurements.rowHeight+"px";o.innerHTML="";if(n.checkbox){var l=this.createElementWithClass("input","checkbox "+(n.checkbox.cssClass||""));l.setAttribute("type","checkbox");var h=this.createElementWithClass("div","grid-gutter-cell grid-gutter-checkbox");h.appendChild(l[0]);o.appendChild(h)}if(n.icon){var d="grid-gutter-cell grid-gutter-icon ";void 0!==n.icon.cssClass&&(d+=n.icon.cssClass+" ");void 0!==n.icon.index&&(d+=(this.getColumnValue(i,n.icon.index,-1)||"")+" ");n.icon.gutterIconCssCallback&&(d+=n.icon.gutterIconCssCallback(i,this._dataSource)||"");var c=this.createElementWithClass("div",d);if(n.getTooltip){var p=n.getTooltip(i,this._dataSource);p&&Xe._setTooltip(c,p,16)}o.appendChild(c)}this._drawGutterCell(e,t,i,s,a)}var u=e.row;u.innerHTML="";u.style.top=t*this._measurements.rowHeight+"px";u.style.left=this._measurements.gutterWidth+"px";u.style.height=this._measurements.rowHeight+"px";u.style.width=isNaN(this._contentSize.width)?"":this._contentSize.width+2+"px";for(var m=this._columns,g=0,_=m.length;g<_;g++){var f=m[g];if(!f.hidden){var S=f.getCellContents(e,i,s,a,f,r,g);S&&u.appendChild(S)}}Xe.makeElementUnselectable(u);this._gutter&&Xe.makeElementUnselectable(o);this._updateRowSelectionStyle(e,this._selectedRows,this._selectedIndex);u.removeEventListener("DOMAttrModified",this._onAriaExpandedModifiedHandler);if(0!==s){u.setAttribute("aria-expanded",s>0?"true":"false");u.addEventListener("DOMAttrModified",this._onAriaExpandedModifiedHandler)}}_drawGutterCell(e,t,i,s,a){}_drawCell(e,t,i,s,a,r,n){var o,l,h=a.width||20,d=this.createElementWithClass("div","grid-cell");d.style.width=isNaN(h)?String(h):h+"px";var c,p=this._dataSource[t],u=!!(a.hasMoreColumn&&p&&p.hasMoreText);if(a.cellDecorator&&!u){var m=this._dataSource[t];a.cellDecorator(d,m)}else{if(u){o=this._onHasMoreClick.bind(this,p);l=p.hasMoreText}else{void 0!==a.hrefIndex&&(o=this.getColumnValue(t,a.hrefIndex,-1));l=this.getColumnText(t,a,n);c=this.getColumnText(t,a,n,!0)}a.hasHTMLContent||Xe._setTooltip(d,c||l,65);if(o){var g=document.createElement("a");"function"==typeof o?g.onclick=o:g.setAttribute("href",o);g.textContent=l;d.appendChild(g)}else l?a.hasHTMLContent?d.innerHTML=l:d.textContent=l:d.innerHTML="&nbsp;"}if(n===r&&s>0){var _=16*s-13;a.indentOffset=_;if(0!==i){var f=this.createElementWithClass("div","icon grid-tree-icon");f.style.left=_+"px";d.appendChild(f);i>0?f.classList.add("icon-tree-expanded"):f.classList.add("icon-tree-collapsed")}d.style.textIndent=16*s+"px"}if(a.getCellCSSClass){var S=a.getCellCSSClass(t,a.index,n,this._dataSource);if(S)for(var b=S.trim().split(" "),C=0;C<b.length;C++)d.classList.add(b[C])}a.rowCss&&d.classList.add(a.rowCss);return d}_drawHeader(){var e=this._columns,t=this._sortOrder;if(this._header){for(var i=document.createDocumentFragment(),s=0,a=e.length;s<a;s++){var r=e[s];if(!r.hidden){var n=this.createElementWithClass("div","grid-header-column");Xe._setTooltip(n,r.tooltip,65);n.style.width=(r.width||20)+"px";n._data={columnIndex:s,header:!0};var o=this.createElementWithClass("div","separator");r.fixed&&(o.style.cursor="auto");o._data={columnIndex:s,separator:!0};n.appendChild(o);var l=r.getHeaderCellContents(r,s);r.headerCss&&l.classList.add(r.headerCss);r.tooltip&&Xe._setTooltip(l,r.tooltip,65);n.appendChild(l);var h=this.createElementWithClass("div","sort-handle");t.forEach((e,t,i)=>{if(e.index===r.index){this._setSortOrderClass(n,e.order);return!1}});this.setGutterHeaderSortOrder();n.appendChild(h);i.appendChild(n)}}this._headerCanvas.innerHTML="";this._headerCanvas.appendChild(i);Xe.makeElementUnselectable(this._header)}}_drawHeaderCellValue(e,t){var i=document.createElement("div");i.classList.add("title");i.innerText=e.text||"";t===this._indentIndex&&void 0!==this._indentLevels&&null!==this._indentLevels&&i.classList.add("indented-title");return i}_layoutContentSpacer(){for(var e=0,t=this._columns,i=0,s=t.length;i<s;i++)t[i].hidden||(e+=(t[i].width||20)+this._measurements.cellOffset);e+=2;var a=Math.max(1,this._expandedCount*this._measurements.rowHeight);this._contentSpacer.style.width=e+"px";this._contentSpacer.style.height=a+"px";this._gutter&&(this._gutter.style.height=a+"px");this._ignoreScroll=!0;try{var r=Math.max(0,Math.min(this._scrollTop,a-this._canvasHeight));if(r!==this._scrollTop){this._scrollTop=r;this._canvas.scrollTop=r}var n=Math.max(0,Math.min(this._scrollLeft,e-this._canvasWidth));if(n!==this._scrollLeft){this._scrollLeft=n;this._canvas.scrollLeft=n}}finally{this._ignoreScroll=!1}this._contentSize.width=e;this._contentSize.height=a}_layoutHeader(){this._header&&(this._headerCanvas.style.left=this._measurements.gutterWidth-this._scrollLeft+"px");this._gutter&&(this._gutter.style.left=this._scrollLeft+"px")}_fixScrollPos(){var e=this._ignoreScroll;this._ignoreScroll=!0;try{this._canvas.scrollLeft=this._scrollLeft;this._canvas.scrollTop=this._scrollTop}finally{this._ignoreScroll=e}}_redraw(e){this._layoutHeader();this._updateViewport(e)}_getExpandState(e){var t=0;this._expandStates&&"number"==typeof this._expandStates[e]&&(t=this._expandStates[e]);return t}_selectRow(e,t,i){var s=i&&i.ctrl,a=i&&i.shift,r=i&&i.rightClick;if(s)this._addSelection(e,t,{toggle:!0});else if(a){this._clearSelection();this._addSelectionRange(e,t)}else if(r)if(this._selectedRows&&this._selectedRows.hasOwnProperty(e)){this._selectedIndex=e;this._updateAriaAttribute()}else{this._clearSelection();this._addSelection(e,t)}else{this._clearSelection();this._addSelection(e,t)}}_selectAll(){if(this._count>0&&!1!==this._options.allowMultiSelect){this._clearSelection();this._selectionStart=0;var e=Math.max(0,this._selectedIndex);this._addSelectionRange(this._count-1,void 0,{doNotFireEvent:!0});this._selectedIndex=e;this._updateSelectionStyles();this._selectionChanged()}}_clearSelection(){this._selectionCount=0;this._selectedRows=null}_addSelection(e,t,i){var s=i&&i.keepSelectionStart,a=i&&i.doNotFireEvent,r=i&&i.toggle,n=!1;if(!1===this._options.allowMultiSelect){s=!1;n=!!this._selectedRows&&this._selectedRows.hasOwnProperty(e);this._clearSelection()}if(!n){this._selectedRows||(this._selectedRows={});if(e>=0){var o=!0;if(this._selectedRows.hasOwnProperty(e)){if(r){o=!1;this._selectionCount=Math.max(0,this._selectionCount-1);delete this._selectedRows[e]}}else this._selectionCount++;"number"!=typeof t&&(t=this._getDataIndex(e));o&&(this._selectedRows[e]=t);this._selectedIndex=e;this._updateAriaAttribute();(this._selectionStart<0||!s)&&(this._selectionStart=e)}else{t=-1;this._selectedIndex=-1}}if(!a){this._updateSelectionStyles();this._selectionChanged();this._selectedIndexChanged(this._selectedIndex,t)}}_addSelectionRange(e,t,i){var s,a=i&&i.doNotFireEvent,r=-1;if(!1===this._options.allowMultiSelect)this._addSelection(e,t);else{this._selectedRows&&(r=this._selectedRows[this._selectedIndex]);this._selectionStart<0&&(this._selectionStart=e);var n=Math.min(this._selectionStart,e),o=Math.max(this._selectionStart,e);"number"==typeof t&&n===e||(t=this._getDataIndex(n));for(var l=n;l<=o;l++){this._addSelection(l,t,{keepSelectionStart:!0,doNotFireEvent:!0});l===e&&(s=t);var h=this._getExpandState(t);h<0?t+=1-h:t++}this._selectedIndex=e;this._updateAriaAttribute();if(!a){this._updateSelectionStyles();this._selectionChanged();r!==s&&this._selectedIndexChanged(this._selectedIndex,s)}}}_updateAriaAttribute(){var e=this._getDataIndex(this._selectedIndex);if(e>=0){var t=this.getRowInfo(e);if(t&&t.row){var i=t.row.getAttribute("id");if(i!==this._activeAriaId){var s=this._getAriaLabelForRow(t);t.row.setAttribute("aria-label",s);this._activeAriaId=i}t.row.focus()}else this._updateAriaOnViewportUpdate=!0}}_getAriaLabelForRow(e){var t="",i=(e.rowIndex,e.dataIndex);if(this._expandStates){this._expandStates[i];this._indentLevels[i]}if(this._gutter){var s=this._options.gutter;if(s.getTooltip){var a=s.getTooltip(i,this._dataSource);if(a){t&&(t+=", ");t+=a}}}for(var r=this._columns,n=0,o=r.length;n<o;n++){var l=r[n];if(!l.hidden){var h=this.getColumnText(i,l,n);t&&(t+=", ");t+=h}}return t}_updateSelectionStyles(){this._delayedUpdateCookie&&window.clearTimeout(this._delayedUpdateCookie);this._delayedUpdateCookie=window.setTimeout(()=>{var e,t=this._selectedRows,i=this._selectedIndex,s=this._rows;for(e in s){var a=s[e];this._updateRowSelectionStyle(a,t,i)}},10)}_selectionChanged(){this.selectionChanged(this._selectedIndex,this._selectionCount,this._selectedRows);this.fireCustomEvent(this._element,"selectionchanged",[{selectedIndex:this._selectedIndex,selectedCount:this._selectionCount,selectedRows:this._selectedRows}])}_selectedIndexChanged(e,t){this.selectedIndexChanged(e,t);this.fireCustomEvent(this._element,Xe.EVENT_SELECTED_INDEX_CHANGED,[e,t])}_updateRowSelectionStyle(e,t,i){var s=e.rowIndex,a=e.row,r=e.gutterRow;a.classList.remove("grid-row-selected");a.classList.remove("grid-row-selected-blur");a.classList.remove("grid-row-current");a.setAttribute("tabindex","-1");if(r){(n=r.querySelector("input.checkbox"))&&n.setAttribute("checked",String(!1))}if(t&&t.hasOwnProperty(s)){if(r){var n;(n=r.querySelector("input.checkbox"))&&n.setAttribute("checked",String(!1))}this._active?a.classList.add("grid-row-selected"):a.classList.add("grid-row-selected-blur")}if(s===i){a.classList.add("grid-row-current");this._rowSelectedCallback&&this._rowSelectedCallback()}}_measureCanvasSize(){this._canvasHeight=this._canvas.clientHeight;this._canvasWidth=this._canvas.clientWidth}_onContainerResize(e){this.layout()}_setupMoveEvents(){document.addEventListener("mousemove",e=>this._onDocumentMouseMove(e));document.addEventListener("mouseup",e=>this._onDocumentMouseUp(e))}_clearMoveEvents(){document.removeEventListener("mousemove",null,!0);document.removeEventListener("mouseup",null,!0)}_onDocumentMouseMove(e){var t=this._columnSizing;if(t&&!0===t.active){var i=e.pageX-t.origin,s=Math.max(15,t.originalWidth+i);this._columns[t.index].width=s;this._applyColumnSizing(t.index);this._moveSizingElement(t.index)}}_onDocumentMouseUp(e){window.setTimeout(()=>{this._tryFinishColumnSizing(!1)},0);return!1}_onHeaderMouseDown(e){if(1!==e.which)return!0;var t=this.findClosestElement(e.target,".separator");if(t&&t._data){var i=t._data.columnIndex,s=this._columns[i];if(!s.fixed){this._columnSizing=new Qe(!0,i,s.width,e.pageX);this._moveSizingElement(i);this._setupMoveEvents();e.stopImmediatePropagation();e.preventDefault();return!1}}}_onHeaderMouseUp(e){return!1}_onHeaderClick(e){var t=this.findClosestElement(e.target,".grid-header-column");if(t&&!this._columnSizing){var i=this.findClosestElement(e.target,".separator");if(i&&i._data)return!1;if(t._data){var s=t._data.columnIndex,a=this._columns[s];a.canSortBy&&!a.fixed&&this._sortBy(a,e.shiftKey)}}}_onHeaderDblClick(e){var t=this.findClosestElement(e.target,".separator");if(t&&t._data){this._tryFinishColumnSizing(!0);var i=t._data.columnIndex,s=this._columns[i],a=Math.max(s.maxLength||0,3),r=1.1+.7*Math.exp(-a/20),n=s.width;s.width=(s.indentOffset||0)+Math.round(a*r*this._measurements.unitEx);this._applyColumnSizing(i,n,!0);return!1}}_onHasMoreClick(e){for(var t,i,s,a=0;a<this._dataSource.length;a++)if(this._dataSource[a]===e){s=a;break}if(void 0!==s){if(s<this._expandStates.length)for(a=s-1;a>=0;a--){if(Math.abs(this._expandStates[a])>=s-a){i=a;break}}if(void 0!==i){t=this._dataSource[i];var r=this.getExpansionPath(i);this._getLoadMoreChildDataCallback(t,r,(e,t)=>{null!==e&&this._adjustForDynamicData(e.itemsWithPlaceholders,e.expandStates,i,s,t)})}}}_moveSizingElement(e){var t=this._measurements.gutterWidth;if(!this._sizingElement){if(e<0)return;this._sizingElement=this.createElementWithClass("div","grid-column-sizing");this._canvas.appendChild(this._sizingElement)}this._sizingElement.style.height=this._canvas.clientHeight-1+"px";this._sizingElement.style.top=this._scrollTop+"px";if(e<0){this._sizingElement.style.left="-5000px";this._sizingElement.style.top="-5000px";this._sizingElement.style.height="0px"}else{for(var i=0;i<=e;){var s=this._columns[i++];s.hidden||(t+=s.width)}this._sizingElement.style.left=t-1+"px"}}_getVisibleColumnIndex(e){var t=0,i=0;length=this._columns.length;if(this._columns[e].hidden)return-1;for(;t<e;){this._columns[t].hidden||i++;t++}return i}_applyColumnSizing(e,t,i){var s=this._getVisibleColumnIndex(e)+1,a=this._columns[e],r=!1;t=t||-1;if(a){r=a.width!==t;this.rootElement.querySelector(".grid-header-canvas .grid-header-column:nth-child("+s+")").style.width=a.width+"px"}if(!0===i){r&&this.layout();this._onColumnResize(a)}}_onColumnResize(e){this.fireCustomEvent(this._element,"columnresize",[e])}_tryFinishColumnSizing(e){var t=this._columnSizing;if(t){if(!0===t.active){e||this._applyColumnSizing(t.index,t.originalWidth,!0);this._moveSizingElement(-1)}this._columnSizing=null;this._clearMoveEvents()}}_getSortColumns(e){for(var t=this._columns,i=[],s=0,a=e.length;s<a;s++){var r,n=e[s];t.forEach(function(e,t,i){if(e.index===n.index){r=e;return!1}});i.push(r)}return i}_sortBy(e,t){var i=this._sortOrder.slice(0),s=!1;if(e){for(var a=0,r=i.length;a<r;a++){if((n=i[a]).index===e.index){i.splice(a,1);s=!0;break}}var n;n=s?new Be(n.index,"asc"===n.order?"desc":"asc"):new Be(e.index,"asc");t&&this._options.allowSortOnMultiColumns?i.push(n):i=[n]}var o=this._getSortColumns(i);this._onSort(i,o)}_onSort(e,t){!1!==this.onSort(e,t)&&this.fireCustomEvent(this._element,"sort",[{sortOrder:e,sortColumns:t}])}_trySorting(e,t){t||(t=this._getSortColumns(e));var i=[],s=0;for(var a in this._selectedRows){var r=this._selectedRows[a],n=this._dataSource[r];if(n){i.push(n);s+=parseInt(a)}}var o=new Ue(null,null);Xe.addItemsToTree(this._dataSource,this._expandStates,0,this._dataSource.length,o);this._sortOrder&&1===this._sortOrder.length&&1===e.length&&this._sortOrder[0]!==e[0]&&this._sortOrder[0].index===e[0].index?this._sortOrder[0].order!==e[0].order&&Xe.walkTree(o,i=>{ze.stableReverse(i.children,(i,s)=>ze.sortComparer(e,t,i.data,s.data))}):Xe.walkTree(o,i=>{i.children.sort((i,s)=>ze.sortComparer(e,t,i.data,s.data))});this._dataSource=[];this._expandStates=[];for(var l=0;l<o.children.length;l++)Xe.walkTree(o.children[l],e=>{this._dataSource.push(e.data);this._expandStates.push(e.expandState)});this._indentLevels=Xe.expand(this._expandStates);this._updateRanges();if(this._selectionCount>0){this._clearSelection();var h=0;for(l=0;l<i.length;l++){if((r=this._dataSource.indexOf(i[l]))>=0){var d=this._getRowIndex(r);this._addSelection(d,r);h+=d}}this._scrollTop+=(h-s)/this._selectionCount*this._measurements.rowHeight}}_onCanvasScroll(e){var t=this._canvas;this._resetScroll=!0;this._scrollLeft=t.scrollLeft;this._scrollTop=t.scrollTop;this._ignoreScroll||this._redraw();return!1}_getClickedCell(e){return this.findClosestElement(e.target,".grid-cell")}_createEditCellBox(e,t,i,s){var a=i.innerText,r=this.createElementWithClass("input","grid-edit-box");r.setAttribute("type","text");r.setAttribute("value",a);function n(a){var n=r.value;i.innerText=n;if(s){s(n,e,t);a.stopPropagation();a.preventDefault();return!1}}r.addEventListener("focusout",function(e){n(e)});r.addEventListener("keydown",function(e){if(13===e.keyCode)n(e);else if(27===e.keyCode){i.innerText=a;e.stopPropagation();e.preventDefault();return!1}});i.innerHTML="";i.appendChild(r);r.select();r.focus()}_onEditCell(e){if(!e.target.classList.contains("grid-tree-icon")){var t=this._getClickedCell(e);if(t&&t.classList.contains("grid-cell-editable")){var i=this.getRowInfoFromEvent(e,".grid-row");if(i){for(var s=i.row.children,a=s.length,r=-1,n=0;n<a;n++)t===s[n]&&(r=n);this._createEditCellBox(i.dataIndex,r,t,this._editCellCallback)}}}}_onRowMouseDown(e){var t=this.getRowInfoFromEvent(e,".grid-row");if(t){var i=e.target;1===e.which&&i.classList.contains("grid-tree-icon")?this._onToggle(t):3===e.which&&this._options&&this._options.disableRightClickSelection||this._selectRow(t.rowIndex,t.dataIndex,{ctrl:e.ctrlKey,shift:e.shiftKey,rightClick:3===e.which})}}_onGutterClick(e){var t=this.getRowInfoFromEvent(e,".grid-gutter-row");t&&(this._selectedRows&&"number"==typeof this._selectedRows[t.rowIndex]||this._selectRow(t.rowIndex,t.dataIndex))}_onBlur(e){if(e.target.classList.contains("grid-edit-box"))e.stopPropagation();else{this._active=!1;this._updateSelectionStyles()}}_onFocus(e){if(e.target.classList.contains("grid-edit-box"))e.stopPropagation();else{this._active=!0;this._updateSelectionStyles();this._updateAriaAttribute()}}_onKeyDown(e){var t={lo:-1,hi:-1},i=this._canvas;if(this._options.isGridDisabled)return!1;if(this._copyInProgress){27===e.keyCode&&this._cancelable&&this._cancelable.cancel();return!1}this._count>0&&(t={lo:0,hi:this._expandedCount-1});var s=!1;switch(e.keyCode){case 65:if(!e.ctrlKey)return!0;e.preventDefault();this._selectAll();break;case 40:this._clearSelection();if(e.ctrlKey){e.preventDefault();e.shiftKey?this._addSelectionRange(t.hi):this._addSelection(t.hi)}else if(e.shiftKey){e.preventDefault();this._addSelectionRange(Math.min(this._selectedIndex+1,t.hi))}else this._addSelection(Math.min(this._selectedIndex+1,t.hi));break;case 38:this._clearSelection();if(e.ctrlKey){e.preventDefault();e.shiftKey?this._addSelectionRange(t.lo):this._addSelection(t.lo)}else if(e.shiftKey){e.preventDefault();this._addSelectionRange(Math.max(this._selectedIndex-1,t.lo))}else this._addSelection(Math.max(this._selectedIndex-1,t.lo));break;case 34:case 33:var a=i.clientHeight,r=Math.floor(a/this._measurements.rowHeight);this._clearSelection();34===e.keyCode?e.shiftKey?this._addSelectionRange(Math.min(this._selectedIndex+r,t.hi)):this._addSelection(Math.min(this._selectedIndex+r,t.hi)):e.shiftKey?this._addSelectionRange(Math.max(this._selectedIndex-r,t.lo)):this._addSelection(Math.max(this._selectedIndex-r,t.lo));break;case 39:if(this.tryToggle(!0,e.shiftKey)||0===this._expandStates[this._getDataIndex(this._selectedIndex)]){this._clearSelection();this._addSelection(this._selectedIndex)}else this._addSelection(Math.min(this._selectedIndex+1,t.hi));break;case 37:if(this.tryToggle(!1,e.shiftKey)){this._clearSelection();this._addSelection(this._selectedIndex)}else{var n=this._selectedIndex;if(null!==this._indentLevels)for(var o=this._indentLevels[this._getDataIndex(this._selectedIndex)];o>1&&n>t.lo&&this._indentLevels[this._getDataIndex(n)]>=o;)--n;this._addSelection(Math.max(n,t.lo))}break;case 36:this._clearSelection();e.shiftKey?this._addSelectionRange(t.lo):this._addSelection(t.lo);break;case 35:this._clearSelection();e.shiftKey?this._addSelectionRange(t.hi):this._addSelection(t.hi);break;case 9:document.activeElement!==this.getElement()&&this.getElement().focus();s=!0;break;default:s=!0}this.getSelectedRowIntoView();s||e.preventDefault();return!1}_onToggle(e){if(this._expandStates){var t=this._expandStates[e.dataIndex];if(0!==t){t>0?this.collapseNode(e.dataIndex):t<0&&this.expandNode(e.dataIndex);this._clearSelection();this._addSelection(Math.min(e.rowIndex,this._expandedCount-1),e.dataIndex);this._layoutContentSpacer();this._redraw()}}}}Xe.TYPE_NAME="GridControl";Xe.MAX_COPY_SIZE=1e3;Xe.PAYLOAD_SIZE=200;Xe.EVENT_SELECTED_INDEX_CHANGED="selectedIndexChanged";Xe.GlobalGridInstanceNumber=0;var Ze=i(80),$e=i(129),et=i(86),tt=i(20),it=i(31),st=i(40);class at extends Q.a{constructor(e,t,i,s){super(e);this._direction=null;this._minSize="number"==typeof t&&t>0?t:at._gridSplitterDefaultMinSize;this._scrollableContainer=i;this._callback=s;this.rootElement.contains(at._gridSplitterClass)||this.rootElement.classList.add(at._gridSplitterClass);this._resizerDisplay=document.createElement("div");this._resizerDisplay.className=at._gridSplitterClass+" "+at._gridSplitterResizerClass;this._resizerDisplay.style.position="relative";this._resizerDisplay.style.display="none";this.rootElement.appendChild(this._resizerDisplay);this.rootElement.addEventListener("mousedown",this.onMouseDown.bind(this))}get direction(){null===this._direction&&(this._direction=this.getSplitterDirection());return this._direction}get gridCSS(){this._gridCSS||(this._gridCSS=this.getParentGridCSS());return this._gridCSS}getSplitterDirection(){var e;e=this.rootElement.classList.contains(at._gridSplitterVerticalClass)?1:this.rootElement.classList.contains(at._gridSplitterHorizontalClass)?0:this.rootElement.clientWidth>this.rootElement.clientHeight?1:0;var t=window.getComputedStyle(this.rootElement);if(1===e){this._gridIndex=parseInt(t.msGridRow,10)-1;this._resizerDisplay.className+=" "+at._gridSplitterClass+"-Vertical"}else{this._gridIndex=parseInt(t.msGridColumn,10)-1;this._resizerDisplay.className+=" "+at._gridSplitterClass+"-Horizontal"}return e}getParentGridCSS(){var e=window.getComputedStyle(this.rootElement.parentElement);return 1===this.direction?e.msGridRows:e.msGridColumns}calculateGridInfo(){this._gridCSS=this.getParentGridCSS();if(!this._gridCSS)throw new Error(Object(l.a)("JSPerf.1019"));this._gridCSSParts=this._gridCSS.split(" ");if(!(this._gridCSSParts.length>=this._gridIndex&&this._gridIndex>0))throw new Error(Object(l.a)("JSPerf.1021"));var e=this._gridCSSParts[this._gridIndex-1],t=this._gridCSSParts[this._gridIndex];if(-1===e.indexOf("px")||-1===t.indexOf("px"))throw new Error(Object(l.a)("JSPerf.1020"));this._gridCSSTotal=parseFloat(e)+parseFloat(t)}onMouseMove(e){var t=1===this.direction?e.pageY:e.pageX,i=this.rootElement.previousElementSibling,s=this.rootElement.nextElementSibling,a=0,r=0;if(1===this.direction){a=i.offsetTop+this._minSize;r=s.offsetTop+s.offsetHeight-this._minSize}else{a=i.offsetLeft+this._minSize;r=s.offsetLeft+s.offsetWidth-this._minSize}if(!this._scrollableContainer){var n=this._scrollableContainer.scrollTop;a-=n;r-=n}var o=t;t<a?o=a:t>r&&(o=r);this._endPosition=o;var l=o-this._startPosition;1===this.direction?this._resizerDisplay.style.top=l+"px":this._resizerDisplay.style.left=l+"px";e.stopImmediatePropagation();e.preventDefault()}onMouseUp(e){this._resizerDisplay.style.display="none";this.rootElement.style.removeProperty("background-color");document.body.style.cursor=this._previousCursor;var t=0,i=0;if(1===this.direction){t=this.rootElement.previousElementSibling.clientHeight;i=this.rootElement.nextElementSibling.clientHeight}else{t=this.rootElement.previousElementSibling.clientWidth;i=this.rootElement.nextElementSibling.clientWidth}var s=(i-(this._endPosition-this._startPosition))/(t+i);if(s>0&&s<1){for(var a=(1-s)*this._gridCSSTotal,r=s*this._gridCSSTotal,n="",o=0;o<this._gridCSSParts.length;o++){o===this._gridIndex-1?n+=a+"fr":o===this._gridIndex?n+=r+"fr":n+=this._gridCSSParts[o];o<this._gridCSSParts.length-1&&(n+=" ")}1===this.direction?this.rootElement.parentElement.style.msGridRows=n:this.rootElement.parentElement.style.msGridColumns=n;this._gridCSS=n;this._callback&&"function"==typeof this._callback&&this._callback()}document.removeEventListener("mousemove",this._mouseMoveListener,!0);document.removeEventListener("mouseup",this._mouseUpListener,!0);e.stopImmediatePropagation();e.preventDefault()}onMouseDown(e){this.calculateGridInfo();this._previousCursor=document.body.style.cursor;document.body.style.cursor=window.getComputedStyle(this.rootElement).cursor;this._startPosition=1===this.direction?e.pageY:e.pageX;this.rootElement.style.backgroundColor="transparent";this._resizerDisplay.style.display="block";this._resizerDisplay.style.top="0";this._resizerDisplay.style.left="0";this._mouseMoveListener=this.onMouseMove.bind(this);this._mouseUpListener=this.onMouseUp.bind(this);document.addEventListener("mousemove",this._mouseMoveListener,!0);document.addEventListener("mouseup",this._mouseUpListener,!0);e.stopImmediatePropagation();e.preventDefault()}}at._gridSplitterClass="gridSplitter";at._gridSplitterResizerClass="gridSplitter-Resizer";at._gridSplitterVerticalClass="gridSplitter-Vertical";at._gridSplitterHorizontalClass="gridSplitter-Horizontal";at._gridSplitterDefaultMinSize=100;class rt{static getDataSource(e,t){switch(e){case pe.roots:return new nt(t);case pe.types:return new ot(t);case pe.dominators:return new lt(t);default:throw new Error(Object(l.a)("JSPerf.1002"))}}}class nt{constructor(e){this.snapshot=e}get hasDetachedDomNodes(){return this.snapshot.hasDetachedDomNodes}getRootHeapDataTreeItem(e,t,i,s,a){return Promise.resolve(this.snapshot.getAllRootObjects(e,t,a))}getHeapDataTreeItem(e,t,i,s,a,r,n){return this.snapshot.getAllChildrenForObject(i,s,e,t,a,r,n,e.showNonMatchingReferences)}getReferenceTreeItems(e,t,i,s,a,r,n,o){return this.snapshot.getReferenceTreeItems(e,t,i,s,a,r)}getAvailableFields(e){var t=[];t.push("name");t.push("type");t.push("size");e?t.push("containsDetachedDomNode"):t.push("isDetachedDomNode");this.snapshot.isDiff&&t.push("sizeDiff");t.push("retainedSize");this.snapshot.isDiff&&t.push("retainedSizeDiff");return t}getAvailableFieldsForReferenceTree(e){return this.getAvailableFields(e)}}class ot{constructor(e){this.snapshot=e}get hasDetachedDomNodes(){return this.snapshot.hasDetachedDomNodes}getRootHeapDataTreeItem(e,t,i,s,a){return this.snapshot.getAllTypes(e,t,a)}getHeapDataTreeItem(e,t,i,s,a,r,n){return this.snapshot.getAllChildrenForObjectOrType(i,s,e,t,a,r,n,e.showNonMatchingReferences)}getReferenceTreeItems(e,t,i,s,a,r,n,o){return this.snapshot.getReferenceTreeItems(e,t,i,s,a,r)}getAvailableFields(e){var t=[];t.push("name");t.push("type");t.push("size");e?t.push("containsDetachedDomNode"):t.push("isDetachedDomNode");this.snapshot.isDiff&&t.push("sizeDiff");t.push("retainedSize");this.snapshot.isDiff&&t.push("retainedSizeDiff");t.push("childrenCount");return t}getAvailableFieldsForReferenceTree(e){var t=[];t.push("name");t.push("type");t.push("size");this.snapshot.isDiff&&t.push("sizeDiff");t.push("retainedSize");return t}}class lt{constructor(e){this.snapshot=e}get hasDetachedDomNodes(){return this.snapshot.hasDetachedDomNodes}getRootHeapDataTreeItem(e,t,i,s,a){return this.snapshot.getAllObjects(e,t,i,s,a)}getHeapDataTreeItem(e,t,i,s,a,r,n){return this.snapshot.getRetainedDescendants(i,n,e,t,a,r)}getReferenceTreeItems(e,t,i,s,a,r,n,o){return this.snapshot.getReferenceTreeItems(e,t,i,s,a,r)}getAvailableFields(e){var t=[];t.push("name");t.push("type");t.push("size");e?t.push("containsDetachedDomNode"):t.push("isDetachedDomNode");this.snapshot.isDiff&&t.push("sizeDiff");t.push("retainedSize");this.snapshot.isDiff&&t.push("retainedSizeDiff");return t}getAvailableFieldsForReferenceTree(e){return this.getAvailableFields(e)}}var ht=i(112),dt=i(19);class ct{static GetName(e,t){var i;if(e)for(var s in e)if(e.hasOwnProperty(s)){if(e[s]===t){i=s;break}}i||(i=t.toString());return i}static Parse(e,t,i=!0){var s;if(e){i&&(t=t.toLowerCase());for(var a in e)if(e.hasOwnProperty(a)){var r=a.toString();i&&(r=r.toLowerCase());if(t===r){s=e[a];break}}}return s}static GetValues(e){var t=[];if(e)for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];"number"==typeof s&&t.push(s)}return t}}class pt extends he{constructor(e){super();this._snapshotDataViewController=e;this.title=Object(l.b)(ct.GetName(pe,this._snapshotDataViewController.dataViewModel.viewType));this.tooltipString=Object(l.b)(ct.GetName(pe,this._snapshotDataViewController.dataViewModel.viewType)+"Tooltip");this.content=this._snapshotDataViewController.view}get controller(){return this._snapshotDataViewController}onActiveChanged(){if(this.active){this._snapshotDataViewController.setSnapshotDataSource();window.setImmediate(()=>{this.header.rootElement===document.activeElement||this._snapshotDataViewController.setFocusOnGrid()})}}}class ut{constructor(e){this._storageId=e;this._navigationId=J.getNextId();this.model=new mt;this.view=new gt(this,this.model)}get currentDataViewController(){return this.view.currentDataViewController}get navigationId(){return this._navigationId}static getHashKey(e){for(var t=0,i=0;i<e.length;i++)t+=e.charCodeAt(i);return t}getSnapshotDataViewController(e){return new bt(e,this.model,this.view)}giveFeedback(){Et.internalFeedback.isEnabled().then(e=>{if(e){var t="";this.view.currentDataViewController&&(t=ct.GetName(pe,this.view.currentDataViewController.viewType));Et.shell.save(!1).then(e=>{Et.internalFeedback.sendData(!0,"","",t,"",e)})}})}loadSnapshot(e,t,i,s){if(!t||1!==t.length)throw new Error(Object(l.a)("JSPerf.1012"));this.setTargetView(i,s);var a=Et.shell.getSnapshotFullPath(e,t[0]),r=ut.getHashKey(a);ae.logPerformance({id:z.b.Memory_ProcessingSnapshot_Start,key:r});this.model.progressText=Object(l.b)("ProcessingSnapshot");return Et.memoryAnalyzerData.processSnapshot(a).then(this.onSnapshotProcessingCompleted.bind(this,r),this.onSnapshotProcessingFailed.bind(this,r))}setTargetView(e,t){this.model.targetView=e;this.model.sortProperty=t}onSnapshotProcessingCompleted(e,t){var i=new Fe(t,!1,0,0);this.model.snapshot=i;this.model.progressText=Object(l.b)("ProcessingSnapshotCompleted");ae.logPerformance({id:z.b.Memory_ProcessingSnapshot_Stop,key:e});Et.onIdle()}onSnapshotProcessingFailed(e,t){if(!t)throw new Error(Object(l.a)("JSPerf.1013"));this.model.latestSnapshotError=t;this.model.progressText="";ae.logPerformance({id:z.b.Memory_ProcessingSnapshot_Stop,key:e});Et.onIdle()}}class mt extends Se.b{constructor(){super()}static initialize(){Se.a.defineProperty(mt,mt.DataTabModelPropertyName,null,(e,t,i)=>e.onDataTabModelChanged(t,i));Se.a.defineProperty(mt,mt.DisplayCircularReferencesPropertyName,!1);Se.a.defineProperty(mt,mt.DisplayObjectIDsPropertyName,!1);Se.a.defineProperty(mt,mt.FoldObjectsByDominatorPropertyName,!1);Se.a.defineProperty(mt,mt.IsDiffPropertyName,!1);Se.a.defineProperty(mt,mt.IsDisplayedPropertyName,!1,e=>e.onIsDisplayedChanged());Se.a.defineProperty(mt,mt.LatestSnapshotErrorPropertyName,null);Se.a.defineProperty(mt,mt.ProgressTextPropertyName,"");Se.a.defineProperty(mt,mt.ProgressValuePropertyName,"");Se.a.defineProperty(mt,mt.ScopeFilterOptionsPropertyName,null);Se.a.defineProperty(mt,mt.ScopeFilterPropertyName,2);Se.a.defineProperty(mt,mt.ShowBuiltInsPropertyName,!0);Se.a.defineProperty(mt,mt.ShowNonMatchingReferencesPropertyName,!0);Se.a.defineProperty(mt,mt.SnapshotPropertyName,null,e=>e.onSnapshotChanged());Se.a.defineProperty(mt,mt.SortPropertyPropertyName,"");Se.a.defineProperty(mt,mt.TargetViewPropertyName,"")}onDataTabModelChanged(e,t){e&&(e.isDisplayed=!1);t&&(t.isDisplayed=this.isDisplayed)}onIsDisplayedChanged(){this.dataTabModel&&(this.dataTabModel.isDisplayed=this.isDisplayed)}onSnapshotChanged(){this.setScopeFilterOptions()}onFilterStringChanging(){ae.logPerformance({id:z.b.Memory_GridFilterResponse_Start})}onFilterStringChanged(){ae.logPerformance({id:z.b.Memory_GridFilterResponse_Stop})}setScopeFilterOptions(){if(this.snapshot){var e=this.snapshot.getSnapshotDiffStats(),t=[{value:(0).toString(),text:Object(l.b)("ScopeObjectsLeftFromPreviousSnapshot",this.snapshot.firstSnapshotId,ye.a.getDecimalLocaleString(e.leftOverObjectsCount,!0))},{value:1..toString(),text:Object(l.b)("ScopeObjectsAddedBetweenSnapshots",this.snapshot.firstSnapshotId,this.snapshot.lastSnapshotId,ye.a.getDecimalLocaleString(e.addedObjectsCount,!0))},{value:2..toString(),text:Object(l.b)("ScopeAllObjects",this.snapshot.lastSnapshotId,ye.a.getDecimalLocaleString(e.objectsCount,!0))}];this.scopeFilterOptions=t;this.scopeFilter=1;this.isDiff=this.snapshot.isDiff}else this.scopeFilterOptions=[]}}mt.DataTabModelPropertyName="dataTabModel";mt.DisplayCircularReferencesPropertyName="displayCircularReferences";mt.DisplayObjectIDsPropertyName="displayObjectIDs";mt.FoldObjectsByDominatorPropertyName="foldObjectsByDominator";mt.IsDiffPropertyName="isDiff";mt.IsDisplayedPropertyName="isDisplayed";mt.LatestSnapshotErrorPropertyName="latestSnapshotError";mt.ProgressTextPropertyName="progressText";mt.ProgressValuePropertyName="progressValue";mt.ScopeFilterPropertyName="scopeFilter";mt.ScopeFilterOptionsPropertyName="scopeFilterOptions";mt.ShowBuiltInsPropertyName="showBuiltIns";mt.ShowNonMatchingReferencesPropertyName="showNonMatchingReferences";mt.SnapshotPropertyName="snapshot";mt.SortPropertyPropertyName="sortProperty";mt.TargetViewPropertyName="targetView";mt.initialize();class gt extends L.a{constructor(e,t){super("SnapshotTabTemplate");this._controller=e;this._model=t;this._snapshotAnalysisView=new _t(this._controller,this._model);this._model.propertyChanged.addHandler(this.onPropertyChanged.bind(this));this._snapshotDataNavigation=new Q.a(this.findElement("snapshotDataNavigation"));this._snapshotProcessingProgressDiv=this.findElement("snapshotProcessingProgressDiv");this._progressText=this.findElement("progressText");this._progressText.setAttribute("aria-live","assertive");this._progressBar=this.findElement("progressBar");this._snapshotProcessingError=this.findElement("snapshotProcessingError");this._snapshotProcessingErrorMsg=this.findElement("snapshotProcessingErrorMsg");this.findElement("snapshotProcessingErrorLabel").innerText=Object(l.b)("ErrorWhileProcessing");this.uiUpdateViews();this.updateProgress()}get currentDataView(){var e=this.currentDataViewTab;return e?e.content:null}get currentDataViewController(){var e=this.currentDataViewTab;return e?e.controller:null}get currentDataViewTab(){return this._tabControl&&this._tabControl.selectedItem?this._tabControl.selectedItem:null}switchToDataView(e){var t=this._tabControl.getTab(e);t&&(t.controller.dataViewModel.filterString="");this._tabControl.selectedItem=t}onPropertyChanged(e){switch(e){case mt.LatestSnapshotErrorPropertyName:this.updateSnapshotError();break;case mt.ProgressTextPropertyName:case mt.ProgressValuePropertyName:this.updateProgress();break;case mt.ShowBuiltInsPropertyName:this.forEachTab(e=>{e.controller.snapshotViewModel.showBuiltIns=this._model.showBuiltIns});break;case mt.SnapshotPropertyName:this.uiUpdateViews();break;case mt.SortPropertyPropertyName:this.updateSort();break;case mt.TargetViewPropertyName:this.updateTargetView()}}forEachTab(e){for(var t=0;t<this._tabControl.length();t++){e(this._tabControl.getTab(t))}}updateProgress(){this._model.progressText&&(this._progressText.textContent=this._model.progressText);this._model.progressValue&&(this._progressBar.value=this._model.progressValue)}updateTargetView(){if(this._tabControl)for(var e=this._model.targetView,t=0;t<this._tabControl.length();t++){var i=this._tabControl.getTab(t);i.title===e&&(this._tabControl.selectedItem=i)}}updateSort(){this.currentDataView&&this.currentDataView.sortBy(this._model.sortProperty,"desc")}updateSnapshotError(){var e=this._model.latestSnapshotError;if(e){this.showProgress(!1);this._snapshotProcessingErrorMsg.innerText=Ce.format(e);this._snapshotProcessingError.style.display="block"}else{this._snapshotProcessingErrorMsg.innerText="";this._snapshotProcessingError.style.display="none"}}getNewTab(e){return new pt(this._controller.getSnapshotDataViewController(e))}uiUpdateViews(){this.updateSnapshotError();if(this._tabControl){for(var e=0;e<this._tabControl.length();e++)this._tabControl.getTab(e);this._snapshotDataNavigation.removeChild(this._tabControl)}if(this._model.snapshot){this._snapshotDataNavigation.rootElement.classList.remove("snapshotDataNavigationHidden");this.showProgress(!1);this._tabControl=new X;this._tabControl.tabsLeftAligned=!0;this._tabControl.afterBarContainer.appendChild(this._snapshotAnalysisView.rootElement);var t=ct.GetValues(pe);for(e=0;e<t.length;e++){var i=t[e],s=this.getNewTab(i);this._tabControl.addTab(s)}this.updateTargetView();this.updateSort();this._snapshotAnalysisView.setupSettingsMenu();this._snapshotAnalysisView.onTabChanged();this._tabControl.selectedItemChanged=((e,t)=>{this._model.targetView=t.title;this._snapshotAnalysisView.onTabChanged();this.updateNavigationFrames()});this._tabControl.rootElement.classList.add("snapshotDataNavigation");this._snapshotDataNavigation.appendChild(this._tabControl);this.updateNavigationFrames()}else{this._snapshotDataNavigation.rootElement.classList.add("snapshotDataNavigationHidden");this.showProgress(!0);J.updateAdditionalNavigationFrames(this._controller.navigationId)}}showProgress(e){e?this._snapshotProcessingProgressDiv.classList.remove("snapshotProcessingProgressDivHidden"):this._snapshotProcessingProgressDiv.classList.add("snapshotProcessingProgressDivHidden")}updateNavigationFrames(){J.updateAdditionalNavigationFrames(this._controller.navigationId,[F.a.makeNavigationFrameFromTarget(this._tabControl.rootElement,this.currentDataViewTab.header.rootElement),F.a.makeNavigationFrameFromCallback(this.currentDataView.navigationContainer,()=>"none"!==this.currentDataView.navigationContainer.style.display?this.currentDataView.navigationTarget:null)])}}class _t extends dt.a{constructor(e,t){super("MemoryAnalyzer.analysisBarTemplate");this._controller=e;this.model=t;this.model.displayObjectIDs=Et.userSettings.displayObjectIDs;this.model.foldObjectsByDominator=Et.userSettings.foldObjectsByDominator;this.model.showBuiltIns=Et.userSettings.showBuiltIns;this.model.showNonMatchingReferences=Et.userSettings.showNonMatchingReferences;this._filterInput=this.getNamedControl("filterInput")}setupSettingsMenu(){if(this.model.snapshot&&!this._settingsMenu){var e=this.getNamedControl("settingsMenuButton");this._settingsMenu=new ht.a;this._settingsMenu.menuItemsTemplateId="MemoryAnalyzer.settingsDropDownMenu";this._settingsMenu.targetButtonElement=e.rootElement;this._settingsMenu.dismissOnTargetButtonClick=!0;this.model.isDiff=this.model.snapshot.isDiff;this._settingsMenu.model=this.model;this.rootElement.appendChild(this._settingsMenu.rootElement)}}onTabChanged(){var e=this._controller.currentDataViewController;e&&(this.model.dataTabModel=e.dataViewModel)}}class ft{constructor(e,t,i,s){this.gridData=e;this.expandStates=t;this.toggleFunction=i;this.loadMoreFunction=s}}class St{constructor(e,t){this.view=e;this._item=t}get object(){return this._item}get objectId(){return this._item.objectId}get parentObjectId(){return this._item.parentObjectId}get sourceInfo(){return this._item.sourceInfo}}class bt{constructor(e,t,i){this.viewType=e;this.snapshotViewModel=t;this._dataSource=rt.getDataSource(e,this.snapshotViewModel.snapshot);this._viewSwitcher=i;this.dataViewModel=new Ct(this.viewType,this.snapshotViewModel.snapshot.isDiff);this.dataViewModel.showUnknownTypes=Et.userSettings.showUnknownTypes;this.dataViewModel.showUnknownSizes=Et.userSettings.showUnknownSizes;this.view=new vt(this,this.dataViewModel,this.snapshotViewModel);_.a.notify(de.SnapshotDataViewReady,{viewModel:this.dataViewModel,snapshotDataSource:this._dataSource})}get currentDataView(){return this._viewSwitcher.currentDataView}get isTextFilterSupported(){return this.viewType!==pe.roots}setFocusOnGrid(){this.view.setFocusOnGrid()}setSnapshotDataSource(){this.dataViewModel.snapshotDataSource=this._dataSource;this.view.refreshGrids()}showPathToDominator(e,t){this._viewSwitcher.switchToDataView(pe.dominators);this._viewSwitcher.currentDataView.showPathToDominator(e,t)}showPathToRoot(e,t){this._viewSwitcher.switchToDataView(pe.roots);this._viewSwitcher.currentDataView.showPathToRoot(e,t)}}class Ct extends Se.b{constructor(e,t=!1){super();this.viewType=e;this.isDiff=t;this.isTextSearchable=this.viewType!==pe.roots;this.isDominatorFoldingPossible=this.viewType!==pe.roots}get hasDetachedDomNodes(){return this.snapshotDataSource.hasDetachedDomNodes}static initialize(){Se.a.defineProperty(Ct,Ct.IsDiffPropertyName,!1);Se.a.defineProperty(Ct,Ct.IsDisplayedPropertyName,!1);Se.a.defineProperty(Ct,Ct.IsDominatorFoldingPossiblePropertyname,!0);Se.a.defineProperty(Ct,Ct.IsTextSearchablePropertyName,!1);Se.a.defineProperty(Ct,Ct.FilterStringPropertyName,"");Se.a.defineProperty(Ct,Ct.ShowUnknownSizesPropertyName,!1);Se.a.defineProperty(Ct,Ct.ShowUnknownTypesPropertyName,!1);Se.a.defineProperty(Ct,Ct.SnapshotDataSourcePropertyName,null)}}Ct.FilterStringPropertyName="filterString";Ct.IsDiffPropertyName="isDiff";Ct.IsDisplayedPropertyName="isDisplayed";Ct.IsDominatorFoldingPossiblePropertyname="isDominatorFoldingPossible";Ct.IsTextSearchablePropertyName="isTextSearchable";Ct.ShowUnknownSizesPropertyName="showUnknownSizes";Ct.ShowUnknownTypesPropertyName="showUnknownTypes";Ct.SnapshotDataSourcePropertyName="snapshotDataSource";Ct.initialize();class vt extends L.a{constructor(e,t,i,s){super("SnapshotDataViewTemplate");this._fieldNameToColumnMapMainGrid={};this._fieldNameToColumnMapReferenceGrid={};this._controller=e;this._dataViewModel=t;this._snapshotViewModel=i;this._dataViewModel.propertyChanged.addHandler(this.onPropertyChanged.bind(this));this._snapshotViewModel.propertyChanged.addHandler(this.onPropertyChanged.bind(this));this._referenceViewContainer=this.findElement("referenceViewContainer");this._snapshotGridContainer=this.findElement("snapshotGridContainer");this._reachedItemsCapMessageContainer=this.findElement("reachedItemsCapMessageContainer");this.findElement("referenceGraphTitleLabel").innerText=Object(l.b)("ReferenceGraph");this._snapshotViewGridSplitter=new at(this.findElement("snapshotViewGridSplitter"),25,this.findElement("snapshotScrollableContainer"),this.refreshGrids.bind(this));if(!vt.GridContextMenu){var a={callback:vt.onShowInDominatorsViewCommand,hidden:vt.isShowInDominatorsViewCommandHidden,disabled:this.isShowInDominatorsViewCommandDisabled.bind(this),label:Object(l.b)("ShowInDominatorsViewLabel"),type:De.MenuItemType.command},r={callback:vt.onShowInRootsViewCommand,hidden:vt.isShowInRootsViewCommandHidden,label:Object(l.b)("ShowInRootsViewLabel"),type:De.MenuItemType.command},n={type:De.MenuItemType.separator},o={callback:vt.onShowInDomExplorerCommand,hidden:()=>!Ze.a.isAvailable,disabled:vt.isShowInDomExplorerCommandDisabled,label:Object(l.b)("ShowInDomExplorerLabel"),type:De.MenuItemType.command},h={accessKey:Object(l.b)("EnterKey"),callback:vt.onViewSourceCommand,disabled:vt.isViewSourceCommandDisabled,label:Object(l.b)("ViewSourceLabel"),type:De.MenuItemType.command};vt.GridContextMenu=De.create([a,r,n,o,h])}s?this._sortOrder=new Be(s,"desc"):this._dataViewModel.isDiff?this._dataViewModel.viewType===pe.types?this._sortOrder=new Be("childrenCount","desc"):this._sortOrder=new Be("retainedSizeDiff","desc"):this._dataViewModel.viewType===pe.types?this._sortOrder=new Be("childrenCount","desc"):this._sortOrder=new Be("retainedSize","desc");this._sortOrderForReferences=new Be("retainedSize","desc");this.uiUpdateSnapshotDataSource()}get navigationContainer(){return this._referenceViewContainer}get navigationTarget(){return this._gridReference?this._gridReference.getElement():null}get selectedItem(){return this._selectedItem}static getSortComparer(e,t){var i=t[e.index],s=i.comparer,a="asc"===e.order;return(t,r)=>{var n=s(i,e.order,t,r);return a?n:-n}}static columnComparerForStrings(e,t,i,s){return vt.naturalSort(i[e.index],s[e.index])}static naturalSort(e,t){var i=/(\d+)|([^\d\(\)]+)/g,s=String(e).toLocaleLowerCase().match(i),a=String(t).toLocaleLowerCase().match(i);if(!s)return a?-1:0;if(!a)return 1;for(;s.length>0&&a.length>0;){var r=s.shift(),n=a.shift(),o=parseInt(r,10),l=parseInt(n,10);if(isNaN(o)&&isNaN(l)){if(r!==n)return r.localeCompare(n)>0?1:-1}else{if(isNaN(o))return 1;if(isNaN(l))return-1;if(o!==l)return o-l}}return s.length-a.length}static columnComparerForNumbers(e,t,i,s){return(i[e.index]||0)-(s[e.index]||0)}static formatChildrenCount(e,t,i,s,a){var r=s[e];return r.childrenCount?ye.a.getDecimalLocaleString(r.childrenCount,!0):""}static formatSize(e,t,i,s,a){var r=s[e];if(r.size){var n=ye.a.getPrettyPrintSize(r.size)+(r.isSizeApproximate?"*":" ");a&&r.isSizeApproximate&&(n=Object(l.b)("ApproximateSizeTooltip",n));return n}return""}static formatRetainedSize(e,t,i,s,a){var r=s[e];return r.retainedSize?ye.a.getPrettyPrintSize(r.retainedSize):""}static formatRetainedSizeDiff(e,t,i,s,a){var r=s[e];return r.retainedSizeDiff?(r.retainedSizeDiff>0?"+":"-")+ye.a.getPrettyPrintSize(Math.abs(r.retainedSizeDiff)):""}static formatSizeDiff(e,t,i,s,a){var r=s[e];return r.sizeDiff?(r.sizeDiff>0?"+":"-")+ye.a.getPrettyPrintSize(Math.abs(r.sizeDiff)):""}populateFieldNameToColumnMap(e){var t={};t.name=new Ge("name",Object(l.b)("Identifiers"),Object(l.b)("IdentifiersTooltip"),350,!0,null,e?this.getDiffNameCellCSSClass.bind(this):null,vt.columnComparerForStrings,!0);t.name.cellDecorator=this.decorateNameCell.bind(this);t.name.hasMoreColumn=!0;t.type=new Ge("type",Object(l.b)("Type"),Object(l.b)("TypeTooltip"),115,!0,null,e?this.getDiffNameCellCSSClass.bind(this):null,vt.columnComparerForStrings);t.size=new Ge("size",Object(l.b)("Size"),Object(l.b)("SizeTooltip"),65,!0,vt.formatSize,this.getNumericCellCSSClass.bind(this,e),vt.columnComparerForNumbers);t.retainedSize=new Ge("retainedSize",Object(l.b)("RetainedSize"),Object(l.b)("RetainedSizeTooltip"),80,!0,vt.formatRetainedSize,this.getNumericCellCSSClass.bind(this,e),vt.columnComparerForNumbers);t.childrenCount=new Ge("childrenCount",Object(l.b)("Count"),Object(l.b)("CountTooltip"),50,!0,vt.formatChildrenCount,this.getNumericCellCSSClass.bind(this,e),vt.columnComparerForNumbers);t.sizeDiff=new Ge("sizeDiff",Object(l.b)("SizeDiff"),Object(l.b)("SizeDiffTooltip"),65,!0,vt.formatSizeDiff,this.getNumericCellCSSClass.bind(this,e),vt.columnComparerForNumbers);t.retainedSizeDiff=new Ge("retainedSizeDiff",Object(l.b)("RetainedSizeDiff"),Object(l.b)("RetainedSizeDiffTooltip"),105,!0,vt.formatRetainedSizeDiff,this.getNumericCellCSSClass.bind(this,e),vt.columnComparerForNumbers);t.containsDetachedDomNode=new Ge("containsDetachedDomNode","","",0,!0,null,null,vt.columnComparerForStrings);t.containsDetachedDomNode.hidden=!0;t.isDetachedDomNode=new Ge("isDetachedDomNode","","",0,!0,null,null,vt.columnComparerForStrings);t.isDetachedDomNode.hidden=!0;return t}onPropertyChanged(e){switch(e){case mt.ScopeFilterPropertyName:ae.logExecuteCommand(ne.SCOPE_FILTER,N.c.Ui);break;case Ct.FilterStringPropertyName:ae.logExecuteCommand(ne.IDENTIFIER_FILTER,N.c.Ui);break;case mt.FoldObjectsByDominatorPropertyName:ae.logExecuteCommand(ne.FOLD_BY_DOMINATOR,N.c.Ui);break;case mt.ShowBuiltInsPropertyName:ae.logExecuteCommand(ne.SHOW_BUILT_INS,N.c.Ui);break;case mt.DisplayObjectIDsPropertyName:ae.logExecuteCommand(ne.DISPLAY_OBJECT_IDS,N.c.Ui)}switch(e){case mt.DisplayObjectIDsPropertyName:this.refreshGrids();break;case mt.IsDiffPropertyName:case Ct.IsDiffPropertyName:case mt.ShowBuiltInsPropertyName:case Ct.ShowUnknownTypesPropertyName:case Ct.ShowUnknownSizesPropertyName:case mt.ScopeFilterPropertyName:case Ct.SnapshotDataSourcePropertyName:case Ct.FilterStringPropertyName:case mt.DisplayCircularReferencesPropertyName:case mt.ShowNonMatchingReferencesPropertyName:this.uiUpdateSnapshotDataSource();break;case mt.FoldObjectsByDominatorPropertyName:this.updateSortOrders();this.uiUpdateSnapshotDataSource();break;case Ct.IsDisplayedPropertyName:this.onIsDisplayedChanged()}}refreshGrids(){this._grid&&this._grid.layout();this._gridReference&&this._gridReference.layout()}setFocusOnGrid(e){if(this._grid){var t=this._grid.getSelectedRowIndex();("number"==typeof e||"number"!=typeof t||t<=0)&&this._grid.ensureSelectedIndex(e||0);this._grid.setFocusToSelectedRow()}}getUidChain(e){return this._dataViewModel.snapshotDataSource.snapshot.getUidChain(e)}showPathToDominator(e,t){var i=this._dataViewModel.snapshotDataSource.snapshot.getPathToDominator(e,t,this.getFilter());this._rootQueryPromise&&this._rootQueryPromise.then(()=>this.navigateToObjectForPath(i))}showPathToRoot(e,t){var i=this._dataViewModel.snapshotDataSource.snapshot.getPathToRoot(e,this.getFilter(),t);this._rootQueryPromise&&this._rootQueryPromise.then(()=>this.navigateToObjectForPath(i))}sortBy(e,t){this._sortOrder.index=e;this._sortOrder.order=t;this.updateTree()}static isShowInRootsViewCommandHidden(){return!vt.GridContextMenuData||!vt.GridContextMenuData.view||vt.GridContextMenuData.view._dataViewModel.viewType===pe.roots&&vt.GridContextMenuData.view._focusedGrid===vt.GridContextMenuData.view._grid}static isShowInDomExplorerCommandDisabled(){if(!vt.GridContextMenuData)return!1;var e=vt.GridContextMenuData.object,t=vt.GridContextMenuData.view;return!(Ze.a.isAvailable&&e&&t&&t.getUidChain(e.objectId))}static onShowInDomExplorerCommand(){if(vt.GridContextMenuData){var e=vt.GridContextMenuData.object,t=vt.GridContextMenuData.view;if(Ze.a.isAvailable&&e&&t){var i=t.getUidChain(e.objectId);i&&Ze.a.selectDomElement(i)}}}static isViewSourceCommandDisabled(){return!(vt.GridContextMenuData&&vt.GridContextMenuData.view&&vt.GridContextMenuData.sourceInfo)}static onRequestViewSource(e){vt.viewSource(e.source,e.line,e.column)}static onShowInRootsViewCommand(){if(vt.GridContextMenuData&&vt.GridContextMenuData.view){ae.logExecuteCommand(ne.ROOT_VIEW,N.c.ContextMenu);vt.GridContextMenuData.view._controller.showPathToRoot(vt.GridContextMenuData.objectId,vt.GridContextMenuData.parentObjectId);vt.GridContextMenuData=null}}static onViewSourceCommand(){if(vt.GridContextMenuData&&vt.GridContextMenuData.view&&vt.GridContextMenuData.sourceInfo){var e=vt.GridContextMenuData.sourceInfo;window.setImmediate(()=>{vt.viewSource(e.source,e.line,e.column)})}}static showSourceInfoTooltip(e,t){t&&st.g(t.source,t.line,t.column).then(i=>{var s={name:t.name,line:i.oneBasedLine,column:i.oneBasedColumn,source:i.documentPath},a=new $e.a(s,e,"SourceInfoIdentifierLabel");tt.c({content:a.html,contentContainsHTML:!0})})}static viewSource(e,t,i){st.h(e,t,i).then(()=>{},e=>{Et.shell.hostShell.setStatusBarText(Object(l.b)("UnableToViewSource"),!0)})}static onShowInDominatorsViewCommand(){if(vt.GridContextMenuData&&vt.GridContextMenuData.view){ae.logExecuteCommand(ne.DOMINATOR_VIEW,N.c.ContextMenu);vt.GridContextMenuData.view._controller.showPathToDominator(vt.GridContextMenuData.objectId,vt.contextMenuScopeFilter());vt.GridContextMenuData=null}}static isShowInDominatorsViewCommandHidden(){return!vt.GridContextMenuData||!vt.GridContextMenuData.view||vt.GridContextMenuData.view._dataViewModel.viewType===pe.dominators&&vt.GridContextMenuData.view._focusedGrid===vt.GridContextMenuData.view._grid}static isObjectScopeConformed(e,t){if(!e.diffOperation&&!e.isFabricatedObject)return!1;switch(t){case 1:return e.isAdded;case 0:return!e.isAdded&&!e.isBaseline;case 2:default:return!0}}static contextMenuScopeFilter(){return vt.GridContextMenuData&&vt.GridContextMenuData.view&&vt.GridContextMenuData.view._dataViewModel.isDiff?vt.GridContextMenuData.view._snapshotViewModel.scopeFilter:2}onIsDisplayedChanged(){this._dataViewModel.isDisplayed?this.updateHighlight():this.clearHighlight()}decorateNameCell(e,t){var i,s=t,a=s.name,r=s.name,n=document.createElement("span");vt.isObjectScopeConformed(s,this.getScopeFilter())&&(vt.HTMLRegex.test(s.kind)?i=et.a.getHtmlTokens(a):"String"===s.kind?i=et.a.getStringTokens(a):"Number"===s.kind&&(i=et.a.getNumberTokens(a)));if(i&&i.length>0)for(var o=0;o<i.length;o++){var h=i[o],d=document.createElement("span");d.className=et.a.getCssClass(h.type);d.textContent=h.value;n.appendChild(d)}else n.textContent=a;if(this._snapshotViewModel.displayObjectIDs&&s.objectId&&!s.isFabricatedObject){n.innerHTML+=" @"+s.objectId;r+=" @"+s.objectId}if(s.isCircularReference){n.innerHTML+=Object(l.b)("CircularReferenceMarker");r+=Object(l.b)("CircularReferenceMarker")+" "+Object(l.b)("CircularReferenceMessage")}var c=s.sourceInfo;if(c){n.className="BPT-FileLink";n.onclick=vt.onRequestViewSource.bind(this,c);e.addEventListener("mouseover",vt.showSourceInfoTooltip.bind(this,r,c))}else{e.setAttribute("data-plugin-vs-tooltip"," "+r);e.setAttribute("aria-label",s.name)}e.appendChild(n)}getWarningCss(e,t){var i=t[e];return i.isDetachedDomNode?i instanceof Le?"detachedDomNodeChildrenWarning":"detachedDomNodeWarning":i.hasDetachedDomNodeChildren&&this._snapshotViewModel.foldObjectsByDominator?"detachedDomNodeChildrenWarning":void 0}isShowInDominatorsViewCommandDisabled(){return!(vt.GridContextMenuData&&vt.GridContextMenuData.view&&vt.isObjectScopeConformed(vt.GridContextMenuData.object,vt.contextMenuScopeFilter()))}navigateToObjectForPath(e){if(e&&e.length>0&&this._grid){for(var t=e.reverse(),i=this._grid._dataSource,s=this._grid.getExpandStates(),a=0,r=0;r<t.length;r++)for(;a<i.length;a++){if(i[a].objectId===t[r]){if(r===t.length-1)this._grid.setSelectedDataIndex(a);else{s[a]<0&&this._grid.expandNode(a);a++}break}0!==s[a]&&(a+=Math.abs(s[a])-1)}this._grid.layout();window.setImmediate(()=>{this._grid.setFocusToSelectedRow()})}}getDiffNameCellCSSClass(e,t,i,s){var a=s[e],r=this.getScopeFilter();if(!a.diffOperation&&!a.isFabricatedObject)return null;switch(r){case 1:return a.isAdded?null:"unmatchedScopeObject";case 0:if(a.isChanged&&!a.isBaseline)return null;if(a.isAdded||a.isBaseline)return"unmatchedScopeObject";break;case 2:default:return null}return null}getNumericCellCSSClass(e,t,i,s,a){var r="numeric-data";e&&(r+=" "+this.getDiffNameCellCSSClass(t,i,s,a));return r}onGridContextMenu(e,t){this._focusedGrid=e;var i=e.getSelectedDataIndex(),s=!1,a=t.pageX,r=t.pageY;if(0===t.clientX&&0===t.clientY){s=i>-1;var n=e.getRowInfo(i).row;if(n){var o=n.getBoundingClientRect();a=Math.round(o.left+o.width/4);r=Math.round(o.top+o.height/2)}else s=!1}else for(var l=document.elementFromPoint(t.clientX,t.clientY);l;){if(l&&l.classList){if(l.classList.contains("grid-row")){s=!0;break}if(l.classList.contains("grid-canvas"))break}l=l.parentElement}if(s){var h,d=-1;"number"==typeof i&&i>=0&&((h=e.getRowData(i))instanceof Le||(d=h.objectId));if(d>=0){if(vt.GridContextMenu){vt.GridContextMenuData=new St(this,h);vt.GridContextMenu.show(a,r)}}else vt.GridContextMenuData=null}t.preventDefault();t.stopImmediatePropagation();return!1}uiUpdateAll(){this.uiUpdateSnapshotDataSource()}uiUpdateSnapshotDataSource(){if(this._dataViewModel.snapshotDataSource){var e=this._dataViewModel.snapshotDataSource.snapshot.isDiff;this._fieldNameToColumnMapMainGrid=this.populateFieldNameToColumnMap(e);this._fieldNameToColumnMapReferenceGrid=this.populateFieldNameToColumnMap(e)}this._referenceViewContainer.style.display="none";this.updateTree()}updateSortOrders(){if(this._snapshotViewModel.foldObjectsByDominator){this._sortOrder&&"isDetachedDomNode"===this._sortOrder.index&&(this._sortOrder.index="containsDetachedDomNode");this._sortOrderForReferences&&"isDetachedDomNode"===this._sortOrderForReferences.index&&(this._sortOrderForReferences.index="containsDetachedDomNode")}else{this._sortOrder&&"containsDetachedDomNode"===this._sortOrder.index&&(this._sortOrder.index="isDetachedDomNode");this._sortOrderForReferences&&"containsDetachedDomNode"===this._sortOrderForReferences.index&&(this._sortOrderForReferences.index="isDetachedDomNode")}}getFilter(){return{displayObjectIDs:this._snapshotViewModel.displayObjectIDs,foldObjectsByDominator:this._snapshotViewModel.foldObjectsByDominator,showNonMatchingReferences:this._snapshotViewModel.showNonMatchingReferences,showBuiltIns:this._snapshotViewModel.showBuiltIns,showUnknownTypes:this._dataViewModel.showUnknownTypes,showUnknownSizes:this._dataViewModel.showUnknownSizes,filterString:this._dataViewModel.filterString}}getScopeFilter(){return this._dataViewModel.isDiff?isNaN(this._snapshotViewModel.scopeFilter)?1:this._snapshotViewModel.scopeFilter:2}getUpdatedSorter(e,t){return{sortProperty:e.index,sortOrder:"asc"===e.order?ue.ascending:ue.descending,sortComparer:vt.getSortComparer(e,t)}}getSorter(){return this.getUpdatedSorter(this._sortOrder,this._fieldNameToColumnMapMainGrid)}getSorterForReferences(){return this.getUpdatedSorter(this._sortOrderForReferences,this._fieldNameToColumnMapReferenceGrid)}markAllObjectsScopeConformed(e){for(var t=e.items,i=0;i<t.length;i++)t[i].isScopeConformed=!0}updateTree(){if(this._dataViewModel.snapshotDataSource){if(this._rootQueryPromise){ae.logPerformance({id:z.b.Memory_DisplayFirstLevelSnapshotData_Stop});this._rootQueryPromise.cancel()}ae.logPerformance({id:z.b.Memory_DisplayFirstLevelSnapshotData_Stop});this._rootQueryPromise=D.a.wrap(this._dataViewModel.snapshotDataSource.getRootHeapDataTreeItem(this.getFilter(),this.getSorter(),0,vt.ROOTS_LOAD_CAP,this.getScopeFilter()).then(e=>{var t,i=e.items;if(e.totalCount>e.items.length){this._reachedItemsCapMessageContainer.style.display="block";t=Object(l.b)("ReachedItemsCapMessage",ye.a.getDecimalLocaleString(e.items.length,!0),ye.a.getDecimalLocaleString(e.totalCount,!0));this._reachedItemsCapMessageContainer.innerText=t}else this._reachedItemsCapMessageContainer.style.display="none";var s,a=this.getTreeInfo(i,((e,t,i,s)=>{var a=this.getScopeFilter(),r=!1;if(this._snapshotViewModel.showNonMatchingReferences&&(vt.isObjectScopeConformed(e,a)||e.isScopeConformed)){a=2;r=!0}var n=this._dataViewModel.snapshotDataSource.getHeapDataTreeItem(this.getFilter(),this.getSorter(),e.id,t,i,s,a);r&&this.markAllObjectsScopeConformed(n);return n}).bind(this)),r=this.getColumnInfoForMainGrid(this._dataViewModel.snapshotDataSource.getAvailableFields(this._snapshotViewModel.foldObjectsByDominator)),n=new Ke(a.toggleFunction,a.loadMoreFunction,r,[this._sortOrder],null,this.notifyRowSelected.bind(this));n.disableRightClickSelection=!1;s=this._snapshotViewModel.foldObjectsByDominator?this._fieldNameToColumnMapMainGrid.containsDetachedDomNode:this._fieldNameToColumnMapMainGrid.isDetachedDomNode;if(this._grid){this._grid.setDataSource(a.gridData,a.expandStates,n.columns,n.sortOrders,-1);this._grid.setGutterHeaderClickSortColumn(s);this._grid.setAriaDescription(t)}else{var o={cssClass:"",index:"",gutterIconCssCallback:this.getWarningCss.bind(this)};n.gutter.backgroundColor=Object(it.b)().getValue("plugin-background-color");n.gutter.icon=o;n.gutter.headerClickSortColumn=s;n.gutter.getTooltip=this.detachedDomNodeTooltip.bind(this);this._grid=this.createGrid(a.gridData,a.expandStates,n,this._snapshotGridContainer);this._grid.getElement().tabIndex=4;this._grid.getElement().addEventListener("sort",this.sortCompleted.bind(this));this._grid.getElement().addEventListener("sortStarted",this.sortStarted.bind(this));this._grid.getElement().addEventListener("selectionchanged",this.onGridSelectionChanged.bind(this));this._grid.setAriaDescription(t)}ae.logPerformance({id:z.b.Memory_DisplayFirstLevelSnapshotData_Stop});Et.onIdle()}))}}detachedDomNodeTooltip(e,t){var i=t[e];return i.isDetachedDomNode?i.isWinJsDisposable?Object(l.b)("DetachedDomNodeDisposableTooltip"):i instanceof Le?Object(l.b)("DetachedDomNodeTypeObjectTooltip"):Object(l.b)("DetachedDomNodeTooltip"):i.hasDetachedDomNodeChildren&&this._snapshotViewModel.foldObjectsByDominator?i instanceof Le?Object(l.b)("DetachedDomNodeRetainingTypeObjectTooltip"):Object(l.b)("HasDetachedDomNodeChildrenTooltip"):null}updateHighlight(){var e=this._selectedItem;if(Ze.a.isAvailable&&e){var t=this.getUidChain(e.objectId);t&&Ze.a.highlightElement(t)}else this.clearHighlight()}clearHighlight(){Ze.a.isAvailable&&Ze.a.clearHighlight()}onGridSelectionChanged(e){var t=e.customData[0];if(1===t.selectedCount){var i=t.selectedRows[t.selectedIndex];void 0!==i&&(this._selectedItem=this._grid.getRowData(i))}else 0===t.selectedCount&&(this._selectedItem=null);this.showReferences(this._selectedItem);this.updateHighlight()}notifyRowSelected(){_.a.notify(de.DetailsViewRowSelected)}showReferences(e){var t;ae.logPerformance({id:z.b.Memory_UpdateObjectReferenceGraph_Start});e&&e.id&&!isNaN(e.id)&&(t=this._dataViewModel.snapshotDataSource.getReferenceTreeItems(e.id,e.id,0,this.getSorterForReferences(),this._snapshotViewModel.displayObjectIDs,this._snapshotViewModel.displayCircularReferences,0,-1).items);if(t&&0!==t.length){var i,s=e.id,a=this.getTreeInfo(t,(e,t,i,a)=>this._dataViewModel.snapshotDataSource.getReferenceTreeItems(s,e.parentObjectId,e.nodeId,this.getSorterForReferences(),this._snapshotViewModel.displayObjectIDs,this._snapshotViewModel.displayCircularReferences,0,-1)),r=this.getColumnInfoForReferenceGrid(this._dataViewModel.snapshotDataSource.getAvailableFieldsForReferenceTree(this._snapshotViewModel.foldObjectsByDominator)),n=new Ke(a.toggleFunction,a.loadMoreFunction,r,[this._sortOrderForReferences],null,this.notifyRowSelected.bind(this));n.disableRightClickSelection=!1;n.ariaTitle=Object(l.b)("ReferenceGraph");i=this._snapshotViewModel.foldObjectsByDominator?this._fieldNameToColumnMapMainGrid.containsDetachedDomNode:this._fieldNameToColumnMapMainGrid.isDetachedDomNode;if(this._gridReference){this._gridReference.setDataSource(a.gridData,a.expandStates,n.columns,n.sortOrders,-1);this._gridReference.setGutterHeaderClickSortColumn(i);this._gridReference.updateGetChildDataCallback(a.toggleFunction)}else{var o={cssClass:"",index:"",gutterIconCssCallback:this.getWarningCss.bind(this)};n.gutter.backgroundColor=Object(it.b)().getValue("plugin-background-color");n.gutter.icon=o;n.gutter.headerClickSortColumn=i;n.gutter.getTooltip=this.detachedDomNodeTooltip.bind(this);this._gridReference=this.createGrid(a.gridData,a.expandStates,n,this._referenceViewContainer);this._gridReference.getElement().tabIndex=4;this._gridReference.getElement().addEventListener("sort",this.sortCompletedForReferences.bind(this))}this._referenceViewContainer.style.removeProperty("display");1===t.length&&t[0].hasChildren&&this._gridReference.expandNode(0);ae.logPerformance({id:z.b.Memory_UpdateObjectReferenceGraph_Stop})}else{this._referenceViewContainer.style.display="none";ae.logPerformance({id:z.b.Memory_UpdateObjectReferenceGraph_Stop})}}getMoreText(e,t,i){var s;if(e<t){var a=Math.min(i,t-e);s=Object(l.b)("ChildrenLoadNext",ye.a.getDecimalLocaleString(a,!0))}return s}getTreeInfo(e,t){var i=this.getPlaceholderRowsAndExpandStates(e),s=i.itemsWithPlaceholders,a=i.expandStates;return new ft(s,a,(e,i,s)=>{var a=t(e,i,0,vt.CHILDREN_LOAD_CAP),r=this.getMoreText(a.items.length,a.totalCount,vt.CHILDREN_LOAD_CAP);r&&(e.nextStartIndex=a.items.length);s(this.getPlaceholderRowsAndExpandStates(a.items),r)},(e,i,s)=>{var a=e.nextStartIndex;if(a){var r=t(e,i,a,vt.CHILDREN_LOAD_CAP),n=this.getMoreText(a+r.items.length,r.totalCount,vt.CHILDREN_LOAD_CAP);n&&(e.nextStartIndex=a+r.items.length);s(this.getPlaceholderRowsAndExpandStates(r.items),n)}})}getPlaceholderRowsAndExpandStates(e){for(var t=[],i={name:"",value:"",isPlaceholder:!0},s=[],a=0;e&&a<e.length;a++){t.push(e[a]);if(e[a].hasChildren){s.push(-1);t.push(i);s.push(0)}else s.push(0)}return{itemsWithPlaceholders:t,expandStates:s}}createGrid(e,t,i,s){s.innerHTML="";var a=new Xe(s,i);a.setDataSource(e,t,i.columns,i.sortOrders,-1);s.addEventListener("contextmenu",this.onGridContextMenu.bind(this,a));s.addEventListener("keydown",this.onKeyDown.bind(this,a));return a}getColumnInfo(e,t){for(var i=[],s=0;s<e.length;s++){if(!t.hasOwnProperty(e[s]))throw new Error(Object(l.a)("JSPerf.1003"));i.push(t[e[s]])}return i}getColumnInfoForMainGrid(e){return this.getColumnInfo(e,this._fieldNameToColumnMapMainGrid)}getColumnInfoForReferenceGrid(e){return this.getColumnInfo(e,this._fieldNameToColumnMapReferenceGrid)}onKeyDown(e,t){this._focusedGrid=e;if(121!==t.keyCode||t.altKey||t.ctrlKey||!t.shiftKey){if(13===t.keyCode&&!t.altKey&&!t.ctrlKey&&!t.shiftKey){this.tryViewSource();t.preventDefault()}}else{var i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);this.onGridContextMenu(e,i);t.preventDefault()}}sortCompleted(e){var t=e.customData[0];this._sortOrder=t.sortOrder[0];Et.onIdle();ae.logPerformance({id:z.b.Memory_GridSort_Stop})}sortStarted(e){ae.logPerformance({id:z.b.Memory_GridSort_Start})}sortCompletedForReferences(e){var t=e.customData[0];this._sortOrderForReferences=t.sortOrder[0]}tryViewSource(){var e=this._grid.getSelectedDataIndex();if(e>-1){var t=this._grid.getRowData(e).sourceInfo;t&&vt.onRequestViewSource(t)}}}vt.ROOTS_LOAD_CAP=2e3;vt.CHILDREN_LOAD_CAP=2e3;vt.HTMLRegex=/HTML.*Element/;class wt{constructor(e,t,i){this._storageId=e;this._firstSnapshotId=t;this._lastSnapshotId=i;this._navigationId=J.getNextId();this.model=new mt;this.model.progressText=Object(l.b)("GeneratingComparisonView");this.view=new gt(this,this.model)}get currentDataViewController(){return this.view.currentDataViewController}get navigationId(){return this._navigationId}getSnapshotDataViewController(e){return new bt(e,this.model,this.view)}diffSnapshots(e,t,i,s){this.setTargetView(i,s);for(var a=[],r=0,n=0;n<t.length;n++){var o=Et.shell.getSnapshotFullPath(e,t[n]);a.push(o);r+=ut.getHashKey(o)}ae.logPerformance({id:z.b.Memory_ProcessingDiffSnapshot_Start,key:r});return Et.memoryAnalyzerData.processSnapshotDiff(a).then(this.onDiffCompleted.bind(this,r),this.onDiffFailed.bind(this,r))}setTargetView(e,t){this.model.targetView=e;this.model.sortProperty=t}onDiffCompleted(e,t){var i=new Fe(t,!0,this._firstSnapshotId,this._lastSnapshotId);this.model.snapshot=i;ae.logPerformance({id:z.b.Memory_ProcessingDiffSnapshot_Stop,key:e});Et.onIdle()}onDiffFailed(e,t){this.model.latestSnapshotError=t;ae.logPerformance({id:z.b.Memory_ProcessingDiffSnapshot_Stop,key:e});Et.onIdle()}}class yt extends he{constructor(e){super();this._snapshotViewController=e;this.content=e.view}get model(){return this._snapshotViewController.model}onActiveChanged(){if(this.active){var e=this._snapshotViewController.view.currentDataView;e&&e.refreshGrids();J.switchNavigationView(this._snapshotViewController.navigationId)}}}class Dt extends V.a{constructor(e){super("Common.defaultToolbarTemplate");this.title=Object(l.b)("F12ToolTitle");this.panelTemplateId="MemoryAnalyzer.toolbarButtonsPanel";this._shellView=e;this.addClickHandlerToButton("openSessionButton",this.onOpenSessionToolbarButtonClick.bind(this));this.addClickHandlerToButton("saveSessionButton",this.onSaveSessionToolbarButtonClick.bind(this));this.addClickHandlerToButton("startToolbarButton",this.onStartToolbarButtonClick.bind(this));this.addClickHandlerToButton("stopToolbarButton",this.onStopToolbarButtonClick.bind(this));this.addClickHandlerToButton("takeSnapshotToolbarButton",this.onTakeSnapshotToolbarButtonClick.bind(this))}onOpenSessionToolbarButtonClick(){ae.logExecuteCommand(ne.IMPORT_SESSION,N.c.Ui);this._shellView&&this._shellView.openSession()}onSaveSessionToolbarButtonClick(){ae.logExecuteCommand(ne.EXPORT_SESSION,N.c.Ui);this._shellView&&this._shellView.saveSession()}onStartToolbarButtonClick(){ae.logExecuteCommand(ne.START_PROFILE,N.c.Ui);this._shellView&&this._shellView.startProfiling()}onStopToolbarButtonClick(){ae.logExecuteCommand(ne.STOP_PROFILE,N.c.Ui);this._shellView&&this._shellView.stopProfiling()}onTakeSnapshotToolbarButtonClick(){ae.logExecuteCommand(ne.TAKE_SNAPSHOT,N.c.Ui);this._shellView&&this._shellView.takeSnapshot()}}class It extends Re{constructor(e,t,i){super(t);this._openedDocs={};var s=new ke(i);this._controller=s;e.addEventListener("closing",()=>{this.closeAllSnapshots();this.clearEtw()});this._hostShell=new H.a;this._selfTestInitialized=!1}get controller(){return this._controller}get hostShell(){return this._hostShell}get view(){return this._view}static async load(){try{const e=await Object(q.a)().openFileDialog({name:"",extensions:["diagsession"]},{access:U.a.read,encoding:"BINARY",persistence:U.d.temporary,type:U.f.binary}),t=await It.loadFromStream(e),i=new E(t,!0);await Et.changeSession(i)}catch(e){if(void 0!==e.number&&e.number===P.a.E_ABORT)return;It.errorDisplay.show(Object(l.b)("OpenSessionFailedMessage"))}}static async loadFromStream(e){try{await Et.packager.openPackage(e.streamId);const t=Et.packager.getResourcePathsByType(P.a.MEMORY_ANALYZER_SNAPSHOT_RESOURCE_TYPE);Et.packager.closePackage();if(t.length<1||""===t[0])throw new Error(Object(l.a)("JSPerf.1075"));const i=t[0].split("\\");return i[i.length-2]+"\\"+i[i.length-1]}finally{await e.close()}}static async save(){try{const e=await Object(q.a)().saveFileDialog({name:"",extensions:["diagsession"]},{access:U.a.readWrite,encoding:"BINARY",persistence:U.d.temporary,type:U.f.binary}),t=await Et.saveSession();await Object(o.g)(t,e.streamId);await e.close();Object(o.h)(t);_.a.notify(de.SessionSaveCompleted)}catch(e){if(void 0!==e.number&&e.number===P.a.E_ABORT)return;It.errorDisplay.show(Object(l.b)("SaveSessionFailedMessage"))}}async changeSession(e){await this.closeAllSnapshots();this.session=e;const t=await this.session.getSessionInfo();await this._controller.setSession(t);const i=this._controller.summaryViewController.model;this._controller.summaryViewController.removeExistingGraph();if(this._view){this._view.closeView();this._view=null}this.initializeView();this._view.updateUIState();i.snapshotSummaryCollection&&(i.isStartProfilingPromptVisible=0===i.snapshotSummaryCollection.length)}getDoc(e){return this._openedDocs[e]}closeAllSnapshots(){for(var e in this._openedDocs)this._openedDocs.hasOwnProperty(e)&&this._view.removeDoc(this._openedDocs[e]);this._openedDocs={};for(var t=[],i=this._controller.summaryViewController.model.snapshotSummaryCollection,s=0;s<i.length;++s){var a=i.getItem(s).snapshotFile,r=this.getSnapshotFullPath(a.storageId,a.relativePath);t.push(r);t.push(r+we.fileExtension)}this._controller.clearSummaryTab();for(;t.length>0;){var n=t.pop();Object(o.h)(n)}return Promise.resolve()}getHostSpecificString(e,...t){return Object(l.b)(e+"F12",t)}getSnapshotFullPath(e,t){return(m.b.isWinRTHost?P.b.F12_TEMP_DATA_ROOT_PATH_UWP:P.b.F12_TEMP_DATA_ROOT_PATH)+e+"\\"+t}initializeView(){this._view&&R.a.fail("Tried to initialize a view when one already exists!");this._view=new Tt(this._controller);if(!this._selfTestInitialized&&Y.a.SelfTest&&K.a()){this._selfTestInitialized=!0;Y.a.SelfTest.init()}}isGraphCollectionSupported(){return!0}openSnapshot(e,t,i,s){i=i.toLocaleUpperCase();return this.session.openSnapshotDetails(e,t,i,s).then(e=>{var t=this._openedDocs[i];if(!t){var s=new ut(e.storageId);(t={controller:s,sessionInfo:e,title:i,view:new yt(s)}).view.title=i;this._openedDocs[i]=t}t.controller.setTargetView(e.targetView,e.sortProperty);this._view.addOrActivateDoc(t);return t.controller.loadSnapshot(e.storageId,e.filePaths,e.targetView,e.sortProperty)})}openSnapshotDiff(e,t,i,s,a,r){i=i.toLocaleUpperCase();return this.session.openSnapshotDiff(e,t,i,s,a,r).then(e=>{var t=this._openedDocs[i];if(t){t.controller.setTargetView(e.targetView,e.sortProperty);this._view.addOrActivateDoc(t);return Promise.resolve(null)}var r=new wt(e.storageId,s,a);(t={controller:r,sessionInfo:e,title:i,view:new yt(r)}).view.title=i;this._openedDocs[i]=t;t.controller.setTargetView(e.targetView,e.sortProperty);this._view.addOrActivateDoc(t);return r.diffSnapshots(e.storageId,e.filePaths,e.targetView,e.sortProperty).then(()=>void 0)})}resetView(){this._view.resetView()}startGraphCollection(){this._etwDataCollector||(this._etwDataCollector=new A.a);return this._etwDataCollector.startSession("JavaScriptCollectionAgent.dll","{8C0C6322-37F1-11E3-8259-6C3BE516EAD0}",!1,y.c.memoryAnalyzer)}clearEtw(){this._view&&this._view.stopProfiling();if(this._etwDataCollector){this._etwDataCollector.stopCollection();this._etwDataCollector=null}}}It.errorDisplay=Object(B.a)();class Tt extends L.a{constructor(e){super("f12ViewTemplate");this._controller=e;this._isProfiling=!1;this._startProfilingLink=this.findElement("startProfilingMessage");this._startProfilingLink.innerText=Object(l.b)("F12StartProfilingMessage");this._startProfilingLink.addEventListener("click",this.onStartClick.bind(this));this._startProfilingLink.addEventListener("keydown",this.onStartClick.bind(this));this._stopProfilingPrompt=this.findElement("stopProfilingPrompt");this._stopProgress=this.findElement("stopProgressBar");this.findElement("stopProfilingMessage").innerText=Object(l.b)("StoppingSession");this._model=e.summaryViewController.model;this._model.propertyChanged.addHandler(this.onPropertyChanged.bind(this));this._model.isOffline=!0;this._model.isRunning=!G.b();this._toolbarControl=new Dt(this);this._toolbarControl.model=this._model;this.findElement("toolbarContainer").appendChild(this._toolbarControl.rootElement);J.setToolbar(this._toolbarControl);J.updateAdditionalNavigationFrames(this._controller.summaryViewController.navigationId);J.switchNavigationView(this._controller.summaryViewController.navigationId);try{F.a.registerFocusHandlers(y.c.memoryAnalyzer)}catch(e){}this._tabControl=new X;this._tabControl.tabsLeftAligned=!0;this._tabControl.addTab(this._controller.view);this._tabControl.selectedItemChanged=((e,t)=>this.onSelectedTabChanged(e,t));this._startProfilingPrompt=this.findElement("startProfilingPrompt");this.updateStartProfilingPrompt();this.findElement("tabContainer").appendChild(this._tabControl.rootElement);this._parentContainer=document.getElementById("mainContainer");this._keyDownHandler=this.onKeyDown.bind(this);document.addEventListener("keydown",this._keyDownHandler);this._parentContainer.appendChild(this.rootElement)}get summaryViewModel(){return this._model}addOrActivateDoc(e){this._tabControl.containsTab(e.view)||this._tabControl.addTab(e.view);this._tabControl.selectedItem=e.view}closeView(){document.removeEventListener("keydown",this._keyDownHandler);this._parentContainer.innerHTML=""}removeDoc(e){this._tabControl.removeTab(e.view)}resetView(){this._model.isStartProfilingPromptVisible=!0;J.reset();J.updateAdditionalNavigationFrames(this._controller.summaryViewController.navigationId);J.switchNavigationView(this._controller.summaryViewController.navigationId)}startProfiling(){if(this._controller){Et.shell.closeAllSnapshots();R.a.isTrue(this._model.isTargetCompatible);ae.logPerformance({id:z.b.Memory_ToolReady_Start});W.b(y.c.memoryAnalyzer);this._isProfiling=!0;this._controller.goOnline();ae.logPerformance({id:z.b.Memory_ToolReady_Stop});this._model.isStartProfilingPromptVisible=!1;this.updateUIState();this._toolbarControl.getNamedControl("takeSnapshotToolbarButton").rootElement.focus()}}stopProfiling(){if(this._controller){this._isProfiling&&W.c(y.c.memoryAnalyzer);this._isProfiling=!1;this._controller.showWarning(null);this._controller.goOffline();0===this._model.snapshotSummaryCollection.length&&this.resetView();this.updateUIState()}}async openSession(){this._isProfiling&&this.stopProfiling();await It.load()}saveSession(){It.save()}takeSnapshot(){if(this._controller){this._controller.takeSnapshot();this.updateUIState()}}onPropertyChanged(e){switch(e){case Pe.IsActivatedPropertyName:this.onActivationChange();break;case Pe.StartProfilingEnabledPropertyName:case Pe.IsRunningPropertyName:this.updateUIState();break;case Pe.IsStartProfilingPromptVisiblePropertyName:this.updateStartProfilingPrompt();break;case Pe.IsTargetCompatiblePropertyName:if(this._controller)if(this._model.isTargetCompatible)this._controller.showWarning(null);else{this._controller.showWarning(Et.shell.getHostSpecificString("WarningIncompatibleStandardsMode"));this._model.isStartProfilingPromptVisible=!1}this.updateUIState()}if(e===Pe.IsOfflinePropertyName&&this._model.isOffline&&this._isProfiling){W.c(y.c.memoryAnalyzer);this._isProfiling=!1}}onActivationChange(){this.updateSnapshotDisplayState(this._tabControl.selectedItem,this._model.isActivated)}onSelectedTabChanged(e,t){this.updateSnapshotDisplayState(e,!1);this.updateSnapshotDisplayState(t,this._model.isActivated)}updateSnapshotDisplayState(e,t){e&&e instanceof yt&&(e.model.isDisplayed=t)}onStartClick(e){if(this._model.isOffline&&j.a.isValidEvent(e)||32===e.keyCode||13===e.keyCode){ae.logExecuteCommand(ne.START_PROFILE,N.c.Ui);this.startProfiling()}}onKeyDown(e){switch(e.keyCode){case 69:if(e.ctrlKey&&!e.altKey&&!e.shiftKey)if(this._model.isOffline){if(this._model.isStartEnabled){ae.logExecuteCommand(ne.START_PROFILE,N.c.KeyboardShortcut);this.startProfiling();e.preventDefault()}}else if(this._model.isStopEnabled){ae.logExecuteCommand(ne.STOP_PROFILE,N.c.KeyboardShortcut);this.stopProfiling();e.preventDefault()}break;case 79:if(e.ctrlKey&&!e.altKey&&!e.shiftKey&&this._model.isOpenSessionEnabled){ae.logExecuteCommand(ne.IMPORT_SESSION,N.c.KeyboardShortcut);this.openSession();e.preventDefault()}break;case 83:if(e.ctrlKey&&!e.altKey&&!e.shiftKey&&this._model.isSaveSessionEnabled){ae.logExecuteCommand(ne.EXPORT_SESSION,N.c.KeyboardShortcut);this.saveSession();e.preventDefault()}break;case 84:if(e.ctrlKey&&e.shiftKey&&!e.altKey){ae.logExecuteCommand(ne.TAKE_SNAPSHOT,N.c.KeyboardShortcut);this.takeSnapshot();e.preventDefault()}}}updateStartProfilingPrompt(){this._startProfilingPrompt.style.display=this._model.isStartProfilingPromptVisible?"":"none";this._tabControl.rootElement.style.display=this._model.isStartProfilingPromptVisible?"none":"";this._model.isStartProfilingPromptVisible&&J.updateAdditionalNavigationFrames(this._controller.summaryViewController.navigationId)}updateUIState(){this._startProfilingLink.style.display=this._model.isStartEnabled?"":"none";this._stopProfilingPrompt.style.display=this._model.isStopping?"":"none";this._stopProgress.style.display=this._model.isStopping?"":"none";this._model.isRunning?Tt.errorDisplay.close():Tt.errorDisplay.show(Object(l.b)("MemoryDisabledAtBreakpoint"))}}Tt.errorDisplay=Object(B.a)();class xt{constructor(){this._eventManager=new C.a;this._traceWriter=new S.a}get internalFeedback(){return this._internalFeedback}get memoryAnalyzerData(){return this._memoryAnalyzerData}get packager(){return this._packager}get shell(){return this._shell}get traceWriter(){return this._traceWriter}get userSettings(){return this._userSettings}addEventListener(e,t){if(e===Pt.Initialized&&this._shell){var i=document.createEvent("Event");i.initEvent(Pt.Initialized,!1,!1);t(i)}else this._eventManager.addEventListener(e,t)}async changeSession(e){this._session=e;await this._shell.changeSession(this._session);this.onIdle()}main(){this._externalObj=m.b;window.addEventListener("load",()=>{Object(v.g)().call("ms:host","postPendingMessageToPlugin",[y.c.memoryAnalyzer]);var e,t,i;e=new E;this._internalFeedback=new x;try{this._packager=new f.a(this._externalObj.packager)}catch(e){this._packager=null}t=m.b.utilities.loadExtension("MemoryAnalyzer.dll","{8C0C6312-37F1-11E3-8259-6C3BE516EAD0}");i=w;le();i&&(this._traceWriter=new S.b(i));this._memoryAnalyzerData=new T(t);(new k).getUserSettings().then(t=>{this._userSettings=t;this._session=e;this.initializeErrorReporting();m.b.addEventListener("close",this.onClose);e.getSessionInfo().then(t=>{this._shell=this.getShell(e,t);this._shell.initializeView();this.onIdle();this._eventManager.dispatchEvent(Pt.Initialized)})});Object(g.a)()})}initializeErrorReporting(){window.onerror=((e,t,i)=>{var s,a;arguments&&arguments[3]&&"number"==typeof arguments[3]&&(s=arguments[3]);if(arguments&&arguments[4]&&arguments[4]instanceof Error){a="Error number: "+arguments[4].number;a+="\r\nStack: "+arguments[4].stack}else a="Unhandled Error";this.reportError(new Error(e),a,t,i,s);return!0})}onIdle(){_.a.notify(de.Idle)}removeEventListener(e,t){this._eventManager.removeEventListener(e,t)}reportError(e,t,i,s,a){if(!this.userSettings||!this.userSettings.disableWER){var r=e.message||e.description,n=i||"MemoryAnalyzer",o=s||0,l=a||0,h="Error description:  "+r;e.number&&(h+="\r\nError number:  "+e.number);i&&(h+="\r\nSource:  "+i);if(e.stack){var d=e.stack;h+="\r\nError stack:  "+d;if(!r){var c=d.indexOf("\n");if(c>0){c=Math.min(c,50);r=d.substring(0,c)}}if(void 0===i){var p=d.match(/(file|res):?([^)]+)\)/);p&&p.length>2&&(n=p[2])}if(void 0===s){(!(p=d.match(/line ?(\d+)/))||p.length<=1)&&(p=d.match(/js:?(\d+):/));p&&p.length>1&&(o=parseInt(p[1]))}}t&&(h+="\r\nAdditional Info:  "+t);b.a(r,n,o,h,l);this.internalFeedback.isEnabled().then(e=>{e&&this._session.save(!1).then(e=>{this.internalFeedback.sendData(!0,"","","",h,e)})})}}saveSession(){return this._session.save(!1)}getShell(e,t){return new It(this._externalObj,e,t)}onClose(){_.a.notify(de.WindowClose)}}i.d(t,"ProgramEvents",function(){return Pt});i.d(t,"Program",function(){return Et});class Pt{}Pt.Initialized="initialized";u();const Ot=new xt;Object(a.a)().then(async()=>{Object(s.a)();Ot.main()});let Et=Ot}});
