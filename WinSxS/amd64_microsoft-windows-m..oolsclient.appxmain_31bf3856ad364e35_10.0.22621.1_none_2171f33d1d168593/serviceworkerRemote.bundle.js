!function(e){var r={};function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};e[i].call(n.exports,n,n.exports,t);n.l=!0;return n.exports}t.m=e;t.c=r;t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})};t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})};t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};t.d(r,"a",r);return r};t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)};t.p="";t(t.s=6)}([function(e,r,t){"use strict";class i{static escapeRegExp(e){return String.prototype.replace.call(e,i.ESCAPE_USER_INPUT_REGEX,"\\$&")}static escapeRegExpWithWildCard(e){return String.prototype.replace.call(e,i.ESCAPE_USER_INPUT_REGEX,function(e){return"*"===e?".*":"\\"+e})}static wrapInQuotes(e){return'"'+String.prototype.replace.call(e,/\\"/g,'"')+'"'}static unescapeHtml(e){if("string"!=typeof e){if(null===e||void 0===e)return"";e=""+e}return String.prototype.replace.call(String.prototype.replace.call(String.prototype.replace.call(String.prototype.replace.call(String.prototype.replace.call(e,/&gt;/g,">"),/&lt;/g,"<"),/&apos;/g,"'"),/&quot;/g,'"'),/&amp;/g,"&")}static escapeHtmlAndPreserveWhitespace(e){var r=[e],t=(e=String.prototype.replace.call(e,/(\r\n|\n\r|\r|\n)/g,"\r\n")).split("\r\n");if(t.length>0){r=[];for(var n=0;n<t.length;n++){var s=t[n];s="<pre>"+(s=i.escapeHtml(s))+"</pre>";r.push(s)}}return r}static escapeHtml(e){if("string"!=typeof e){if(null===e||void 0===e)return"";e=""+e}return String.prototype.replace.call(String.prototype.replace.call(String.prototype.replace.call(String.prototype.replace.call(String.prototype.replace.call(e,/&/g,"&amp;"),/"/g,"&quot;"),/'/g,"&apos;"),/</g,"&lt;"),/>/g,"&gt;")}static replaceSpacesWithNonBreakingSpaceEntities(e){return String.prototype.replace.call(e,/ /g," ")}static replaceLineBreaksWithNonBreakingSpaceEntities(e){return String.prototype.replace.call(e,/[\r\n]/g," ")}}i.ESCAPE_USER_INPUT_REGEX=/([.+?^=!:${}()|\[\]\/\\])|(\*)/g;t.d(r,"a",function(){return n});t.d(r,"e",function(){return s});t.d(r,"d",function(){return a});t.d(r,"c",function(){return c});t.d(r,"b",function(){return l});var n;!function(e){e[e.Frame=0]="Frame";e[e.ExtensionContext=1]="ExtensionContext"}(n||(n={}));class s{static addListener(e,r,t,i){i?e.addEventListener(r,t,i):e.addEventListener(r,t)}static addSafeListener(e,r,t,i,n,o){var a=s.createSafeFunction(e,i,o);s.addListener(r,t,a,n);return a}static removeListener(e,r,t,i){i?e.removeEventListener(r,t,i):e.removeEventListener(r,t)}static getDefaultView(e){return e?void 0!==e.defaultView?e.defaultView:e.parentWindow:null}static isCrossSiteWindow(e,r){try{e.Object.getOwnPropertyNames(r)}catch(e){return!0}return!1}static getValidWindow(e,r,t){try{if(dom.isWindow(r)){let i=r;if(s.isCrossSiteWindow(e,r)){let n=dom.getCrossSiteWindow(e,r,t);n&&(i=n.document.defaultView)}if(i.document)return{isValid:!0,window:i.document.defaultView}}}catch(e){}return{isValid:!1,window:null}}static getValidContentWindow(e,r){try{return s.getValidWindow(e,r.contentWindow)}catch(e){return{isValid:!1}}}static originForWindow(e){return e&&e.location&&e.location.protocol&&e.location.host?i.escapeHtml(e.location.protocol+"//"+e.location.host):null}static createSafeFunction(e,r,t){return s.executeScript("(func) => { return (...args) => func(...args) }",e,!0)(browser.createSafeFunction(e,r,t))}static safeAsyncCall(e,r){let t,i;const n=new Promise((e,r)=>{t=e;i=r});let s=this.createSafeFunction(e,e=>{t(e)}),o=this.createSafeFunction(e,e=>{i(e)});r.then(s,o);return n}static executeScript(e,r,t){return diagnosticsScript.debugEval.bind(r)(e,t)}static getWindowIterator(e){return new o([e],e=>{for(var r=[],t=0;t<e.frames.length;t++){var i=s.getValidWindow(e,e.frames[t]);i.isValid&&r.push(i.window)}return r})}static getStyleSheetIterator(e,r){var t=[e];if(!r)for(var i=0;i<e.imports.length;i++)t.push(e.imports[i]);return new o(t,e=>{if(!r||!e.imports)return null;for(var t=[],i=0;i<e.imports.length;i++)t.push(e.imports[i]);return t})}static refreshBrowser(){try{browser.refresh()}catch(e){}}}class o{constructor(e,r){this._q=e;this._moreItems=r}hasNext(){return this._q.length>0}next(){if(!this.hasNext())return null;var e=this._q.pop(),r=this._moreItems(e);r&&(this._q=this._q.concat(r));return e}}class a{static propertyEvaluationFunction(e,r){var t,i;if(e.location.protocol.indexOf("http")>=0){t=a.HttpObjectWatchList.lastIndexOf(Object.prototype.toString.call(r));i=a.HttpPropertyIgnorelist[t]}else if(e.location.protocol.indexOf("ms-appx")>=0){t=a.FileObjectWatchList.lastIndexOf(Object.prototype.toString.call(r));i=a.FilePropertyIgnorelist[t]}return i?(e,r)=>{if(!(i.lastIndexOf(r)>=0))try{return e[r]}catch(e){return e.toString()}}:(e,r)=>e[r]}}a.HttpObjectWatchList=["[object Window]"];a.HttpPropertyIgnorelist=[["indexedDB","msIndexedDB"]];a.FileObjectWatchList=["[object Window]"];a.FilePropertyIgnorelist=[["clipboardData"]];class c{constructor(e){this._global=e;this._name=e.location.hostname+e.location.pathname}get name(){return this._name}get type(){return n.Frame}get global(){return this._global}set global(e){this._global=e}executeScript(e,r){return s.executeScript(e,browser.unwrapMirror(this._global),r)}createSafeFunction(e){return s.createSafeFunction(browser.unwrapMirror(this._global),e,!0)}addSafeListener(e,r,t,i){return s.addSafeListener(browser.unwrapMirror(this._global),e,r,t,i,!0)}}class l{constructor(e){this._extensionContext=e;let r=this._extensionContext.name;const t=r.lastIndexOf("_");t>=0&&(r=r.substr(0,t));this._name=r}get name(){return this._name}get type(){return n.ExtensionContext}get global(){return this._extensionContext.global}get extensionContext(){return this._extensionContext}executeScript(e,r){return s.executeScript(e,browser.unwrapMirror(this._extensionContext.global),r)}createSafeFunction(e){return this._extensionContext.createSafeFunction(browser.unwrapMirror(this.global),e)}addSafeListener(e,r,t,i){var n=this.createSafeFunction(t);s.addListener(e,r,n,i);return n}}},function(e,r,t){"use strict";t.d(r,"a",function(){return i});class i{static isTrue(e,r){if(!e){r=r?"Internal error. "+r:"Internal error. Unexpectedly false.";i.fail(r)}}static isFalse(e,r){if(e){r=r?"Internal error. "+r:"Internal error. Unexpectedly true.";i.fail(r)}}static isNull(e,r){if(null!==e){r=r?"Internal error. "+r:"Internal error. Unexpectedly not null.";r+=" '"+e+"'";i.fail(r)}}static isUndefined(e,r){0;if(void 0!==e){r=r?"Internal error. "+r:"Internal error. Unexpectedly not undefined.";r+=" '"+e+"'";i.fail(r)}}static hasValue(e,r){if(null===e||void 0===e){r=r?"Internal error. "+r:"Internal error. Unexpectedly "+(null===e?"null":"undefined")+".";i.fail(r)}}static areEqual(e,r,t){e!==r&&i.fail(`Error: ${t}, Unexpectedly not equal- Actual: '${e}', Expected: '${r}'`)}static areNotEqual(e,r,t){e===r&&i.fail(`Error: ${t}, Identical input passed to areNotEqual: '${e}'`)}static failDebugOnly(e){i.fail(e)}static fail(e){var r=new Error((e||"Assert failed.")+"\n");try{throw r}catch(e){e.stack&&(e.description=e.stack);throw e}}}},function(e,r,t){"use strict";t.d(r,"a",function(){return n});var i=t(1);class n{constructor(e,r,t,i,n){this._ourIdentifier=e;this._nextId=0;this._promiseTable={};this._jsonRpcMethodReceive=r;this._jsonRpcNotificationReceive=t;this._postMessage=i;Date.now||(Date.now=function(){return+new Date});n(e=>{this.onMessage(e)})}jsonRpcMethodCall(e,r,t,n,s){t||i.a.failDebugOnly("Trying to insert a promise into the queue without a completed function: The front end will have no way of knowing this promise completed");var a=this._ourIdentifier+"|"+this._nextId;this._nextId++;this._promiseTable[a]={completed:t,error:n};var c=JSON.stringify({id:a,method:e,params:r});if(o.RandomDelay){o.queueData(()=>{this._postMessage(c,s)},c);return!0}return this._postMessage(c,s)}jsonRpcNotification(e,r,t){var i=this._ourIdentifier+"|NULL",n=JSON.stringify({id:i,method:e,params:r});o.RandomDelay?o.queueData(()=>{this._postMessage(n,t)},n):this._postMessage(n,t)}onMessage(e){var r=JSON.parse(e.data),t=r.id.split("|");i.a.areEqual(t.length,2);"NULL"===t[1]?t[0]!==this._ourIdentifier&&this._jsonRpcNotificationReceive(r.method,r.params,r.id):t[0]!==this._ourIdentifier||r.method?o.RandomDelay?o.queueData(()=>{this.handleCall(r)},e.data):this.handleCall(r):o.RandomDelay?o.queueData(()=>{this.handleReply(r)},e.data):this.handleReply(r)}handleReply(e){if(this._promiseTable[e.id]&&this._promiseTable[e.id].completed){if(e.error){i.a.isUndefined(e.data,"Can't have both data and error");this._promiseTable[e.id].error(e.error)}else this._promiseTable[e.id].completed(e.data);delete this._promiseTable[e.id]}else i.a.failDebugOnly("Can't complete a promise that does not exist in the promise table. Probably a dup reply msg.")}handleCall(e){this._jsonRpcMethodReceive(e.method,e.params,(r,t)=>{var i;i=t?JSON.stringify({id:e.id,error:t}):JSON.stringify({id:e.id,data:r});this._postMessage(i)},e.id)}}class s{constructor(e,r){this.callback=e;this.message=r}}class o{static enableDelay(e,r){o.RandomDelay=!0;o.CalculateDelayTime=e;o.DelayedMessage=r}static disableDelay(){o.RandomDelay=!1;if(o.RandomDelayTimeout){clearTimeout(o.RandomDelayTimeout);o.RandomDelayTimeout=null;o.clearQueue()}}static queueData(e,r){var t=new s(e,r);o.DelayedQueue.push(t);if(!o.RandomDelayTimeout){var i=o.CalculateDelayTime(r);o.RandomDelayTimeout=setTimeout(o.fireRandomly,i)}}static fireRandomly(){var e=o.DelayedQueue.shift();o.DelayedMessage(e.message);e.callback();if(o.DelayedQueue.length>0){var r=o.CalculateDelayTime(o.DelayedQueue[0].message);o.RandomDelayTimeout=setTimeout(o.fireRandomly,r)}else o.RandomDelayTimeout=null}static clearQueue(){for(var e=0;e<o.DelayedQueue.length;e++){var r=o.DelayedQueue[e];o.DelayedMessage(r.message);r.callback()}o.DelayedQueue=[]}}o.RandomDelay=!1;o.DelayedQueue=[]},,,,function(e,r,t){"use strict";t.r(r);var i,n=t(2),s=t(0);!function(e){e[e.starting=0]="starting";e[e.running=1]="running";e[e.stopping=2]="stopping";e[e.stopped=3]="stopped"}(i||(i={}));const o="registrationChanged",a="controllerchange",c="clientsChanged",l="updatefound",d="executionStateChanged",u="statechange",h="serviceWorkerUpdate",g="serviceWorkerExecutionStateChanged";class v{constructor(e,r){this.remote=e;this.browser=r;this._observedServiceWorkerContainers=new Set;this._observedDiOMServiceWorkerContainers=new Set;this._observedServiceWorkerRegistrations=new Set;this._observedDiOMServiceWorkerRegistrations=new Set;this._observedSWs=new Set;this._observedDiOMSWs=new Set;this.onServiceWorkerUpdate=(()=>{this.remote.notify(h,[])});this.onServiceWorkerExecutionStateChanged=(()=>{this.remote.notify(g,[])})}areServiceWorkersEnabled(e){let r;r=e?this.remote.getWindowForOrigin(e):s.e.getDefaultView(this.browser.document);return this.areServiceWorkersEnabledInWindow(r)}areServiceWorkersEnabledInWindow(e){return!!e&&!!e.navigator.serviceWorker&&e.isSecureContext}async getServiceWorkerAttachParams(e,r,t){const n=await this.retrieveServiceWorkerByVersion(e,r,t);n.isRunning!==i.stopped&&n.isRunning!==i.stopping||await n.start();return this.getPIDandHWNDfromDebugId(n.debugId)}async retrieveServiceWorkerRegistrations(e){const r=this.remote.getWindowForOrigin(e);this.throwIfServiceWorkersDisabled(r);await this.registerServiceWorkerEvents(e);let t,i;await Promise.all([this.safeRetrieveJSServiceWorkerRegistrations(r).then(e=>{t=e}),this.retrieveDiagOMServiceWorkerRegistrations(e).then(e=>{i=e})]);const n=this.createF12ServiceWorkerRegistrations(r,t,i);if(void 0===n)throw new Error("Javascript and DiagnosticsOM service worker registrations did not match in length");return n}async retrieveServiceWorkerByVersion(e,r,t){const i=(await this.retrieveDiagOMServiceWorkerRegistrations(e)).find(e=>e.scope===r);if(i){if(i.active&&i.active.version===t)return i.active;if(i.installing&&i.installing.version===t)return i.installing;if(i.waiting&&i.waiting.version===t)return i.waiting;throw new Error(`Could not find service worker with version: ${t} on the registration with scope: ${r}`)}throw new Error(`Could not find a service worker registration for scope: ${r}`)}async unregisterServiceWorker(e,r){const t=this.remote.getWindowForOrigin(r);this.throwIfServiceWorkersDisabled(t);const i=await this.safeRetrieveJSServiceWorkerRegistration(t,e);if(i)return i.unregister();throw new Error(`Could not find a service worker registration for scope: ${e}`)}async updateServiceWorker(e,r){const t=this.remote.getWindowForOrigin(r);this.throwIfServiceWorkersDisabled(t);const i=await this.safeRetrieveJSServiceWorkerRegistration(t,e);if(i)return i.update();throw new Error(`Could not find a service worker registration for scope: ${e}`)}async serviceWorkerSimulatePushNotification(e,r,t){const i=await this.retrieveDiagOMServiceWorkerRegistration(t,r);if(i)return i.simulatePush(e);throw new Error(`Could not find a service worker registration for scope: ${r}`)}async startServiceWorker(e,r,t){(await this.retrieveServiceWorkerByVersion(e,r,t)).start()}async stopServiceWorker(e,r,t){return(await this.retrieveServiceWorkerByVersion(e,r,t)).stop()}async registerServiceWorkerEvents(e){const r=this.remote.getWindowForOrigin(e);this.throwIfServiceWorkersDisabled(r);const t=r.navigator.serviceWorker;if(!this._observedServiceWorkerContainers.has(t)){s.e.addSafeListener(r,t,a,this.onServiceWorkerUpdate);this._observedServiceWorkerContainers.add(t)}const i=this.browser.getServiceWorkerForOrigin(e);if(!this._observedDiOMServiceWorkerContainers.has(i)){i.addEventListener(o,this.onServiceWorkerUpdate);this._observedDiOMServiceWorkerContainers.add(i)}}clearServiceWorkerReferences(){this.removeEventListeners(this._observedDiOMServiceWorkerContainers,o,this.onServiceWorkerUpdate);this._observedDiOMServiceWorkerContainers.clear();this._observedServiceWorkerContainers.clear();this.removeEventListeners(this._observedDiOMServiceWorkerRegistrations,c,this.onServiceWorkerUpdate);this._observedDiOMServiceWorkerRegistrations.clear();this.removeEventListeners(this._observedServiceWorkerRegistrations,l,this.onServiceWorkerUpdate);this._observedServiceWorkerRegistrations.clear();this.removeEventListeners(this._observedDiOMSWs,d,this.onServiceWorkerExecutionStateChanged);this._observedDiOMSWs.clear();this.removeEventListeners(this._observedSWs,u,this.onServiceWorkerUpdate);this._observedSWs.clear()}throwIfServiceWorkersDisabled(e){if(!this.areServiceWorkersEnabledInWindow(e))throw new Error("Service workers are not enabled on this page")}async safeRetrieveJSServiceWorkerRegistrations(e){const r=await s.e.safeAsyncCall(e,e.navigator.serviceWorker.getRegistrations());return Array.from(r)}safeRetrieveJSServiceWorkerRegistration(e,r,t){return s.e.safeAsyncCall(e,e.navigator.serviceWorker.getRegistration(t||r))}retrieveDiagOMServiceWorkerRegistrations(e){let r=this.remote.getWindowForOrigin(e);r||(r=s.e.getDefaultView(this.browser.document));this.throwIfServiceWorkersDisabled(r);return e?this.browser.getServiceWorkerForOrigin(e).getDiagnosticsRegistrations():this.browser.getServiceWorkerForOrigin().getDiagnosticsRegistrations()}async retrieveDiagOMServiceWorkerRegistration(e,r){const t=this.remote.getWindowForOrigin(e);this.throwIfServiceWorkersDisabled(t);return r?(await this.browser.getServiceWorkerForOrigin(e).getDiagnosticsRegistrations()).find(e=>e.scope===r):this.browser.getServiceWorkerForOrigin(e).getDiagnosticsRegistration()}createF12ServiceWorkerRegistrations(e,r,t){if(!r||!t)return;if(r.length!==t.length)return;return r.map(r=>{const i=t.find(e=>r.scope===e.scope);if(!i)throw new Error(`Expected to find a diagnosticsOM Registration with scope "${r.scope}"`);return this.createF12ServiceWorkerRegistration(e,r,i)})}createF12ServiceWorkerRegistration(e,r,t){if(!this._observedServiceWorkerRegistrations.has(r)){s.e.addSafeListener(e,r,l,this.onServiceWorkerUpdate);this._observedServiceWorkerRegistrations.add(r)}if(!this._observedDiOMServiceWorkerRegistrations.has(t)){t.addEventListener(c,this.onServiceWorkerUpdate);this._observedDiOMServiceWorkerRegistrations.add(t)}const i={clientUrls:[],installTime:void 0,registrationTime:t.registrationTimeStamp,scope:r.scope};if(r.active&&t.active){i.active=this.createF12ServiceWorker(e,r.active,t.active);i.installTime=t.active.installTimeStamp}r.installing&&t.installing&&(i.installing=this.createF12ServiceWorker(e,r.installing,t.installing));if(r.waiting&&t.waiting){i.waiting=this.createF12ServiceWorker(e,r.waiting,t.waiting);i.installTime=t.waiting.installTimeStamp}for(const e of t.clientUrls)i.clientUrls.push(e);return i}createF12ServiceWorker(e,r,t){if(!this._observedSWs.has(r)){s.e.addSafeListener(e,r,u,this.onServiceWorkerUpdate);this._observedSWs.add(r)}if(!this._observedDiOMSWs.has(t)){t.addEventListener(d,this.onServiceWorkerExecutionStateChanged);this._observedDiOMSWs.add(t)}return{debugId:t.debugId,scriptURL:r.scriptURL,state:r.state,status:t.isRunning,version:t.version}}getPIDandHWNDfromDebugId(e){const r=new RegExp(/([a-f0-9]{8})([a-f0-9\-]{20})([a-f0-9]{8})/i),[,t,,i]=r.exec(e);return{pid:parseInt(i,16),hwnd:t}}removeEventListeners(e,r,t){for(const i of e)i.removeEventListener&&i.removeEventListener(r,t)}}t.d(r,"default",function(){return p});t.d(r,"serviceWorkerRemote",function(){return f});class p{constructor(){this._isInitialLoad=!0;this._port=toolUI.createPort("serviceWorkerDiagPort");toolUI.connect(this._port);this._rpc=new n.a("SERVICEWORKER_REMOTE_13",(e,r,t)=>this.jsonRpcMethodReceive(e,r,t),(e,r)=>this.jsonRpcNotificationReceive(e,r),e=>{this._port.postMessage(e)},e=>{this._port.addEventListener("message",r=>{e(r)})});s.e.addListener(browser,"beforeScriptExecute",()=>this.onBeforeScriptExecute());this.onBeforeScriptExecute()}notify(e,r){this._rpc.jsonRpcNotification(e,r)}getWindowForOrigin(e){if(!e)return null;const r=[s.e.getDefaultView(browser.document)];for(;r.length>0;){const t=r.pop();if(s.e.originForWindow(t)===e)return t;for(let e=0;e<t.frames.length;e++){const i=s.e.getValidWindow(t,t.frames[e]);i.isValid&&r.push(i.window)}}return null}async getServiceWorkerAttachParams(e,r,t){return this._serviceWorkerManager.getServiceWorkerAttachParams(e,r,t)}async retrieveServiceWorkerRegistrations(e){return this._serviceWorkerManager.retrieveServiceWorkerRegistrations(e)}async retrieveServiceWorkerByVersion(e,r,t){return this._serviceWorkerManager.retrieveServiceWorkerByVersion(e,r,t)}async unregisterServiceWorker(e,r){return this._serviceWorkerManager.unregisterServiceWorker(e,r)}async updateServiceWorker(e,r){return this._serviceWorkerManager.updateServiceWorker(e,r)}async registerServiceWorkerEvents(e){return this._serviceWorkerManager.registerServiceWorkerEvents(e)}async serviceWorkerSimulatePushNotification(e,r,t){return this._serviceWorkerManager.serviceWorkerSimulatePushNotification(e,r,t)}async startServiceWorker(e,r,t){return this._serviceWorkerManager.startServiceWorker(e,r,t)}async stopServiceWorker(e,r,t){return this._serviceWorkerManager.stopServiceWorker(e,r,t)}clearServiceWorkerReferences(){this._serviceWorkerManager.clearServiceWorkerReferences()}onBeforeScriptExecute(){this._serviceWorkerManager||(this._serviceWorkerManager=new v(this,browser));this._isInitialLoad&&(this._isInitialLoad=!1)}jsonRpcMethodReceive(e,r,t){let i;(i=r?this[e].apply(this,r):this[e].apply(this)).then&&"function"==typeof i.then?i.then(t).catch(e=>{t(void 0,e)}):t(i,void 0)}jsonRpcNotificationReceive(e,r){}}const f=new p}]);
