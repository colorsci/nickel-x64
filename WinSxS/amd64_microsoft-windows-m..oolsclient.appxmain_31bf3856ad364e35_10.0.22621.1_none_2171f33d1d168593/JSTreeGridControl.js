var __extends,Common;(function(n){function r(){document.addEventListener("keydown",function(n){if(n.keyCode===116||n.keyCode===117||n.keyCode===121&&n.shiftKey||n.keyCode===70&&n.ctrlKey)return n.preventDefault(),n.stopPropagation(),!1});document.addEventListener("contextmenu",function(n){return n.preventDefault(),n.stopPropagation(),!1});window.addEventListener("mousewheel",function(n){if(n.ctrlKey)return n.preventDefault(),n.stopPropagation(),!1})}var t,i;(function(n){n[n.BACKSPACE=8]="BACKSPACE";n[n.TAB=9]="TAB";n[n.ENTER=13]="ENTER";n[n.SHIFT=16]="SHIFT";n[n.CONTROL=17]="CONTROL";n[n.ALT=18]="ALT";n[n.CAPS_LOCK=20]="CAPS_LOCK";n[n.ESCAPE=27]="ESCAPE";n[n.SPACE=32]="SPACE";n[n.PAGE_UP=33]="PAGE_UP";n[n.PAGE_DOWN=34]="PAGE_DOWN";n[n.END=35]="END";n[n.HOME=36]="HOME";n[n.ARROW_LEFT=37]="ARROW_LEFT";n[n.ARROW_FIRST=37]="ARROW_FIRST";n[n.ARROW_UP=38]="ARROW_UP";n[n.ARROW_RIGHT=39]="ARROW_RIGHT";n[n.ARROW_DOWN=40]="ARROW_DOWN";n[n.ARROW_LAST=40]="ARROW_LAST";n[n.INSERT=45]="INSERT";n[n.DELETE=46]="DELETE";n[n.A=65]="A";n[n.B=66]="B";n[n.C=67]="C";n[n.F=70]="F";n[n.G=71]="G";n[n.K=75]="K";n[n.M=77]="M";n[n.O=79]="O";n[n.V=86]="V";n[n.X=88]="X";n[n.Y=89]="Y";n[n.Z=90]="Z";n[n.MENU=93]="MENU";n[n.PLUS=107]="PLUS";n[n.MINUS=109]="MINUS";n[n.F1=112]="F1";n[n.F2=113]="F2";n[n.F3=114]="F3";n[n.F4=115]="F4";n[n.F5=116]="F5";n[n.F6=117]="F6";n[n.F7=118]="F7";n[n.F8=119]="F8";n[n.F9=120]="F9";n[n.F10=121]="F10";n[n.F11=122]="F11";n[n.F12=123]="F12";n[n.COMMA=188]="COMMA";n[n.PERIOD=190]="PERIOD"})(n.KeyCodes||(n.KeyCodes={}));t=n.KeyCodes,function(n){n[n.LEFT_BUTTON=0]="LEFT_BUTTON";n[n.MIDDLE_BUTTON=1]="MIDDLE_BUTTON";n[n.RIGHT_BUTTON=2]="RIGHT_BUTTON"}(n.MouseButtons||(n.MouseButtons={}));i=n.MouseButtons;n.blockBrowserAccelerators=r})(Common||(Common={})),function(n){(function(n){var t=function(){function n(n){if(this._rootElement=n,typeof this._rootElement=="undefined")this._rootElement=document.createElement("div"),this._rootElement.style.width=this._rootElement.style.height="100%";else if(this._rootElement===null)throw new Error("Invalid root element for Control.")}return n.prototype.appendChild=function(n){this._rootElement.appendChild(n.rootElement);n.parent=this},n.prototype.removeChild=function(n){n.rootElement.parentElement&&(this._rootElement.removeChild(n.rootElement),n.parent=null)},Object.defineProperty(n.prototype,"rootElement",{get:function(){return this._rootElement},set:function(n){if(!n)throw new Error("Invalid root");var t=this._rootElement;this._rootElement=n;t&&t.parentNode&&t.parentNode.replaceChild(n,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},set:function(n){this._parent!==n&&(this._parent=n,this._parent&&!this._parent.rootElement.contains(this._rootElement)&&this._parent.appendChild(this),this.onParentChanged())},enumerable:!0,configurable:!0}),n.prototype.onParentChanged=function(){},n}();n.Control=t})(n.Controls||(n.Controls={}));var t=n.Controls}(Common||(Common={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){(function(i){var u,l,o,f,e,s,a,r,h;(function(n){var t=function(){function t(){}return t.stableReverse=function(n,t){for(var r,u,f=[],i=n.length-1;i>=0;i--){for(r=i-1;r>=0;r--)if(0!==t(n[r],n[i]))break;for(u=r+1;u<=i;u++)f.push(n[u]);i=r+1}for(i=0;i<f.length;i++)n[i]=f[i]},t.defaultComparer=function(n,t,i,r){var f=i[n.index],u=r[n.index];return typeof f=="undefined"||f===null?typeof u=="undefined"||u===null?0:-1:typeof u=="undefined"||u===null?1:f.toString().toLocaleUpperCase().localeCompare(u.toString().toLocaleUpperCase())},t.sortComparer=function(t,i,r,u){for(var f=0;f<t.length;f++){var o=t[f],s=i[f],h=s.comparer||n.TreeNodeSort.defaultComparer,e=h(s,o.order,r,u);if(e===0)continue;else return o.order==="desc"?-e:e}return 0},t}();n.TreeNodeSort=t})(i.Utility||(i.Utility={}));u=i.Utility;l=function(){function n(n,t,i){this.gridData=n;this.expandStates=t;this.toggleFunction=i}return n}();i.TreeInfo=l;o=function(){function n(t,i,r,u,f,e,o,s,h){this.index=t;this.text=i;this.tooltip=r;this.width=u;this.canSortBy=f;this.getColumnValue=e;this.getCellCSSClass=o;this.comparer=s;this.hasHTMLContent=!1;this.defaultSortOrder=h||"asc";this.maxTooltipLineLength=n.DEFAULT_MAX_TOOLTIP_LINE_LENGTH}return n.DEFAULT_MAX_TOOLTIP_LINE_LENGTH=64,n}();i.ColumnInfo=o;f=function(){function n(n,t){this.index=n;this.order=t}return n}();i.SortOrderInfo=f;e=function(){function n(n,t){this.data=n;this.expandState=t;this.children=[]}return n}();i.TreeNode=e;s=function(){function n(n,t){this.icon=n;this.checkbox=t}return n}();i.GutterOptions=s;a=function(){function n(n,t,i,r,u){this.childDataCallback=n;this.columns=t;this.sortOrders=i;this.allowMultiSelect=u||!1;this.allowSortOnMultiColumns=!1;this.asyncInit=!0;this.autoSort=!0;this.coreCssClass="grid";this.cssClass="";this.canvasClass="grid-canvas";this.headerElementClass="grid-header";this.headerColumnElementClass="grid-header-column";this.rowClass="grid-row";this.rowNormalClass="grid-row-normal";this.rowSelectedClass="grid-row-selected";this.rowSelectedBlurClass="grid-row-selected-blur";this.rowCurrentClass="grid-row-current";this.cellClass="grid-cell";this.expandStates=[];this.extendViewportBy=3;this.gutter=new s;this.header=!0;this.height="100%";this.initialSelection=!1;this.keepSelection=!1;this.payloadSize=200;this.source=null;this.editCellCallback=r;this.overflowColumn=!1;this.focusable=!0}return n}();i.GridOptions=a;r=function(){function n(n,t){this.rowIndex=n;this.dataIndex=t}return n}();i.RowIndexInfo=r;h=function(){function n(n,t){this.width=n;this.height=t}return n}();i.Size=h;var c=function(){function n(n,t){this.start=n;this.end=t}return n}(),v=function(){function n(n,t,i,r){this.active=n;this.index=t;this.originalWidth=i;this.origin=r}return n}(),y=function(t){function i(n,i){t.call(this,n);this._options=i;this._canvas=null;this._contentSpacer=null;this._element=null;this._focus=null;this._gutter=null;this._gutterHeader=null;this._header=null;this._headerCanvas=null;this._dataSource=[];this._rows={};this._columns=[];this._expandStates=null;this._expandedCount=0;this._sortOrder=[];this._rowInfoMap={};this._editCellCallback=null;this._selectedRows=null;this._selectionStart=-1;this._selectionCount=0;this._selectedIndex=-1;this._active=!1;this._activeAriaId=null;this._getChildDataCallback=null;this._canvasHeight=300;this._canvasWidth=300;this._contentSize=null;this._measurements={};this._count=0;this._indentIndex=0;this._indentLevels=null;this._visibleRange=[];this._columnSizing=null;this._sizingElement=null;this._copyInProgress=!1;this._resetScroll=!1;this._ignoreScroll=!1;this._scrollTop=0;this._scrollLeft=0;this._cancelable=null;this._updateThemeAttributes();this.initialize()}return __extends(i,t),i._setTooltip=function(n,t,i,r){r=r||o.DEFAULT_MAX_TOOLTIP_LINE_LENGTH;r!==-1&&(t=this._textSplit(t,r));Microsoft.Plugin.Tooltip.defaultTooltipContentToHTML&&(t=t.replace(/[<>]/g,function(n){return n==="<"?"&lt;":"&gt;"}),t=t.replace("\r\n","<br/>"));var u={content:t,height:i,contentContainsHTML:Microsoft.Plugin.Tooltip.defaultTooltipContentToHTML};n.setAttribute("data-plugin-vs-tooltip",JSON.stringify(u))},i.prototype.getSelectionCount=function(){return this._selectionCount},i.prototype.getElement=function(){return this._element},i.prototype.setAriaDescription=function(n){this._ariaDescription=n;this._updateGridAriaLabel()},i.prototype.initializeDataSource=function(){var n;if(this._resetScroll){this._ignoreScroll=!0;try{n=this._canvas;n.scrollTop=0;n.scrollLeft=0;this._scrollLeft=0;this._scrollTop=0;this._resetScroll=!1}finally{this._ignoreScroll=!1}}return this.setDataSource(this._options.source,this._options.expandStates,this._options.columns,this._options.sortOrders).then(this._initializeDataSourceComplete.bind(this))},i.prototype.activateWithDynamicData=function(n){this.setDataSource([],[],this._options.columns,null);this._count=n;this._expandedCount=n;this._expandStates=[0]},i.prototype.setDataSource=function(n,t,r,u,f){var s=this,o,h,l,e,c;if(this._dataSource=n||[],this._count=l=this._dataSource.length,t?(this._expandStates=t,this._indentLevels=i.expand(t)):(this._indentLevels=null,this._expandStates=null),this._expandedCount=l,this._updateRanges(),this._columns=[],r){var a=function(n,t,i,r,u,f,e){return s._drawCell(n,t,i,r,u,f,e)},v=function(n,t){return s._drawHeaderCellValue(n,t)},y=function(n,t,i){return s.getColumnValue(n,t,i)};for(o=0,h=r.length;o<h;o++)e=r[o],e.index=typeof e.index!="undefined"?e.index:String(o),e.canSortBy=e.canSortBy!==!1,e.canMove=e.canMove!==!1,e.width=typeof e.width!="undefined"?e.width:100,e.getCellContents=e.getCellContents||a,e.getHeaderCellContents=e.getHeaderCellContents||v,e.getColumnValue=e.getColumnValue||y,this._columns.push(e)}if(this._sortOrder=[],u)for(o=0,h=u.length;o<h;o++)c=u[o],c.order!=="desc"&&(c.order="asc"),this._sortOrder.push(c);return this._clearSelection(),this._determineIndentIndex(),this._options.asyncInit?window.setTimeout(function(){return s._layoutAfterSetDataSource(f)},0):this._layoutAfterSetDataSource(f),this._updateAriaLabelForColumns(r),Promise.resolve(null)},i.prototype.getRowInfo=function(n){return this._rows[n]},i.prototype.getRowData=function(n){return this._dataSource[n]},i.prototype.getRowDataIndex=function(n){return this._dataSource.indexOf(n)},i.prototype.getColumns=function(){return this._columns||[]},i.prototype.getSortOrder=function(){return this._sortOrder||[]},i.prototype.getSortColumns=function(n){return n=n||this.getSortOrder(),this._getSortColumns(n)},i.prototype._updateRanges=function(){var n=0,i=0,r=this._count,t=[],u=0,f;if(this._expandStates){while(n<r)f=this._expandStates[n],f<0?(t[t.length]=new c(i,n),u+=n-i+1,n+=1-f,i=n):n++;i<r&&(t[t.length]=new c(i,r-1),u+=r-i)}else u=r,t[t.length]=new c(0,u);this._expandedCount=u;this._visibleRange=t},i.prototype.expandNode=function(n){var r=this,t,i;this._dataSource[n+1].isPlaceholder&&this._getChildDataCallback(this._dataSource[n],function(t){t!==null&&r._adjustForDynamicData(t.itemsWithPlaceholders,t.expandStates,n)});this._expandStates&&(t=this._getExpandState(n),t<0&&(this._expandStates[n]=-t,this._updateRanges(),i=this._rows[n],i&&(i.isDirty=!0),this._onExpandedCollapsed(!0,n)))},i.prototype.collapseNode=function(n){var t,i;this._expandStates&&(t=this._expandStates[n],t>0&&(this._expandStates[n]=-t,this._updateRanges(),i=this._rows[n],i&&(i.isDirty=!0),this._onExpandedCollapsed(!1,n)))},i.prototype.expandAllNodes=function(){var n=0,f=this._count,t=this._expandStates,i=!1,e=this._rows,r,u;if(t){while(n<f)r=t[n],r<0&&(t[n]=-r,i=!0,u=e[n],u&&(u.isDirty=!0)),n++;i&&(this._updateRanges(),this._onExpandedCollapsed(!0))}return i},i.prototype.collapseAllNodes=function(){var n=0,f=this._count,t=this._expandStates,i=!1,e=this._rows,r,u;if(t){while(n<f)r=t[n],r>0&&(t[n]=-r,i=!0,u=e[n],u&&(u.isDirty=!0)),n++;i&&(this._updateRanges(),this._onExpandedCollapsed(!1))}return i},i.prototype.expandAll=function(){var n=this;this._updateExpansionStateAndRedraw(function(){return n.expandAllNodes()})},i.prototype.collapseAll=function(){var n=this;this._updateExpansionStateAndRedraw(function(){return n.collapseAllNodes()})},i.prototype.tryToggle=function(n){var i,t,r;if(!this._expandStates||this._selectedIndex<0||this.getExpandedCount()<=0||(t=this._getDataIndex(this._selectedIndex),r=this._rows[t],!r))return!1;if(i=this._getExpandState(t),i!==0){if(n)if(i<0)this.expandNode(t);else return!1;else if(i>0)this.collapseNode(t);else return!1;return this._clearSelection(),this._addSelection(this._selectedIndex),this._layoutContentSpacer(),this._redraw(),!0}return!1},i.prototype.calculateVisibleRowIndices=function(n,t){var i=this.getExpandedCount()-1,r=this._measurements.rowHeight||1;return{first:Math.min(i,Math.max(0,Math.ceil(n/r))),last:Math.min(i,Math.floor(t/r)-1)}},i.prototype.getSelectedRowIntoView=function(n){return this._getRowIntoView(this._selectedIndex,n)},i.prototype.getSelectedRowIntoViewCenter=function(){return this._getRowIntoViewCenter(this._selectedIndex)},i.prototype.getSelectedRows=function(){return this._selectedRows},i.prototype.cacheRows=function(){},i.prototype.updateRow=function(n,t){var r=0,u=0,i;typeof t=="undefined"||t<0?t=this._getDataIndex(n):(typeof n=="undefined"||n<0)&&(n=this._getRowIndex(t));i=this._rows[t];i&&(this._expandStates&&(r=this._getExpandState(t),u=this.indentLevel(t)),this._updateRow(i,n,t,r,u))},i.prototype.layout=function(){this._takeMeasurements();this._measureCanvasSize();this._cleanUpRows();this._fixScrollPos();this._layoutContentSpacer();this._updateViewport();this._layoutHeader();this._drawHeader()},i.prototype.redraw=function(){this._fixScrollPos();this._redraw(!0)},i.prototype.getColumnValue=function(n,t){return this._dataSource[n][t]},i.prototype.getColumnText=function(n,t,r){var u,f=t.getColumnValue(n,t.index,r,this._dataSource);return u=typeof f!="string"?i.convertValueToDisplayString(f,t.format):f,t.maxLength=Math.max(t.maxLength||0,u.length),u},i.prototype.getSelectedRowIndex=function(){return this._selectionCount>0?this._selectedIndex:-1},i.prototype.setSelectedRowIndex=function(n){this._clearSelection();this._addSelection(n)},i.prototype.getSelectedDataIndex=function(){return this._getDataIndex(this.getSelectedRowIndex())},i.prototype.getSelectedDataIndices=function(){var i,n=this._selectedRows,t=[];if(n)for(i in n)t[t.length]=n[i];return t},i.prototype.ensureDataIndexExpanded=function(n){for(var t=this._getRowIndex(n);t<0||n>0&&t===0;)this.expandNode(this._getDataIndex(-t)),t=this._getRowIndex(n);return t},i.prototype.setSelectedDataIndex=function(n,t){var i=t?this.ensureDataIndexExpanded(n):this._getRowIndex(n);this.setSelectedRowIndex(i)},i.prototype.selectionChanged=function(){},i.prototype.selectedIndexChanged=function(){},i.prototype.onSort=function(n,t){return this._options.autoSort&&(this._trySorting(n,t),this._sortOrder=n,this.layout()),!0},i.prototype.getRowInfoFromEvent=function(n,t){var i=this.findClosestElement(n.target,t);return i?this._rowInfoMap[i.id]:null},i.prototype.getExpandStates=function(){return this._expandStates},i.prototype.options=function(){return this._options},i.prototype.getExpandedCount=function(){return this._expandedCount},i.prototype.setCounts=function(n){this._expandedCount=n;this._count=n},i.prototype.updateCounts=function(n){this._expandedCount+=n;this._count+=n},i.prototype.getVisibleRowIndices=function(){return this._getVisibleRowIndices()},i.prototype.addEventListenerToCanvas=function(n,t,i){this._canvas.addEventListener(n,function(){return i.apply(t,arguments)})},i.prototype.onSelectRow=function(){},i.prototype.widenRows=function(n){var u=4,i,r,t,f;for(t in this._canvas.children)if(t!=="0"&&this._canvas.children.hasOwnProperty(t)&&this._canvas.children[t].children){i=0;for(r in this._canvas.children[t].children)this._canvas.children[t].children.hasOwnProperty(r)&&(i+=this._canvas.children[t].children[r].scrollWidth);n<i+u&&(n=i+u)}for(t in this._canvas.children)t!=="0"&&this._canvas.children.hasOwnProperty(t)&&this._canvas.children[t].children&&(f=this._canvas.children[t],f.style.width=n+"px")},i.prototype.canvasClientWidth=function(){return this._canvas.clientWidth},i.prototype.markRowDirty=function(n){this._rows[n]&&(this._rows[n].isDirty=!0)},i.prototype.getMeasurements=function(){return this._measurements},i.prototype.getRowTop=function(n){return n*this._measurements.rowHeight},i.prototype.getTotalDataHeight=function(){return this.getExpandedCount()*this._measurements.rowHeight},i.prototype.isActive=function(){return this._active},i.prototype.getHeaderHeight=function(){return this._options.header?this._header.clientHeight:0},i.prototype.onCtrlC=function(){},i.prototype.onF12=function(){},i.prototype.onCtrlG=function(){},i.prototype.isEmpty=function(){var n,t;for(n in this._rows)if(t=parseInt(n),this._rows.hasOwnProperty(t))return!1;return!0},i.prototype.getCanvas=function(){return this._canvas},i.prototype.updateMouseOverRowStyle=function(){},i.prototype.updateMouseOutRowStyle=function(){},i.prototype.updateSelectedRowStyle=function(){},i.prototype.updateUnselectedRowStyle=function(){},i.prototype.onTreeIconMouseOver=function(){},i.prototype.onTreeIconMouseOut=function(){},i.expand=function(n){var u=[],i,t,r,e,f,o;if(n.length>0){for(i=[],t={level:1,origCount:n.length,remainingCount:n.length},i.push(t),r=0;r<n.length;){for(u.push(t.level),t.remainingCount--;t.remainingCount===0;){if(i.pop(),i.length==0)if(r===n.length-1)break;else throw new Error("invalid descendant counts, nesting not possible");if(e=i[i.length-1],e.remainingCount-=t.origCount,t=e,t.remainingCount<0)throw new Error("invalid descendant counts, cannot convert to indentation levels")}f=Math.abs(n[r]);f>0&&(o={level:u[u.length-1]+1,origCount:f,remainingCount:f},i.push(o),t=o);r++}if(i.length>0)throw new Error("invalid descendant counts, more input expected")}return u},i.prototype._getExpandState=function(n){var t=0;return this._expandStates&&typeof this._expandStates[n]=="number"&&(t=this._expandStates[n]),t},i.prototype._clearSelection=function(){this._selectionCount=0;this._selectedRows=null;this._activeAriaId=null},i.prototype._addSelection=function(n,t,i){var u=i&&i.keepSelectionStart,f=i&&i.doNotFireEvent,e=i&&i.toggle,r;if(this._options.allowMultiSelect===!1&&(u=!1,this._clearSelection()),this._selectedRows||(this._selectedRows={}),n>=0?(r=!0,this._selectedRows.hasOwnProperty(n)?e&&(r=!1,this._selectionCount=Math.max(0,this._selectionCount-1),delete this._selectedRows[n]):this._selectionCount++,typeof t!="number"&&(t=this._getDataIndex(n)),r&&(this._selectedRows[n]=t),this._selectedIndex=n,this._updateAriaAttribute(),(this._selectionStart<0||!u)&&(this._selectionStart=n)):(t=-1,this._selectedIndex=-1),f||(this._updateSelectionStyles(),this._selectionChanged(),this._selectedIndexChanged(this._selectedIndex,t)),n>=0)this.onSelectRow(n)},i.prototype.checkUpdateActive=function(n){this._selectionCount>0&&n.rowIndex===this._selectedIndex&&n.row&&this.updateActive(n.row)},i.prototype.updateActive=function(n){n.focus()},i.prototype._updateAriaAttribute=function(){var i=this._getDataIndex(this._selectedIndex),n,t,r;i!=null&&(n=this.getRowInfo(i),n&&n.row?(t=n.row.getAttribute("id"),t!==this._activeAriaId&&(r=this._getAriaLabelForRow(n),n.row.setAttribute("aria-label",r),this._activeAriaId=t),this._active&&this.checkUpdateActive(n)):this._updateAriaOnViewportUpdate=!0)},i.prototype._getAriaLabelForRow=function(n){var i="",c=n.rowIndex,u=n.dataIndex,s=0,h=0,f,t,e,r,o;for(this._expandStates&&(s=this._expandStates[u],h=this._indentLevels[u]),f=this._columns,t=0,e=f.length;t<e;t++)(r=f[t],r.hidden)||(o=r.text+", "+this.getColumnText(u,r,t),i&&(i+=", "),i+=o);return i},i.prototype._updateSelectionStyles=function(){var n=this,t=function(){var t,u=n._selectedRows,f=n._selectedIndex,i=n._rows,r;for(t in i)r=i[t],n._updateRowSelectionStyle(r,u,f)};this._options.allowMultiSelect?(this._delayedUpdateSelectionCookie&&window.clearImmediate(this._delayedUpdateSelectionCookie),this._delayedUpdateSelectionCookie=window.setImmediate(function(){t()})):t()},i.prototype._updateRowSelectionStyle=function(n,t,i){var f=n.rowIndex,u=n.row,r=n.gutterRow;u.classList.remove(this._options.rowSelectedClass);u.classList.remove(this._options.rowSelectedBlurClass);u.classList.remove(this._options.rowCurrentClass);this.updateUnselectedRowStyle(n);r&&(r.classList.remove("grid-gutter-row-selected"),r.classList.remove("grid-gutter-row-selected-blur"),r.classList.remove("grid-gutter-row-current"),r.querySelector("input.checkbox").setAttribute("checked",String(!1)));t&&t.hasOwnProperty(f)&&(r&&r.querySelector("input.checkbox").setAttribute("checked",String(!0)),this._active?(u.classList.add(this._options.rowSelectedClass),this.updateSelectedRowStyle(n),r&&r.classList.add("grid-gutter-row-selected")):(u.classList.add(this._options.rowSelectedBlurClass),r&&r.classList.add("grid-gutter-row-selected-blur")));f===i&&(u.classList.add(this._options.rowCurrentClass),r&&r.classList.add("grid-gutter-row-current"))},i.prototype.focus=function(n){if(this._options.focusable){var i=this._focus,t=function(){try{i.focus()}catch(n){}};typeof n=="undefined"?t():window.setTimeout(function(){t()},n)}},i.prototype._onContainerMouseDown=function(n){var t=n.target;t.classList.contains("grid-edit-box")||this._options.focusable&&this.focus(10)},i.prototype._onContainerResize=function(){this.layout()},i.prototype._applyColumnSizing=function(n,t,i){var e=this._getVisibleColumnIndex(n)+1,r=this._columns[n],u=!1,f;t=t||-1;r&&(u=r.width!==t,f=this.rootElement.querySelector(".grid-header-canvas ."+this._options.headerColumnElementClass+":nth-child("+e+")"),f.style.width=r.width+"px");i===!0&&(u&&this.layout(),this._onColumnResize(r))},i.prototype._trySorting=function(n,t){var y=this,s,h,c,l,o,a,r,f,v;t||(t=this._getSortColumns(n));s=[];h=0;for(c in this._selectedRows)f=this._selectedRows[c],l=this._dataSource[f],l&&(s.push(l),h+=parseInt(c));for(o=new e(null,null),i.addItemsToTree(this._dataSource,this._expandStates,0,this._dataSource.length,o),this._sortOrder&&this._sortOrder.length===1&&n.length===1&&this._sortOrder[0]!==n[0]&&this._sortOrder[0].index===n[0].index?this._sortOrder[0].order!==n[0].order&&i.walkTree(o,function(i){u.TreeNodeSort.stableReverse(i.children,function(i,r){return u.TreeNodeSort.sortComparer(n,t,i.data,r.data)})}):i.walkTree(o,function(i){i.children.sort(function(i,r){return u.TreeNodeSort.sortComparer(n,t,i.data,r.data)})}),this._dataSource=[],this._expandStates=[],r=0;r<o.children.length;r++)i.walkTree(o.children[r],function(n){y._dataSource.push(n.data);y._expandStates.push(n.expandState)});if(this._indentLevels=i.expand(this._expandStates),this._updateRanges(),this._selectionCount>0){for(this._clearSelection(),a=0,r=0;r<s.length;r++)f=this._dataSource.indexOf(s[r]),f>=0&&(v=this._getRowIndex(f),this._addSelection(v,f),a+=v);this._scrollTop+=(a-h)/this._selectionCount*this._measurements.rowHeight}},i.prototype.findClosestElement=function(n,t){for(var r=this._element.parentNode,i=n;i&&i!==r;){if(i.msMatchesSelector(t))return i;i=i.parentNode}return i},i.prototype.fireCustomEvent=function(n,t,i){var r=document.createEvent("Event");r.initEvent(t,!0,!0);r.customData=i;n.dispatchEvent(r)},i.prototype.createElementWithClass=function(n,t){var i=document.createElement(n);return t&&(i.className=t),i},i.prototype._attachEvents=function(){var n=this;window.addEventListener("resize",function(t){return n._onContainerResize(t)});this._element.addEventListener("mousedown",function(t){return n._onContainerMouseDown(t)});this._element.addEventListener("keydown",function(t){return n._onKeyDown(t)});Microsoft.Plugin.Theme.addEventListener("themechanged",function(t){return n._onThemeChanged(t)});this._options.focusable&&(this._focus.addEventListener("focus",function(t){return n._onFocus(t)}),this._focus.addEventListener("blur",function(t){return n._onBlur(t)}));this._canvas.addEventListener("mousedown",function(t){return n._onRowMouseDown(t)});this._canvas.addEventListener("dblclick",function(t){return n._onEditCell(t)});this._canvas.addEventListener("scroll",function(t){return n._onCanvasScroll(t)});this._canvas.addEventListener("selectstart",function(){return!1});this._header&&(this._header.addEventListener("mousedown",function(t){return n._onHeaderMouseDown(t)}),this._header.addEventListener("mouseup",function(t){return n._onHeaderMouseUp(t)}),this._header.addEventListener("click",function(t){return n._onHeaderClick(t)}),this._header.addEventListener("dblclick",function(t){return n._onHeaderDblClick(t)}));this._gutter&&(this._gutter.addEventListener("click",function(t){return n._onGutterClick(t)}),this._gutter.addEventListener("mouseover",function(n){var t=this.findClosestElement(n.target,".grid-gutter-row");t&&t.classList.add("grid-gutter-row-hover")}.bind(this)),this._gutter.addEventListener("mouseout",function(n){var t=this.findClosestElement(n.target,".grid-gutter-row");t&&t.classList.remove("grid-gutter-row-hover")}.bind(this)))},i.prototype._getDataIndex=function(n){var t,u,r=-1,f=this._visibleRange,i;if(n<0)return-1;for(t=0,u=f.length;t<u;t++)if(i=f[t],r+=i.end-i.start+1,n<=r)return i.end-r+n;return n},i.prototype._getRowIndex=function(n){for(var r=0,f=this._visibleRange,t,i=0,u=f.length;i<u;i++){if(t=f[i],n>=t.start){if(n<=t.end)return r+n-t.start}else break;r+=t.end-t.start+1}return-Math.max(0,r-1)},i.prototype._updateViewport=function(n){var v=this._count,o=[],s=[],f=[],y=this._expandStates||[],c=this.getExpandedCount()-1,l=this._getVisibleRowIndices(),u=l.first,e=l.last,t,h;u=Math.max(0,u-this._options.extendViewportBy);e=Math.min(c,e+this._options.extendViewportBy);var a=Math.max(0,u-this._options.payloadSize),p=Math.min(c,e+this._options.payloadSize),i=this._getDataIndex(a),w=u;for(t=a;t<=p&&i<v;t++)t<u?o[o.length]=new r(t,i):t>e?s[s.length]=new r(t,i):(f[f.length]=new r(t,i),w=t),h=y[i],h<0?i+=1-h:i++;this.cacheRows(o,f,s);this._drawRows(f,n);this._updateAriaOnViewportUpdate&&(this._updateAriaOnViewportUpdate=!1,this._updateAriaAttribute())},i.prototype._drawRows=function(n,t){var u=this,tt=this._expandStates,p=0,w=0,c=this._gutter,it=this._canvas,b,e,k=document.createDocumentFragment(),v=null,o,y,d,l,r,s,h,nt;for(c&&(b=this._gutter,v=document.createDocumentFragment()),o=this._rows,y={},this._rows=y,d=n.length,l=0;l<d;l++){var g=n[l],a=g.rowIndex,f=g.dataIndex,i=o[f];i?(e=i.rowIndex!==a,e?i.rowIndex=a:(e=i.isDirty,delete i.isDirty),t&&(e=!0),delete o[f]):(e=!0,r=this.createElementWithClass("div",this._options.rowClass),r.classList.add(this._options.rowNormalClass),r.id="row_"+this._getId()+"_"+f,r.addEventListener("mouseover",function(n){var t=n.target,i=n.relatedTarget,r;t&&i&&(i.parentElement===t||t.parentElement===i)||(r=u.getRowInfoFromEvent(n,"."+u._options.rowClass),r&&u.updateMouseOverRowStyle(r))},!1),r.addEventListener("mouseout",function(n){var t=n.target,i=n.relatedTarget,r;t&&i&&(i.parentElement===t||t.parentElement===i)||(r=u.getRowInfoFromEvent(n,"."+u._options.rowClass),r&&u.updateMouseOutRowStyle(r))},!1),k.appendChild(r),s={rowIndex:a,dataIndex:f,row:r},c&&(h=this.createElementWithClass("div","grid-gutter-row grid-gutter-row-normal"),v.appendChild(h),h.id="gtr_"+r.id,this._rowInfoMap[h.id]=s,s.gutterRow=h),this._rowInfoMap[r.id]=s,i=s);y[f]=i;e&&(tt&&(p=this._getExpandState(f),w=this.indentLevel(f)),this._updateRow(i,a,f,p,w));r&&(r.onfocus=function(n){return u._onRowElementFocus(n)},r.onblur=function(n){return u._onRowElementBlur(n)})}for(nt in o)i=o[nt],c&&(delete this._rowInfoMap[i.gutterRow.id],i.gutterRow.parentElement.removeChild(i.gutterRow)),delete this._rowInfoMap[i.row.id],this._cleanUpCells(i),i.row.parentElement.removeChild(i.row);it.appendChild(k);this._updateDynamicRowsStyle(n);c&&b.appendChild(v)},i.prototype.getColumnPixelIndent=function(n){return n*i.INDENT_PER_LEVEL},i.prototype.addTreeIconWithIndent=function(n,t,i,r){var f=this,e=this.getColumnPixelIndent(i)-13,u;r.indentOffset=e;t!==0&&(u=this.createElementWithClass("div","icon grid-tree-icon"),u.style.left=e+"px",n.appendChild(u),t>0?u.classList.add("icon-tree-expanded"):u.classList.add("icon-tree-collapsed"),u.addEventListener("mouseover",function(n){f.onTreeIconMouseOver(n)}),u.addEventListener("mouseout",function(n){f.onTreeIconMouseOut(n)}));n.style.textIndent=this.getColumnPixelIndent(i)+"px"},i.prototype._drawCell=function(n,t,r,u,f,e,o){var a=f.width||20,v,s=this.createElementWithClass("div",this._options.cellClass),h,c,y,p,l;if(s.style.width=isNaN(a)?String(a):a+"px",typeof f.hrefIndex!="undefined"&&(v=this.getColumnValue(t,f.hrefIndex,-1)),h=this.getColumnText(t,f,o),f.hasHTMLContent||i._setTooltip(s,h,65,f.maxTooltipLineLength),v?(c=document.createElement("a"),c.setAttribute("href",v),c.innerText=h,s.appendChild(c)):h?f.hasHTMLContent?s.innerHTML=h:s.innerText=h:s.innerHTML="&nbsp;",o===e&&u>0&&this.addTreeIconWithIndent(s,r,u,f),f.getCellCSSClass&&(y=f.getCellCSSClass(t,f.index,o,this._dataSource),y))for(p=y.trim().split(" "),l=0;l<p.length;l++)s.classList.add(p[l]);return f.rowCss&&s.classList.add(f.rowCss),s},i.prototype._onRowMouseDown=function(n){var t=this.getRowInfoFromEvent(n,"."+this._options.rowClass),i;t&&(i=n.target,n.which===1&&i.classList.contains("grid-tree-icon")?this._onToggle(t):this._selectRow(t.rowIndex,t.dataIndex,{ctrl:n.ctrlKey,shift:n.shiftKey,rightClick:n.which===3}))},i.prototype._onBlur=function(n){if(n){var t=n.target;if(t.classList.contains("grid-edit-box")){n.stopPropagation();return}}this._active=!1;this._updateSelectionStyles()},i.prototype._onFocus=function(n){var t=n.target;if(t.classList.contains("grid-edit-box")){n.stopEventPropagation();return}this._active=!0;this._updateSelectionStyles();this._updateAriaAttribute()},i.prototype._onCanvasFocus=function(){},i.prototype._onRowElementFocus=function(n){return this._onFocus(n)},i.prototype._onRowElementBlur=function(n){return this._onBlur(n)},i.prototype._onKeyDown=function(t){var i={lo:-1,hi:-1},e=n.KeyCodes,f=this._canvas,u,r;if(this._copyInProgress)return t.keyCode===27&&this._cancelable&&this._cancelable.cancel(),!1;this._count>0&&(i={lo:0,hi:this.getExpandedCount()-1});this._selectedIndex<0&&this._addSelection(i.lo);switch(t.keyCode){case 65:if(t.ctrlKey)this._selectAll();else return!0;break;case 67:t.ctrlKey&&this.onCtrlC();break;case 123:t.altKey||t.ctrlKey||t.shiftKey||this.onF12();break;case 71:t.ctrlKey&&this.onCtrlG();break;case 40:this._clearSelection();t.ctrlKey?t.shiftKey?this._addSelectionRange(i.hi):this._addSelection(i.hi):t.shiftKey?this._addSelectionRange(Math.min(this._selectedIndex+1,i.hi)):this._addSelection(Math.min(this._selectedIndex+1,i.hi));break;case 38:this._clearSelection();t.ctrlKey?t.shiftKey?this._addSelectionRange(i.lo):this._addSelection(i.lo):t.shiftKey?this._addSelectionRange(Math.max(this._selectedIndex-1,i.lo)):this._addSelection(Math.max(this._selectedIndex-1,i.lo));break;case 34:case 33:u=f.clientHeight;r=Math.floor(u/this._measurements.rowHeight);this._clearSelection();t.keyCode===34?t.shiftKey?this._addSelectionRange(Math.min(this._selectedIndex+r,i.hi)):this._addSelection(Math.min(this._selectedIndex+r,i.hi)):t.shiftKey?this._addSelectionRange(Math.max(this._selectedIndex-r,i.lo)):this._addSelection(Math.max(this._selectedIndex-r,i.lo));break;case 39:this._clearSelection();this.tryToggle(!0,t.shiftKey)?(this._addSelection(this._selectedIndex),this.layout()):t.shiftKey?this._addSelectionRange(Math.min(this._selectedIndex+1,i.hi)):this._addSelection(Math.min(this._selectedIndex+1,i.hi));break;case 37:this._clearSelection();this.tryToggle(!1,t.shiftKey)?(this._addSelection(this._selectedIndex),this.layout()):t.shiftKey?this._addSelectionRange(Math.max(this._selectedIndex-1,i.lo)):this._addSelection(Math.max(this._selectedIndex-1,i.lo));break;case 36:this._clearSelection();t.shiftKey?this._addSelectionRange(i.lo):this._addSelection(i.lo);break;case 35:this._clearSelection();t.shiftKey?this._addSelectionRange(i.hi):this._addSelection(i.hi);break;case 9:return t.shiftKey&&this.rootElement.focus(),this.getSelectedRowIntoView(),!0}return this.getSelectedRowIntoView(),t.preventDefault(),!1},i.prototype._onThemeChanged=function(){var n=this._textFontPx;this._updateThemeAttributes();this._textFontPx!==n&&this._textFontPx!==0&&n!==0&&(this._measurements.rowHeight=this._measurements.rowHeight*this._textFontPx/n,this._measurements.textLineHeight=this._measurements.textLineHeight*this._textFontPx/n,this.redraw())},i.prototype._onToggle=function(n){if(this._expandStates){var t=this._getExpandState(n.dataIndex);t!==0&&(t>0?this.collapseNode(n.dataIndex):t<0&&this.expandNode(n.dataIndex),this._clearSelection(),this._addSelection(Math.min(n.rowIndex,this.getExpandedCount()-1),n.dataIndex),this._layoutContentSpacer(),this._redraw())}},i.prototype._onExpandedCollapsed=function(n,t){this.fireCustomEvent(this._element,i.EVENT_ROW_EXPANDED_COLLAPSED,[{isExpanded:n,dataIndex:t}])},i.prototype.indentLevel=function(n){return this._indentLevels[n]},i.prototype.setVisibleRange=function(n){this._visibleRange=n},i.addItemsToTree=function(n,t,r,u,f){for(var s,h,c=Math.min(r+u,n.length),o=r;o<c;o++)s=new e(n[o],t[o]),h=Math.abs(s.expandState),h>0&&(i.addItemsToTree(n,t,o+1,h,s),o+=h),f.children.push(s)},i.walkTree=function(n,t){var f,r,u,e;if(t&&(t(n),f=0,r=n.children,r&&(f=r.length)))for(u=0;u<f;u++)e=r[u],i.walkTree(e,t)},i.makeElementUnselectable=function(n){var i,t,r;for(n.setAttribute("unselectable","on"),i=n.querySelectorAll("*"),t=0;t<i.length;t++){r=i[t];switch(r.tagName){case"IFRAME":case"TEXTAREA":case"INPUT":case"SELECT":break;default:r.setAttribute("unselectable","on")}}},i.toDecimalLocaleString=function(n,t,i){var y=function(n,t,i){for(var r=n.length;r<t;r++)n=i?"0"+n:n+"0";return n},f,c,o,r=n.toString(),u="";if(c=i?i.numberFormat:Microsoft.Plugin.Culture.NumberFormat,o=r.split(/e/i),r=o[0],f=o.length>1?parseInt(o[1],10):0,o=r.split("."),r=o[0],u=o.length>1?o[1]:"",f>0?(u=y(u,f,!1),r+=u.slice(0,f),u=u.substr(f)):f<0&&(f=-f,r=y(r,f+1,!0),u=r.slice(-f,r.length)+u,r=r.slice(0,-f)),u.length>0&&(u=c.NumberDecimalSeparator+u),t===!0){for(var l=c.NumberGroupSizes,a=c.NumberGroupSeparator,s=l[0],v=1,e=r.length-1,h="";e>=0;){if(s===0||s>e)return h.length>0?r.slice(0,e+1)+a+h+u:r.slice(0,e+1)+u;h=h.length>0?r.slice(e-s+1,e+1)+a+h:r.slice(e-s+1,e+1);e-=s;v<l.length&&(s=l[v],v++)}return r.slice(0,e+1)+a+h+u}return r+u},i.convertValueToDisplayString=function(n,t){return n!=null?typeof n=="string"?n:n instanceof Date?n.toLocaleString(Microsoft.Plugin.Culture.lang,t):typeof n=="number"?t?n.toLocaleString(Microsoft.Plugin.Culture.lang,t):i.toDecimalLocaleString(n):typeof n=="boolean"?n?"True":"False":n.toString():""},i._textSplit=function(n,t){var r="\r\n",i,u;return n.indexOf(r)>=0?n:n.length<=t?n:(i=n.lastIndexOf(" ",t),i!==-1?n=n.substring(0,i)+r+n.substring(i+1):(i=t,n=n.substring(0,i)+r+n.substring(i)),u=i+r.length,n.substring(0,u)+this._textSplit(n.substring(u),t))},i._approximateTextWidth=function(n,t){var i=1.1+.7*Math.exp(-n/20);return Math.round(n*i*t)},i.prototype.initialize=function(){this._element=document.createElement("div");this._element.className=this._options.coreCssClass;this._element.style.height=this._options.height;this.rootElement.appendChild(this._element);this._buildDom();this._contentSize=new h(300,400);this._takeMeasurements();this._getChildDataCallback=this._options.childDataCallback||null;this._editCellCallback=this._options.editCellCallback||null;this._options.asyncInit?window.setTimeout(function(){this._attachEvents()}.bind(this),10):this._attachEvents();this.initializeDataSource()},i.prototype._cleanUpCells=function(n){var t,r,i;if(this._options.cellCleanUpCallback&&(t=n.row,t&&t.hasChildNodes()))for(r=t.children,i=0;i<r.length;i++)this._options.cellCleanUpCallback(r.item(i))},i.prototype._getId=function(){return i.TYPE_NAME},i.prototype._enhance=function(){this._buildDom()},i.prototype._buildDom=function(){var n=document.createDocumentFragment(),t=this._options.gutter,i=t&&(t.icon||t.checkbox);this._options.focusable&&(this._focus=document.createElement("div"),this._focus.className="grid-focus",this._focus.setAttribute("tabIndex","0"),n.appendChild(this._focus));this._canvas=document.createElement("div");this._canvas.className=this._options.canvasClass;this._contentSpacer=document.createElement("div");this._contentSpacer.className="grid-content-spacer";this._canvas.appendChild(this._contentSpacer);this._options.header&&(this._element.classList.add("has-header"),this._header=document.createElement("div"),this._header.className=this._options.headerElementClass,this._headerCanvas=document.createElement("div"),this._headerCanvas.className="grid-header-canvas",this._header.appendChild(this._headerCanvas),n.appendChild(this._header));i&&(this._element.classList.add("has-gutter"),this._gutter=document.createElement("div"),this._gutter.className="grid-gutter",this._canvas.appendChild(this._gutter),this._header&&(this._gutterHeader=document.createElement("div"),this._gutterHeader.className="grid-gutter-header",this._header.appendChild(this._gutterHeader)));n.appendChild(this._canvas);this._element.appendChild(n);this._updateAriaLabelForColumns(this._options.columns)},i.prototype._updateAriaLabelForColumns=function(n){var t,i;if(n){for(this._ariaColumns="",t=0;t<n.length;t++)i=n[t],this._ariaColumns&&(this._ariaColumns+=", "),this._ariaColumns+=i.text;this._updateGridAriaLabel()}},i.prototype._updateGridAriaLabel=function(){var n="";n+=this._ariaColumns||"";n&&(n+=", ");n+=this._ariaDescription||"";this._element.setAttribute("aria-label",n)},i.prototype._mergeExpandStates=function(n,t,i){var e=i.length-1,f,r,u;for(t.splice(n+1,1),r=0;r<=e;r++)t.splice(n+r+1,0,i[r]);for(f=0,r=n;r>=0;r--)u=t[r],Math.abs(u)>f?(t[r]=u<0?u-e:u+e,f=0):f++},i.prototype._takeMeasurements=function(){var f=this._options.coreCssClass,n,i,t,r,u;this._options.cssClass&&(f+=" "+this._options.cssClass);n=this.createElementWithClass("div",f);n.style.position="absolute";n.style.left="-5000px";n.style.top="-5000px";n.style.width="1000px";n.style.height="500px";document.body.appendChild(n);i=this.createElementWithClass("div",this._options.rowClass);i.classList.add(this._options.rowNormalClass);n.appendChild(i);t=this.createElementWithClass("div",this._options.cellClass);t.style.width="100px";t.innerText="1";i.appendChild(t);this._measurements.rowHeight=i.offsetHeight;this._measurements.cellOffset=t.offsetWidth-100;t.innerText="1\n1";this._measurements.textLineHeight=i.offsetHeight-this._measurements.rowHeight;r=this.createElementWithClass("div");r.style.overflow="hidden";r.style.width="1em";r.style.height="1ex";t.appendChild(r);this._measurements.unitEx=r.offsetHeight;u=this.createElementWithClass("div","grid-gutter");u.appendChild(this.createElementWithClass("div","grid-gutter-row grid-gutter-row-selected"));n.appendChild(u);this._measurements.gutterWidth=this._gutter?u.clientWidth:0;n.style.overflow="scroll";this._measurements.scrollbarWidth=n.offsetWidth-n.clientWidth;document.body.removeChild(n)},i.prototype._initializeDataSourceComplete=function(){this.getExpandedCount()>0?this._options.keepSelection&&this._selectedIndex>=0?this._selectRow(Math.min(this._selectedIndex,this.getExpandedCount()-1)):this._selectRow(this._options.initialSelection!==!1?0:-1):this.setSelectedRowIndex(-1)},i.prototype._layoutAfterSetDataSource=function(n){this.layout();this._ensureSelectedIndex(n)},i.prototype._adjustForDynamicData=function(n,t,r){var u,f;for(this._dataSource.splice(r+1,1),u=0;u<n.length;u++)this._dataSource.splice(r+u+1,0,n[u]);this._mergeExpandStates(r,this._expandStates,t);f=this._dataSource.length;this._count=f;this._indentLevels=this._expandStates?i.expand(this._expandStates):null;this._expandedCount=f;this._updateRanges();this._determineIndentIndex();this.layout()},i.prototype._ensureSelectedIndex=function(n){var t=this._selectedIndex;typeof n=="number"&&(this._selectedIndex=n);this._selectedIndex>=0&&(this._count<=this._selectedIndex&&(this._selectedIndex=this._count-1),this._selectedIndex!==t&&this._addSelection(this._selectedIndex))},i.prototype._determineIndentIndex=function(){for(var t=this._columns,n=0,i=t.length;n<i;n++)if(t[n].indent){this._indentIndex=n;return}this._indentIndex=0},i.prototype._updateExpansionStateAndRedraw=function(n){var i,t=this._selectedIndex;t>=0&&(i=this._getDataIndex(t));n();t>=0&&(this._clearSelection(),this._addSelection(Math.abs(this._getRowIndex(i))));this._layoutContentSpacer();this._redraw()},i.prototype._getVisibleRowIndices=function(){var n=this._scrollTop,t=n+this._canvasHeight;return this.calculateVisibleRowIndices(n,t)},i.prototype._getRowIntoView=function(n,t){var u;if(t)return u=Math.max(0,Math.min(n||0,this.getExpandedCount()-1)),this._canvas.scrollTop=this.getRowTop(u),!0;var f=this._getVisibleRowIndices(),i=f.first,e=f.last,r=e-i;return n<i||n>e?(i=this._selectedIndex>i?Math.max(n-r,0):Math.max(0,Math.min(n+r,this.getExpandedCount()-1)-r),this._canvas.scrollTop=this.getRowTop(i),!0):!1},i.prototype._getRowIntoViewCenter=function(n){var t=this.getRowTop(n),i,r;return(t=t-this._canvasHeight/2,i=this._canvas.scrollHeight-this._canvasHeight,t>i&&(t=i),r=0,t<r&&(t=r),this._canvas.scrollTop!=t)?(this._canvas.scrollTop=t,!0):!1},i.prototype._cleanUpRows=function(){var t=this._rows,r=this._gutter,i,n;for(i in t)n=t[i],n.row.parentElement&&(this._cleanUpCells(n),n.row.parentElement.removeChild(n.row),delete this._rowInfoMap[n.row.id]),r&&n.gutterRow.parentElement&&(n.gutterRow.parentElement.removeChild(n.gutterRow),delete this._rowInfoMap[n.gutterRow.id]);this._rows={}},i.prototype._updateDynamicRowsStyle=function(n){for(var r,f,t,e,u,o,i=0;i<n.length;i++)if(r=this._rows[n[i].dataIndex],r){for(f=r.row.children,t=0;t<f.length;t++)(e=this._columns[t],e&&e.alwaysEnableTooltip)||(u=f[t],o=u.scrollWidth>u.offsetWidth,o||u.removeAttribute("data-plugin-vs-tooltip"));this.checkUpdateActive(r)}},i.prototype._updateRow=function(n,t,r,u,f){var k=this._indentIndex,a,v,h,w,e,y,c,b,l,p;if(this._gutter){var o=this._options.gutter,d=n.gutterRow,s=d.firstElementChild;s.style.top=this.getRowTop(t)+"px";s.style.left="0px";s.style.width=this._measurements.gutterWidth+"px";s.style.height=this._measurements.rowHeight+"px";o.checkbox&&(a=this.createElementWithClass("input","checkbox "+(o.checkbox.cssClass||"")),a.setAttribute("type","checkbox"),v=this.createElementWithClass("div","grid-gutter-cell grid-gutter-checkbox"),v.appendChild(a[0]),s.appendChild(v));o.icon&&(h="grid-gutter-cell grid-gutter-icon ",typeof o.icon.cssClass!="undefined"&&(h+=o.icon.cssClass+" "),typeof o.icon.index!="undefined"&&(h+=(this.getColumnValue(r,o.icon.index,-1)||"")+" "),o.icon.ownerDraw!==!1&&(h+=this._getGutterIconClass(t,r,u,f)||""),w=this.createElementWithClass("div",h),s.appendChild(w));this._drawGutterCell(n,t,r,u,f)}for(this._cleanUpCells(n),e=n.row,e.innerHTML="",e.style.top=this.getRowTop(t)+"px",e.style.left=this._measurements.gutterWidth+"px",e.style.height=this._measurements.rowHeight+"px",this._options.overflowColumn===!1?e.style.width=isNaN(this._contentSize.width)?"":this._contentSize.width+2+"px":e.style.minWidth=isNaN(this._contentSize.width)?"":this._contentSize.width+2+"px",y=this._columns,c=0,b=y.length;c<b;c++)(l=y[c],l.hidden)||(p=l.getCellContents(n,r,u,f,l,k,c),p&&e.appendChild(p));i.makeElementUnselectable(e);this._gutter&&i.makeElementUnselectable(s);this._updateRowSelectionStyle(n,this._selectedRows,this._selectedIndex);u!==0&&e.setAttribute("aria-expanded",u>0?"true":"false")},i.prototype._getGutterIconClass=function(){return""},i.prototype._drawGutterCell=function(){},i.prototype._drawHeader=function(){var s=this._columns,c=this._sortOrder,o,r,h,n,t,f,e,u;if(this._header){for(o=document.createDocumentFragment(),r=0,h=s.length;r<h;r++)(n=s[r],n.hidden)||(t=this.createElementWithClass("div",this._options.headerColumnElementClass),i._setTooltip(t,n.tooltip,65,n.maxTooltipLineLength),t.style.width=(n.width||20)+"px",t._data={columnIndex:r,header:!0},f=this.createElementWithClass("div","separator"),n.fixed&&(f.style.cursor="auto"),f._data={columnIndex:r,separator:!0},t.appendChild(f),e=n.getHeaderCellContents(n,r),n.headerCss&&e.classList.add(n.headerCss),n.tooltip&&i._setTooltip(e,n.tooltip,65,n.maxTooltipLineLength),t.appendChild(e),u=this.createElementWithClass("div","sort-handle"),c.forEach(function(t){if(t.index===n.index)return t.order==="asc"?u.innerHTML=i.ASCENDING_ARROW:t.order==="desc"&&(u.innerHTML=i.DESCENDING_ARROW),u.setAttribute("aria-label",""),u.setAttribute("role","img"),!1}),t.appendChild(u),o.appendChild(t));this._headerCanvas.innerHTML="";this._headerCanvas.appendChild(o);i.makeElementUnselectable(this._header)}},i.prototype._drawHeaderCellValue=function(n,t){var i=document.createElement("div");return i.classList.add("title"),n.hasHTMLContent?i.innerHTML=n.text||"&nbsp;":i.innerText=n.text||"",t!==this._indentIndex||typeof this._indentLevels=="undefined"||this._indentLevels===null||i.classList.add("indented-title"),i},i.prototype._layoutContentSpacer=function(){for(var t,r,u,n=0,f=this._columns,i=0,e=f.length;i<e;i++)f[i].hidden||(n+=(f[i].width||20)+this._measurements.cellOffset);n=n+2;t=Math.max(1,this.getTotalDataHeight());this._contentSpacer.style.width=n+"px";this._contentSpacer.style.height=t+"px";this._gutter&&(this._gutter.style.height=t+"px");this._ignoreScroll=!0;try{r=Math.max(0,Math.min(this._scrollTop,t-this._canvasHeight));r!==this._scrollTop&&(this._scrollTop=r,this._canvas.scrollTop=r);u=Math.max(0,Math.min(this._scrollLeft,n-this._canvasWidth));u!==this._scrollLeft&&(this._scrollLeft=u,this._canvas.scrollLeft=u)}finally{this._ignoreScroll=!1}this._contentSize.width=n;this._contentSize.height=t},i.prototype._layoutHeader=function(){this._header&&(this._headerCanvas.style.left=this._measurements.gutterWidth-this._scrollLeft+"px");this._gutter&&(this._gutter.style.left=this._scrollLeft+"px")},i.prototype._fixScrollPos=function(){var n=this._ignoreScroll;this._ignoreScroll=!0;try{this._canvas.scrollLeft=this._scrollLeft;this._canvas.scrollTop=this._scrollTop}finally{this._ignoreScroll=n}},i.prototype._redraw=function(n){this._layoutHeader();this._updateViewport(n)},i.prototype._selectRow=function(n,t,i){var r=i&&i.ctrl,u=i&&i.shift,f=i&&i.rightClick;r?this._addSelection(n,t,{toggle:!0}):u?(this._clearSelection(),this._addSelectionRange(n,t)):f?this._selectedRows&&this._selectedRows.hasOwnProperty(n)?(this._selectedIndex=n,this._updateAriaAttribute()):(this._clearSelection(),this._addSelection(n,t)):(this._clearSelection(),this._addSelection(n,t))},i.prototype._selectAll=function(){for(var i,r,n=0,t=0,u=this._dataSource.length;t<u;++t)i=this._dataSource[t],i&&!i.isPlaceholder&&++n;n--;n>=0&&this._options.allowMultiSelect!==!1&&(this._clearSelection(),this._selectionStart=0,r=Math.max(0,this._selectedIndex),this._addSelectionRange(n,undefined,{doNotFireEvent:!0}),this._selectedIndex=r,this._updateSelectionStyles(),this._selectionChanged())},i.prototype._addSelectionRange=function(n,t,i){var h=i&&i.doNotFireEvent,o=-1,f,u,s,r,e;if(this._options.allowMultiSelect===!1)this._addSelection(n,t);else{for(this._selectedRows&&(o=this._selectedRows[this._selectedIndex]),this._selectionStart<0&&(this._selectionStart=n),u=Math.min(this._selectionStart,n),s=Math.max(this._selectionStart,n),(typeof t!="number"||u!==n)&&(t=this._getDataIndex(u)),r=u;r<=s;r++)this._addSelection(r,t,{keepSelectionStart:!0,doNotFireEvent:!0}),r===n&&(f=t),typeof t=="number"&&(e=this._getExpandState(t),t+=e<0?1-e:1);this._selectedIndex=n;this._updateAriaAttribute();h||(this._updateSelectionStyles(),this._selectionChanged(),o!==f&&this._selectedIndexChanged(this._selectedIndex,f))}},i.prototype._selectionChanged=function(){this.selectionChanged(this._selectedIndex,this._selectionCount,this._selectedRows);this.fireCustomEvent(this._element,"selectionchanged",[{selectedIndex:this._selectedIndex,selectedCount:this._selectionCount,selectedRows:this._selectedRows}])},i.prototype._selectedIndexChanged=function(n,t){this.selectedIndexChanged(n,t);this.fireCustomEvent(this._element,i.EVENT_SELECTED_INDEX_CHANGED,[n,t])},i.prototype._measureCanvasSize=function(){this._canvasHeight=this._canvas.clientHeight;this._canvasWidth=this._canvas.clientWidth},i.prototype._setupMoveEvents=function(){var n=this;document.addEventListener("mousemove",function(t){return n._onDocumentMouseMove(t)});document.addEventListener("mouseup",function(t){return n._onDocumentMouseUp(t)})},i.prototype._clearMoveEvents=function(){document.removeEventListener("mousemove",null,!0);document.removeEventListener("mouseup",null,!0)},i.prototype._onDocumentMouseMove=function(n){var t=this._columnSizing;if(t&&t.active===!0){var i=n.pageX-t.origin,r=Math.max(15,t.originalWidth+i),u=this._columns[t.index];u.width=r;this._applyColumnSizing(t.index);this._moveSizingElement(t.index)}},i.prototype._onDocumentMouseUp=function(){var n=this;return window.setTimeout(function(){n._tryFinishColumnSizing(!1)},0),!1},i.prototype._onHeaderMouseDown=function(n){var t,i,r;return n.which!==1?!0:(t=this.findClosestElement(n.target,".separator"),t&&t._data&&(i=t._data.columnIndex,r=this._columns[i],!r.fixed)?(this._columnSizing=new v(!0,i,r.width,n.pageX),this._moveSizingElement(i),this._setupMoveEvents(),n.stopImmediatePropagation(),n.preventDefault(),!1):void 0)},i.prototype._onHeaderMouseUp=function(){return!1},i.prototype._onHeaderClick=function(n){var i=this.findClosestElement(n.target,"."+this._options.headerColumnElementClass),r,u,t;if(i&&!this._columnSizing){if(r=this.findClosestElement(n.target,".separator"),r&&r._data)return!1;i._data&&(u=i._data.columnIndex,t=this._columns[u],t.canSortBy&&!t.fixed&&this._sortBy(t,n.shiftKey))}},i.prototype._onHeaderDblClick=function(n){var f=this.findClosestElement(n.target,".separator"),r,u,o,s,l;if(f&&f._data){this._tryFinishColumnSizing(!0);var h=f._data.columnIndex,t=this._columns[h],c=3,e=i._approximateTextWidth(c,this._measurements.unitEx),a=this.getExpandedCount();for(r=0;r<a;r++)(u=0,o=this._getDataIndex(r),t.indent&&(u+=this.getColumnPixelIndent(this._indentLevels[o])),s=this.getColumnText(o,t,-1).length,!t.indent&&s<=c)||(u+=i._approximateTextWidth(s,this._measurements.unitEx),e=Math.max(e,u));return l=t.width,t.width=e,this._applyColumnSizing(h,l,!0),!1}},i.prototype._moveSizingElement=function(n){var r=this._measurements.gutterWidth,t,i;if(!this._sizingElement){if(n<0)return;this._sizingElement=this.createElementWithClass("div","grid-column-sizing");this._canvas.appendChild(this._sizingElement)}if(this._sizingElement.style.height=this._canvas.clientHeight-1+"px",this._sizingElement.style.top=this._scrollTop+"px",n<0)this._sizingElement.style.left="-5000px",this._sizingElement.style.top="-5000px",this._sizingElement.style.height="0px";else{for(t=0;t<=n;)i=this._columns[t++],i.hidden||(r+=i.width);this._sizingElement.style.left=r-1+"px"}},i.prototype._getVisibleColumnIndex=function(n){var t=0,i=0,r=this._columns.length;if(this._columns[n].hidden)return-1;while(t<n)this._columns[t].hidden||i++,t++;return i},i.prototype._onColumnResize=function(n){this.fireCustomEvent(this._element,"columnresize",[n])},i.prototype._tryFinishColumnSizing=function(n){var t=this._columnSizing;t&&(t.active===!0&&(n||this._applyColumnSizing(t.index,t.originalWidth,!0),this._moveSizingElement(-1)),this._columnSizing=null,this._clearMoveEvents())},i.prototype._getSortColumns=function(n){for(var e,t,r,u=this._columns,f=[],i=0,o=n.length;i<o;i++)for(e=n[i],t=0;t<u.length;++t)if(r=u[t],r.index===e.index){f.push(r);break}return f},i.prototype._sortBy=function(n,t){var i=this._sortOrder.slice(0),e=!1,u,o,r,s;if(n){for(u=0,o=i.length;u<o;u++)if(r=i[u],r.index===n.index){i.splice(u,1);e=!0;break}r=e?new f(r.index,r.order==="asc"?"desc":"asc"):new f(n.index,n.defaultSortOrder);t&&this._options.allowSortOnMultiColumns?i.push(r):i=[r]}if(this._options.onBeforeSortCallback)this._options.onBeforeSortCallback(i);s=this._getSortColumns(i);this._onSort(i,s)},i.prototype._onSort=function(n,t){this.onSort(n,t)!==!1&&this.fireCustomEvent(this._element,"sort",[{sortOrder:n,sortColumns:t}])},i.prototype._onCanvasScroll=function(){var n=this._canvas;return this._resetScroll=!0,this._scrollLeft=n.scrollLeft,this._scrollTop=n.scrollTop,this._ignoreScroll||this._redraw(),!1},i.prototype._getClickedCell=function(n){return this.findClosestElement(n.target,".grid-cell")},i.prototype._createEditCellBox=function(n,t,i,r){function e(f){var e=u.value;return i.innerText=e,r?(r(e,n,t),f.stopPropagation(),f.preventDefault(),!1):void 0}var f=i.innerText,u=this.createElementWithClass("input","grid-edit-box");u.setAttribute("type","text");u.setAttribute("value",f);u.addEventListener("focusout",function(n){e(n)});u.addEventListener("keydown",function(n){if(n.keyCode===13)e(n);else if(n.keyCode===27)return i.innerText=f,n.stopPropagation(),n.preventDefault(),!1});i.innerHTML="";i.appendChild(u);u.select();u.focus()},i.prototype._onEditCell=function(n){var e=n.target,t,r,i;if(!e.classList.contains("grid-tree-icon")&&(t=this._getClickedCell(n),t&&t.classList.contains("grid-cell-editable")&&(r=this.getRowInfoFromEvent(n,"."+this._options.rowClass),r))){var u=r.row.children,o=u.length,f=-1;for(i=0;i<o;i++)t===u[i]&&(f=i);this._createEditCellBox(r.dataIndex,f,t,this._editCellCallback)}},i.prototype._onGutterClick=function(n){var t=this.getRowInfoFromEvent(n,".grid-gutter-row");t&&(this._selectedRows&&typeof this._selectedRows[t.rowIndex]=="number"||this._selectRow(t.rowIndex,t.dataIndex))},i.prototype._updateThemeAttributes=function(){var n=Microsoft.Plugin.Theme.getValue("plugin-font-size");this._textFontPx=n.indexOf("px")!==-1?parseInt(n.substring(0,n.indexOf("px"))):n.indexOf("pt")!==-1?Math.round(parseInt(n.substring(0,n.indexOf("pt")))/.75):0},i.EVENT_ROW_EXPANDED_COLLAPSED="rowExpandedCollapsed",i.TYPE_NAME="GridControl",i.MAX_COPY_SIZE=1e3,i.PAYLOAD_SIZE=200,i.EVENT_SELECTED_INDEX_CHANGED="selectedIndexChanged",i.INDENT_PER_LEVEL=16,i.ASCENDING_ARROW="5",i.DESCENDING_ARROW="6",i}(t.Control);i.GridControl=y})(t.Grid||(t.Grid={}));var i=t.Grid})(n.Controls||(n.Controls={}));var t=n.Controls}(Common||(Common={})),function(n){(function(t){(function(n){n[n.Horizontal=0]="Horizontal";n[n.Vertical=1]="Vertical"})(t.GridSplitterDirection||(t.GridSplitterDirection={}));var r=t.GridSplitterDirection,i=function(n){function t(i,r,u){n.call(this,i);this._direction=null;this._minSize=typeof r=="number"&&r>0?r:t._gridSplitterDefaultMinSize;this._callback=u;this.rootElement.contains(t._gridSplitterClass)||this.rootElement.classList.add(t._gridSplitterClass);this._resizerDisplay=document.createElement("div");this._resizerDisplay.className=t._gridSplitterClass+" "+t._gridSplitterResizerClass;this._resizerDisplay.style.position="relative";this._resizerDisplay.style.display="none";this.rootElement.appendChild(this._resizerDisplay);this.rootElement.addEventListener("mousedown",this.onMouseDown.bind(this));this.rootElement.addEventListener("keyup",this.onKeyPress.bind(this))}return __extends(t,n),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction===null&&(this._direction=this.getSplitterDirection()),this._direction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridCSS",{get:function(){return this._gridCSS||(this._gridCSS=this.getParentGridCSS()),this._gridCSS},enumerable:!0,configurable:!0}),t.prototype.getSplitterDirection=function(){var n;return n=this.rootElement.classList.contains(t._gridSplitterVerticalClass)?1:this.rootElement.classList.contains(t._gridSplitterHorizontalClass)?0:this.rootElement.clientWidth>this.rootElement.clientHeight?1:0,n==1?(this._gridIndex=parseInt(window.getComputedStyle(rootElement).msGridRow,10)-1,this._resizerDisplay.className+=" "+t._gridSplitterClass+"-Vertical"):(this._gridIndex=parseInt(window.getComputedStyle(rootElement).msGridColumn,10)-1,this._resizerDisplay.className+=" "+t._gridSplitterClass+"-Horizontal"),n},t.prototype.getParentGridCSS=function(){return this.direction===1?window.getComputedStyle(rootElement.parentElement).msGridRows:window.getComputedStyle(rootElement.parentElement).msGridColumns},t.prototype.calculateGridInfo=function(){if(this._gridCSS=this.getParentGridCSS(),!this._gridCSS)throw new Error(Microsoft.Plugin.Resources.getErrorString("JSPerf.1019"));if(this._gridCSSParts=this._gridCSS.split(" "),this._gridCSSParts.length>=this._gridIndex&&this._gridIndex>0){var n=this._gridCSSParts[this._gridIndex-1],t=this._gridCSSParts[this._gridIndex];if(n.indexOf("fr")===-1||t.indexOf("fr")===-1)throw new Error(Microsoft.Plugin.Resources.getErrorString("JSPerf.1020"));this._gridCSSTotal=parseFloat(n)+parseFloat(t)}else throw new Error(Microsoft.Plugin.Resources.getErrorString("JSPerf.1021"))},t.prototype.onMouseMove=function(n){var f=this.direction===1?n.pageY:n.pageX,o=this.rootElement.previousElementSibling,i=this.rootElement.nextElementSibling,r=0,u=0,t,e;this.direction===1?(r=o.offsetTop+this._minSize,u=i.offsetTop+i.offsetHeight-this._minSize):(r=o.offsetLeft+this._minSize,u=i.offsetLeft+i.offsetWidth-this._minSize);t=f;f<r?t=r:f>u&&(t=u);this._endPosition=t;e=t-this._startPosition;this.direction===1?this._resizerDisplay.style.top=e+"px":this._resizerDisplay.style.left=e+"px";n.stopImmediatePropagation();n.preventDefault()},t.prototype.onMouseUp=function(n){this._resizerDisplay.style.display="none";this.rootElement.style.removeProperty("background-color");document.body.style.cursor=this._previousCursor;var t=this._endPosition-this._startPosition;this.moveSplitter(t);document.removeEventListener("mousemove",this._mouseMoveListener,!0);document.removeEventListener("mouseup",this._mouseUpListener,!0);n.stopImmediatePropagation();n.preventDefault()},t.prototype.onMouseDown=function(n){this.calculateGridInfo();this._previousCursor=document.body.style.cursor;document.body.style.cursor=window.getComputedStyle(rootElement).cursor;this._startPosition=this.direction===1?n.pageY:n.pageX;this.rootElement.style.backgroundColor="transparent";this._resizerDisplay.style.display="block";this._resizerDisplay.style.top="0";this._resizerDisplay.style.left="0";this._mouseMoveListener=this.onMouseMove.bind(this);this._mouseUpListener=this.onMouseUp.bind(this);document.addEventListener("mousemove",this._mouseMoveListener,!0);document.addEventListener("mouseup",this._mouseUpListener,!0);n.stopImmediatePropagation();n.preventDefault()},t.prototype.onKeyPress=function(n){var i,u,f,r;(this.getSplitterDirection()==1?(i=40,u=38):(i=39,u=37),n.keyCode==i||n.keyCode==u)&&(f=n.keyCode==i,r=this.sizePrevious+this.sizeCurrent,r*=f?1:-1,r*=t._gridSplitterArrowMoveRatio,this.calculateGridInfo(),this.moveSplitter(r),n.stopImmediatePropagation(),n.preventDefault())},t.prototype.moveSplitter=function(n){var r=(this.sizeCurrent-n)/(this.sizePrevious+this.sizeCurrent),t;if(r>0&&r<1){var u=(1-r)*this._gridCSSTotal,f=r*this._gridCSSTotal,i="";for(t=0;t<this._gridCSSParts.length;t++)i+=t===this._gridIndex-1?u+"fr":t===this._gridIndex?f+"fr":this._gridCSSParts[t],t<this._gridCSSParts.length-1&&(i+=" ");this.direction===1?this.rootElement.parentElement.style.msGridRows=i:this.rootElement.parentElement.style.msGridColumns=i;this._gridCSS=i;this._callback&&typeof this._callback=="function"&&this._callback()}},Object.defineProperty(t.prototype,"sizePrevious",{get:function(){var n=this.rootElement.previousElementSibling;return this.computeSize(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sizeCurrent",{get:function(){var n=this.rootElement.nextElementSibling;return this.computeSize(n)},enumerable:!0,configurable:!0}),t.prototype.computeSize=function(n){return this.direction==1?n.clientHeight:n.clientWidth},t._gridSplitterClass="gridSplitter",t._gridSplitterResizerClass="gridSplitter-Resizer",t._gridSplitterVerticalClass="gridSplitter-Vertical",t._gridSplitterHorizontalClass="gridSplitter-Horizontal",t._gridSplitterDefaultMinSize=100,t._gridSplitterArrowMoveRatio=.02,t}(n.Controls.Control);t.GridSplitterControl=i})(n.Controls||(n.Controls={}));var t=n.Controls}(Common||(Common={}))
//# sourceMappingURL=JSTreeGridControl.min.js.map
