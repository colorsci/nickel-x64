var Common;!function(e){!function(t){"use strict";let i;!function(e){class t{static stableReverse(e,t){for(var i=[],s=e.length-1;s>=0;s--){for(var n=s-1;n>=0&&0===t(e[n],e[s]);n--);for(var a=n+1;a<=s;a++)i.push(e[a]);s=n+1}for(s=0;s<i.length;s++)e[s]=i[s]}static defaultComparer(e,t,i,s){var n=i[e.index],a=s[e.index];return void 0===n||null===n?void 0===a||null===a?0:-1:void 0===a||null===a?1:n.toString().toLocaleUpperCase().localeCompare(a.toString().toLocaleUpperCase())}static sortComparer(t,i,s,n){for(var a=0;a<t.length;a++){var r=t[a],o=i[a],l=(o.comparer||e.TreeNodeSort.defaultComparer)(o,r.order,s,n);if(0!==l)return"desc"===r.order?-l:l}return 0}}e.TreeNodeSort=t}(i=t.Utility||(t.Utility={}));class s{constructor(e,t,i){this.gridData=e;this.expandStates=t;this.toggleFunction=i}}t.TreeInfo=s;class n{constructor(e,t,i,s,n,a,r,o){this.index=e;this.text=t;this.tooltip=i;this.width=s;this.canSortBy=n;this.getColumnValue=a;this.getCellCSSClass=r;this.comparer=o;this.hasHTMLContent=!1;this.hasMixedContent=!1}get percentWidth(){return this._percentWidth}set percentWidth(e){F12.Tools.Utility.Assert.isTrue(0<=e&&e<=1);this._percentWidth=e}}n.MIN_RESIZE_WIDTH=60;t.ColumnInfo=n;class a{constructor(e,t){this.index=e;this.order=t}}t.SortOrderInfo=a;class r{constructor(e,t){this.data=e;this.expandState=t;this.children=[]}}t.TreeNode=r;class o{constructor(e,t){this.icon=e;this.checkbox=t}}t.GutterOptions=o;class l{constructor(e,t,i,s,n,a){this.childDataCallback=e;this.columns=t;this.sortOrders=i;this.allowMultiSelect=!1;this.allowSortOnMultiColumns=!1;this.asyncInit=!0;this.autoSort=!0;this.coreCssClass="grid";this.cssClass="";this.expandStates=[];this.extendViewportBy=3;this.gutter=new o;this.header=!1;this.height="100%";this.initialSelection=!1;this.keepSelection=!1;this.payloadSize=200;this.source=null;this.preEditCellCallback=s;this.commitEditCellCallback=n;this.postEditCellCallback=a;this.disableRightClickSelection=!0;this.isGridEnabled=!0;this.prerenderCallback=null;this.onRowToggleCallback=null;this.keyboardEventHandler=null;this.commitOnTab=!1;this.alwaysForceSort=!1}}t.GridOptions=l;class d{constructor(e,t){this.rowIndex=e;this.dataIndex=t}}t.RowIndexInfo=d;class h{constructor(e,t){this.width=e;this.height=t}}class c{constructor(e,t){this.start=e;this.end=t}}t.Range=c;class _{constructor(e,t,i,s){this.active=e;this.index=t;this.originalWidth=i;this.origin=s}}t.ColumnSizing=_;class u extends e.Controls.Legacy.Control{constructor(e,t){super(e);this._options=t;this._canvas=null;this._contentSpacer=null;this._element=null;this._gutter=null;this._gutterHeader=null;this._header=null;this._headerCanvas=null;this._dataSource=[];this._rows={};this._columns=[];this._expandStates=null;this._expandedCount=0;this._sortOrder=[];this._rowInfoMap={};this._selectedRows=null;this._selectionStart=-1;this._selectionCount=0;this._selectedIndex=-1;this._active=!1;this._activeAriaId=null;this._getChildDataCallback=null;this._canvasHeight=300;this._canvasWidth=300;this._contentSize=null;this._measurements={};this._count=0;this._indentIndex=0;this._indentLevels=null;this._visibleRange=[];this._columnSizing=null;this._sizingElement=null;this._copyInProgress=!1;this._resetScroll=!1;this._ignoreScroll=!1;this._scrollTop=0;this._scrollLeft=0;this._cancelable=null;this._onAriaExpandedModifiedHandler=this.onAriaExpandedModified.bind(this);this.initialize()}get isVerticalScrollbarVisible(){return this._canvasHeight<this._canvas.scrollHeight}initialize(){this._element=document.createElement("div");this._element.className=this._options.coreCssClass;this._element.style.height=this._options.height;this.rootElement.appendChild(this._element);this._buildDom();this._contentSize=new h(300,400);this._takeMeasurements();this._getChildDataCallback=this._options.childDataCallback||null;this._options.asyncInit?window.setTimeout(function(){this._attachEvents()}.bind(this),10):this._attachEvents();this.initializeDataSource()}findClosestElement(e,t){for(var i=this._element.parentNode,s=e;s&&s!==i;){if(s.msMatchesSelector(t))return s;s=s.parentNode}return s}fireCustomEvent(e,t,i){var s=document.createEvent("Event");s.initEvent(t,!0,!0);s.customData=i;e.dispatchEvent(s)}onAriaExpandedModified(e){if("aria-expanded"===e.attrName){var t=this.getRowInfoFromEvent(e,".grid-row");t&&this.tryToggle("true"===e.newValue,!1,t.dataIndex)}}createElementWithClass(e,t){var i=document.createElement(e);t&&(i.className=t);return i}static expand(e){var t=[];if(e.length>0){var i=[],s={level:1,origCount:e.length,remainingCount:e.length};i.push(s);for(var n=0;n<e.length;){t.push(s.level);s.remainingCount--;for(;0===s.remainingCount;){i.pop();if(0===i.length){if(n===e.length-1)break;throw new Error("invalid descendant counts, nesting not possible")}var a=i[i.length-1];a.remainingCount-=s.origCount;if((s=a).remainingCount<0)throw new Error("invalid descendant counts, cannot convert to indentation levels")}var r=Math.abs(e[n]);if(r>0){var o={level:t[t.length-1]+1,origCount:r,remainingCount:r};i.push(o);s=o}n++}if(i.length>0)throw new Error("invalid descendant counts, more input expected")}return t}static addItemsToTree(e,t,i,s,n){for(var a=Math.min(i+s,e.length),o=i;o<a;o++){var l=new r(e[o],t[o]),d=Math.abs(l.expandState);if(d>0){u.addItemsToTree(e,t,o+1,d,l);o+=d}n.children.push(l)}}static walkTree(e,t){if(t){t(e);var i=0,s=e.children;if(s&&(i=s.length))for(var n=0;n<i;n++){var a=s[n];u.walkTree(a,t)}}}static makeElementUnselectable(e){e.setAttribute("unselectable","on");for(var t=e.querySelectorAll("*"),i=0;i<t.length;i++){var s=t[i];switch(s.tagName){case"FRAME":case"IFRAME":case"TEXTAREA":case"INPUT":case"SELECT":break;default:s.setAttribute("unselectable","on")}}}static toDecimalLocaleString(e,t,i){var s,n,a,r=function(e,t,i){for(var s=e.length;s<t;s++)e=i?"0"+e:e+"0";return e},o=e.toString(),l="";n=i?i.numberFormat:Sys.CultureInfo.CurrentCulture;o=(a=o.split(/e/i))[0];s=a.length>1?parseInt(a[1],10):0;o=(a=o.split("."))[0];l=a.length>1?a[1]:"";if(s>0){o+=(l=r(l,s,!1)).slice(0,s);l=l.substr(s)}else if(s<0){l=(o=r(o,(s=-s)+1,!0)).slice(-s,o.length)+l;o=o.slice(0,-s)}l.length>0&&(l=n.NumberDecimalSeparator+l);if(!0===t){for(var d=n.NumberGroupSizes,h=n.NumberGroupSeparator,c=d[0],_=1,u=o.length-1,g="";u>=0;){if(0===c||c>u)return g.length>0?o.slice(0,u+1)+h+g+l:o.slice(0,u+1)+l;g=g.length>0?o.slice(u-c+1,u+1)+h+g:o.slice(u-c+1,u+1);u-=c;if(_<d.length){c=d[_];_++}}return o.slice(0,u+1)+h+g+l}return o+l}static convertValueToDisplayString(e,t){return null!=e?"string"==typeof e?e:e?e.localeFormat(t||"G"):"number"==typeof e?t?e.toLocaleString(t):u.toDecimalLocaleString(e):"boolean"==typeof e?e?"True":"False":e.toString():""}_getId(){return u.TYPE_NAME}getSelectionCount(){return this._selectionCount}set expandedCount(e){this._expandedCount=e;this._options.expandedCountChangedCallback&&this._options.expandedCountChangedCallback(this._expandedCount)}getExpandedCount(){return this._expandedCount}getElement(){return this._element}_enhance(e){this._buildDom()}_buildDom(){var e=document.createDocumentFragment(),t=this._options.gutter,i=t&&(t.icon||t.checkbox);this._canvas=document.createElement("div");this._canvas.className="grid-canvas";this._canvas.setAttribute("role","treegrid");this._contentSpacer=document.createElement("div");this._contentSpacer.className="grid-content-spacer";this._canvas.appendChild(this._contentSpacer);if(this._options.header){this._element.classList.add("has-header");this._header=document.createElement("div");this._header.className="grid-header";this._headerCanvas=document.createElement("div");this._headerCanvas.className="grid-header-canvas";this._header.appendChild(this._headerCanvas);e.appendChild(this._header)}if(i){this._element.classList.add("has-gutter");this._gutter=document.createElement("div");this._gutter.className="grid-gutter";this._canvas.appendChild(this._gutter);if(this._header){this._gutterHeader=document.createElement("div");this._gutterHeader.className="grid-gutter-header";this._header.appendChild(this._gutterHeader)}}e.appendChild(this._canvas);this._element.appendChild(e)}_attachEvents(){window.addEventListener("resize",e=>this._onContainerResize(e));this._element.addEventListener("mousedown",e=>this._onContainerMouseDown(e));this._canvas.addEventListener("keydown",e=>this._onKeyDown(e));this._canvas.addEventListener("mousedown",e=>this._onRowMouseDown(e));this._canvas.addEventListener("dblclick",e=>this.onEditCell(e));this._canvas.addEventListener("scroll",e=>this._onCanvasScroll(e));this._canvas.addEventListener("selectstart",function(){return!1});if(this._header){this._header.addEventListener("mousedown",e=>this._onHeaderMouseDown(e));this._header.addEventListener("mouseup",e=>this._onHeaderMouseUp(e));this._header.addEventListener("click",e=>this._onHeaderClick(e));this._header.addEventListener("dblclick",e=>this._onHeaderDblClick(e))}if(this._gutter){this._gutter.addEventListener("click",e=>this._onGutterClick(e));this._gutter.addEventListener("mouseover",e=>{var t=this.findClosestElement(e.target,".grid-gutter-row");t&&t.classList.add("grid-gutter-row-hover")});this._gutter.addEventListener("mouseout",e=>{var t=this.findClosestElement(e.target,".grid-gutter-row");t&&t.classList.remove("grid-gutter-row-hover")})}}_mergeExpandStates(e,t,i){var s=i.length-1;t.splice(e+1,1);for(var n=0;n<=s;n++)t.splice(e+n+1,0,i[n]);var a=0;for(n=e;n>=0;n--){var r=t[n];if(Math.abs(r)>a){t[n]=r<0?r-s:r+s;a=0}else a++}}_takeMeasurements(){var e=this._options.coreCssClass;this._options.cssClass&&(e+=" "+this._options.cssClass);var t=this.createElementWithClass("div",e);t.style.position="absolute";t.style.left="-5000px";t.style.top="-5000px";t.style.width="1000px";t.style.height="500px";document.body.appendChild(t);var i=this.createElementWithClass("div","grid-row grid-row-normal");t.appendChild(i);var s=this.createElementWithClass("div","grid-cell");s.style.width="100px";s.innerText="1";i.appendChild(s);this._measurements.rowHeight=i.offsetHeight;this._measurements.cellOffset=s.offsetWidth-100;var n=this.createElementWithClass("div");n.style.overflow="hidden";n.style.width="1em";n.style.height="1ex";s.appendChild(n);this._measurements.unitEx=n.offsetHeight;var a=this.createElementWithClass("div","grid-gutter");a.appendChild(this.createElementWithClass("div","grid-gutter-row grid-gutter-row-selected"));t.appendChild(a);this._gutter?this._measurements.gutterWidth=a.clientWidth:this._measurements.gutterWidth=0;document.body.removeChild(t)}initializeDataSource(){if(this._resetScroll){this._ignoreScroll=!0;try{var e=this._canvas;e.scrollTop=0;e.scrollLeft=0;this._scrollLeft=0;this._scrollTop=0;this._resetScroll=!1}finally{this._ignoreScroll=!1}}this.setDataSource(this._options.source,this._options.expandStates,this._options.columns,this._options.sortOrders);this._expandedCount>0?this._options.keepSelection&&this._selectedIndex>=0?this._selectRow(Math.min(this._selectedIndex,this._expandedCount-1)):this._selectRow(!1!==this._options.initialSelection?0:-1):this.setSelectedRowIndex(-1)}setDataSource(e,t,i,s,n,a,r){var o,l,d;this._rowInfoMap={};this._dataSource=e||[];this._count=d=this._dataSource.length;if(t){this._expandStates=t;this._indentLevels=u.expand(t)}else{this._indentLevels=null;this._expandStates=null}this.expandedCount=d;this._updateRanges();this._columns=[];if(i){var h=(e,t,i,s,n,a,r)=>this._drawCell(e,t,i,s,n,a,r),c=(e,t)=>this._drawHeaderCellValue(e,t),_=(e,t,i)=>this.getColumnValue(e,t,i);for(o=0,l=i.length;o<l;o++){var g=i[o];g.index=void 0!==g.index?g.index:String(o);g.canSortBy=!1!==g.canSortBy;g.canMove=!1!==g.canMove;g.width=void 0!==g.width?g.width:100;g.getCellContents=g.getCellContents||h;g.getHeaderCellContents=g.getHeaderCellContents||c;g.getColumnValue=g.getColumnValue||_;this._columns.push(g)}}this._sortOrder=[];if(s)for(o=0,l=s.length;o<l;o++){var p=s[o];"desc"!==p.order&&(p.order="asc");this._sortOrder.push(p)}this._clearSelection();this._determineIndentIndex();this._options.asyncInit?window.setImmediate(()=>{this._layoutAfterSetDataSource(n,a,r)}):this._layoutAfterSetDataSource(n,a,r)}getDataSource(){return this._dataSource}_layoutAfterSetDataSource(e,t,i){this.layout(void 0,t);this._ensureSelectedIndex(e);i&&this.scrollToBottom(()=>{});this._selectRow(e,null,null,!0===t)}_adjustForDynamicData(e,t,i){if(this._options.isGridEnabled){this._dataSource.splice(i+1,1);for(var s=0;s<e.length;s++)this._dataSource.splice(i+s+1,0,e[s]);this._mergeExpandStates(i,this._expandStates,t);var n=this._dataSource.length;this._count=n;this._expandStates?this._indentLevels=u.expand(this._expandStates):this._indentLevels=null;this.expandedCount=n;this._updateRanges();this._clearSelection();this._determineIndentIndex();this._layoutAfterSetDataSource(this._getRowIndex(i),!0)}}_ensureSelectedIndex(e){var t=this._selectedIndex;"number"==typeof e&&(this._selectedIndex=e);if(this._selectedIndex>=0){this._count<=this._selectedIndex&&(this._selectedIndex=this._count-1);this._selectedIndex!==t&&this._addSelection(this._selectedIndex)}}getRowInfo(e){return this._rows[e]}getRowData(e){return this._dataSource[e]}getColumns(){return this._columns||[]}getSortOrder(){return this._sortOrder||[]}insertAdditionalDynamicData(e,t){void 0!==e&&this._adjustForDynamicData(e.itemsWithPlaceholders,e.expandStates,t-1)}_determineIndentIndex(){var e,t,i=this._columns;for(e=0,t=i.length;e<t;e++)if(i[e].indent){this._indentIndex=e;return}this._indentIndex=0}_getDataIndex(e){var t,i,s,n=-1,a=this._visibleRange;if(e<0)return-1;for(t=0,i=a.length;t<i;t++)if(e<=(n+=(s=a[t]).end-s.start+1))return s.end-n+e;return e}_getRowIndex(e){var t,i,s,n=0,a=this._visibleRange;for(t=0,i=a.length;t<i&&e>=(s=a[t]).start;t++){if(e<=s.end)return n+e-s.start;n+=s.end-s.start+1}return-Math.max(0,n-1)}_updateRanges(){var e=0,t=0,i=this._count,s=[],n=0;if(this._expandStates){for(;e<i;){var a=this._expandStates[e];if(a<0){s[s.length]=new c(t,e);n+=e-t+1;t=e+=1-a}else e++}if(t<i){s[s.length]=new c(t,i-1);n+=i-t}}else{n=i;s[s.length]=new c(0,n)}this.expandedCount=n;this._visibleRange=s}expandNode(e){if(this._options.isGridEnabled){this._options.onRowToggleCallback&&this._options.onRowToggleCallback(this._dataSource,e,!0);this._dataSource[e+1].isPlaceholder&&this._getChildDataCallback(this._dataSource[e],t=>{void 0!==t&&this._adjustForDynamicData(t.itemsWithPlaceholders,t.expandStates,e)});if(this._expandStates){var t=this._expandStates[e];if(t<0){this._expandStates[e]=-t;this._updateRanges();var i=this._rows[e];i&&(i.isDirty=!0)}}}}collapseNode(e){if(this._options.isGridEnabled){if(this._expandStates){var t=this._expandStates[e];if(t>0){this._options.onRowToggleCallback&&this._options.onRowToggleCallback(this._dataSource,e,!1);this._expandStates[e]=-t;this._updateRanges();var i=this._rows[e];i&&(i.isDirty=!0)}}this.layout()}}expandAllNodes(){var e=0,t=this._count,i=this._expandStates,s=!1,n=this._rows;if(i){for(;e<t;){var a=i[e];if(a<0){i[e]=-a;s=!0;var r=n[e];r&&(r.isDirty=!0)}e++}s&&this._updateRanges()}return s}collapseAllNodes(){var e=0,t=this._count,i=this._expandStates,s=!1,n=this._rows;if(i){for(;e<t;){var a=i[e];if(a>0){i[e]=-a;s=!0;var r=n[e];r&&(r.isDirty=!0)}e++}s&&this._updateRanges()}return s}expandAll(){this._updateExpansionStateAndRedraw(()=>this.expandAllNodes)}collapseAll(){this._updateExpansionStateAndRedraw(()=>this.collapseAllNodes)}_updateExpansionStateAndRedraw(e){var t,i=this._selectedIndex;i>=0&&(t=this._getDataIndex(i));e();if(i>=0){this._clearSelection();this._addSelection(Math.abs(this._getRowIndex(t)))}this._layoutContentSpacer();this._redraw();this._notifyForPrerender()}tryToggle(e,t,i){var s;if(!this._expandStates||this._selectedIndex<0||this._expandedCount<=0)return!1;var n=void 0!==i?i:this._getDataIndex(this._selectedIndex);if(!this._rows[n])return!1;if(0!==(s=this._expandStates[n])){if(e){if(!(s<0))return!1;this.expandNode(n)}else{if(!(s>0))return!1;this.collapseNode(n)}this._clearSelection();this._addSelection(this._getRowIndex(n),null,null,!0);this._layoutContentSpacer();this._redraw();this._notifyForPrerender();return!0}return!1}layoutOnResize(){this._onContainerResize(void 0)}_getVisibleRowIndices(){var e=this._scrollTop,t=e+this._canvasHeight,i=this._expandedCount-1,s=this._measurements.rowHeight||1;return{first:Math.min(i,Math.max(0,Math.ceil(e/s))),last:Math.min(i,Math.floor(t/s)-1)}}_getRowIntoView(e,t){if(t){this._canvas.scrollTop=Math.max(0,Math.min(e||0,this._expandedCount-1))*this._measurements.rowHeight;return!0}var i=this._getVisibleRowIndices(),s=i.first,n=i.last,a=n-s;if(e<s||e>n){s=this._selectedIndex>s?Math.max(e-a,0):Math.max(0,Math.min(e+a,this._expandedCount-1)-a);this._canvas.scrollTop=s*this._measurements.rowHeight;return!0}return!1}getSelectedRowIntoView(e){return this._getRowIntoView(this._selectedIndex,e)}cacheRows(e,t,i){}_updateViewport(e,t){for(var i=this._count,s=[],n=[],a=[],r=this._expandStates||[],o=this._expandedCount-1,l=this.getViewPortRanges(),h=Math.max(0,l.start-this._options.payloadSize),c=Math.min(o,l.end+this._options.payloadSize),_=this._getDataIndex(h),u=h;u<=c&&_<i;u++){if(u<l.start)s[s.length]=new d(u,_);else if(u>l.end)n[n.length]=new d(u,_);else{a[a.length]=new d(u,_);this._lastRenderedDataIndex=_}var g=r[_];g<0?_+=1-g:_++}this.measureColumnSize(t);this.cacheRows(s,a,n);this._drawRows(a,e)}_cleanUpRows(){var e,t=this._rows,i=this._gutter;for(e in t){var s=t[e];if(s.row.parentElement){s.row.parentElement.removeChild(s.row);delete this._rowInfoMap[s.row.id]}i&&s.gutterRow.parentElement&&s.gutterRow.parentElement.removeChild(s.gutterRow)}this._rows={}}_drawRows(e,t){var i,s,n=this._expandStates,a=0,r=this._indentLevels,o=0,l=this._gutter,d=this._canvas;if(this._editBoxControl){this._editBoxControl.dismiss();this._editBoxControl=null}var h=document.createDocumentFragment(),c=null;if(l){i=this._gutter;c=document.createDocumentFragment()}var _=this._rows,u={};this._rows=u;for(var g=e.length,p=0;p<g;p++){var m=e[p],v=m.rowIndex,f=m.dataIndex,x=_[f];if(x){if(s=x.rowIndex!==v){x.rowIndex=v;x.row.id="row_"+this._getId()+"_"+v;this._rowInfoMap[x.row.id]=x}else{s=x.isDirty;delete x.isDirty}t&&(s=!0);delete _[f]}else{s=!0;var C=this.createElementWithClass("div","grid-row grid-row-normal");C.id="row_"+this._getId()+"_"+v;C.setAttribute("role","row");h.appendChild(C);var w={rowIndex:v,dataIndex:f,row:C};if(l){var S=this.createElementWithClass("div","grid-gutter-row grid-gutter-row-normal");c.appendChild(S);S.id="gtr_"+C.id;this._rowInfoMap[S.id]=w;w.gutterRow=S}this._rowInfoMap[C.id]=w;x=w}u[f]=x;if(s){if(n){a=n[f];o=r[f];x.row.setAttribute("aria-level",""+o)}this._updateRow(x,v,f,a,o)}}for(var I in _){x=_[I];if(l){delete this._rowInfoMap[x.gutterRow.id];x.gutterRow.parentElement.removeChild(x.gutterRow)}delete this._rowInfoMap[x.row.id];x.row.parentElement.removeChild(x.row)}d.appendChild(h);l&&i.appendChild(c)}updateRow(e,t){var i=0,s=0;void 0===t||t<0?t=this._getDataIndex(e):(void 0===e||e<0)&&(e=this._getRowIndex(t));var n=this._rows[t];if(n){if(this._expandStates){i=this._expandStates[t];s=this._indentLevels[t]}this._updateRow(n,e,t,i,s)}}_updateRow(e,t,i,s,n){var a=this._indentIndex;if(this._gutter){var r=this._options.gutter,o=e.gutterRow.firstElementChild;o.style.top=t*this._measurements.rowHeight+"px";o.style.left="0px";o.style.width=this._measurements.gutterWidth+"px";o.style.height=this._measurements.rowHeight+"px";if(r.checkbox){var l=this.createElementWithClass("input","checkbox "+(r.checkbox.cssClass||""));l.setAttribute("type","checkbox");var d=this.createElementWithClass("div","grid-gutter-cell grid-gutter-checkbox");d.appendChild(l[0]);o.appendChild(d)}if(r.icon){var h="grid-gutter-cell grid-gutter-icon ";void 0!==r.icon.cssClass&&(h+=r.icon.cssClass+" ");void 0!==r.icon.index&&(h+=(this.getColumnValue(i,r.icon.index,-1)||"")+" ");!1!==r.icon.ownerDraw&&(h+=this._getGutterIconClass(t,i,s,n)||"");var c=this.createElementWithClass("div",h);o.appendChild(c)}this._drawGutterCell(e,t,i,s,n)}var _=e.row;_.innerHTML="";_.style.top=t*this._measurements.rowHeight+"px";_.style.left=this._measurements.gutterWidth+"px";_.style.height=this._measurements.rowHeight+"px";_.style.width=isNaN(this._contentSize.width)?"":this._contentSize.width+2+"px";for(var g=this._columns,p=0,m=g.length;p<m;p++){var v=g[p];if(!v.hidden){var f=v.getCellContents(e,i,s,n,v,a,p);if(f){f.setAttribute("role","gridcell");f.setAttribute("aria-readonly",!f.classList.contains("grid-cell-editable")+"");_.appendChild(f)}}}u.makeElementUnselectable(_);this._gutter&&u.makeElementUnselectable(o);this._updateRowSelectionStyle(e,this._selectedRows,this._selectedIndex);_.removeEventListener("DOMAttrModified",this._onAriaExpandedModifiedHandler);if(0!==s){_.setAttribute("aria-expanded",s>0?"true":"false");_.addEventListener("DOMAttrModified",this._onAriaExpandedModifiedHandler)}}_getGutterIconClass(e,t,i,s){return""}_drawGutterCell(e,t,i,s,n){}static _setTooltip(e,t,i){var s={content:t,height:i};e.setAttribute("data-plugin-vs-tooltip",JSON.stringify(s))}_drawCell(e,t,i,s,n,a,r){var o,l=n.width||20,d=this.createElementWithClass("div","grid-cell");d.style.width=isNaN(l)?String(l):l+"px";if(n.cellDecorator){var h=this._dataSource[t];n.cellDecorator(d,h)}else{void 0!==n.hrefIndex&&(o=this.getColumnValue(t,n.hrefIndex,-1));var c=this.getColumnText(t,n,r),_=!1;if(c.length>u.MAX_CELL_CONTENT_SIZE){_=!0;d.setAttribute("grid-edit-value",c);c=c.substr(0,u.MAX_CELL_CONTENT_SIZE)}"function"==typeof n.getCellTooltip?u._setTooltip(d,n.getCellTooltip(t,n.index,r,this._dataSource),u.DEFAULT_TOOLTIP_HEIGHT):n.hasHTMLContent||n.hasMixedContent&&n.getCellCSSClass&&-1!==n.getCellCSSClass(t,n.index,r,this._dataSource).indexOf("grid-mixed-cell-html")||u._setTooltip(d,_?c+"...":c,u.DEFAULT_TOOLTIP_HEIGHT);if(o){var g=document.createElement("a");g.setAttribute("href",o);g.setAttribute("tabindex","-1");g.innerText=c;d.appendChild(g)}else c?n.hasHTMLContent||n.hasMixedContent&&n.getCellCSSClass&&-1!==n.getCellCSSClass(t,n.index,r,this._dataSource).indexOf("grid-mixed-cell-html")?d.innerHTML=c:d.innerText=c:d.innerHTML="&nbsp;"}if(r===a&&s>0){var p=s*u.INDENT_WIDTH-13;n.indentOffset=p;if(0!==i){var m=this.createElementWithClass("div","icon grid-tree-icon");m.style.left=p+"px";d.appendChild(m);i>0?m.classList.add("icon-tree-expanded"):m.classList.add("icon-tree-collapsed")}d.style.textIndent=s*u.INDENT_WIDTH+"px"}if(n.hasGlyph){var v=2,f=n.getGlyphClass(t,n.index,r,this._dataSource);if(f&&""!==f){var x=this.createElementWithClass("div",f+" grid-cell-glyph");x.style.left=s*u.INDENT_WIDTH+v+"px";d.appendChild(x);d.style.textIndent=s*u.INDENT_WIDTH+u.GLYPH_WIDTH+v+"px"}}if(n.getCellCSSClass){var C=n.getCellCSSClass(t,n.index,r,this._dataSource);if(C)for(var w=C.trim().split(" "),S=0;S<w.length;S++)w[S]&&d.classList.add(w[S])}n.rowCss&&d.classList.add(n.rowCss);return d}_drawSplitters(){if(this._options.drawRowSplitters&&this._dataSource.length>0){for(var e=this._canvas.querySelectorAll(".grid-row-splitter"),t=0;t<e.length;t++){var i=e[t];i.parentElement.removeChild(i)}var s=this.getRowInfo(this._lastRenderedDataIndex),n=0;if(s){var a=this._canvas.scrollHeight-1+"px";for(t=0;t<this._columns.length-1;t++){var r=this._columns[t];if(!r.hidden){var o=this.createElementWithClass("div","grid-row-splitter");n+=parseInt(s.row.children[t].style.width);o.style.left=n+"px";o.style.height=a;o.setAttribute("grid-splitter-index",""+t);if(r.fixed||this._columns[t+1].fixed)o.classList.add("fixed");else{o.addEventListener("mousedown",e=>{this._onSplitterMouseDown(e)});o.addEventListener("dblclick",e=>{this._onSplitterDblClick(e)})}this._canvas.appendChild(o)}}}}}_drawHeader(){var e=this._columns,t=this._sortOrder;if(this._header){for(var i=document.createDocumentFragment(),s=0,n=e.length;s<n;s++){var a=e[s];if(!a.hidden){var r=this.createElementWithClass("div","grid-header-column");u._setTooltip(r,a.tooltip,u.DEFAULT_TOOLTIP_HEIGHT);r.style.width=(a.width||20)+"px";r._data={columnIndex:s,header:!0};var o=this.createElementWithClass("div","separator");a.fixed&&(o.style.cursor="auto");o._data={columnIndex:s,separator:!0};r.appendChild(o);var l=a.getHeaderCellContents(a,s);a.headerCss&&l.classList.add(a.headerCss);a.tooltip&&u._setTooltip(l,a.tooltip,u.DEFAULT_TOOLTIP_HEIGHT);r.appendChild(l);var d=this.createElementWithClass("div","sort-handle");t.forEach((e,t,i)=>{if(e.index===a.index){"asc"===e.order?r.classList.add("ascending"):"desc"===e.order&&r.classList.add("descending");return!1}});r.appendChild(d);i.appendChild(r)}}this._headerCanvas.innerHTML="";this._headerCanvas.appendChild(i);u.makeElementUnselectable(this._header)}}_drawHeaderCellValue(e,t){var i=document.createElement("div");i.classList.add("title");i.innerText=e.text||"";t===this._indentIndex&&void 0!==this._indentLevels&&null!==this._indentLevels&&i.classList.add("indented-title");return i}_layoutContentSpacer(){for(var e=0,t=this._columns,i=0,s=t.length;i<s;i++)t[i].hidden||(e+=(t[i].width||20)+this._measurements.cellOffset);e+=2;var n=Math.max(1,this._expandedCount*this._measurements.rowHeight);this._contentSpacer.style.width=e+"px";this._contentSpacer.style.height=n+"px";this._gutter&&(this._gutter.style.height=n+"px");this._ignoreScroll=!0;try{var a=Math.max(0,Math.min(this._scrollTop,n-this._canvasHeight));if(a!==this._scrollTop){this._scrollTop=a;this._canvas.scrollTop=a}var r=Math.max(0,Math.min(this._scrollLeft,e-this._canvasWidth));if(r!==this._scrollLeft){this._scrollLeft=r;this._canvas.scrollLeft=r}}finally{this._ignoreScroll=!1}this._contentSize.width=e;this._contentSize.height=n}_layoutHeader(){this._header&&(this._headerCanvas.style.left=this._measurements.gutterWidth-this._scrollLeft+"px");this._gutter&&(this._gutter.style.left=this._scrollLeft+"px")}layout(e,t=!0){this._measureCanvasSize();var i=-1;document.activeElement&&this._canvas.contains(document.activeElement)&&(i=this._selectedIndex);this._cleanUpRows();this._fixScrollPos();this._layoutContentSpacer();this._updateViewport(!1,e);!document.activeElement&&i>=0&&this._addSelection(i,null,null,t);this._layoutHeader();this._drawHeader();this._drawSplitters()}_fixScrollPos(){var e=this._ignoreScroll;this._ignoreScroll=!0;try{this._canvas.scrollLeft=this._scrollLeft;this._canvas.scrollTop=this._scrollTop}finally{this._ignoreScroll=e}}redraw(){this._fixScrollPos();this._redraw(!0)}_redraw(e){this._layoutHeader();this._updateViewport(e)}getColumnValue(e,t,i){return this._dataSource[e][t]}getColumnText(e,t,i){var s,n=t.getColumnValue(e,t.index,i,this._dataSource);s="string"!=typeof n?u.convertValueToDisplayString(n,t.format):n;t.maxLength=Math.max(t.maxLength||0,s.length);return s}_getExpandState(e){var t=0;this._expandStates&&"number"==typeof this._expandStates[e]&&(t=this._expandStates[e]);return t}getViewPortRanges(){var e=this._expandedCount-1,t=this._getVisibleRowIndices(),i=t.first,s=t.last;i=Math.max(0,i-this._options.extendViewportBy);s=Math.min(e,s+this._options.extendViewportBy);var n=this._getDataIndex(i),a=this._getDataIndex(s);return new c(Math.min(n,i),Math.max(a,s))}scrollToBottom(e){this._scrollRenderComplete=e;if(this._canvas.scrollTop+this._canvas.clientHeight>=this._canvas.scrollHeight){if(this._scrollRenderComplete){this._scrollRenderComplete();this._scrollRenderComplete=null}}else this._canvas.scrollTop=this._canvas.scrollHeight}setViewState(e){this._options.isGridEnabled=e;e?this.rootElement.classList.remove("busy"):this.rootElement.classList.add("busy")}_selectRow(e,t,i,s){var n=i&&i.ctrl,a=i&&i.shift,r=i&&i.rightClick;if(n)this._addSelection(e,t,{toggle:!0});else if(a){this._clearSelection();this._addSelectionRange(e,t)}else if(r)if(this._selectedRows&&this._selectedRows.hasOwnProperty(e)){this._selectedIndex=e;this._updateAriaAttribute()}else{this._clearSelection();this._addSelection(e,t)}else{this._clearSelection();this._addSelection(e,t,null,s)}}_selectAll(){if(this._count>0&&!1!==this._options.allowMultiSelect){this._clearSelection();this._selectionStart=0;var e=Math.max(0,this._selectedIndex);this._addSelectionRange(this._count-1,void 0,{doNotFireEvent:!0});this._selectedIndex=e;this._updateSelectionStyles();this._selectionChanged()}}getSelectedRowIndex(){return this._selectedIndex}setSelectedRowIndex(e){this._clearSelection();this._addSelection(e)}getSelectedDataIndex(){return this._getDataIndex(this._selectedIndex)}getSelectedDataIndices(){var e,t=this._selectedRows,i=[];if(t)for(e in t)i[i.length]=t[e];return i}ensureDataIndexExpanded(e){for(var t=this._getRowIndex(e);t<0||e>0&&0===t;){this.expandNode(this._getDataIndex(-t));t=this._getRowIndex(e)}return t}setSelectedDataIndex(e,t){var i=t?this.ensureDataIndexExpanded(e):this._getRowIndex(e);this.setSelectedRowIndex(i)}focus(e){var t=()=>{if(document.activeElement!==this._canvas)try{if(this._selectedIndex>-1){var e=this._getDataIndex(this._selectedIndex),t=this._rows[e];if(t){var i=t.row;i&&i.focus()}}}catch(e){}};e?window.setTimeout(()=>{t()},e):t()}_clearSelection(){this._selectionCount=0;this._selectedRows=null}_addSelection(e,t,i,s){var n=i&&i.keepSelectionStart,a=i&&i.doNotFireEvent,r=i&&i.toggle;if(!1===this._options.allowMultiSelect){n=!1;this._clearSelection()}this._selectedRows||(this._selectedRows={});if(e>=0){var o=!0;if(this._selectedRows.hasOwnProperty(e)){if(r){o=!1;this._selectionCount=Math.max(0,this._selectionCount-1);delete this._selectedRows[e]}}else this._selectionCount++;"number"!=typeof t&&(t=this._getDataIndex(e));o&&(this._selectedRows[e]=t);this._selectedIndex=e;this._updateAriaAttribute();(this._selectionStart<0||!n)&&(this._selectionStart=e)}else{t=-1;this._selectedIndex=-1}if(!a){this._updateSelectionStyles();this._selectionChanged();s&&this.focus();this._selectedIndexChanged(this._selectedIndex,t)}}_addSelectionRange(e,t,i){var s,n=i&&i.doNotFireEvent,a=-1;if(!1===this._options.allowMultiSelect)this._addSelection(e,t);else{this._selectedRows&&(a=this._selectedRows[this._selectedIndex]);this._selectionStart<0&&(this._selectionStart=e);var r=Math.min(this._selectionStart,e),o=Math.max(this._selectionStart,e);"number"==typeof t&&r===e||(t=this._getDataIndex(r));for(var l=r;l<=o;l++){this._addSelection(l,t,{keepSelectionStart:!0,doNotFireEvent:!0});l===e&&(s=t);var d=this._getExpandState(t);d<0?t+=1-d:t++}this._selectedIndex=e;this._updateAriaAttribute();if(!n){this._updateSelectionStyles();this._selectionChanged();a!==s&&this._selectedIndexChanged(this._selectedIndex,s)}}}_updateAriaAttribute(){if(this._active){var e=this._getDataIndex(this._selectedIndex);if(e>=0){var t=this.getRowInfo(e);if(t&&t.row){var i=t.row.getAttribute("id");if(i!==this._activeAriaId){this._canvas.setAttribute("aria-activedescendant",i);this._activeAriaId=i}}}}}_updateSelectionStyles(){this._delayedUpdateCookie&&window.clearTimeout(this._delayedUpdateCookie);this._delayedUpdateCookie=window.setTimeout(()=>{var e,t=this._selectedRows,i=this._selectedIndex,s=this._rows;for(e in s){var n=s[e];this._updateRowSelectionStyle(n,t,i)}},10)}_selectionChanged(){this.selectionChanged(this._selectedIndex,this._selectionCount,this._selectedRows);this.fireCustomEvent(this._element,"selectionchanged",[{selectedIndex:this._selectedIndex,selectedCount:this._selectionCount,selectedRows:this._selectedRows}])}selectionChanged(e,t,i){}_selectedIndexChanged(e,t){this.selectedIndexChanged(e,t);this.fireCustomEvent(this._element,u.EVENT_SELECTED_INDEX_CHANGED,[e,t])}selectedIndexChanged(e,t){}_updateRowSelectionStyle(e,t,i){var s=e.rowIndex,n=e.row,a=e.gutterRow;n.classList.remove("grid-row-selected");n.classList.remove("grid-row-selected-blur");n.classList.remove("grid-row-current");n.setAttribute("tabindex","-1");if(a){a.classList.remove("grid-gutter-row-selected");a.classList.remove("grid-gutter-row-selected-blur");a.classList.remove("grid-gutter-row-current");a.querySelector("input.checkbox").setAttribute("checked",String(!1))}if(t&&t.hasOwnProperty(s)){a&&a.querySelector("input.checkbox").setAttribute("checked",String(!0));if(this._active){n.classList.add("grid-row-selected");n.setAttribute("tabindex","1");a&&a.classList.add("grid-gutter-row-selected")}else{n.classList.add("grid-row-selected-blur");n.setAttribute("tabindex","1");a&&a.classList.add("grid-gutter-row-selected-blur")}}if(s===i){n.classList.add("grid-row-current");a&&a.classList.add("grid-gutter-row-current")}}_notifyForPrerender(){if(this._options.prerenderCallback){var e=this.getViewPortRanges();this._options.prerenderCallback(e.start,e.end)}}measureColumnSize(e){for(var t=this._canvas.clientWidth-(this.isVerticalScrollbarVisible?0:17),i=0;i<this._columns.length;i++){(s=this._columns[i]).fixed&&(t-=s.width)}if(t>0){if(e)for(i=0;i<this._columns.length;i++){!(s=this._columns[i]).fixed&&s.percentWidth&&(s.percentWidth=s.width/t)}for(i=0;i<this._columns.length;i++){var s;!(s=this._columns[i]).fixed&&s.percentWidth&&(s.width=t*s.percentWidth)}}}_onContainerMouseDown(e){e.target.classList.contains("grid-edit-box")||this.focus(10)}_measureCanvasSize(){this._canvasHeight=this._canvas.clientHeight;this._canvasWidth=this._canvas.clientWidth}_onContainerResize(e){this._resizeLayoutTimeout||(this._resizeLayoutTimeout=window.setTimeout(()=>{this._takeMeasurements();this.measureColumnSize(!1);this.layout();this._notifyForPrerender();this._resizeLayoutTimeout=null},200))}_setupMoveEvents(){document.addEventListener("mousemove",e=>this._onDocumentMouseMove(e));document.addEventListener("mouseup",e=>this._onDocumentMouseUp(e))}_clearMoveEvents(){document.removeEventListener("mousemove",null,!0);document.removeEventListener("mouseup",null,!0)}_onDocumentMouseMove(e){var t=this._columnSizing;if(t&&!0===t.active){var i=e.pageX-t.origin,s=Math.max(15,t.originalWidth+i);this._columns[t.index].width=s;this._applyColumnSizing(t.index);this._moveSizingElement(t.index)}}_onDocumentMouseUp(e){window.setImmediate(()=>{this._tryFinishColumnSizing(!1)});return!1}_onHeaderMouseDown(e){if(1!==e.which)return!0;var t=this.findClosestElement(e.target,".separator");if(t&&t._data){var i=t._data.columnIndex,s=this._columns[i];if(!s.fixed){this._columnSizing=new _(!0,i,s.width,e.pageX);this._moveSizingElement(i);this._setupMoveEvents();e.stopImmediatePropagation();e.preventDefault();return!1}}}_onHeaderMouseUp(e){return!1}_onHeaderClick(e){var t=this.findClosestElement(e.target,".grid-header-column");if(t&&!this._columnSizing){var i=this.findClosestElement(e.target,".separator");if(i&&i._data)return!1;if(t._data){var s=t._data.columnIndex,n=this._columns[s];n.canSortBy&&!n.fixed&&this._sortBy(n,e.shiftKey,this._options.alwaysForceSort)}}}_onHeaderDblClick(e){var t=this.findClosestElement(e.target,".separator");if(t&&t._data){this._tryFinishColumnSizing(!0);var i=t._data.columnIndex,s=this._columns[i],n=Math.max(s.maxLength||0,3),a=1.1+.7*Math.exp(-n/20),r=s.width;s.width=(s.indentOffset||0)+Math.round(n*a*this._measurements.unitEx);this._applyColumnSizing(i,r,!0);return!1}}getCellContentWidth(e){if(document.createRange){var t=document.createRange();if(e.firstChild&&e.firstChild.nodeType===Node.TEXT_NODE){t.selectNodeContents(e.firstChild);var i=t.getBoundingClientRect();return parseInt(e.style.textIndent,10)+i.width}}return e.clientWidth}_onSplitterDblClick(e){var t=0,i=e.target;if(i){var s=parseInt(i.getAttribute("grid-splitter-index"),10);t=0;for(var a in this._rows){var r=this._rows[a];if(r){var o=this.getCellContentWidth(r.row.children[s]);t=t>o?t:o}}var l=this._columns[s],d=this._columns[s+1];l.hasGlyph&&(t+=u.GLYPH_WIDTH);var h=l.width-(t+3),c=l.width-h,_=d.width+h;if(c>=n.MIN_RESIZE_WIDTH&&_>=n.MIN_RESIZE_WIDTH){l.width-=h;d.width+=h;window.setImmediate(()=>{this.layout(!0)})}else if(_<n.MIN_RESIZE_WIDTH){c-=n.MIN_RESIZE_WIDTH-_;_=n.MIN_RESIZE_WIDTH}}}_onSplitterMouseDown(e){var t,i,s,a,r=e=>{var i=document.querySelector(".grid-row-splitter.active");if(i){var r=e.clientX-t,o=s.width+r,l=a.width-r;if(o>=n.MIN_RESIZE_WIDTH&&l>=n.MIN_RESIZE_WIDTH){i.style.left=i.offsetLeft+r+"px";t=e.clientX;s.width+=r;a.width-=r}}},o=e=>{var t=document.querySelector(".grid-row-splitter.active");if(t){t.classList.remove("active");window.setImmediate(()=>{this.layout(!0)})}document.removeEventListener("mousemove",r);document.removeEventListener("mouseup",o)};if(0===e.button){var l=e.target;i=parseInt(l.getAttribute("grid-splitter-index"),10);s=this._columns[i];a=this._columns[i+1];if(!s.fixed&&!a.fixed){l.classList.add("active");t=e.clientX;document.addEventListener("mousemove",r);document.addEventListener("mouseup",o)}}}_moveSizingElement(e){var t=this._measurements.gutterWidth;if(!this._sizingElement){if(e<0)return;this._sizingElement=this.createElementWithClass("div","grid-column-sizing");this._canvas.appendChild(this._sizingElement)}this._sizingElement.style.height=this._canvas.clientHeight-1+"px";this._sizingElement.style.top=this._scrollTop+"px";if(e<0){this._sizingElement.style.left="-5000px";this._sizingElement.style.top="-5000px";this._sizingElement.style.height="0px"}else{for(var i=0;i<=e;){var s=this._columns[i++];s.hidden||(t+=s.width)}this._sizingElement.style.left=t-1+"px"}}_getVisibleColumnIndex(e){var t=0,i=0;this._columns.length;if(this._columns[e].hidden)return-1;for(;t<e;){this._columns[t].hidden||i++;t++}return i}_applyColumnSizing(e,t,i){var s=this._getVisibleColumnIndex(e)+1,n=this._columns[e],a=!1;t=t||-1;if(n){a=n.width!==t;this.rootElement.querySelector(".grid-header-canvas .grid-header-column:nth-child("+s+")").style.width=n.width+"px"}if(!0===i){a&&this.layout();this._onColumnResize(n)}}_onColumnResize(e){this.fireCustomEvent(this._element,"columnresize",[e])}_tryFinishColumnSizing(e){var t=this._columnSizing;if(t){if(!0===t.active){e||this._applyColumnSizing(t.index,t.originalWidth,!0);this._moveSizingElement(-1)}this._columnSizing=null;this._clearMoveEvents()}}_getSortColumns(e){for(var t=this._columns,i=[],s=0,n=e.length;s<n;s++){var a,r=e[s];t.forEach(function(e,t,i){if(e.index===r.index){a=e;return!1}});i.push(a)}return i}_sortBy(e,t,i){var s=this._sortOrder.slice(0),n=!1;if(e){for(var r=0,o=s.length;r<o;r++){if((l=s[r]).index===e.index){s.splice(r,1);n=!0;break}}var l;l=n?new a(l.index,"asc"===l.order?"desc":"asc"):new a(e.index,"asc");t&&this._options.allowSortOnMultiColumns?s.push(l):s=[l]}var d=this._getSortColumns(s);this._onSort(s,d,i)}_onSort(e,t,i=!1){!1!==this.onSort(e,t,i)&&this.fireCustomEvent(this._element,"sort",[{sortOrder:e,sortColumns:t}])}onSort(e,t,i=!1){if(this._options.autoSort){this._trySorting(e,t,i);this._sortOrder=e;this.layout()}return!0}_trySorting(e,t,s=!1){t||(t=this._getSortColumns(e));var n=[],a=0;for(var o in this._selectedRows){var l=this._selectedRows[o],d=this._dataSource[l];if(d){n.push(d);a+=parseInt(o)}}var h=new r(null,null);u.addItemsToTree(this._dataSource,this._expandStates,0,this._dataSource.length,h);this._sortOrder&&1===this._sortOrder.length&&1===e.length&&this._sortOrder[0]!==e[0]&&this._sortOrder[0].index===e[0].index&&!s?this._sortOrder[0].order!==e[0].order&&u.walkTree(h,s=>{i.TreeNodeSort.stableReverse(s.children,(s,n)=>i.TreeNodeSort.sortComparer(e,t,s.data,n.data))}):u.walkTree(h,s=>{s.children.sort((s,n)=>i.TreeNodeSort.sortComparer(e,t,s.data,n.data))});this._dataSource=[];this._expandStates=[];for(var c=0;c<h.children.length;c++)u.walkTree(h.children[c],e=>{this._dataSource.push(e.data);this._expandStates.push(e.expandState)});this._indentLevels=u.expand(this._expandStates);this._updateRanges();if(this._selectionCount>0){this._clearSelection();var _=0;for(c=0;c<n.length;c++){if((l=this._dataSource.indexOf(n[c]))>=0){var g=this._getRowIndex(l);this._addSelection(g,l);_+=g}}this._scrollTop+=(_-a)/this._selectionCount*this._measurements.rowHeight}}_onCanvasScroll(e){var t=this._canvas;this._resetScroll=!0;this._scrollLeft=t.scrollLeft;this._scrollTop=t.scrollTop;if(!this._ignoreScroll){this._notifyForPrerender();this._redraw();if(this._scrollRenderComplete){this._scrollRenderComplete();this._scrollRenderComplete=null}}return!1}getRowInfoFromEvent(e,t){var i=this.findClosestElement(e.target,t);return this._rowInfoMap[i.id]}_getClickedCell(e){return this.findClosestElement(e.target,".grid-cell")}_isCellEditing(e){return 1===e.querySelectorAll(".grid-edit-box").length}createEditBox(e,i,s){if(this._options.isGridEnabled){void 0!==this._options.preEditCellCallback&&this._options.preEditCellCallback(e,i);var n,a=this.getColumns()[i];a.getEditBox&&(n=a.getEditBox(e,a));this._editBoxControl=new t.GridCellEditControl(e,i,s,this,this._options,n);this._editBoxControl.inputElement.setAttribute("aria-label",Microsoft.Plugin.Resources.getString("AddToWatchesWindowLink"));s.innerHTML="";s.appendChild(this._editBoxControl.inputElement);try{this._editBoxControl.inputElement.select();this._editBoxControl.inputElement.focus()}catch(e){}}}onEditCell(e){if(!e.target.classList.contains("grid-tree-icon")){var t=this._getClickedCell(e);if(this._isCellEditing(t))return;if(t&&t.classList.contains("grid-cell-editable")){var i=this.getRowInfoFromEvent(e,".grid-row");if(i){for(var s=i.row.children,n=s.length,a=-1,r=0;r<n;r++)t===s[r]&&(a=r);this.createEditBox(i.dataIndex,a,t)}}}}_onRowMouseDown(e){var t=this.getRowInfoFromEvent(e,".grid-row");if(t){var i=e.target;if(1===e.which&&i.classList.contains("grid-tree-icon"))this._onToggle(t);else if(!(3===e.which&&this._options&&this._options.disableRightClickSelection||i.classList.contains("grid-edit-box"))){this._selectRow(t.rowIndex,t.dataIndex,{ctrl:e.ctrlKey,shift:e.shiftKey,rightClick:3===e.which});this.focus(0)}}}_onGutterClick(e){var t=this.getRowInfoFromEvent(e,".grid-gutter-row");t&&(this._selectedRows&&"number"==typeof this._selectedRows[t.rowIndex]||this._selectRow(t.rowIndex,t.dataIndex))}_onBlur(e){if(e.target.classList.contains("grid-edit-box"))e.stopPropagation();else{this._active=!1;this._updateSelectionStyles()}}_onFocus(e){if(e.target.classList.contains("grid-edit-box"))e.stopPropagation();else{this._active=!0;this._updateSelectionStyles();this._updateAriaAttribute()}}_onKeyDown(t){var i={lo:-1,hi:-1},s=e.KeyCodes;this._canvas;if(!this._options.isGridEnabled)return!1;if(this._copyInProgress){t.keyCode===s.Escape&&this._cancelable&&this._cancelable.cancel();return!1}this._count>0&&(i={lo:0,hi:this._expandedCount-1});this._selectedIndex<0&&this._addSelection(i.lo);if(this._options.keyboardEventHandler&&-1!==this._options.keyboardEventHandler.keys.indexOf(t.key)){if(this._options.keyboardEventHandler.handler(t,this._dataSource,this._getDataIndex(this._selectedIndex))){t.preventDefault();return!1}}switch(t.keyCode){case s.ArrowDown:this._clearSelection();this._addSelection(Math.min(this._selectedIndex+1,i.hi),null,null,!0);break;case s.ArrowUp:this._clearSelection();this._addSelection(Math.max(this._selectedIndex-1,i.lo),null,null,!0);break;case s.PageDown:this._clearSelection();var n=this._getVisibleRowIndices();if(this._selectedIndex<n.last)this._addSelection(n.last,null,null,!0);else{var a=n.last-n.first+1;this._addSelection(Math.min(this._selectedIndex+a,i.hi),null,null,!0)}break;case s.PageUp:this._clearSelection();n=this._getVisibleRowIndices();if(this._selectedIndex>n.first)this._addSelection(n.first,null,null,!0);else{a=n.last-n.first+1;this._addSelection(Math.max(this._selectedIndex-a,i.lo),null,null,!0)}break;case s.ArrowRight:this.tryToggle(!0,t.shiftKey);break;case s.ArrowLeft:if(!this.tryToggle(!1,t.shiftKey))for(var r=this._getDataIndex(this._selectedIndex),o=r-1;o>=0;){if(r-o<=Math.abs(this._expandStates[o])){this._selectRow(this._getRowIndex(o),null,null,!0);break}o--}break;case s.Home:this._clearSelection();this._addSelection(i.lo,null,null,!0);break;case s.End:this._clearSelection();this._addSelection(i.hi,null,null,!0);break;case s.F2:var l=this.getRowInfo(this._getDataIndex(this._selectedIndex));if(l){var d=this._getFirstEditableCellIndex(l.row.children);d>=0&&this.createEditBox(l.dataIndex,d,l.row.children[d])}break;default:return!0}this.getSelectedRowIntoView();t.preventDefault();return!1}_getFirstEditableCellIndex(e){for(var t=0;t<e.length;t++)if(e[t].classList.contains("grid-cell-editable"))return t;return-1}_onToggle(e){if(this._expandStates){var t=this._expandStates[e.dataIndex];if(0!==t){t>0?this.collapseNode(e.dataIndex):t<0&&this.expandNode(e.dataIndex);this._clearSelection();this._addSelection(Math.min(e.rowIndex,this._expandedCount-1),e.dataIndex,null,!0);this._layoutContentSpacer();this._redraw();this._notifyForPrerender()}}}getExpandStates(){return this._expandStates}}u.TYPE_NAME="GridControl";u.MAX_CELL_CONTENT_SIZE=1e3;u.MAX_COPY_SIZE=1e3;u.PAYLOAD_SIZE=200;u.EVENT_SELECTED_INDEX_CHANGED="selectedIndexChanged";u.INDENT_WIDTH=12;u.GLYPH_WIDTH=10;u.DEFAULT_TOOLTIP_HEIGHT=65;t.GridControl=u}(e.Grid||(e.Grid={}))}(Common||(Common={}));
