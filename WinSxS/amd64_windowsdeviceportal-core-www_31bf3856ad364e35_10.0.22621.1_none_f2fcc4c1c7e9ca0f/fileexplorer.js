function FileExplorerViewer(n,t){function f(n,t,r,u,f){return(f.Type&i.fileType)===i.fileType?'<center><span class="symbol" aria-label="file">&#xe7c3;<\/span><\/center>':(f.Type&i.directoryType)===i.directoryType?'<center><span class="symbol" aria-label="directory">&#xe70a;<\/span><\/center>':'<center><span class="symbol" aria-label="directory">+<\/span><\/center>'}function e(n,t,r,u,f){return(f.Type&i.fileType)===i.fileType?f.Name:(f.Type&i.appType)===i.appType?'<a class="link" role="link">'+f.Name+"<\/a> ("+f.PackageFullName+")":'<a class="link" role="link">'+f.Name+"<\/a>"}function o(n,t,r,u,f){return(f.Type&i.fileType)===i.fileType?bytesToDisplayValue(r):""}function s(n,t,r,u,f){return(f.Type&i.fileType)===i.fileType||(f.Type&i.directoryType)===i.directoryType?"<center><a class='symbol link' style='text-decoration: none;' aria-label='download' tabindex='0' role='button'>&#xe74e;<\/a><\/center>":""}function h(n,t,r,u,f){return f.Type===i.fileType||f.Type===i.directoryType?"<center><span class='symbol link' style='text-decoration: none;' aria-label='delete' tabindex='0' role='button'>&#xe74d;<\/span><\/center>":""}function c(n,t,r,u,f){return f.Type===i.fileType||f.Type===i.directoryType?"<center><span class='symbol link' style='text-decoration: none;' aria-label='rename' role='button' tabindex='0'>&#xe70f;<\/span><\/center>":""}function l(n){var r=this.fileExplorerGrid,u=r.getCellFromEvent(n),t=this.dataView.getItems()[u.row],o,f,e;if(r.getColumns()[u.cell].id==="Delete"&&(t.Type===i.fileType||t.Type===i.directoryType?confirm("Permanently delete "+t.Name+"?")&&this.deleteFile(i.currentKnownFolderId,t.Name,i.currentPackageName,i.currentPath):t.Type===i.directoryType&&confirm("Permanently delete "+t.Name+"? All contents of the folder will be removed.")&&this.deleteFolder(i.currentKnownFolderId,t.Name,i.currentPackageName,i.currentPath)),r.getColumns()[u.cell].id==="Name"&&t.Type!==i.fileType){if(t.Id=="NewFolder"){fileExplorerViewer.createFolder();return}var s=i.currentKnownFolderId||t.KnownFolderId,h=i.currentPackageName||t.PackageFullName,c=t.SubPath;i.updateTable(s,h,c);$("#directoryMessage").focus();$("#fileExplorerGrid").focus();window.history.pushState({knownFolderId:s,packageName:h,path:c},"",window.location.href)}r.getColumns()[u.cell].id==="Rename"&&(t.Type===i.fileType||t.Type===i.directoryType)&&(o=prompt("Enter new name",t.Name),o&&this.renameItem(i.currentKnownFolderId,t.Name,o,i.currentPackageName,t.SubPath));r.getColumns()[u.cell].id==="Download"&&(f="",e={knownfolderid:t.KnownFolderId,filename:t.Name,packagefullname:i.currentPackageName||"\\"},t.SubPath&&(e.path=t.SubPath),t.Type===i.fileType?f="/api/filesystem/apps/file?"+$.param(e):(t.Type===i.directoryType||t.Type===i.nonEditableFolder)&&(f="/api/filesystem/apps/folder?"+$.param(e)),fetch(f).then(n=>{n.status==200?window.location=f:n.status==423?alert("File locked by another process."):alert("Something went wrong.  HTTP status code: "+n.status)}))}function a(){this.fileExplorerGrid.updateRowCount();this.fileExplorerGrid.render()}function v(n,t){this.fileExplorerGrid.invalidateRows(t.rows);this.fileExplorerGrid.render()}function y(n,t){this.dataView.sort(gridCaseInsensitiveObjectComparer.bind(t),t.sortAsc)}function p(n,t){return n.Name<t.Name?-1:n.Name>t.Name?1:0}var i=this,r,u;i.currentKnownFolderId;i.currentPackageName;i.currentPath;i.appType=14;i.fileType=15;i.directoryType=16;i.nonEditableFolder=17;i.firstLoad=!0;r=[{id:"FileType",name:"Type",field:"FileType",sortable:!0,width:50,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:f},{id:"Name",name:"Name",field:"Name",sortable:!0,width:500,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:e},{id:"DateCreated",name:"Date Created",field:"DateCreated",sortable:!0,width:200,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:fileTimeFormatter},{id:"FileSize",name:"File Size",field:"FileSize",sortable:!0,width:100,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:o},{id:"Download",name:"Save",field:"Download",width:50,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:s},{id:"Delete",name:"Delete",field:"Delete",width:60,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:h},{id:"Rename",name:"Rename",field:"Rename",width:70,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:c}];u={selectedCellCssClass:"rowSelected",enableCellNavigation:!0,enableColumnReorder:!1,showHeaderRow:!0,syncColumnCellResize:!0,scaleHeightToDockContentParent:!0,enableTextSelectionOnCells:!0,rowHeight:36.5,headerRowHeight:40.45,gridLabel:t.gridLabel,rowHeaderName:t.rowHeaderName,rowHeaderId:t.rowHeaderId,rowHeaderColumn:t.rowHeaderColumn};this.dataView=new Slick.Data.DataView;this.fileExplorerGrid=new Slick.Grid("#"+n,this.dataView,r,u);$(window).resize(this.fileExplorerGrid.resizeCanvas.bind(this.fileExplorerGrid));this.dataView.onRowCountChanged.subscribe(a.bind(this));this.dataView.onRowsChanged.subscribe(v.bind(this));this.fileExplorerGrid.onSort.subscribe(y.bind(this));this.fileExplorerGrid.setSortColumn("Name",!0);this.fileExplorerGrid.onClick.subscribe(l.bind(this));this.pathLabel=$("#DirectoryNavigationPath");this.fullPathLabel=$("#DirectoryFullPath");this.updateTable=function(n,t,r,u,f){document.cookie="FileExplorerKnownFolderId="+n;document.cookie="FileExplorerPackageName="+t;document.cookie="FileExplorerPath="+r;n===undefined?i.getKnownFoldersList(u,f):n=="LocalAppData"&&t===undefined?i.getInstalledApps(u,f):i.getFiles(n,t,r,u,f)};this.updateGlobalState=function(){i.newPage=!1;(i.firstLoad||i.currentKnownFolderId!==undefined||i.currentPackageName!==undefined||i.currentPath!==undefined)&&(i.newPage=!0,i.firstLoad=!1);delete i.currentKnownFolderId;delete i.currentPackageName;delete i.currentPath};this.getKnownFoldersList=function(n,t){var r=new WebbRest;r.getKnownFolders().done(function(r){var e,f,u,o;for(i.updateGlobalState(),e=[],f=r.KnownFolders.sort(),u=0;u<f.length;u++)e.push({Id:f[u],Name:f[u],Type:i.nonEditableFolder,KnownFolderId:f[u]});i.dataView.setItems(e,"Id");o='<a class="link pathLink" role="link" tabindex="0" id="pathLink1">User Folders<\/a> \\';i.pathLabel.html(o);i.fullPathLabel.html("&nbsp;");$("#uploadFileSection").hide();$("#directoryMessage").text("User Folders");$("#fileExplorerGrid").show();t!==!0&&n!==undefined&&$("#"+n).focus()}).fail(function(){alert("Failed to get the list of known folders")})};this.getInstalledApps=function(n,t){var r=new WebbRest;r.getInstalledAppPackages().done(function(r){var u,e,f,o;for(i.updateGlobalState(),i.currentKnownFolderId="LocalAppData",r.InstalledPackages.sort(function(n,t){return n.PackageFullName.localeCompare(t.PackageFullName)}),u=r.InstalledPackages.filter(function(n,t){return t>0&&r.InstalledPackages[t-1].PackageFullName==n.PackageFullName?!1:isDeveloperApp(n)?!0:!1}),u.sort(p),e=[],f=0;f<u.length;f++)e.push({Id:u[f].PackageFullName,Name:u[f].PackageDisplayName,PackageFullName:u[f].PackageFullName,Type:i.appType,KnownFolderId:"LocalAppData"});i.dataView.setItems(e,"Id");o='<a class="link pathLink" role="link" tabindex="0" id="pathLink1">User Folders<\/a> \\ <a class="link pathLink" role="link" tabindex="0" id="pathLink2" data-knownfolderid="'+i.currentKnownFolderId+'" data-path="\\">'+i.currentKnownFolderId+"<\/a> \\";i.pathLabel.html(o);i.fullPathLabel.html("&nbsp;");$("#uploadFileSection").hide();u.length==0?($("#directoryMessage").html("Apps you create will appear here.<br /><br /><a href='https://go.microsoft.com/fwlink/?LinkId=817324'>Get started at Windows Dev Center<\/a>"),$("#fileExplorerGrid").hide()):($("#directoryMessage").text("Installed packages"),$("#fileExplorerGrid").show());t!==!0&&(n!==undefined?$("#"+n).focus():$("#directoryMessage").focus())}).fail(function(){alert("Failed to get the list of installed apps")})};this.getFiles=function(n,t,r,u,f){var e=new WebbRest;e.getFiles(n,t,r).done(function(e){var s,h,c,v,a,l,o;if(i.updateGlobalState(),i.currentKnownFolderId=n,i.currentPackageName=t,i.currentPath=r,s="",r)for(h=r.split("\\").filter(function(n){return n.length!=0}),c="",o=0;o<h.length;o++)c=c+"\\"+h[o],s=t!==undefined?s+' \\ <a class="link pathLink" role="link" tabindex="0" id="pathLink'+(4+o)+'" data-knownfolderid="'+n+'" data-packagename="'+t+'" data-path="'+c+'">'+h[o]+"<\/a>":s+' \\ <a class="link pathLink" role="link" tabindex="0" id="pathLink'+(3+o)+'" data-knownfolderid="'+n+'" data-path="'+c+'">'+h[o]+"<\/a>";for(v='<a class="link pathLink" role="link" tabindex="0" id="pathLink1">User Folders<\/a> \\ <a class="link pathLink" role="link" tabindex="0" id="pathLink2" data-knownfolderid="'+n+'" data-path="\\">'+n+"<\/a>",a="",t!==undefined&&(a=' \\  <a class="link pathLink" role="link" tabindex="0" id="pathLink3" data-knownfolderid="'+n+'" data-packagename="'+t+'" data-path="\\">'+t+"<\/a>"),i.pathLabel.html(v+a+s+" \\"),l=e.FullPath;l.indexOf("\\\\")!=-1;)l=l.split("\\\\").join("\\");for(i.fullPathLabel.html("Full path: "+l),o=0;o<e.Items.length;o++)e.Items[o].KnownFolderId=n,(e.Items[o].Type&i.directoryType)!=i.directoryType&&(e.Items[o].Type=i.fileType);e.Items.unshift({Id:"NewFolder",Name:"Create New Folder",Type:null,KnownFolderId:null});i.dataView.setItems(e.Items,"Id");e.Items.length===0?($("#fileExplorerGrid").hide(),$("#directoryMessage").text("This folder has no data associated with it")):($("#fileExplorerGrid").show(),$("#directoryMessage").text("Directory contents"));$("#uploadFileSection").show();f!==!0&&(u!==undefined?$("#"+u).focus():$("#directoryMessage").focus())}).fail(function(){t===undefined?alert("Failed to get files inside knownFolderId: "+n):alert("Failed to get files for package: "+t)})};this.uploadFile=function(){var n=$("#fileToUpload").prop("files")[0],r,t,u;n&&(n.type.includes("zip")&&(r=confirm("Extract zip file contents to this directory?")),$("#uploadText").text(""),$("#uploadLoader")[0].style.display=="none"?$("#uploadLoader").toggle("hidden"):($(".checkmark").toggle(),$(".loader").toggleClass("load-complete")),t=new FormData,t.append("file",n),u={knownfolderid:i.currentKnownFolderId,packagefullname:i.currentPackageName||"\\",path:i.currentPath||"\\",extract:r||!1},$.ajax({url:"/api/filesystem/apps/file?"+$.param(u),cache:!1,contentType:!1,processData:!1,data:t,type:"post"}).done(function(){i.updateTable(i.currentKnownFolderId,i.currentPackageName,i.currentPath);$("#uploadLoader")[0].style.display!="none"&&($(".loader").toggleClass("load-complete"),$(".checkmark").toggle(),$("#uploadText").text(n.name+" uploaded."))}).fail(function(n){$("#uploadLoader").toggle("hidden");alert(WebManagement.ErrorStringFromStatus(n.responseJSON))}))};this.deleteFolder=function(n,t,r,u){var f=new WebbRest;f.deleteFolder(n,file,packageName,u).done(function(){i.updateTable(n,packageName,u)}).fail(function(n){alert(WebManagement.ErrorStringFromStatus(n.responseJSON))})};this.deleteFile=function(n,t,r,u){var f=new WebbRest;f.deleteFile(n,t,r,u).done(function(){i.updateTable(n,r,u)}).fail(function(n){alert(WebManagement.ErrorStringFromStatus(n.responseJSON))})};this.renameItem=function(n,t,r,u,f){var e=new WebbRest;e.renameFile(n,t,r,u,f).done(function(){i.updateTable(n,u,i.currentPath)}).fail(function(n){alert(WebManagement.ErrorStringFromStatus(n.responseJSON))})};this.createFolder=function(){var n=prompt("Enter folder name","New Folder"),t;n&&(t=new WebbRest,t.createFolder(i.currentKnownFolderId,n,i.currentPackageName,i.currentPath).done(function(){i.updateTable(i.currentKnownFolderId,i.currentPackageName,i.currentPath)}).fail(function(n){alert(WebManagement.ErrorStringFromStatus(n.responseJSON))}))}}function showError(n){var t="unknown",i;n.responseJSON&&n.responseJSON.ErrorCode&&(t=n.responseJSON.ErrorCode);n.responseJSON&&n.responseJSON.ErrorMessage&&(t=n.responseJSON.ErrorMessage);i=new Wdp.Utils._showPopUp("Something went wrong","Error code: "+t+"<br/>Message: Unknown error.")}function showShareDetailsOverlay(n,t,i){var r=document.createElement("div"),f,e,u;r.className=cssClassPopup+" fileexplorer-sharedetails";f='<h4>Instructions<\/h4><p>Open a file explorer and go to: <p><p><span class="fileexplorer-sharedetails-value">'+n+'<\/span><br /><br /><span>Username: <\/span><span class="fileexplorer-sharedetails-value">'+t.replace("\\\\","")+'<\/span><br /><br /><span>Password: <\/span><span class="fileexplorer-sharedetails-value">'+i+"<\/span><\/p><br/><p>If you don't want to enter credentials, you can run this command from a command prompt, then browse to "+n+": <p><p>cmdkey.exe /add:"+window.location.hostname+" /user:"+window.location.hostname+'\\DevToolsUser /pass:"'+i+'"<p><button id="fileexplorer-sharedetails-closecommand" class="'+cssClassPrimaryCommand+'">Close<\/button>';e=new Wdp._Overlay(r,{html:f});e._show();u=r.querySelector("#fileexplorer-sharedetails-closecommand");u.addEventListener("click",Wdp.Utils._hideVisibleOverlays,!1);u.focus()}function showShareDetails(n){$.getJSON("/ext/smb/developerfolder").done(function(n){var t="\\\\"+window.location.hostname+n.Path.split(":")[1],i="\\\\"+window.location.hostname+"\\"+n.Username,r=n.Password;showShareDetailsOverlay(t,i,r)}).error(function(n){showError(n)});n.stopPropagation();n.preventDefault()}var WebbRest,bytesToDisplayValue,fileTimeFormatter,gridCaseInsensitiveObjectComparer,wdpPsuedoNamespace="wdp-",cssClassPopup=wdpPsuedoNamespace+"popup",cssClassPrimaryCommand="btn-primary",browseButton,fileExplorerViewer;window.onpopstate=function(n){var t=undefined,i=undefined,r=undefined;n.state&&(t=n.state.knownFolderId,i=n.state.packageName,r=n.state.path);fileExplorerViewer.updateTable(t,i,r,undefined,!0)};$(function(){var n,t,i;fileExplorerViewer=new FileExplorerViewer("fileExplorerGrid",{gridLabel:"File explorer",rowHeaderName:"Name"});n=getCookie("FileExplorerKnownFolderId");(n==""||n=="undefined")&&(n=undefined);t=getCookie("FileExplorerPackageName");(t==""||t=="undefined")&&(t=undefined);i=getCookie("FileExplorerPath");(i==""||i=="undefined")&&(i=undefined);fileExplorerViewer.updateTable(n,t,i);enableSlickGridTabbing("fileExplorerGrid",!0);$("#DirectoryNavigationPath").on("click",".pathLink",function(){var n=$(this).data("knownfolderid"),t=$(this).data("packagename"),i=$(this).data("path"),r=$(this).attr("id");fileExplorerViewer.updateTable(n,t,i,r);window.history.pushState({knownFolderId:n,packageName:t,path:i},"",window.location.href)}).on("keypress",".pathLink",function(n){if(n.which==13)return $(this).click(),!1});$("#uploadFile").on("click",function(){fileExplorerViewer.uploadFile()});$("#uploadFileSection").hide();browseButton=document.getElementById("fileexplorer-openshare");browseButton.addEventListener("click",showShareDetails,!1)})