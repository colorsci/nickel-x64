function RefreshPageForSignedInUser(){hasSignedInUser?$("#NoSignedInUserWarning").hide():$("#NoSignedInUserWarning").show();$("#InstallAppSignedInUserLabel").text("Current user: "+userName)}function CheckDeviceFamily(){if(window.DeviceSettings&&window.DeviceSettings.DeviceFamily&&window.DeviceSettings.DeviceFamily===_DESKTOP_DEVICE_FAMILY)checkSignedInUserTimerCookie=setInterval(CheckForSignedInUser,1e3)}function CheckForSignedInUser(){var n=hasSignedInUser&&!!userName,t=userSid;hasSignedInUser=!1;userName="";userSid="";Wdp.Utils._getSignedInUserAsync().then(function(i){i.UserDisplayName&&(hasSignedInUser=!0,userName=i.UserDisplayName,userSid=i.UserSID);(hasSignedInUser!==n||userSid!==t)&&RefreshPageForSignedInUser()}).fail(function(){RefreshPageForSignedInUser()})}function StreamingInstallDebuggerViewer(n,t,i){function v(n,t,i,r,u){var f='<input type="checkbox" class="checkboxControl-multiselect"';return f+=' onchange="streamingInstallDebuggerViewer.updateMultiselectControls('+u.Order+", "+t+', this.checked)" ',u.Selected&&(f+=" checked"),f+">"}function y(n,t,i,r,u){return u.Order}function p(n,t,i,r,u){return u.ContentGroupName}function w(n,t,i,r,u){var e='<select class="content-group-drop-down dropdownControl-currentState"',o,s,f;for(e+=' onchange="streamingInstallDebuggerViewer.updateCurrentState('+u.Order+", "+n+", "+t+', this.value)" >',o=["Staged","Staging","Queued","NotStaged"],s=["Staged","Staging","Queued","Not Staged"],f=0;f<o.length;f++)e+='<option value="'+o[f]+'"',u.CurrentState===o[f]&&(e+=' selected="selected"'),e+=">"+s[f]+"<\/option>";return e+"<\/select>"}function b(n,t,i,r,u){var f='<input type="range" class="content-group-slider sliderControl-stagingPercentage" min="0" value="'+u.StagingPercentage+'" step="1" aria-valuemin="0" aria-valuemax="100" aria-valuenow="'+u.StagingPercentage+'"';return u.CurrentState!=="Staging"&&(f+=" disabled"),f+=' onchange="streamingInstallDebuggerViewer.updateStagingPercentage('+u.Order+", "+n+", "+t+', this.value)" ',f+('><output class="content-group-slider-stagingPct-value">'+u.StagingPercentage+"<\/output>")}function k(){var n=$("#content-group-filter-and-multi-select");$(document.createElement("select")).attr("id","content-group-filter-type").attr("aria-label","Filter Type").append('<option value="Current State">Current State<\/option>').append('<option value="Content Group Name">Content Group Name<\/option>').appendTo(n).change(function(){r.dataView.refresh();r.updateTable()});$(document.createElement("input")).attr("id","content-group-filter-search").attr("class","filterBoxShort").attr("class","filterBoxWide").attr("type","search").attr("aria-label","Filter Text").appendTo(n).bind("input",function(){r.dataView.refresh();r.updateTable()});$(document.createElement("input")).attr("id","content-group-toggle-multi-select").attr("type","image").attr("aria-label","Toggle Multi Select").attr("src","tools/StreamingInstallDebugger/e762.png").addClass("content-group-toggle-multi-select-off").appendTo(n).click(function(n){nt(n)});$('<hr align="left" width="973px" style="margin-top:65px;">').appendTo("#content-group-separate-controls-and-grid")}function d(){var t=[{id:"Order",name:"Order",field:"Order",sortable:!0,resizable:!1,width:50,cssClass:"tableCell content-group-cell",headerCssClass:"tableHeader",formatter:y},{id:"ContentGroupName",name:"Content Group Name",field:"ContentGroupName",resizable:!1,sortable:!0,width:500,cssClass:"tableCell content-group-cell",headerCssClass:"tableHeader",formatter:p},{id:"CurrentState",name:"Current State",field:"CurrentState",resizable:!1,sortable:!0,width:162,cssClass:"tableCell content-group-cell",headerCssClass:"tableHeader",formatter:w},{id:"StagingPercentage",name:"Staging Percentage",field:"StagingPercentage",resizable:!1,sortable:!1,width:260,cssClass:"tableCell content-group-cell",headerCssClass:"tableHeader",formatter:b}],u={selectedCellCssClass:"rowSelected",enableCellNavigation:!1,enableColumnReorder:!1,showHeaderRow:!0,syncColumnCellResize:!0,scaleHeightToDockContentParent:!0,enableTextSelectionOnCells:!0,rowHeight:36,headerRowHeight:40.45,gridLabel:i.gridLabel,rowHeaderName:i.rowHeaderName,rowHeaderId:i.rowHeaderId,rowHeaderColumn:i.rowHeaderColumn};r.dataView=new Slick.Data.DataView;r.streamingInstallDebuggerGrid=new Slick.Grid("#"+n,r.dataView,t,u);$(window).resize(r.streamingInstallDebuggerGrid.resizeCanvas.bind(r.streamingInstallDebuggerGrid));r.streamingInstallDebuggerGrid.onSort.subscribe(tt.bind(r));r.dataView.setFilter(g);enableSlickGridTabbing(n,!0)}function g(n){var i=$("#content-group-filter-search").val().toLowerCase(),r=$("#content-group-filter-type").find("option:selected").val(),t;return t=r==="Current State"?n.CurrentState.toLowerCase().indexOf(i)==0?n:null:r==="Content Group Name"?n.ContentGroupName.toLowerCase().indexOf(i)==0?n:null:n,n.Filtered=t?!1:!0,t}function nt(){var l=r.streamingInstallDebuggerGrid,t=l.getColumns(),o=$("#content-group-filter-search"),y=null,s=36,i="#content-group-multi-select-dropdown-and-stage-pct",p,w,b,k,n,c;if(t.length==4)o.removeClass("filterBoxWide"),o.addClass("filterBoxShort"),p='<select id="ms-dropDown-state"><option value=""><\/option><option value="Staged">Staged<\/option><option value="Staging">Staging<\/option><option value="Queued">Queued<\/option><option value="NotStaged">Not Staged<\/option><\/select>',$(p).appendTo(i),$("#ms-dropDown-state").change(function(n){var i,e,t;if($("#streaming-debug-error-message").text(""),i=n.target.value,i){for(e=[],t=0;t<r.contentGroups.length;t++)r.contentGroups[t].Selected&&!r.contentGroups[t].Filtered&&e.push(r.contentGroups[t].ContentGroupName);e.length>0?f({Names:e,State:i}).then(function(){for(t=0;t<r.contentGroups.length;t++)r.contentGroups[t].Selected&&!r.contentGroups[t].Filtered&&(r.contentGroups[t].CurrentState=i);r.updateTable()}).fail(function(){$("#streaming-debug-error-message").text(u);$("#ms-dropDown-state").val("")}):($("#streaming-debug-error-message").text(h),$("#ms-dropDown-state").val(""))}}),w='<input id="ms-slider-stagingPct" type="range" class="content-group-slider" min="0" value="0" step="1" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><output id="ms-slider-stagingPct-value">0<\/output>',$(w).appendTo(i),$("#ms-slider-stagingPct").change(function(n){var i,s,o,t;if($("#streaming-debug-error-message").text(""),i=n.target.value,i){for($("#ms-slider-stagingPct-value").text(parseInt(i)),s="Staging",o=[],t=0;t<r.contentGroups.length;t++)if(r.contentGroups[t].Selected&&!r.contentGroups[t].Filtered)if(r.contentGroups[t].CurrentState===s)o.push(r.contentGroups[t].ContentGroupName);else{e();$("#streaming-debug-error-message").text(a);return}o.length>0?f({Names:o,State:s,Percent:parseInt(i)}).then(function(){for(t=0;t<r.contentGroups.length;t++)r.contentGroups[t].Selected&&!r.contentGroups[t].Filtered&&(r.contentGroups[t].StagingPercentage=i);r.updateTable()}).fail(function(){e();$("#streaming-debug-error-message").text(u)}):(e(),$("#streaming-debug-error-message").text(h))}}),n=$("#content-group-toggle-multi-select"),n.removeClass("content-group-toggle-multi-select-off"),n.addClass("content-group-toggle-multi-select-on"),n.appendTo(i),$(i).addClass("content-group-background"),b='<input type="checkbox" id="sg-header-ms-checkbox" style="transform: scale(.6); ">',k={id:"MultiSelect",name:b,field:"MultiSelect",sortable:!1,width:s,cssClass:"tableCell content-group-cell",headerCssClass:"tableHeader multi-select-table-header",formatter:v},t.unshift(k),t[2].width-=s,enableSlickGridTabbing(r.parentId,!0),y=function(n){var t;if(n.target.checked){for(t=0;t<r.contentGroups.length;t++)r.contentGroups[t].Selected=!0;r.updateTable()}else{for(t=0;t<r.contentGroups.length;t++)r.contentGroups[t].Selected=!1;r.updateTable()}};else{for(idx=0;idx<r.contentGroups.length;idx++)r.contentGroups[idx].Selected=!1;$(i).removeClass("content-group-background");o.removeClass("filterBoxShort");o.addClass("filterBoxWide");$("#ms-slider-stagingPct-value").remove();$("#ms-slider-stagingPct").remove();$("#ms-dropDown-state").remove();n=$("#content-group-toggle-multi-select");n.removeClass("content-group-toggle-multi-select-on");n.addClass("content-group-toggle-multi-select-off");n.appendTo("#content-group-filter-and-multi-select");t[2].width+=s;t.shift()}if(l.setColumns(t),r.updateTable(),c=$("#sg-header-ms-checkbox"),c)c.on("click",y)}function e(){$("#ms-slider-stagingPct").val(0);$("#ms-slider-stagingPct-value").text(0)}function tt(n,t){r.dataView.sort(gridCaseInsensitiveObjectComparer.bind(t),t.sortAsc);r.streamingInstallDebuggerGrid.invalidate();o()}function it(n){r.contentGroups.length=0;for(var t=0;t<n.length;t++)r.contentGroups.push({Order:t+1,ContentGroupName:n[t].Name,CurrentState:n[t].State,StagingPercentage:n[t].State==="Staged"?100:0,Filtered:!1})}function rt(){var n=new WebbRest;n.getContentGroups(r.currentPackage.PackageFullName).done(function(n){it(n.ContentGroups);r.streamingInstallDebuggerGrid||(k(),d());r.updateTable()}).fail(function(){$("#streaming-debug-error-message").text(c)})}function f(n){var t=$.Deferred(),i={ContentGroupsState:n},u={package:r.currentPackage.PackageFullName},f="/api/app/packagemanager/contentgroups?"+$.param(u);return $.ajax({url:f,cache:!1,type:"post",data:JSON.stringify(i),datatype:"json",contentType:"application/json"}).done(function(n){t.resolve(n)}).fail(function(n,i,r){t.reject(n,r)}),t}function o(){r.streamingInstallDebuggerGrid.render()}var r=this;r.currentPackage=t;r.contentGroups=[];r.streamingInstallDebuggerGrid=null;r.dataView=null;r.parentId=n;var s="Requested operation failed.",u=s+" No changes have been made!",c=s+" Could not get content groups!",l=" Fetching app list succeeded but no loose file streamable app packages were found.",a=' Selected content groups must be in "Staging" state in order to set staging percentage.',h=" No content groups were selected.";r.updateTableRow=function(){var n=r.streamingInstallDebuggerGrid;n.invalidate();o()};r.updateTable=function(){r.dataView.setItems(r.contentGroups,"Order");r.streamingInstallDebuggerGrid.invalidate();o()};r.updateCurrentState=function(n,t,i,e){var o;$("#streaming-debug-error-message").text("");var s=n-1,h=r.dataView.getItems()[s],c=h.CurrentState;c!==e&&(o=function(n){r.contentGroups[s].CurrentState=n;r.updateTableRow();var u=r.streamingInstallDebuggerGrid.getCellNode(t,i),f=$(u).children(".dropdownControl-currentState");f.focus()},o(e),f({Names:[h.ContentGroupName],State:e}).fail(function(){$("#streaming-debug-error-message").text(u);o(c)}))};r.updateStagingPercentage=function(n,t,i,e){var s;$("#streaming-debug-error-message").text("");var h=n-1,o=r.dataView.getItems()[h],c=o.StagingPercentage;c!==e&&(s=function(n){r.contentGroups[h].StagingPercentage=n;r.updateTableRow();var u=r.streamingInstallDebuggerGrid.getCellNode(t,i),f=$(u).children(".sliderControl-stagingPercentage");f.focus()},s(e),f({Names:[o.ContentGroupName],State:o.CurrentState,Percent:parseInt(e)}).fail(function(){$("#streaming-debug-error-message").text(u);s(c)}))};r.updateMultiselectControls=function(n,t,i){var f,u,e;for($("#streaming-debug-error-message").text(""),r.contentGroups[n-1].Selected=i,i||$("#sg-header-ms-checkbox").prop("checked",!1),f=null,u=null,e=0;e<r.contentGroups.length;e++)r.contentGroups[e].Selected===!0&&(f===null?f=r.contentGroups[e].CurrentState:r.contentGroups[e].CurrentState!=f&&(f=""),u===null?u=r.contentGroups[e].StagingPercentage:r.contentGroups[e].StagingPercentage!=u&&(u=0));f===null&&(f="");u===null&&(u=0);$("#ms-dropDown-state").val(f);$("#ms-slider-stagingPct").val(parseInt(u));$("#ms-slider-stagingPct-value").text(u)};r.onChangeSelectedPackage=function(n){$("#streaming-debug-error-message").text("");var t=installedAppsViewer.getPackageEntryFromUniqueId(n.val());t&&(!r.currentPackage||r.currentPackage.PackageFullName!==t.PackageFullName)&&(r.currentPackage=t,rt());r.currentPackage?$("#appStartButton").prop("disabled",!1):($("#streaming-debug-error-message").text(l),$("#appStartButton").prop("disabled",!0))}}var InstalledAppsViewer,streamingInstallDebuggerViewer,_DESKTOP_DEVICE_FAMILY="Windows.Desktop",_UNKNOWN_DEVICE_FAMILY="Unknown",checkSignedInUserTimerCookie=null,hasSignedInUser=!0,userName,userSid,deviceFamily=_UNKNOWN_DEVICE_FAMILY,WebbRest,gridCaseInsensitiveObjectComparer;$(function(){function n(){clearInterval(checkSignedInUserTimerCookie)}installedAppsViewer=new InstalledAppsViewer("appListSection",{streamableAppsOnly:!0,enableStart:!0,enableRefresh:!0,enableDetails:!1,disablePackageActionButtons:!hasSignedInUser});streamingInstallDebuggerViewer=new StreamingInstallDebuggerViewer("content-group-app-debugging",installedAppsViewer.getSelectedPackage(),{gridLabel:"Streaming Install Debugger",rowHeaderName:"Name"});installedAppsViewer.subscribeOnChangeSelectedPackage(streamingInstallDebuggerViewer.onChangeSelectedPackage);CheckDeviceFamily();window.addEventListener("beforeunload",n,!1)});
/*!
//@ sourceURL=tools/StreamingInstallDebugger/StreamingInstallDebugger.js
*/
