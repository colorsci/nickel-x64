(function(n){function i(n){this.options=r.extend({},i.defaultOptions,n);this.data=[];this.maxValue=Number.NaN;this.minValue=Number.NaN}function t(n){this.options=r.extend({},t.defaultChartOptions,n);this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0;this.lastRenderTimeMillis=0}var r={extend:function(){var n,t;for(arguments[0]=arguments[0]||{},n=1;n<arguments.length;n++)for(t in arguments[n])arguments[n].hasOwnProperty(t)&&(arguments[0][t]=typeof arguments[n][t]=="object"?arguments[n][t]instanceof Array?arguments[n][t]:r.extend(arguments[0][t],arguments[n][t]):arguments[n][t]);return arguments[0]}};i.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0};i.prototype.resetBounds=function(){var t,n;if(this.data.length)for(this.maxValue=this.data[0][1],this.minValue=this.data[0][1],t=1;t<this.data.length;t++)n=this.data[t][1],n>this.maxValue&&(this.maxValue=n),n<this.minValue&&(this.minValue=n);else this.maxValue=Number.NaN,this.minValue=Number.NaN};i.prototype.append=function(n,t,i){for(var r=this.data.length-1;r>0&&this.data[r][0]>n;)r--;this.data.length>0&&this.data[r][0]===n?i?(this.data[r][1]+=t,t=this.data[r][1]):this.data[r][1]=t:r<this.data.length-1?this.data.splice(r+1,0,[n,t]):this.data.push([n,t]);this.maxValue=isNaN(this.maxValue)?t:Math.max(this.maxValue,t);this.minValue=isNaN(this.minValue)?t:Math.min(this.minValue,t)};i.prototype.dropOldData=function(n,t){for(var i=0;this.data.length-i>=t&&this.data[i+1][0]<n;)i++;i!==0&&this.data.splice(0,i)};t.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(n,t){return parseFloat(n).toFixed(t)},yMaxFormatter:function(n,t){return parseFloat(n).toFixed(t)},maxValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,sharpLines:!1,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2},horizontalLines:[]};t.AnimateCompatibility=function(){var n=function(n,t){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){return window.setTimeout(function(){n((new Date).getTime())},16)};return i.call(window,n,t)},t=function(n){var t=window.cancelAnimationFrame||function(n){clearTimeout(n)};return t.call(window,n)};return{requestAnimationFrame:n,cancelAnimationFrame:t}}();t.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"};t.prototype.addTimeSeries=function(n,i){this.seriesSet.push({timeSeries:n,options:r.extend({},t.defaultSeriesPresentationOptions,i)});n.options.resetBounds&&n.options.resetBoundsInterval>0&&(n.resetBoundsTimerId=setInterval(function(){n.resetBounds()},n.options.resetBoundsInterval))};t.prototype.removeTimeSeries=function(n){for(var i=this.seriesSet.length,t=0;t<i;t++)if(this.seriesSet[t].timeSeries===n){this.seriesSet.splice(t,1);break}n.resetBoundsTimerId&&clearInterval(n.resetBoundsTimerId)};t.prototype.getTimeSeriesOptions=function(n){for(var i=this.seriesSet.length,t=0;t<i;t++)if(this.seriesSet[t].timeSeries===n)return this.seriesSet[t].options};t.prototype.bringToFront=function(n){for(var i,r=this.seriesSet.length,t=0;t<r;t++)if(this.seriesSet[t].timeSeries===n){i=this.seriesSet.splice(t,1);this.seriesSet.push(i[0]);break}};t.prototype.streamTo=function(n,t){this.canvas=n;this.delay=t;this.start()};t.prototype.start=function(){var n,i,r;this.frame||(this.options.enableDpiScaling&&window&&window.devicePixelRatio!==1&&(n=this.canvas.getAttribute("width"),i=this.canvas.getAttribute("height"),this.canvas.setAttribute("width",n*window.devicePixelRatio),this.canvas.setAttribute("height",i*window.devicePixelRatio),this.canvas.style.width=n+"px",this.canvas.style.height=i+"px",this.canvas.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)),r=function(){this.frame=t.AnimateCompatibility.requestAnimationFrame(function(){this.render();r()}.bind(this))}.bind(this),r())};t.prototype.stop=function(){this.frame&&(t.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame)};t.prototype.updateValueRange=function(){for(var r,f,i=this.options,n=Number.NaN,t=Number.NaN,u=0;u<this.seriesSet.length;u++)r=this.seriesSet[u].timeSeries,isNaN(r.maxValue)||(n=isNaN(n)?r.maxValue:Math.max(n,r.maxValue)),isNaN(r.minValue)||(t=isNaN(t)?r.minValue:Math.min(t,r.minValue));if(i.maxValue!=null?n=i.maxValue:n*=i.maxValueScale,i.minValue!=null&&(t=i.minValue),this.options.yRangeFunction&&(f=this.options.yRangeFunction({min:t,max:n}),t=f.min,n=f.max),!isNaN(n)&&!isNaN(t)){var s=n-t,e=s-this.currentValueRange,o=t-this.currentVisMinValue;this.isAnimatingScale=Math.abs(e)>.1||Math.abs(o)>.1;this.currentValueRange+=i.scaleSmoothing*e;this.currentVisMinValue+=i.scaleSmoothing*o}this.valueRange={min:t,max:n}};t.prototype.render=function(n,t){var d=(new Date).getTime(),ft,tt,l,c,v,y,p,w,it,a,e,f,s,ut,k;if(this.isAnimatingScale||(ft=Math.min(1e3/6,this.options.millisPerPixel),!(d-this.lastRenderTimeMillis<ft))){this.lastRenderTimeMillis=d;n=n||this.canvas;t=t||d-(this.delay||0);t-=t%this.options.millisPerPixel;var i=n.getContext("2d"),r=this.options,u={top:0,left:0,width:n.clientWidth,height:n.clientHeight},et=t-u.width*r.millisPerPixel,g=function(n){var t=n-this.currentVisMinValue;return this.currentValueRange===0?u.height:u.height-Math.round(t/this.currentValueRange*u.height)}.bind(this),nt=function(n){return Math.round(u.width-(t-n)/r.millisPerPixel)};if(this.updateValueRange(),i.font=r.labels.fontSize+"px "+r.labels.fontFamily,i.save(),i.translate(u.left,u.top),i.beginPath(),i.rect(0,0,u.width,u.height),i.clip(),i.save(),i.fillStyle=r.grid.fillStyle,i.clearRect(0,0,u.width,u.height),i.fillRect(0,0,u.width,u.height),i.restore(),i.save(),i.lineWidth=r.grid.lineWidth,i.strokeStyle=r.grid.strokeStyle,r.grid.millisPerLine>0)for(tt=u.width-i.measureText(k).width+4,l=t-t%r.grid.millisPerLine;l>=et;l-=r.grid.millisPerLine)if(c=nt(l),r.grid.sharpLines&&(c-=.5),i.beginPath(),i.moveTo(c,0),i.lineTo(c,u.height),i.stroke(),i.closePath(),r.timestampFormatter&&c<tt){var lt=new Date(l),ot=r.timestampFormatter(lt),st=i.measureText(ot).width;tt=c-st-2;i.fillStyle=r.labels.fillStyle;i.fillText(ot,c-st,u.height-2)}for(v=1;v<r.grid.verticalSections;v++)y=Math.round(v*u.height/r.grid.verticalSections),r.grid.sharpLines&&(y-=.5),i.beginPath(),i.moveTo(0,y),i.lineTo(u.width,y),i.stroke(),i.closePath();if(r.grid.borderVisible&&(i.beginPath(),i.strokeRect(0,0,u.width,u.height),i.closePath()),i.restore(),r.horizontalLines&&r.horizontalLines.length)for(p=0;p<r.horizontalLines.length;p++)w=r.horizontalLines[p],it=Math.round(g(w.value))-.5,i.strokeStyle=w.color||"#ffffff",i.lineWidth=w.lineWidth||1,i.beginPath(),i.moveTo(0,it),i.lineTo(u.width,it),i.stroke(),i.closePath();for(a=0;a<this.seriesSet.length;a++){i.save();var ht=this.seriesSet[a].timeSeries,h=ht.data,o=this.seriesSet[a].options;if(ht.dropOldData(et,r.maxDataSetLength),i.lineWidth=o.lineWidth,i.strokeStyle=o.strokeStyle,r.interpolation=="dots"){for(i.beginPath(),e=0;e<h.length&&h.length!==1;e++)f=nt(h[e][0]),s=g(h[e][1]),i.moveTo(f,s),i.arc(f,s,1,0,2*Math.PI);i.stroke();i.closePath()}else{i.beginPath();var ct=0,rt=0,b=0;for(e=0;e<h.length&&h.length!==1;e++){if(f=nt(h[e][0]),s=g(h[e][1]),e===0)ct=f,i.moveTo(f,s);else switch(r.interpolation){case"linear":case"line":i.lineTo(f,s);break;case"bezier":default:i.bezierCurveTo(Math.round((rt+f)/2),b,Math.round(rt+f)/2,s,f,s);break;case"step":i.lineTo(f,b);i.lineTo(f,s)}rt=f;b=s}h.length>1&&(o.fillStyle&&(i.lineTo(u.width+o.lineWidth+1,b),i.lineTo(u.width+o.lineWidth+1,u.height+o.lineWidth+1),i.lineTo(ct,u.height+o.lineWidth),i.fillStyle=o.fillStyle,i.fill()),o.strokeStyle&&o.strokeStyle!=="none"&&i.stroke(),i.closePath())}i.restore()}r.labels.disabled||isNaN(this.valueRange.min)||isNaN(this.valueRange.max)||(ut=r.yMaxFormatter(this.valueRange.max,r.labels.precision),k=r.yMinFormatter(this.valueRange.min,r.labels.precision),i.fillStyle=r.labels.fillStyle,i.fillText(ut,u.width-i.measureText(ut).width-2,r.labels.fontSize),i.fillText(k,u.width-i.measureText(k).width-2,u.height-2));i.restore()}};t.timeFormatter=function(n){function t(n){return(n<10?"0":"")+n}return t(n.getHours())+":"+t(n.getMinutes())+":"+t(n.getSeconds())};n.TimeSeries=i;n.SmoothieChart=t})(typeof exports=="undefined"?this:exports)