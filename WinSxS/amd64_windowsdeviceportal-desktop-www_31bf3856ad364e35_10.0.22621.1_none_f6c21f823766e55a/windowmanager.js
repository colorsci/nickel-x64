function WindowManagerViewer(n,t,i){function u(n,t,i,r,u){var f="",e;if(currentHwndSort=="tree"){for(e=0;e<u.Level-1;e++)f+="│ ";u.Level>0&&(f+="└─ ")}return f+("0x"+("00000000"+Math.abs(u.Hwnd).toString(16)).slice(-8))}function f(n,t,i,r,u){var f="";return self.foregroundWindow==u.Hwnd&&(f+="[Foreground Window] "),f+u.Title}function e(n,t,i,r,u){return"0x"+("00000000"+Math.abs(u.Style).toString(16)).slice(-8)}function o(n,t,i,r,u){return"0x"+("00000000"+Math.abs(u.ExStyle).toString(16)).slice(-8)}function r(){var n={windowHandle:self.selectedHwnd};self.containerId&&(n.containerId=self.containerId);$("#ignoreDpiScaling").is(":checked")&&(n.ignoreDpiScaling=!0);$("#windowDetailsImage").attr("src","/api/WindowManager/screenshot?"+$.param(n));$("#windowDetailsImageDownload").attr("href","/api/WindowManager/screenshot?"+$.param(n))}function c(n,t,i){var r=i.getItemById(n);r?$("#windowParent").text("0x"+("00000000"+Math.abs(r.Hwnd).toString(16)).slice(-8)).data("parentWindowId",n).off("click").click(function(){var r=$(this).data("parentWindowId"),n=i.getRowById(r);t.scrollRowIntoView(n);t.setActiveCell(n,0);t.onClick.notify({row:n})}):$("#windowParent").text("").data("parentWindowId",null).off("click")}function l(n){var t="top-left: ("+n.left+", "+n.top+")\n";t+="bottom-right: ("+n.right+", "+n.bottom+")\n";t+="width x height: "+(n.right-n.left)+" x "+(n.bottom-n.top);document.getElementById("windowRectDetails").innerText=t}function a(n){var r=!1,u=!1,t="",i;n==0?(t+="WS_OVERLAPPED\nWS_TILED\n",r=!0):(i=("00000000"+Math.abs(n).toString(16)).slice(-8),i[0]&1&&(t+="WS_VISIBLE\n"),i[0]&2&&(t+="WS_ICONIC\nWS_MINIMIZE\n"),i[0]&4&&(t+="WS_CHILD\nWS_CHILDWINDOW\n"),i[0]&8&&(t+="WS_POPUP\n",u=!0),i[1]&1&&(t+="WS_MAXIMIZE\n"),i[1]&2&&(t+="WS_CLIPCHILDREN\n"),i[1]&4&&(t+="WS_CLIPSIBLINGS\n"),i[1]&8&&(t+="WS_DISABLED\n"),i[2]&1&&(t+="WS_HSCROLL\n"),i[2]&2&&(t+="WS_VSCROLL\n"),i[2]&4&&(t+="WS_DLGFRAME\n"),i[2]&8&&(t+="WS_BORDER\n",u=!0),i[2]&12&&(t+="WS_CAPTION\n",r=!0),i[3]&1&&(t+="WS_MAXIMIZEBOX\nWS_TABSTOP\n",r=!0),i[3]&2&&(t+="WS_GROUP\nWS_MINIMIZEBOX\n",r=!0),i[3]&4&&(t+="WS_SIZEBOX\nWS_THICKFRAME\n",r=!0),i[3]&8&&(t+="WS_SYSMENU\n",r=!0,u=!0));r==!0&&(t+="WS_OVERLAPPEDWINDOW\nWS_TILEDWINDOW\n");u==!0&&(t+="WS_POPUPWINDOW\n");document.getElementById("windowDetailsStyle").innerText=t}function v(n){var t="";if(n==0)t+="WS_EX_LEFT\nWS_EX_LTRREADING\nWS_EX_RIGHTSCROLLBAR\n";else{var u=!1,r=!1,i=("00000000"+Math.abs(n).toString(16)).slice(-8);i[1]&2&&(t+="WS_EX_COMPOSITED\n");i[1]&8&&(t+="WS_EX_NOACTIVATE\n");i[2]&1&&(t+="WS_EX_NOINHERITLAYOUT\n");i[2]&2&&(t+="WS_EX_NOREDIRECTIONBITMAP\n");i[2]&4&&(t+="WS_EX_LAYOUTRTL\n");i[3]&1&&(t+="WS_EX_CONTROLPARENT\n");i[3]&2&&(t+="WS_EX_STATICEDGE\n");i[3]&4&&(t+="WS_EX_APPWINDOW\n");i[3]&8&&(t+="WS_EX_LAYERED\n");i[4]&1&&(t+="WS_EX_RIGHT\n");i[4]&2&&(t+="WS_EX_RTLREADING\n");i[4]&4&&(t+="WS_EX_LEFTSCROLLBAR\n");i[5]&1&&(t+="WS_EX_WINDOWEDGE\n",u=!0,r=!0);i[5]&2&&(t+="WS_EX_CLIENTEDGE\n",u=!0);i[5]&4&&(t+="WS_EX_CONTEXTHELP\n");i[6]&1&&(t+="WS_EX_ACCEPTFILES\n");i[6]&2&&(t+="WS_EX_TRANSPARENT\n");i[6]&4&&(t+="WS_EX_MDICHILD\n");i[6]&8&&(t+="WS_EX_TOOLWINDOW\n",r=!0);i[7]&1&&(t+="WS_EX_DLGMODALFRAME\n");i[7]&4&&(t+="WS_EX_NOPARENTNOTIFY\n");i[7]&8&&(t+="WS_EX_TOPMOST\n",r=!0);u==!0&&(t+="WS_EX_OVERLAPPEDWINDOW\n");r==!0&&(t+="WS_EX_PALETTEWINDOW\n")}document.getElementById("windowDetailsStyleEx").innerText=t}function y(n,t){var r=this.windowsGrid,i,u,f;t&&t.row!=undefined?i=t.row:(u=r.getCellFromEvent(n),i=u.row);f=this.dataView.getItems()[i];p(f,r,this.dataView)}function p(n,t,i){self.selectedHwnd=n.Hwnd;r();c(n.ParentWindowId,t,i);l(n);a(n.Style);v(n.ExStyle)}function w(n,t){if(t.sortCol.field=="Hwnd")if(t.sortAsc==!0&&currentHwndSort=="desc"){currentHwndSort="tree";this.windowsGrid.setSortColumn("WindowId",!0);var i=$.extend(!0,{},t);i.sortCol.field="WindowId";i.sortCol.id="WindowId";i.sortAsc=!0;this.dataView.sort(gridCaseInsensitiveObjectComparer.bind(i),t.sortAsc)}else currentHwndSort=t.sortAsc==!0?"asc":"desc",this.dataView.sort(gridCaseInsensitiveObjectComparer.bind(t),t.sortAsc);else currentHwndSort="none",this.dataView.sort(gridCaseInsensitiveObjectComparer.bind(t),t.sortAsc);this.windowsGrid.invalidate();this.windowsGrid.render()}self.containerId=t;self.foregroundWindow=0;self.selectedHwnd=0;this.flattenWindows=function(n,t,i,r){var e,u,o,f;if(t==null&&(t=Object.keys(n[0]),e=t.indexOf("Children"),e>-1&&t.splice(e,1)),n!==undefined)for(u=0;u<n.length;u++){for(o={Level:i,ParentWindowId:r},f=0;f<t.length;f++)o[t[f]]=n[u][t[f]];this.dataView.addItem(o);n[u].Children!==undefined&&this.flattenWindows(n[u].Children,t,i+1,n[u].WindowId)}};this.updateWindowsList=function(n,t){this.dataView.beginUpdate();this.dataView.setItems([],"WindowId");self.foregroundWindow=t;this.flattenWindows(n,null,0,null);this.dataView.reSort();this.dataView.endUpdate();this.windowsGrid.invalidate();this.windowsGrid.render()};this.onDataSourceError=function(){this.dataView.setItems([],"WindowId");this.windowsGrid.invalidate();this.windowsGrid.render()};var s=[{id:"Hwnd",name:"Hwnd",field:"Hwnd",sortable:!0,width:150,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:u},{id:"Title",name:"Title",field:"Title",sortable:!0,width:250,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:f},{id:"Class",name:"Class",field:"Class",sortable:!0,width:200,cssClass:"tableCell",headerCssClass:"tableHeader"},{id:"ProcessId",name:"ProcessId",field:"ProcessId",sortable:!0,width:75,cssClass:"tableCell",headerCssClass:"tableHeader"},{id:"Visible",name:"Visible",field:"Visible",sortable:!0,width:57,cssClass:"tableCell",headerCssClass:"tableHeader"},{id:"Style",name:"Style",field:"Style",sortable:!0,width:106,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:e},{id:"ExStyle",name:"ExStyle",field:"ExStyle",sortable:!0,width:106,cssClass:"tableCell",headerCssClass:"tableHeader",formatter:o},{id:"WindowId",name:">",field:"WindowId",sortable:!0,width:0,minWidth:0,maxWidth:0,cssClass:"hidden",headerCssClass:"hidden"}],h={selectedCellCssClass:"rowSelected",enableCellNavigation:!0,enableColumnReorder:!1,showHeaderRow:!0,syncColumnCellResize:!0,scaleHeightToDockContentParent:!0,enableTextSelectionOnCells:!0,rowHeight:36.5,headerRowHeight:40.45,gridLabel:i.gridLabel,rowHeaderName:i.rowHeaderName,rowHeaderId:i.rowHeaderId,rowHeaderColumn:i.rowHeaderColumn};this.dataView=new Slick.Data.DataView;this.windowsGrid=new Slick.Grid("#"+n,this.dataView,s,h);$(window).resize(this.windowsGrid.resizeCanvas.bind(this.windowsGrid));this.windowsGrid.onSort.subscribe(w.bind(this));this.windowsGrid.setSortColumn("WindowId",!0);this.windowsGrid.onClick.subscribe(y.bind(this));this.updateContainerId=function(n){self.containerId=n};$("#ignoreDpiScaling").change(function(){r()})}function WindowDataUpdater(n){var t=this;t.dataAvailable=$.Callbacks();t.errorGettingData=$.Callbacks();t.containerId=n;this.refresh=function(){var n=new WebbRest;n.getWindows(t.containerId).done(function(n){t.dataAvailable.fire(n.Windows,n.ForegroundWindow)}).fail(function(){t.errorGettingData.fire()})};this.updateContainerId=function(n){t.containerId=n;this.refresh()}}var WebbRest,currentHwndSort="tree";$(function(){function r(){var i=$("#WindowsContainerIdSelect"),r;i.on("change",function(){var r=i.val();document.cookie="WindowsContainerId="+r;n.updateContainerId(r);t.updateContainerId(r)});oldContainerId=getCookie("WindowsContainerId");r=new WebbRest;r.getContainersList().done(function(u){if(u.Supported){for(index=0;index<u.Containers.length;index++){container=u.Containers[index];var f=container.Id.replace("{","").replace("}",""),e=f===oldContainerId;i.append($("<option>",{value:f,text:container.Owner,selected:e}));e&&(n.updateContainerId(f),t.updateContainerId(f))}r.getWindows().fail(function(){$("#WindowsContainerIdSelect option[value='host']").remove();i.prop("selectedIndex",0).change()}).always(function(){i.show()})}})}var i="",t=new WindowManagerViewer("windowsGrid",i,{gridLabel:"HWNDs"}),n=new WindowDataUpdater(i);n.dataAvailable.add(t.updateWindowsList.bind(t));$("#WindowsGridRefreshButton").click(function(){n.refresh()});r();n.refresh()});
/*!
//@ sourceURL=js/WindowManager.js
*/
