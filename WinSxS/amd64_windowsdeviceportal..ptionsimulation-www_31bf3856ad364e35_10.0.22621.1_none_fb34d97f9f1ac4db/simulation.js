var AnalogWebbRest;$(function(){function l(){return'<span class="symbol">&#xe74d;<\/span>'}function a(n,t,i,r,u){var e=u,f=!1;switch(e.State){case"end":case"stopped":case"paused":f=!0}return f?"<span class='playButton symbol'>&#xe768;<\/span>":"<span class='pauseButton symbol'>&#xe769;<\/span>"}function v(n,t,i,r,u){var e=u,f=!1;switch(e.State){case"end":case"paused":case"playing":f=!0}return f?"<span class='stopButton symbol'>&#xe71a;<\/span>":""}function y(){var i=[{id:"Delete",cssClass:"tableCell",width:40,headerCssClass:"tableHeader",formatter:l},{id:"Name",name:"Name",field:"Name",width:375,cssClass:"tableCell",headerCssClass:"tableHeader"},{id:"PlayPause",cssClass:"tableCell",width:25,headerCssClass:"tableHeader",formatter:a},{id:"Stop",cssClass:"tableCell",width:25,headerCssClass:"tableHeader",formatter:v}];n=new Slick.Data.DataView;n.beginUpdate();n.setItems([]);n.endUpdate();t=new Slick.Grid("#recordingsGrid",n,i,{enableCellNavigation:!0,enableColumnReorder:!1,showHeaderRow:!1,syncColumnCellResize:!0,autoHeight:!0,rowHeight:35});t.onClick.subscribe(p);n.onRowCountChanged.subscribe(function(){t.updateRowCount();t.render()});n.onRowsChanged.subscribe(function(n,i){t.invalidateRows(i.rows);t.render()});$(window).resize(function(){t.resizeCanvas()})}function p(i){var u=t.getCellFromEvent(i),r=n.getItems()[u.row],f=t.getColumns()[u.cell].id;switch(f){case"Delete":d(r);break;case"Stop":k(r);break;case"PlayPause":r.State=="playing"?b(r):w(r)}}function w(n){var t;t=n.Loaded?h(n):tt(n).then(h);t.then(u);c()}function b(n){rt(n).then(u)}function k(n){ut(n).then(it).then(u)}function d(n){nt(n).then(function(){o()})}function e(){var n=new AnalogWebbRest;$("#controlModeType option[value='3']").remove();$("#controlModeType option[value='2']").remove();n.getSimulationControlMode().done(function(n){n.mode==3?$("#controlModeType").append($("<option><\/option>").attr("value",3).text("Legacy")):n.mode==2&&$("#controlModeType").append($("<option><\/option>").attr("value",2).text("Remote"));$("#controlModeType").val(n.mode)}).fail(function(n){i("Failed to get control mode!",n)})}function o(){var u=new AnalogWebbRest;u.getSimulationRecordings().done(function(i){var u=[],f=i.recordings;r={};$.each(f,function(n,t){var i={id:t,Name:t,Loaded:!1,State:"stopped"};u.push(i);r[i.Name]=i});n.beginUpdate();n.setItems(u);t.invalidate();n.endUpdate();g()}).fail(function(n){i("Failed to get recordings",n)})}function g(){var n=new AnalogWebbRest;n.getLoadedSimulationRecordings().done(function(n){var f=n.recordings,i,t;$.each(f,function(n,t){var i=r[t];i&&(i.Loaded=!0,u(i))});for(i in r)t=r[i],t.Loaded?s(t).then(u):u(t)})}function s(n){var t=new AnalogWebbRest;return t.getSimulationRecordingPlaybackState(n.Name).then(function(t){return n.State=t.state,n})}function nt(n){var t=new AnalogWebbRest;return t.deleteSimulationRecording(n.Name).then(function(){return n.Loaded=!1,n.State="stopped",n},function(n){i("Failed to delete recording!",n)})}function tt(n){var t=new AnalogWebbRest;return t.loadSimulationRecording(n.Name).then(function(){return n.Loaded=!0,n},function(n){i("Failed to load recording!",n)})}function it(n){var t=new AnalogWebbRest;return t.unloadSimulationRecording(n.Name).then(function(){return n.Loaded=!1,n.State="stopped",n},function(n){i("Failed to unload recording!",n)})}function h(n){var t=new AnalogWebbRest;return t.playSimulationRecording(n.Name).then(function(){return n.State="playing",n},function(n){i("Failed to play recording!",n)})}function rt(n){var t=new AnalogWebbRest;return t.pauseSimulationRecording(n.Name).then(function(){return n.State="paused",n},function(n){i("Failed to pause recording!",n)})}function ut(n){var t=new AnalogWebbRest;return t.stopSimulationRecording(n.Name).then(function(){return n.State="stopped",n},function(n){i("Failed to stop recording!",n)})}function u(t){n.updateItem(t.Name,t)}function c(){f==null&&(f=setTimeout(ft,1e3))}function ft(){var t=!1,i,n;for(i in r)(n=r[i],n.State=="playing")&&(s(n).then(u),t=!0);f=null;t&&c()}function i(n,t){var r="",u=n,i;t!=undefined&&t.responseText!=undefined&&(i=jQuery.parseJSON(t.responseText),i!=undefined&&i.Reason!=undefined&&i.Reason.length!=0&&(r=i.Reason,i.CodeText!=undefined&&i.CodeText.length!=0&&(r=r+" "+i.CodeText)));r.length!=0&&(u=u+"\r\n"+r);alert(u)}var t,n,r={},f=null;$("#setControlModeButton").click(function(){var n=new AnalogWebbRest,t=$("#controlModeType option:selected").val();$("#setControlModeButton").prop("disabled",!0);n.setSimulationControlMode(t).done(function(){$("#setControlModeButton").prop("disabled",!1);e()}).fail(function(n){$("#setControlModeButton").prop("disabled",!1);i("Failed to set control mode!",n);e()})});$("#uploadRecordingButton").click(function(){$("#recordingFile").click()});$("#recordingFile").change(function(){var t=$("#recordingFile").prop("files")[0],n;t&&(n=new FormData,n.append("file",t),$.ajax({url:"/api/holographic/simulation/playback/file",cache:!1,contentType:!1,processData:!1,data:n,type:"post"}).done(function(){o();$("#fileUpload").get(0).reset()}).fail(function(){i("Failed to upload file!")}))});y();e();o()})