/*!
//@ sourceURL=tools/Location/Location.js
*/
function initMap(){if(typeof Microsoft=="undefined"){setTimeout(initMap,100);return}var n={credentials:bingAppId,center:new Microsoft.Maps.Location(47.733762,-122.146974),mapTypeId:Microsoft.Maps.MapTypeId.road,zoom:defaultZoomLevel,showLogo:!1,showDashboard:!1};map=new Microsoft.Maps.Map(document.getElementById("Map"),n);Microsoft.Maps.Events.addHandler(map,"click",function(n){if(n.targetType=="map"){var t=new Microsoft.Maps.Point(n.getX(),n.getY()),i=n.target.tryPixelToLocation(t);onLocationSelected(i)}});Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",function(){var n={maxResults:4,map:map},t=new Microsoft.Maps.AutosuggestManager(n);t.attachAutosuggest("#locationplugin_suggestion","#locationplugin_suggestionContainer",function(n){onLocationSelected(n.location)})});getOverride()}function ToggleError(n,t,i,r){n.textContent=i;n.style.visibility=r;r==="visible"&&(document.getElementById("wdp-aria-message").innerHTML=i)}function onLocationSelected(n){document.getElementById("locationplugin_latitude").value=n.latitude;document.getElementById("locationplugin_longitude").value=n.longitude;map.entities.clear();pushpin=new Microsoft.Maps.Pushpin(n,null);map.entities.push(pushpin);var t=map.getZoom();t<defaultZoomLevel&&(t=defaultZoomLevel);map.setView({center:n,zoom:t});ToggleError(mainErrorLabel,null,"","hidden")}function getOverride(){$.ajax({url:"/ext/location/override",cache:!1,type:"get"}).done(function(n){var t=n.Override;document.getElementById("overrideToggle").checked=t?!0:!1;ToggleError(mainErrorLabel,null,"","hidden")}).fail(function(){ToggleError(mainErrorLabel,null,"Failed to get the current override mode status.","visible")})}function onOverrideChanged(){var n=document.getElementById("overrideToggle").checked,t=JSON.stringify({Override:n});$.ajax({url:"/ext/location/override",cache:!1,type:"put",data:t,dataType:"json"}).done(function(){ToggleError(mainErrorLabel,null,"","hidden")}).fail(function(){ToggleError(mainErrorLabel,null,"Failed to enable override mode.","visible")})}function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n)}function onPositionOverride(){var r=!1,u=document.getElementById("locationplugin_latitude"),n=u.value,e=document.getElementById("latitudeErrorLabel"),s,i,h;n==null||n==""||!isNumeric(n)||n>90||n<-90?(ToggleError(e,u,"Invalid latitude value.","visible"),r=!0):ToggleError(e,u,"","hidden");var f=document.getElementById("locationplugin_longitude"),t=f.value,o=document.getElementById("longitudeErrorLabel");(t==null||t==""||!isNumeric(t)||t>180||t<-180?(ToggleError(o,f,"Invalid longitude value.","visible"),r=!0):ToggleError(o,f,"","hidden"),r!=!0)&&(s=new Microsoft.Maps.Location(n,t),i=map.getZoom(),i<defaultZoomLevel&&(i=defaultZoomLevel),map.setView({center:s,zoom:i}),h=JSON.stringify({Latitude:parseFloat(n),Longitude:parseFloat(t)}),$.ajax({url:"/ext/location/position",cache:!1,type:"put",data:h,dataType:"json"}).done(function(){ToggleError(mainErrorLabel,null,"","hidden");document.getElementById("wdp-aria-message").innerHTML="Successfully set latitude and longitude"}).fail(function(){ToggleError(mainErrorLabel,null,"Failed to set location in test mode.","visible")}))}var bingAppId="AluoavifO5ISA3Imj0b1l3o1Au6Uurg9zqozXeJqHhu7iKOQ0befrye3tVlVdMvH",defaultZoomLevel=10,pushpin=null,map=null,mainErrorLabel=document.getElementById("mainErrorLabel")